const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/GanttChart-C0OHqhYR.js","assets/vendor-react-D_9RvGEK.js","assets/vendor-react-query-C-U1ibBl.js"])))=>i.map(i=>d[i]);
import{R as N,a as Sh,b as xh,c as Eh,g as co,_ as W,d as Fc,t as Th,e as ki,r as _,j as h,S as Rh,L as Nt,u as Oh,f as qo,h as Ch,i as kh,k as Dh,l as Nh,m as Ah,T as Ih,n as Mh,I as Ph,F as jh,P as Lh,C as $h,o as Fh,p as Uh,q as Hh,s as Bh,H as zh,v as Wh,w as qh,x as Vh,y as Gh,z as Kh,A as Yh,B as Xh,D as Di,E as gr,G as Ni,J as mr,K as Lt,M as C,N as Uc,O as Xe,Q as en,U as xt,V as Ai,W as In,X as us,Y as Qh,Z as uo,$ as ho,a0 as Hc,a1 as Er,a2 as Bc,a3 as zc,a4 as Wc,a5 as rs,a6 as Vo,a7 as qc,a8 as Rr,a9 as hs,aa as Vc,ab as Gc,ac as Kt,ad as ri,ae as Kc,af as Yc,ag as Xc,ah as Qc,ai as ns,aj as Jh,ak as fo,al as Zh,am as Jc,an as go,ao as ef,ap as Zc,aq as Go,ar as tf,as as ui,at as ed,au as fs,av as td,aw as Na,ax as rd,ay as nd,az as Ii,aA as rf,aB as jn,aC as mo,aD as nf,aE as sf,aF as af,aG as Aa,aH as of,aI as po,aJ as lf,aK as cf,aL as df,aM as hi,aN as En,aO as Mn,aP as uf,aQ as hf,aR as ff,aS as gf,aT as mf,aU as pf,aV as bf,aW as yf,aX as vf,aY as Tt,aZ as wf,a_ as _f,a$ as Sf,b0 as xf,b1 as Ef,b2 as Tf,b3 as an,b4 as Mi,b5 as bo,b6 as Rf,b7 as yo,b8 as vo,b9 as Of,ba as Ia,bb as sd,bc as tn,bd as id,be as ad,bf as ni,bg as si,bh as Cf,bi as od,bj as ea,bk as kf,bl as Df,bm as Nf,bn as ld,bo as Af,bp as If,bq as Mf,br as Pf,bs as jf,bt as Lf,bu as cd,bv as wo,bw as $f,bx as Ff,by as Uf,bz as Hf,bA as Bf,bB as zf,bC as Wf,bD as qf,bE as Zn,bF as Vf,bG as Gf,bH as Kf,bI as Yf,bJ as Xf,bK as Qf,bL as Jf,bM as Zf,bN as eg,bO as tg,bP as rg,bQ as ng,bR as dd,bS as ud,bT as sg,bU as ot,bV as ig,bW as ag}from"./vendor-react-D_9RvGEK.js";import{u as Ye,a as St,b as Vt,Q as og,c as lg}from"./vendor-react-query-C-U1ibBl.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();function cg(r){if(typeof document>"u")return;let e=document.head||document.getElementsByTagName("head")[0],t=document.createElement("style");t.type="text/css",e.appendChild(t),t.styleSheet?t.styleSheet.cssText=r:t.appendChild(document.createTextNode(r))}const dg=r=>{switch(r){case"success":return fg;case"info":return mg;case"warning":return gg;case"error":return pg;default:return null}},ug=Array(12).fill(0),hg=({visible:r,className:e})=>N.createElement("div",{className:["sonner-loading-wrapper",e].filter(Boolean).join(" "),"data-visible":r},N.createElement("div",{className:"sonner-spinner"},ug.map((t,n)=>N.createElement("div",{className:"sonner-loading-bar",key:`spinner-bar-${n}`})))),fg=N.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},N.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})),gg=N.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",height:"20",width:"20"},N.createElement("path",{fillRule:"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z",clipRule:"evenodd"})),mg=N.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},N.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z",clipRule:"evenodd"})),pg=N.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},N.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})),bg=N.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},N.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),N.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"})),yg=()=>{const[r,e]=N.useState(document.hidden);return N.useEffect(()=>{const t=()=>{e(document.hidden)};return document.addEventListener("visibilitychange",t),()=>window.removeEventListener("visibilitychange",t)},[]),r};let Ma=1,vg=class{constructor(){this.subscribe=e=>(this.subscribers.push(e),()=>{const t=this.subscribers.indexOf(e);this.subscribers.splice(t,1)}),this.publish=e=>{this.subscribers.forEach(t=>t(e))},this.addToast=e=>{this.publish(e),this.toasts=[...this.toasts,e]},this.create=e=>{var t;const{message:n,...s}=e,i=typeof e?.id=="number"||((t=e.id)==null?void 0:t.length)>0?e.id:Ma++,a=this.toasts.find(l=>l.id===i),o=e.dismissible===void 0?!0:e.dismissible;return this.dismissedToasts.has(i)&&this.dismissedToasts.delete(i),a?this.toasts=this.toasts.map(l=>l.id===i?(this.publish({...l,...e,id:i,title:n}),{...l,...e,id:i,dismissible:o,title:n}):l):this.addToast({title:n,...s,dismissible:o,id:i}),i},this.dismiss=e=>(e?(this.dismissedToasts.add(e),requestAnimationFrame(()=>this.subscribers.forEach(t=>t({id:e,dismiss:!0})))):this.toasts.forEach(t=>{this.subscribers.forEach(n=>n({id:t.id,dismiss:!0}))}),e),this.message=(e,t)=>this.create({...t,message:e}),this.error=(e,t)=>this.create({...t,message:e,type:"error"}),this.success=(e,t)=>this.create({...t,type:"success",message:e}),this.info=(e,t)=>this.create({...t,type:"info",message:e}),this.warning=(e,t)=>this.create({...t,type:"warning",message:e}),this.loading=(e,t)=>this.create({...t,type:"loading",message:e}),this.promise=(e,t)=>{if(!t)return;let n;t.loading!==void 0&&(n=this.create({...t,promise:e,type:"loading",message:t.loading,description:typeof t.description!="function"?t.description:void 0}));const s=Promise.resolve(e instanceof Function?e():e);let i=n!==void 0,a;const o=s.then(async c=>{if(a=["resolve",c],N.isValidElement(c))i=!1,this.create({id:n,type:"default",message:c});else if(_g(c)&&!c.ok){i=!1;const u=typeof t.error=="function"?await t.error(`HTTP error! status: ${c.status}`):t.error,f=typeof t.description=="function"?await t.description(`HTTP error! status: ${c.status}`):t.description,b=typeof u=="object"&&!N.isValidElement(u)?u:{message:u};this.create({id:n,type:"error",description:f,...b})}else if(c instanceof Error){i=!1;const u=typeof t.error=="function"?await t.error(c):t.error,f=typeof t.description=="function"?await t.description(c):t.description,b=typeof u=="object"&&!N.isValidElement(u)?u:{message:u};this.create({id:n,type:"error",description:f,...b})}else if(t.success!==void 0){i=!1;const u=typeof t.success=="function"?await t.success(c):t.success,f=typeof t.description=="function"?await t.description(c):t.description,b=typeof u=="object"&&!N.isValidElement(u)?u:{message:u};this.create({id:n,type:"success",description:f,...b})}}).catch(async c=>{if(a=["reject",c],t.error!==void 0){i=!1;const d=typeof t.error=="function"?await t.error(c):t.error,u=typeof t.description=="function"?await t.description(c):t.description,g=typeof d=="object"&&!N.isValidElement(d)?d:{message:d};this.create({id:n,type:"error",description:u,...g})}}).finally(()=>{i&&(this.dismiss(n),n=void 0),t.finally==null||t.finally.call(t)}),l=()=>new Promise((c,d)=>o.then(()=>a[0]==="reject"?d(a[1]):c(a[1])).catch(d));return typeof n!="string"&&typeof n!="number"?{unwrap:l}:Object.assign(n,{unwrap:l})},this.custom=(e,t)=>{const n=t?.id||Ma++;return this.create({jsx:e(n),id:n,...t}),n},this.getActiveToasts=()=>this.toasts.filter(e=>!this.dismissedToasts.has(e.id)),this.subscribers=[],this.toasts=[],this.dismissedToasts=new Set}};const Dt=new vg,wg=(r,e)=>{const t=e?.id||Ma++;return Dt.addToast({title:r,...e,id:t}),t},_g=r=>r&&typeof r=="object"&&"ok"in r&&typeof r.ok=="boolean"&&"status"in r&&typeof r.status=="number",Sg=wg,xg=()=>Dt.toasts,Eg=()=>Dt.getActiveToasts();Object.assign(Sg,{success:Dt.success,info:Dt.info,warning:Dt.warning,error:Dt.error,custom:Dt.custom,message:Dt.message,promise:Dt.promise,dismiss:Dt.dismiss,loading:Dt.loading},{getHistory:xg,getToasts:Eg});cg("[data-sonner-toaster][dir=ltr],html[dir=ltr]{--toast-icon-margin-start:-3px;--toast-icon-margin-end:4px;--toast-svg-margin-start:-1px;--toast-svg-margin-end:0px;--toast-button-margin-start:auto;--toast-button-margin-end:0;--toast-close-button-start:0;--toast-close-button-end:unset;--toast-close-button-transform:translate(-35%, -35%)}[data-sonner-toaster][dir=rtl],html[dir=rtl]{--toast-icon-margin-start:4px;--toast-icon-margin-end:-3px;--toast-svg-margin-start:0px;--toast-svg-margin-end:-1px;--toast-button-margin-start:0;--toast-button-margin-end:auto;--toast-close-button-start:unset;--toast-close-button-end:0;--toast-close-button-transform:translate(35%, -35%)}[data-sonner-toaster]{position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1:hsl(0, 0%, 99%);--gray2:hsl(0, 0%, 97.3%);--gray3:hsl(0, 0%, 95.1%);--gray4:hsl(0, 0%, 93%);--gray5:hsl(0, 0%, 90.9%);--gray6:hsl(0, 0%, 88.7%);--gray7:hsl(0, 0%, 85.8%);--gray8:hsl(0, 0%, 78%);--gray9:hsl(0, 0%, 56.1%);--gray10:hsl(0, 0%, 52.3%);--gray11:hsl(0, 0%, 43.5%);--gray12:hsl(0, 0%, 9%);--border-radius:8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:0;z-index:999999999;transition:transform .4s ease}@media (hover:none) and (pointer:coarse){[data-sonner-toaster][data-lifted=true]{transform:none}}[data-sonner-toaster][data-x-position=right]{right:var(--offset-right)}[data-sonner-toaster][data-x-position=left]{left:var(--offset-left)}[data-sonner-toaster][data-x-position=center]{left:50%;transform:translateX(-50%)}[data-sonner-toaster][data-y-position=top]{top:var(--offset-top)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--offset-bottom)}[data-sonner-toast]{--y:translateY(100%);--lift-amount:calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:0;overflow-wrap:anywhere}[data-sonner-toast][data-styled=true]{padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px rgba(0,0,0,.1);width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}[data-sonner-toast]:focus-visible{box-shadow:0 4px 12px rgba(0,0,0,.1),0 0 0 2px rgba(0,0,0,.2)}[data-sonner-toast][data-y-position=top]{top:0;--y:translateY(-100%);--lift:1;--lift-amount:calc(1 * var(--gap))}[data-sonner-toast][data-y-position=bottom]{bottom:0;--y:translateY(100%);--lift:-1;--lift-amount:calc(var(--lift) * var(--gap))}[data-sonner-toast][data-styled=true] [data-description]{font-weight:400;line-height:1.4;color:#3f3f3f}[data-rich-colors=true][data-sonner-toast][data-styled=true] [data-description]{color:inherit}[data-sonner-toaster][data-sonner-theme=dark] [data-description]{color:#e8e8e8}[data-sonner-toast][data-styled=true] [data-title]{font-weight:500;line-height:1.5;color:inherit}[data-sonner-toast][data-styled=true] [data-icon]{display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}[data-sonner-toast][data-promise=true] [data-icon]>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}[data-sonner-toast][data-styled=true] [data-icon]>*{flex-shrink:0}[data-sonner-toast][data-styled=true] [data-icon] svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}[data-sonner-toast][data-styled=true] [data-content]{display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;font-weight:500;cursor:pointer;outline:0;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}[data-sonner-toast][data-styled=true] [data-button]:focus-visible{box-shadow:0 0 0 2px rgba(0,0,0,.4)}[data-sonner-toast][data-styled=true] [data-button]:first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}[data-sonner-toast][data-styled=true] [data-cancel]{color:var(--normal-text);background:rgba(0,0,0,.08)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast][data-styled=true] [data-cancel]{background:rgba(255,255,255,.3)}[data-sonner-toast][data-styled=true] [data-close-button]{position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;color:var(--gray12);background:var(--normal-bg);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}[data-sonner-toast][data-styled=true] [data-close-button]:focus-visible{box-shadow:0 4px 12px rgba(0,0,0,.1),0 0 0 2px rgba(0,0,0,.2)}[data-sonner-toast][data-styled=true] [data-disabled=true]{cursor:not-allowed}[data-sonner-toast][data-styled=true]:hover [data-close-button]:hover{background:var(--gray2);border-color:var(--gray5)}[data-sonner-toast][data-swiping=true]::before{content:'';position:absolute;left:-100%;right:-100%;height:100%;z-index:-1}[data-sonner-toast][data-y-position=top][data-swiping=true]::before{bottom:50%;transform:scaleY(3) translateY(50%)}[data-sonner-toast][data-y-position=bottom][data-swiping=true]::before{top:50%;transform:scaleY(3) translateY(-50%)}[data-sonner-toast][data-swiping=false][data-removed=true]::before{content:'';position:absolute;inset:0;transform:scaleY(2)}[data-sonner-toast][data-expanded=true]::after{content:'';position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}[data-sonner-toast][data-mounted=true]{--y:translateY(0);opacity:1}[data-sonner-toast][data-expanded=false][data-front=false]{--scale:var(--toasts-before) * 0.05 + 1;--y:translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}[data-sonner-toast]>*{transition:opacity .4s}[data-sonner-toast][data-x-position=right]{right:0}[data-sonner-toast][data-x-position=left]{left:0}[data-sonner-toast][data-expanded=false][data-front=false][data-styled=true]>*{opacity:0}[data-sonner-toast][data-visible=false]{opacity:0;pointer-events:none}[data-sonner-toast][data-mounted=true][data-expanded=true]{--y:translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}[data-sonner-toast][data-removed=true][data-front=true][data-swipe-out=false]{--y:translateY(calc(var(--lift) * -100%));opacity:0}[data-sonner-toast][data-removed=true][data-front=false][data-swipe-out=false][data-expanded=true]{--y:translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}[data-sonner-toast][data-removed=true][data-front=false][data-swipe-out=false][data-expanded=false]{--y:translateY(40%);opacity:0;transition:transform .5s,opacity .2s}[data-sonner-toast][data-removed=true][data-front=false]::before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount-y,0)) translateX(var(--swipe-amount-x,0));transition:none}[data-sonner-toast][data-swiped=true]{user-select:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation-duration:.2s;animation-timing-function:ease-out;animation-fill-mode:forwards}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=left]{animation-name:swipe-out-left}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=right]{animation-name:swipe-out-right}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=up]{animation-name:swipe-out-up}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=down]{animation-name:swipe-out-down}@keyframes swipe-out-left{from{transform:var(--y) translateX(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translateX(calc(var(--swipe-amount-x) - 100%));opacity:0}}@keyframes swipe-out-right{from{transform:var(--y) translateX(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translateX(calc(var(--swipe-amount-x) + 100%));opacity:0}}@keyframes swipe-out-up{from{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) - 100%));opacity:0}}@keyframes swipe-out-down{from{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) + 100%));opacity:0}}@media (max-width:600px){[data-sonner-toaster]{position:fixed;right:var(--mobile-offset-right);left:var(--mobile-offset-left);width:100%}[data-sonner-toaster][dir=rtl]{left:calc(var(--mobile-offset-left) * -1)}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset-left) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset-left)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--mobile-offset-bottom)}[data-sonner-toaster][data-y-position=top]{top:var(--mobile-offset-top)}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset-left);right:var(--mobile-offset-right);transform:none}}[data-sonner-toaster][data-sonner-theme=light]{--normal-bg:#fff;--normal-border:var(--gray4);--normal-text:var(--gray12);--success-bg:hsl(143, 85%, 96%);--success-border:hsl(145, 92%, 87%);--success-text:hsl(140, 100%, 27%);--info-bg:hsl(208, 100%, 97%);--info-border:hsl(221, 91%, 93%);--info-text:hsl(210, 92%, 45%);--warning-bg:hsl(49, 100%, 97%);--warning-border:hsl(49, 91%, 84%);--warning-text:hsl(31, 92%, 45%);--error-bg:hsl(359, 100%, 97%);--error-border:hsl(359, 100%, 94%);--error-text:hsl(360, 100%, 45%)}[data-sonner-toaster][data-sonner-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg:#000;--normal-border:hsl(0, 0%, 20%);--normal-text:var(--gray1)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg:#fff;--normal-border:var(--gray3);--normal-text:var(--gray12)}[data-sonner-toaster][data-sonner-theme=dark]{--normal-bg:#000;--normal-bg-hover:hsl(0, 0%, 12%);--normal-border:hsl(0, 0%, 20%);--normal-border-hover:hsl(0, 0%, 25%);--normal-text:var(--gray1);--success-bg:hsl(150, 100%, 6%);--success-border:hsl(147, 100%, 12%);--success-text:hsl(150, 86%, 65%);--info-bg:hsl(215, 100%, 6%);--info-border:hsl(223, 43%, 17%);--info-text:hsl(216, 87%, 65%);--warning-bg:hsl(64, 100%, 6%);--warning-border:hsl(60, 100%, 9%);--warning-text:hsl(46, 87%, 65%);--error-bg:hsl(358, 76%, 10%);--error-border:hsl(357, 89%, 16%);--error-text:hsl(358, 100%, 81%)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast] [data-close-button]{background:var(--normal-bg);border-color:var(--normal-border);color:var(--normal-text)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast] [data-close-button]:hover{background:var(--normal-bg-hover);border-color:var(--normal-border-hover)}[data-rich-colors=true][data-sonner-toast][data-type=success]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size:16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:first-child{animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}100%{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}100%{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}100%{opacity:.15}}@media (prefers-reduced-motion){.sonner-loading-bar,[data-sonner-toast],[data-sonner-toast]>*{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}");function Ms(r){return r.label!==void 0}const Tg=3,Rg="24px",Og="16px",Ko=4e3,Cg=356,kg=14,Dg=45,Ng=200;function ar(...r){return r.filter(Boolean).join(" ")}function Ag(r){const[e,t]=r.split("-"),n=[];return e&&n.push(e),t&&n.push(t),n}const Ig=r=>{var e,t,n,s,i,a,o,l,c;const{invert:d,toast:u,unstyled:f,interacting:g,setHeights:b,visibleToasts:m,heights:y,index:v,toasts:p,expanded:w,removeToast:S,defaultRichColors:x,closeButton:E,style:T,cancelButtonStyle:R,actionButtonStyle:k,className:O="",descriptionClassName:D="",duration:A,position:P,gap:Q,expandByDefault:he,classNames:H,icons:J,closeButtonAriaLabel:Oe="Close toast"}=r,[L,Z]=N.useState(null),[ee,Le]=N.useState(null),[G,F]=N.useState(!1),[V,q]=N.useState(!1),[fe,B]=N.useState(!1),[Ae,Ce]=N.useState(!1),[vt,Ze]=N.useState(!1),[kr,U]=N.useState(0),[ie,ke]=N.useState(0),Be=N.useRef(u.duration||A||Ko),ft=N.useRef(null),we=N.useRef(null),K=v===0,He=v+1<=m,I=u.type,j=u.dismissible!==!1,_e=u.className||"",re=u.descriptionClassName||"",Y=N.useMemo(()=>y.findIndex($=>$.toastId===u.id)||0,[y,u.id]),ae=N.useMemo(()=>{var $;return($=u.closeButton)!=null?$:E},[u.closeButton,E]),z=N.useMemo(()=>u.duration||A||Ko,[u.duration,A]),me=N.useRef(0),xe=N.useRef(0),pe=N.useRef(0),ce=N.useRef(null),[nr,Xt]=P.split("-"),de=N.useMemo(()=>y.reduce(($,oe,be)=>be>=Y?$:$+oe.height,0),[y,Y]),et=yg(),gt=u.invert||d,ue=I==="loading";xe.current=N.useMemo(()=>Y*Q+de,[Y,de]),N.useEffect(()=>{Be.current=z},[z]),N.useEffect(()=>{F(!0)},[]),N.useEffect(()=>{const $=we.current;if($){const oe=$.getBoundingClientRect().height;return ke(oe),b(be=>[{toastId:u.id,height:oe,position:u.position},...be]),()=>b(be=>be.filter(Ee=>Ee.toastId!==u.id))}},[b,u.id]),N.useLayoutEffect(()=>{if(!G)return;const $=we.current,oe=$.style.height;$.style.height="auto";const be=$.getBoundingClientRect().height;$.style.height=oe,ke(be),b(Ee=>Ee.find(Ie=>Ie.toastId===u.id)?Ee.map(Ie=>Ie.toastId===u.id?{...Ie,height:be}:Ie):[{toastId:u.id,height:be,position:u.position},...Ee])},[G,u.title,u.description,b,u.id,u.jsx,u.action,u.cancel]);const Se=N.useCallback(()=>{q(!0),U(xe.current),b($=>$.filter(oe=>oe.toastId!==u.id)),setTimeout(()=>{S(u)},Ng)},[u,S,b,xe]);N.useEffect(()=>{if(u.promise&&I==="loading"||u.duration===1/0||u.type==="loading")return;let $;return w||g||et?(()=>{if(pe.current<me.current){const Ee=new Date().getTime()-me.current;Be.current=Be.current-Ee}pe.current=new Date().getTime()})():(()=>{Be.current!==1/0&&(me.current=new Date().getTime(),$=setTimeout(()=>{u.onAutoClose==null||u.onAutoClose.call(u,u),Se()},Be.current))})(),()=>clearTimeout($)},[w,g,u,I,et,Se]),N.useEffect(()=>{u.delete&&(Se(),u.onDismiss==null||u.onDismiss.call(u,u))},[Se,u.delete]);function sr(){var $;if(J?.loading){var oe;return N.createElement("div",{className:ar(H?.loader,u==null||(oe=u.classNames)==null?void 0:oe.loader,"sonner-loader"),"data-visible":I==="loading"},J.loading)}return N.createElement(hg,{className:ar(H?.loader,u==null||($=u.classNames)==null?void 0:$.loader),visible:I==="loading"})}const ir=u.icon||J?.[I]||dg(I);var Pe,it;return N.createElement("li",{tabIndex:0,ref:we,className:ar(O,_e,H?.toast,u==null||(e=u.classNames)==null?void 0:e.toast,H?.default,H?.[I],u==null||(t=u.classNames)==null?void 0:t[I]),"data-sonner-toast":"","data-rich-colors":(Pe=u.richColors)!=null?Pe:x,"data-styled":!(u.jsx||u.unstyled||f),"data-mounted":G,"data-promise":!!u.promise,"data-swiped":vt,"data-removed":V,"data-visible":He,"data-y-position":nr,"data-x-position":Xt,"data-index":v,"data-front":K,"data-swiping":fe,"data-dismissible":j,"data-type":I,"data-invert":gt,"data-swipe-out":Ae,"data-swipe-direction":ee,"data-expanded":!!(w||he&&G),"data-testid":u.testId,style:{"--index":v,"--toasts-before":v,"--z-index":p.length-v,"--offset":`${V?kr:xe.current}px`,"--initial-height":he?"auto":`${ie}px`,...T,...u.style},onDragEnd:()=>{B(!1),Z(null),ce.current=null},onPointerDown:$=>{$.button!==2&&(ue||!j||(ft.current=new Date,U(xe.current),$.target.setPointerCapture($.pointerId),$.target.tagName!=="BUTTON"&&(B(!0),ce.current={x:$.clientX,y:$.clientY})))},onPointerUp:()=>{var $,oe,be;if(Ae||!j)return;ce.current=null;const Ee=Number((($=we.current)==null?void 0:$.style.getPropertyValue("--swipe-amount-x").replace("px",""))||0),at=Number(((oe=we.current)==null?void 0:oe.style.getPropertyValue("--swipe-amount-y").replace("px",""))||0),Ie=new Date().getTime()-((be=ft.current)==null?void 0:be.getTime()),le=L==="x"?Ee:at,mt=Math.abs(le)/Ie;if(Math.abs(le)>=Dg||mt>.11){U(xe.current),u.onDismiss==null||u.onDismiss.call(u,u),Le(L==="x"?Ee>0?"right":"left":at>0?"down":"up"),Se(),Ce(!0);return}else{var Ke,Qe;(Ke=we.current)==null||Ke.style.setProperty("--swipe-amount-x","0px"),(Qe=we.current)==null||Qe.style.setProperty("--swipe-amount-y","0px")}Ze(!1),B(!1),Z(null)},onPointerMove:$=>{var oe,be,Ee;if(!ce.current||!j||((oe=window.getSelection())==null?void 0:oe.toString().length)>0)return;const Ie=$.clientY-ce.current.y,le=$.clientX-ce.current.x;var mt;const Ke=(mt=r.swipeDirections)!=null?mt:Ag(P);!L&&(Math.abs(le)>1||Math.abs(Ie)>1)&&Z(Math.abs(le)>Math.abs(Ie)?"x":"y");let Qe={x:0,y:0};const Dr=It=>1/(1.5+Math.abs(It)/20);if(L==="y"){if(Ke.includes("top")||Ke.includes("bottom"))if(Ke.includes("top")&&Ie<0||Ke.includes("bottom")&&Ie>0)Qe.y=Ie;else{const It=Ie*Dr(Ie);Qe.y=Math.abs(It)<Math.abs(Ie)?It:Ie}}else if(L==="x"&&(Ke.includes("left")||Ke.includes("right")))if(Ke.includes("left")&&le<0||Ke.includes("right")&&le>0)Qe.x=le;else{const It=le*Dr(le);Qe.x=Math.abs(It)<Math.abs(le)?It:le}(Math.abs(Qe.x)>0||Math.abs(Qe.y)>0)&&Ze(!0),(be=we.current)==null||be.style.setProperty("--swipe-amount-x",`${Qe.x}px`),(Ee=we.current)==null||Ee.style.setProperty("--swipe-amount-y",`${Qe.y}px`)}},ae&&!u.jsx&&I!=="loading"?N.createElement("button",{"aria-label":Oe,"data-disabled":ue,"data-close-button":!0,onClick:ue||!j?()=>{}:()=>{Se(),u.onDismiss==null||u.onDismiss.call(u,u)},className:ar(H?.closeButton,u==null||(n=u.classNames)==null?void 0:n.closeButton)},(it=J?.close)!=null?it:bg):null,(I||u.icon||u.promise)&&u.icon!==null&&(J?.[I]!==null||u.icon)?N.createElement("div",{"data-icon":"",className:ar(H?.icon,u==null||(s=u.classNames)==null?void 0:s.icon)},u.promise||u.type==="loading"&&!u.icon?u.icon||sr():null,u.type!=="loading"?ir:null):null,N.createElement("div",{"data-content":"",className:ar(H?.content,u==null||(i=u.classNames)==null?void 0:i.content)},N.createElement("div",{"data-title":"",className:ar(H?.title,u==null||(a=u.classNames)==null?void 0:a.title)},u.jsx?u.jsx:typeof u.title=="function"?u.title():u.title),u.description?N.createElement("div",{"data-description":"",className:ar(D,re,H?.description,u==null||(o=u.classNames)==null?void 0:o.description)},typeof u.description=="function"?u.description():u.description):null),N.isValidElement(u.cancel)?u.cancel:u.cancel&&Ms(u.cancel)?N.createElement("button",{"data-button":!0,"data-cancel":!0,style:u.cancelButtonStyle||R,onClick:$=>{Ms(u.cancel)&&j&&(u.cancel.onClick==null||u.cancel.onClick.call(u.cancel,$),Se())},className:ar(H?.cancelButton,u==null||(l=u.classNames)==null?void 0:l.cancelButton)},u.cancel.label):null,N.isValidElement(u.action)?u.action:u.action&&Ms(u.action)?N.createElement("button",{"data-button":!0,"data-action":!0,style:u.actionButtonStyle||k,onClick:$=>{Ms(u.action)&&(u.action.onClick==null||u.action.onClick.call(u.action,$),!$.defaultPrevented&&Se())},className:ar(H?.actionButton,u==null||(c=u.classNames)==null?void 0:c.actionButton)},u.action.label):null)};function Yo(){if(typeof window>"u"||typeof document>"u")return"ltr";const r=document.documentElement.getAttribute("dir");return r==="auto"||!r?window.getComputedStyle(document.documentElement).direction:r}function Mg(r,e){const t={};return[r,e].forEach((n,s)=>{const i=s===1,a=i?"--mobile-offset":"--offset",o=i?Og:Rg;function l(c){["top","right","bottom","left"].forEach(d=>{t[`${a}-${d}`]=typeof c=="number"?`${c}px`:c})}typeof n=="number"||typeof n=="string"?l(n):typeof n=="object"?["top","right","bottom","left"].forEach(c=>{n[c]===void 0?t[`${a}-${c}`]=o:t[`${a}-${c}`]=typeof n[c]=="number"?`${n[c]}px`:n[c]}):l(o)}),t}const Pg=N.forwardRef(function(e,t){const{id:n,invert:s,position:i="bottom-right",hotkey:a=["altKey","KeyT"],expand:o,closeButton:l,className:c,offset:d,mobileOffset:u,theme:f="light",richColors:g,duration:b,style:m,visibleToasts:y=Tg,toastOptions:v,dir:p=Yo(),gap:w=kg,icons:S,containerAriaLabel:x="Notifications"}=e,[E,T]=N.useState([]),R=N.useMemo(()=>n?E.filter(G=>G.toasterId===n):E.filter(G=>!G.toasterId),[E,n]),k=N.useMemo(()=>Array.from(new Set([i].concat(R.filter(G=>G.position).map(G=>G.position)))),[R,i]),[O,D]=N.useState([]),[A,P]=N.useState(!1),[Q,he]=N.useState(!1),[H,J]=N.useState(f!=="system"?f:typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),Oe=N.useRef(null),L=a.join("+").replace(/Key/g,"").replace(/Digit/g,""),Z=N.useRef(null),ee=N.useRef(!1),Le=N.useCallback(G=>{T(F=>{var V;return(V=F.find(q=>q.id===G.id))!=null&&V.delete||Dt.dismiss(G.id),F.filter(({id:q})=>q!==G.id)})},[]);return N.useEffect(()=>Dt.subscribe(G=>{if(G.dismiss){requestAnimationFrame(()=>{T(F=>F.map(V=>V.id===G.id?{...V,delete:!0}:V))});return}setTimeout(()=>{Sh.flushSync(()=>{T(F=>{const V=F.findIndex(q=>q.id===G.id);return V!==-1?[...F.slice(0,V),{...F[V],...G},...F.slice(V+1)]:[G,...F]})})})}),[E]),N.useEffect(()=>{if(f!=="system"){J(f);return}if(f==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?J("dark"):J("light")),typeof window>"u")return;const G=window.matchMedia("(prefers-color-scheme: dark)");try{G.addEventListener("change",({matches:F})=>{J(F?"dark":"light")})}catch{G.addListener(({matches:V})=>{try{J(V?"dark":"light")}catch(q){console.error(q)}})}},[f]),N.useEffect(()=>{E.length<=1&&P(!1)},[E]),N.useEffect(()=>{const G=F=>{var V;if(a.every(B=>F[B]||F.code===B)){var fe;P(!0),(fe=Oe.current)==null||fe.focus()}F.code==="Escape"&&(document.activeElement===Oe.current||(V=Oe.current)!=null&&V.contains(document.activeElement))&&P(!1)};return document.addEventListener("keydown",G),()=>document.removeEventListener("keydown",G)},[a]),N.useEffect(()=>{if(Oe.current)return()=>{Z.current&&(Z.current.focus({preventScroll:!0}),Z.current=null,ee.current=!1)}},[Oe.current]),N.createElement("section",{ref:t,"aria-label":`${x} ${L}`,tabIndex:-1,"aria-live":"polite","aria-relevant":"additions text","aria-atomic":"false",suppressHydrationWarning:!0},k.map((G,F)=>{var V;const[q,fe]=G.split("-");return R.length?N.createElement("ol",{key:G,dir:p==="auto"?Yo():p,tabIndex:-1,ref:Oe,className:c,"data-sonner-toaster":!0,"data-sonner-theme":H,"data-y-position":q,"data-x-position":fe,style:{"--front-toast-height":`${((V=O[0])==null?void 0:V.height)||0}px`,"--width":`${Cg}px`,"--gap":`${w}px`,...m,...Mg(d,u)},onBlur:B=>{ee.current&&!B.currentTarget.contains(B.relatedTarget)&&(ee.current=!1,Z.current&&(Z.current.focus({preventScroll:!0}),Z.current=null))},onFocus:B=>{B.target instanceof HTMLElement&&B.target.dataset.dismissible==="false"||ee.current||(ee.current=!0,Z.current=B.relatedTarget)},onMouseEnter:()=>P(!0),onMouseMove:()=>P(!0),onMouseLeave:()=>{Q||P(!1)},onDragEnd:()=>P(!1),onPointerDown:B=>{B.target instanceof HTMLElement&&B.target.dataset.dismissible==="false"||he(!0)},onPointerUp:()=>he(!1)},R.filter(B=>!B.position&&F===0||B.position===G).map((B,Ae)=>{var Ce,vt;return N.createElement(Ig,{key:B.id,icons:S,index:Ae,toast:B,defaultRichColors:g,duration:(Ce=v?.duration)!=null?Ce:b,className:v?.className,descriptionClassName:v?.descriptionClassName,invert:s,visibleToasts:y,closeButton:(vt=v?.closeButton)!=null?vt:l,interacting:Q,position:G,style:v?.style,unstyled:v?.unstyled,classNames:v?.classNames,cancelButtonStyle:v?.cancelButtonStyle,actionButtonStyle:v?.actionButtonStyle,closeButtonAriaLabel:v?.closeButtonAriaLabel,removeToast:Le,toasts:R.filter(Ze=>Ze.position==B.position),heights:O.filter(Ze=>Ze.position==B.position),setHeights:D,expandByDefault:o,gap:w,expanded:A,swipeDirections:e.swipeDirections})})):null}))});var Xo={END_DATE_BEFORE_START:"End date cannot be before start date",END_TIME_BEFORE_START:"End time must be after start time when dates are the same"},Ps={VALIDATION_ERROR:"VALIDATION_ERROR",NETWORK_ERROR:"NETWORK_ERROR",SERVER_ERROR:"SERVER_ERROR",AUTHENTICATION_ERROR:"AUTHENTICATION_ERROR"},Qo={PAGE_SIZE:10,PAGE_SIZE_OPTIONS:[10,25,50,100]},We={PRINTING:"STAMPA",PACKAGING:"CONFEZIONAMENTO"},ve={ZANICA:"ZANICA",BUSTO_GAROLFO:"BUSTO_GAROLFO",BOTH:"BOTH"},_r={ACTIVE:"ACTIVE",INACTIVE:"INACTIVE"},hn={CREMA:"CREMA",LIQUIDO:"LIQUIDO",POLVERI:"POLVERI"},fn={T1:"T1",T2:"T2",T3:"T3"};function hd(r){var e,t,n="";if(typeof r=="string"||typeof r=="number")n+=r;else if(typeof r=="object")if(Array.isArray(r)){var s=r.length;for(e=0;e<s;e++)r[e]&&(t=hd(r[e]))&&(n&&(n+=" "),n+=t)}else for(t in r)r[t]&&(n&&(n+=" "),n+=t);return n}function fd(){for(var r,e,t=0,n="",s=arguments.length;t<s;t++)(r=arguments[t])&&(e=hd(r))&&(n&&(n+=" "),n+=e);return n}const _o="-",jg=r=>{const e=$g(r),{conflictingClassGroups:t,conflictingClassGroupModifiers:n}=r;return{getClassGroupId:a=>{const o=a.split(_o);return o[0]===""&&o.length!==1&&o.shift(),gd(o,e)||Lg(a)},getConflictingClassGroupIds:(a,o)=>{const l=t[a]||[];return o&&n[a]?[...l,...n[a]]:l}}},gd=(r,e)=>{if(r.length===0)return e.classGroupId;const t=r[0],n=e.nextPart.get(t),s=n?gd(r.slice(1),n):void 0;if(s)return s;if(e.validators.length===0)return;const i=r.join(_o);return e.validators.find(({validator:a})=>a(i))?.classGroupId},Jo=/^\[(.+)\]$/,Lg=r=>{if(Jo.test(r)){const e=Jo.exec(r)[1],t=e?.substring(0,e.indexOf(":"));if(t)return"arbitrary.."+t}},$g=r=>{const{theme:e,prefix:t}=r,n={nextPart:new Map,validators:[]};return Ug(Object.entries(r.classGroups),t).forEach(([i,a])=>{Pa(a,n,i,e)}),n},Pa=(r,e,t,n)=>{r.forEach(s=>{if(typeof s=="string"){const i=s===""?e:Zo(e,s);i.classGroupId=t;return}if(typeof s=="function"){if(Fg(s)){Pa(s(n),e,t,n);return}e.validators.push({validator:s,classGroupId:t});return}Object.entries(s).forEach(([i,a])=>{Pa(a,Zo(e,i),t,n)})})},Zo=(r,e)=>{let t=r;return e.split(_o).forEach(n=>{t.nextPart.has(n)||t.nextPart.set(n,{nextPart:new Map,validators:[]}),t=t.nextPart.get(n)}),t},Fg=r=>r.isThemeGetter,Ug=(r,e)=>e?r.map(([t,n])=>{const s=n.map(i=>typeof i=="string"?e+i:typeof i=="object"?Object.fromEntries(Object.entries(i).map(([a,o])=>[e+a,o])):i);return[t,s]}):r,Hg=r=>{if(r<1)return{get:()=>{},set:()=>{}};let e=0,t=new Map,n=new Map;const s=(i,a)=>{t.set(i,a),e++,e>r&&(e=0,n=t,t=new Map)};return{get(i){let a=t.get(i);if(a!==void 0)return a;if((a=n.get(i))!==void 0)return s(i,a),a},set(i,a){t.has(i)?t.set(i,a):s(i,a)}}},md="!",Bg=r=>{const{separator:e,experimentalParseClassName:t}=r,n=e.length===1,s=e[0],i=e.length,a=o=>{const l=[];let c=0,d=0,u;for(let y=0;y<o.length;y++){let v=o[y];if(c===0){if(v===s&&(n||o.slice(y,y+i)===e)){l.push(o.slice(d,y)),d=y+i;continue}if(v==="/"){u=y;continue}}v==="["?c++:v==="]"&&c--}const f=l.length===0?o:o.substring(d),g=f.startsWith(md),b=g?f.substring(1):f,m=u&&u>d?u-d:void 0;return{modifiers:l,hasImportantModifier:g,baseClassName:b,maybePostfixModifierPosition:m}};return t?o=>t({className:o,parseClassName:a}):a},zg=r=>{if(r.length<=1)return r;const e=[];let t=[];return r.forEach(n=>{n[0]==="["?(e.push(...t.sort(),n),t=[]):t.push(n)}),e.push(...t.sort()),e},Wg=r=>({cache:Hg(r.cacheSize),parseClassName:Bg(r),...jg(r)}),qg=/\s+/,Vg=(r,e)=>{const{parseClassName:t,getClassGroupId:n,getConflictingClassGroupIds:s}=e,i=[],a=r.trim().split(qg);let o="";for(let l=a.length-1;l>=0;l-=1){const c=a[l],{modifiers:d,hasImportantModifier:u,baseClassName:f,maybePostfixModifierPosition:g}=t(c);let b=!!g,m=n(b?f.substring(0,g):f);if(!m){if(!b){o=c+(o.length>0?" "+o:o);continue}if(m=n(f),!m){o=c+(o.length>0?" "+o:o);continue}b=!1}const y=zg(d).join(":"),v=u?y+md:y,p=v+m;if(i.includes(p))continue;i.push(p);const w=s(m,b);for(let S=0;S<w.length;++S){const x=w[S];i.push(v+x)}o=c+(o.length>0?" "+o:o)}return o};function Gg(){let r=0,e,t,n="";for(;r<arguments.length;)(e=arguments[r++])&&(t=pd(e))&&(n&&(n+=" "),n+=t);return n}const pd=r=>{if(typeof r=="string")return r;let e,t="";for(let n=0;n<r.length;n++)r[n]&&(e=pd(r[n]))&&(t&&(t+=" "),t+=e);return t};function Kg(r,...e){let t,n,s,i=a;function a(l){const c=e.reduce((d,u)=>u(d),r());return t=Wg(c),n=t.cache.get,s=t.cache.set,i=o,o(l)}function o(l){const c=n(l);if(c)return c;const d=Vg(l,t);return s(l,d),d}return function(){return i(Gg.apply(null,arguments))}}const Fe=r=>{const e=t=>t[r]||[];return e.isThemeGetter=!0,e},bd=/^\[(?:([a-z-]+):)?(.+)\]$/i,Yg=/^\d+\/\d+$/,Xg=new Set(["px","full","screen"]),Qg=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,Jg=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,Zg=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,em=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,tm=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,br=r=>On(r)||Xg.has(r)||Yg.test(r),Nr=r=>Ln(r,"length",cm),On=r=>!!r&&!Number.isNaN(Number(r)),ta=r=>Ln(r,"number",On),qn=r=>!!r&&Number.isInteger(Number(r)),rm=r=>r.endsWith("%")&&On(r.slice(0,-1)),ne=r=>bd.test(r),Ar=r=>Qg.test(r),nm=new Set(["length","size","percentage"]),sm=r=>Ln(r,nm,yd),im=r=>Ln(r,"position",yd),am=new Set(["image","url"]),om=r=>Ln(r,am,um),lm=r=>Ln(r,"",dm),Vn=()=>!0,Ln=(r,e,t)=>{const n=bd.exec(r);return n?n[1]?typeof e=="string"?n[1]===e:e.has(n[1]):t(n[2]):!1},cm=r=>Jg.test(r)&&!Zg.test(r),yd=()=>!1,dm=r=>em.test(r),um=r=>tm.test(r),hm=()=>{const r=Fe("colors"),e=Fe("spacing"),t=Fe("blur"),n=Fe("brightness"),s=Fe("borderColor"),i=Fe("borderRadius"),a=Fe("borderSpacing"),o=Fe("borderWidth"),l=Fe("contrast"),c=Fe("grayscale"),d=Fe("hueRotate"),u=Fe("invert"),f=Fe("gap"),g=Fe("gradientColorStops"),b=Fe("gradientColorStopPositions"),m=Fe("inset"),y=Fe("margin"),v=Fe("opacity"),p=Fe("padding"),w=Fe("saturate"),S=Fe("scale"),x=Fe("sepia"),E=Fe("skew"),T=Fe("space"),R=Fe("translate"),k=()=>["auto","contain","none"],O=()=>["auto","hidden","clip","visible","scroll"],D=()=>["auto",ne,e],A=()=>[ne,e],P=()=>["",br,Nr],Q=()=>["auto",On,ne],he=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],H=()=>["solid","dashed","dotted","double","none"],J=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],Oe=()=>["start","end","center","between","around","evenly","stretch"],L=()=>["","0",ne],Z=()=>["auto","avoid","all","avoid-page","page","left","right","column"],ee=()=>[On,ne];return{cacheSize:500,separator:":",theme:{colors:[Vn],spacing:[br,Nr],blur:["none","",Ar,ne],brightness:ee(),borderColor:[r],borderRadius:["none","","full",Ar,ne],borderSpacing:A(),borderWidth:P(),contrast:ee(),grayscale:L(),hueRotate:ee(),invert:L(),gap:A(),gradientColorStops:[r],gradientColorStopPositions:[rm,Nr],inset:D(),margin:D(),opacity:ee(),padding:A(),saturate:ee(),scale:ee(),sepia:L(),skew:ee(),space:A(),translate:A()},classGroups:{aspect:[{aspect:["auto","square","video",ne]}],container:["container"],columns:[{columns:[Ar]}],"break-after":[{"break-after":Z()}],"break-before":[{"break-before":Z()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...he(),ne]}],overflow:[{overflow:O()}],"overflow-x":[{"overflow-x":O()}],"overflow-y":[{"overflow-y":O()}],overscroll:[{overscroll:k()}],"overscroll-x":[{"overscroll-x":k()}],"overscroll-y":[{"overscroll-y":k()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[m]}],"inset-x":[{"inset-x":[m]}],"inset-y":[{"inset-y":[m]}],start:[{start:[m]}],end:[{end:[m]}],top:[{top:[m]}],right:[{right:[m]}],bottom:[{bottom:[m]}],left:[{left:[m]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",qn,ne]}],basis:[{basis:D()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",ne]}],grow:[{grow:L()}],shrink:[{shrink:L()}],order:[{order:["first","last","none",qn,ne]}],"grid-cols":[{"grid-cols":[Vn]}],"col-start-end":[{col:["auto",{span:["full",qn,ne]},ne]}],"col-start":[{"col-start":Q()}],"col-end":[{"col-end":Q()}],"grid-rows":[{"grid-rows":[Vn]}],"row-start-end":[{row:["auto",{span:[qn,ne]},ne]}],"row-start":[{"row-start":Q()}],"row-end":[{"row-end":Q()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",ne]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",ne]}],gap:[{gap:[f]}],"gap-x":[{"gap-x":[f]}],"gap-y":[{"gap-y":[f]}],"justify-content":[{justify:["normal",...Oe()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...Oe(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...Oe(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[p]}],px:[{px:[p]}],py:[{py:[p]}],ps:[{ps:[p]}],pe:[{pe:[p]}],pt:[{pt:[p]}],pr:[{pr:[p]}],pb:[{pb:[p]}],pl:[{pl:[p]}],m:[{m:[y]}],mx:[{mx:[y]}],my:[{my:[y]}],ms:[{ms:[y]}],me:[{me:[y]}],mt:[{mt:[y]}],mr:[{mr:[y]}],mb:[{mb:[y]}],ml:[{ml:[y]}],"space-x":[{"space-x":[T]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[T]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",ne,e]}],"min-w":[{"min-w":[ne,e,"min","max","fit"]}],"max-w":[{"max-w":[ne,e,"none","full","min","max","fit","prose",{screen:[Ar]},Ar]}],h:[{h:[ne,e,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[ne,e,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[ne,e,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[ne,e,"auto","min","max","fit"]}],"font-size":[{text:["base",Ar,Nr]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",ta]}],"font-family":[{font:[Vn]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",ne]}],"line-clamp":[{"line-clamp":["none",On,ta]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",br,ne]}],"list-image":[{"list-image":["none",ne]}],"list-style-type":[{list:["none","disc","decimal",ne]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[r]}],"placeholder-opacity":[{"placeholder-opacity":[v]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[r]}],"text-opacity":[{"text-opacity":[v]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...H(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",br,Nr]}],"underline-offset":[{"underline-offset":["auto",br,ne]}],"text-decoration-color":[{decoration:[r]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:A()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",ne]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",ne]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[v]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...he(),im]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",sm]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},om]}],"bg-color":[{bg:[r]}],"gradient-from-pos":[{from:[b]}],"gradient-via-pos":[{via:[b]}],"gradient-to-pos":[{to:[b]}],"gradient-from":[{from:[g]}],"gradient-via":[{via:[g]}],"gradient-to":[{to:[g]}],rounded:[{rounded:[i]}],"rounded-s":[{"rounded-s":[i]}],"rounded-e":[{"rounded-e":[i]}],"rounded-t":[{"rounded-t":[i]}],"rounded-r":[{"rounded-r":[i]}],"rounded-b":[{"rounded-b":[i]}],"rounded-l":[{"rounded-l":[i]}],"rounded-ss":[{"rounded-ss":[i]}],"rounded-se":[{"rounded-se":[i]}],"rounded-ee":[{"rounded-ee":[i]}],"rounded-es":[{"rounded-es":[i]}],"rounded-tl":[{"rounded-tl":[i]}],"rounded-tr":[{"rounded-tr":[i]}],"rounded-br":[{"rounded-br":[i]}],"rounded-bl":[{"rounded-bl":[i]}],"border-w":[{border:[o]}],"border-w-x":[{"border-x":[o]}],"border-w-y":[{"border-y":[o]}],"border-w-s":[{"border-s":[o]}],"border-w-e":[{"border-e":[o]}],"border-w-t":[{"border-t":[o]}],"border-w-r":[{"border-r":[o]}],"border-w-b":[{"border-b":[o]}],"border-w-l":[{"border-l":[o]}],"border-opacity":[{"border-opacity":[v]}],"border-style":[{border:[...H(),"hidden"]}],"divide-x":[{"divide-x":[o]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[o]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[v]}],"divide-style":[{divide:H()}],"border-color":[{border:[s]}],"border-color-x":[{"border-x":[s]}],"border-color-y":[{"border-y":[s]}],"border-color-s":[{"border-s":[s]}],"border-color-e":[{"border-e":[s]}],"border-color-t":[{"border-t":[s]}],"border-color-r":[{"border-r":[s]}],"border-color-b":[{"border-b":[s]}],"border-color-l":[{"border-l":[s]}],"divide-color":[{divide:[s]}],"outline-style":[{outline:["",...H()]}],"outline-offset":[{"outline-offset":[br,ne]}],"outline-w":[{outline:[br,Nr]}],"outline-color":[{outline:[r]}],"ring-w":[{ring:P()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[r]}],"ring-opacity":[{"ring-opacity":[v]}],"ring-offset-w":[{"ring-offset":[br,Nr]}],"ring-offset-color":[{"ring-offset":[r]}],shadow:[{shadow:["","inner","none",Ar,lm]}],"shadow-color":[{shadow:[Vn]}],opacity:[{opacity:[v]}],"mix-blend":[{"mix-blend":[...J(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":J()}],filter:[{filter:["","none"]}],blur:[{blur:[t]}],brightness:[{brightness:[n]}],contrast:[{contrast:[l]}],"drop-shadow":[{"drop-shadow":["","none",Ar,ne]}],grayscale:[{grayscale:[c]}],"hue-rotate":[{"hue-rotate":[d]}],invert:[{invert:[u]}],saturate:[{saturate:[w]}],sepia:[{sepia:[x]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[t]}],"backdrop-brightness":[{"backdrop-brightness":[n]}],"backdrop-contrast":[{"backdrop-contrast":[l]}],"backdrop-grayscale":[{"backdrop-grayscale":[c]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[d]}],"backdrop-invert":[{"backdrop-invert":[u]}],"backdrop-opacity":[{"backdrop-opacity":[v]}],"backdrop-saturate":[{"backdrop-saturate":[w]}],"backdrop-sepia":[{"backdrop-sepia":[x]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[a]}],"border-spacing-x":[{"border-spacing-x":[a]}],"border-spacing-y":[{"border-spacing-y":[a]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",ne]}],duration:[{duration:ee()}],ease:[{ease:["linear","in","out","in-out",ne]}],delay:[{delay:ee()}],animate:[{animate:["none","spin","ping","pulse","bounce",ne]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[S]}],"scale-x":[{"scale-x":[S]}],"scale-y":[{"scale-y":[S]}],rotate:[{rotate:[qn,ne]}],"translate-x":[{"translate-x":[R]}],"translate-y":[{"translate-y":[R]}],"skew-x":[{"skew-x":[E]}],"skew-y":[{"skew-y":[E]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",ne]}],accent:[{accent:["auto",r]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",ne]}],"caret-color":[{caret:[r]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":A()}],"scroll-mx":[{"scroll-mx":A()}],"scroll-my":[{"scroll-my":A()}],"scroll-ms":[{"scroll-ms":A()}],"scroll-me":[{"scroll-me":A()}],"scroll-mt":[{"scroll-mt":A()}],"scroll-mr":[{"scroll-mr":A()}],"scroll-mb":[{"scroll-mb":A()}],"scroll-ml":[{"scroll-ml":A()}],"scroll-p":[{"scroll-p":A()}],"scroll-px":[{"scroll-px":A()}],"scroll-py":[{"scroll-py":A()}],"scroll-ps":[{"scroll-ps":A()}],"scroll-pe":[{"scroll-pe":A()}],"scroll-pt":[{"scroll-pt":A()}],"scroll-pr":[{"scroll-pr":A()}],"scroll-pb":[{"scroll-pb":A()}],"scroll-pl":[{"scroll-pl":A()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",ne]}],fill:[{fill:[r,"none"]}],"stroke-w":[{stroke:[br,Nr,ta]}],stroke:[{stroke:[r,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},fm=Kg(hm);function gm(r){if(typeof document>"u")return;let e=document.head||document.getElementsByTagName("head")[0],t=document.createElement("style");t.type="text/css",e.appendChild(t),t.styleSheet?t.styleSheet.cssText=r:t.appendChild(document.createTextNode(r))}Array(12).fill(0);let ja=1;class mm{constructor(){this.subscribe=e=>(this.subscribers.push(e),()=>{const t=this.subscribers.indexOf(e);this.subscribers.splice(t,1)}),this.publish=e=>{this.subscribers.forEach(t=>t(e))},this.addToast=e=>{this.publish(e),this.toasts=[...this.toasts,e]},this.create=e=>{var t;const{message:n,...s}=e,i=typeof e?.id=="number"||((t=e.id)==null?void 0:t.length)>0?e.id:ja++,a=this.toasts.find(l=>l.id===i),o=e.dismissible===void 0?!0:e.dismissible;return this.dismissedToasts.has(i)&&this.dismissedToasts.delete(i),a?this.toasts=this.toasts.map(l=>l.id===i?(this.publish({...l,...e,id:i,title:n}),{...l,...e,id:i,dismissible:o,title:n}):l):this.addToast({title:n,...s,dismissible:o,id:i}),i},this.dismiss=e=>(e?(this.dismissedToasts.add(e),requestAnimationFrame(()=>this.subscribers.forEach(t=>t({id:e,dismiss:!0})))):this.toasts.forEach(t=>{this.subscribers.forEach(n=>n({id:t.id,dismiss:!0}))}),e),this.message=(e,t)=>this.create({...t,message:e}),this.error=(e,t)=>this.create({...t,message:e,type:"error"}),this.success=(e,t)=>this.create({...t,type:"success",message:e}),this.info=(e,t)=>this.create({...t,type:"info",message:e}),this.warning=(e,t)=>this.create({...t,type:"warning",message:e}),this.loading=(e,t)=>this.create({...t,type:"loading",message:e}),this.promise=(e,t)=>{if(!t)return;let n;t.loading!==void 0&&(n=this.create({...t,promise:e,type:"loading",message:t.loading,description:typeof t.description!="function"?t.description:void 0}));const s=Promise.resolve(e instanceof Function?e():e);let i=n!==void 0,a;const o=s.then(async c=>{if(a=["resolve",c],N.isValidElement(c))i=!1,this.create({id:n,type:"default",message:c});else if(bm(c)&&!c.ok){i=!1;const u=typeof t.error=="function"?await t.error(`HTTP error! status: ${c.status}`):t.error,f=typeof t.description=="function"?await t.description(`HTTP error! status: ${c.status}`):t.description,b=typeof u=="object"&&!N.isValidElement(u)?u:{message:u};this.create({id:n,type:"error",description:f,...b})}else if(c instanceof Error){i=!1;const u=typeof t.error=="function"?await t.error(c):t.error,f=typeof t.description=="function"?await t.description(c):t.description,b=typeof u=="object"&&!N.isValidElement(u)?u:{message:u};this.create({id:n,type:"error",description:f,...b})}else if(t.success!==void 0){i=!1;const u=typeof t.success=="function"?await t.success(c):t.success,f=typeof t.description=="function"?await t.description(c):t.description,b=typeof u=="object"&&!N.isValidElement(u)?u:{message:u};this.create({id:n,type:"success",description:f,...b})}}).catch(async c=>{if(a=["reject",c],t.error!==void 0){i=!1;const d=typeof t.error=="function"?await t.error(c):t.error,u=typeof t.description=="function"?await t.description(c):t.description,g=typeof d=="object"&&!N.isValidElement(d)?d:{message:d};this.create({id:n,type:"error",description:u,...g})}}).finally(()=>{i&&(this.dismiss(n),n=void 0),t.finally==null||t.finally.call(t)}),l=()=>new Promise((c,d)=>o.then(()=>a[0]==="reject"?d(a[1]):c(a[1])).catch(d));return typeof n!="string"&&typeof n!="number"?{unwrap:l}:Object.assign(n,{unwrap:l})},this.custom=(e,t)=>{const n=t?.id||ja++;return this.create({jsx:e(n),id:n,...t}),n},this.getActiveToasts=()=>this.toasts.filter(e=>!this.dismissedToasts.has(e.id)),this.subscribers=[],this.toasts=[],this.dismissedToasts=new Set}}const Wt=new mm,pm=(r,e)=>{const t=e?.id||ja++;return Wt.addToast({title:r,...e,id:t}),t},bm=r=>r&&typeof r=="object"&&"ok"in r&&typeof r.ok=="boolean"&&"status"in r&&typeof r.status=="number",ym=pm,vm=()=>Wt.toasts,wm=()=>Wt.getActiveToasts(),xs=Object.assign(ym,{success:Wt.success,info:Wt.info,warning:Wt.warning,error:Wt.error,custom:Wt.custom,message:Wt.message,promise:Wt.promise,dismiss:Wt.dismiss,loading:Wt.loading},{getHistory:vm,getToasts:wm});gm("[data-sonner-toaster][dir=ltr],html[dir=ltr]{--toast-icon-margin-start:-3px;--toast-icon-margin-end:4px;--toast-svg-margin-start:-1px;--toast-svg-margin-end:0px;--toast-button-margin-start:auto;--toast-button-margin-end:0;--toast-close-button-start:0;--toast-close-button-end:unset;--toast-close-button-transform:translate(-35%, -35%)}[data-sonner-toaster][dir=rtl],html[dir=rtl]{--toast-icon-margin-start:4px;--toast-icon-margin-end:-3px;--toast-svg-margin-start:0px;--toast-svg-margin-end:-1px;--toast-button-margin-start:0;--toast-button-margin-end:auto;--toast-close-button-start:unset;--toast-close-button-end:0;--toast-close-button-transform:translate(35%, -35%)}[data-sonner-toaster]{position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1:hsl(0, 0%, 99%);--gray2:hsl(0, 0%, 97.3%);--gray3:hsl(0, 0%, 95.1%);--gray4:hsl(0, 0%, 93%);--gray5:hsl(0, 0%, 90.9%);--gray6:hsl(0, 0%, 88.7%);--gray7:hsl(0, 0%, 85.8%);--gray8:hsl(0, 0%, 78%);--gray9:hsl(0, 0%, 56.1%);--gray10:hsl(0, 0%, 52.3%);--gray11:hsl(0, 0%, 43.5%);--gray12:hsl(0, 0%, 9%);--border-radius:8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:0;z-index:999999999;transition:transform .4s ease}@media (hover:none) and (pointer:coarse){[data-sonner-toaster][data-lifted=true]{transform:none}}[data-sonner-toaster][data-x-position=right]{right:var(--offset-right)}[data-sonner-toaster][data-x-position=left]{left:var(--offset-left)}[data-sonner-toaster][data-x-position=center]{left:50%;transform:translateX(-50%)}[data-sonner-toaster][data-y-position=top]{top:var(--offset-top)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--offset-bottom)}[data-sonner-toast]{--y:translateY(100%);--lift-amount:calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:0;overflow-wrap:anywhere}[data-sonner-toast][data-styled=true]{padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px rgba(0,0,0,.1);width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}[data-sonner-toast]:focus-visible{box-shadow:0 4px 12px rgba(0,0,0,.1),0 0 0 2px rgba(0,0,0,.2)}[data-sonner-toast][data-y-position=top]{top:0;--y:translateY(-100%);--lift:1;--lift-amount:calc(1 * var(--gap))}[data-sonner-toast][data-y-position=bottom]{bottom:0;--y:translateY(100%);--lift:-1;--lift-amount:calc(var(--lift) * var(--gap))}[data-sonner-toast][data-styled=true] [data-description]{font-weight:400;line-height:1.4;color:#3f3f3f}[data-rich-colors=true][data-sonner-toast][data-styled=true] [data-description]{color:inherit}[data-sonner-toaster][data-sonner-theme=dark] [data-description]{color:#e8e8e8}[data-sonner-toast][data-styled=true] [data-title]{font-weight:500;line-height:1.5;color:inherit}[data-sonner-toast][data-styled=true] [data-icon]{display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}[data-sonner-toast][data-promise=true] [data-icon]>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}[data-sonner-toast][data-styled=true] [data-icon]>*{flex-shrink:0}[data-sonner-toast][data-styled=true] [data-icon] svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}[data-sonner-toast][data-styled=true] [data-content]{display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;font-weight:500;cursor:pointer;outline:0;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}[data-sonner-toast][data-styled=true] [data-button]:focus-visible{box-shadow:0 0 0 2px rgba(0,0,0,.4)}[data-sonner-toast][data-styled=true] [data-button]:first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}[data-sonner-toast][data-styled=true] [data-cancel]{color:var(--normal-text);background:rgba(0,0,0,.08)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast][data-styled=true] [data-cancel]{background:rgba(255,255,255,.3)}[data-sonner-toast][data-styled=true] [data-close-button]{position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;color:var(--gray12);background:var(--normal-bg);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}[data-sonner-toast][data-styled=true] [data-close-button]:focus-visible{box-shadow:0 4px 12px rgba(0,0,0,.1),0 0 0 2px rgba(0,0,0,.2)}[data-sonner-toast][data-styled=true] [data-disabled=true]{cursor:not-allowed}[data-sonner-toast][data-styled=true]:hover [data-close-button]:hover{background:var(--gray2);border-color:var(--gray5)}[data-sonner-toast][data-swiping=true]::before{content:'';position:absolute;left:-100%;right:-100%;height:100%;z-index:-1}[data-sonner-toast][data-y-position=top][data-swiping=true]::before{bottom:50%;transform:scaleY(3) translateY(50%)}[data-sonner-toast][data-y-position=bottom][data-swiping=true]::before{top:50%;transform:scaleY(3) translateY(-50%)}[data-sonner-toast][data-swiping=false][data-removed=true]::before{content:'';position:absolute;inset:0;transform:scaleY(2)}[data-sonner-toast][data-expanded=true]::after{content:'';position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}[data-sonner-toast][data-mounted=true]{--y:translateY(0);opacity:1}[data-sonner-toast][data-expanded=false][data-front=false]{--scale:var(--toasts-before) * 0.05 + 1;--y:translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}[data-sonner-toast]>*{transition:opacity .4s}[data-sonner-toast][data-x-position=right]{right:0}[data-sonner-toast][data-x-position=left]{left:0}[data-sonner-toast][data-expanded=false][data-front=false][data-styled=true]>*{opacity:0}[data-sonner-toast][data-visible=false]{opacity:0;pointer-events:none}[data-sonner-toast][data-mounted=true][data-expanded=true]{--y:translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}[data-sonner-toast][data-removed=true][data-front=true][data-swipe-out=false]{--y:translateY(calc(var(--lift) * -100%));opacity:0}[data-sonner-toast][data-removed=true][data-front=false][data-swipe-out=false][data-expanded=true]{--y:translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}[data-sonner-toast][data-removed=true][data-front=false][data-swipe-out=false][data-expanded=false]{--y:translateY(40%);opacity:0;transition:transform .5s,opacity .2s}[data-sonner-toast][data-removed=true][data-front=false]::before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount-y,0)) translateX(var(--swipe-amount-x,0));transition:none}[data-sonner-toast][data-swiped=true]{user-select:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation-duration:.2s;animation-timing-function:ease-out;animation-fill-mode:forwards}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=left]{animation-name:swipe-out-left}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=right]{animation-name:swipe-out-right}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=up]{animation-name:swipe-out-up}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=down]{animation-name:swipe-out-down}@keyframes swipe-out-left{from{transform:var(--y) translateX(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translateX(calc(var(--swipe-amount-x) - 100%));opacity:0}}@keyframes swipe-out-right{from{transform:var(--y) translateX(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translateX(calc(var(--swipe-amount-x) + 100%));opacity:0}}@keyframes swipe-out-up{from{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) - 100%));opacity:0}}@keyframes swipe-out-down{from{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) + 100%));opacity:0}}@media (max-width:600px){[data-sonner-toaster]{position:fixed;right:var(--mobile-offset-right);left:var(--mobile-offset-left);width:100%}[data-sonner-toaster][dir=rtl]{left:calc(var(--mobile-offset-left) * -1)}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset-left) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset-left)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--mobile-offset-bottom)}[data-sonner-toaster][data-y-position=top]{top:var(--mobile-offset-top)}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset-left);right:var(--mobile-offset-right);transform:none}}[data-sonner-toaster][data-sonner-theme=light]{--normal-bg:#fff;--normal-border:var(--gray4);--normal-text:var(--gray12);--success-bg:hsl(143, 85%, 96%);--success-border:hsl(145, 92%, 87%);--success-text:hsl(140, 100%, 27%);--info-bg:hsl(208, 100%, 97%);--info-border:hsl(221, 91%, 93%);--info-text:hsl(210, 92%, 45%);--warning-bg:hsl(49, 100%, 97%);--warning-border:hsl(49, 91%, 84%);--warning-text:hsl(31, 92%, 45%);--error-bg:hsl(359, 100%, 97%);--error-border:hsl(359, 100%, 94%);--error-text:hsl(360, 100%, 45%)}[data-sonner-toaster][data-sonner-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg:#000;--normal-border:hsl(0, 0%, 20%);--normal-text:var(--gray1)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg:#fff;--normal-border:var(--gray3);--normal-text:var(--gray12)}[data-sonner-toaster][data-sonner-theme=dark]{--normal-bg:#000;--normal-bg-hover:hsl(0, 0%, 12%);--normal-border:hsl(0, 0%, 20%);--normal-border-hover:hsl(0, 0%, 25%);--normal-text:var(--gray1);--success-bg:hsl(150, 100%, 6%);--success-border:hsl(147, 100%, 12%);--success-text:hsl(150, 86%, 65%);--info-bg:hsl(215, 100%, 6%);--info-border:hsl(223, 43%, 17%);--info-text:hsl(216, 87%, 65%);--warning-bg:hsl(64, 100%, 6%);--warning-border:hsl(60, 100%, 9%);--warning-text:hsl(46, 87%, 65%);--error-bg:hsl(358, 76%, 10%);--error-border:hsl(357, 89%, 16%);--error-text:hsl(358, 100%, 81%)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast] [data-close-button]{background:var(--normal-bg);border-color:var(--normal-border);color:var(--normal-text)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast] [data-close-button]:hover{background:var(--normal-bg-hover);border-color:var(--normal-border-hover)}[data-rich-colors=true][data-sonner-toast][data-type=success]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size:16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:first-child{animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}100%{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}100%{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}100%{opacity:.15}}@media (prefers-reduced-motion){.sonner-loading-bar,[data-sonner-toast],[data-sonner-toast]>*{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}");const vd=6048e5,_m=864e5,wd=6e4,_d=36e5,el=Symbol.for("constructDateFrom");function Or(r,e){return typeof r=="function"?r(e):r&&typeof r=="object"&&el in r?r[el](e):r instanceof Date?new r.constructor(e):new Date(e)}function $t(r,e){return Or(e||r,r)}let Sm={};function Pi(){return Sm}function gs(r,e){const t=Pi(),n=e?.weekStartsOn??e?.locale?.options?.weekStartsOn??t.weekStartsOn??t.locale?.options?.weekStartsOn??0,s=$t(r,e?.in),i=s.getDay(),a=(i<n?7:0)+i-n;return s.setDate(s.getDate()-a),s.setHours(0,0,0,0),s}function fi(r,e){return gs(r,{...e,weekStartsOn:1})}function Sd(r,e){const t=$t(r,e?.in),n=t.getFullYear(),s=Or(t,0);s.setFullYear(n+1,0,4),s.setHours(0,0,0,0);const i=fi(s),a=Or(t,0);a.setFullYear(n,0,4),a.setHours(0,0,0,0);const o=fi(a);return t.getTime()>=i.getTime()?n+1:t.getTime()>=o.getTime()?n:n-1}function tl(r){const e=$t(r),t=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return t.setUTCFullYear(e.getFullYear()),+r-+t}function xm(r,...e){const t=Or.bind(null,e.find(n=>typeof n=="object"));return e.map(t)}function rl(r,e){const t=$t(r,e?.in);return t.setHours(0,0,0,0),t}function Em(r,e,t){const[n,s]=xm(t?.in,r,e),i=rl(n),a=rl(s),o=+i-tl(i),l=+a-tl(a);return Math.round((o-l)/_m)}function Tm(r,e){const t=Sd(r,e),n=Or(r,0);return n.setFullYear(t,0,4),n.setHours(0,0,0,0),fi(n)}function Rm(r){return r instanceof Date||typeof r=="object"&&Object.prototype.toString.call(r)==="[object Date]"}function xd(r){return!(!Rm(r)&&typeof r!="number"||isNaN(+$t(r)))}function Om(r,e){const t=$t(r,e?.in);return t.setFullYear(t.getFullYear(),0,1),t.setHours(0,0,0,0),t}const Cm={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},km=(r,e,t)=>{let n;const s=Cm[r];return typeof s=="string"?n=s:e===1?n=s.one:n=s.other.replace("{{count}}",e.toString()),t?.addSuffix?t.comparison&&t.comparison>0?"in "+n:n+" ago":n};function ra(r){return(e={})=>{const t=e.width?String(e.width):r.defaultWidth;return r.formats[t]||r.formats[r.defaultWidth]}}const Dm={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},Nm={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},Am={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},Im={date:ra({formats:Dm,defaultWidth:"full"}),time:ra({formats:Nm,defaultWidth:"full"}),dateTime:ra({formats:Am,defaultWidth:"full"})},Mm={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},Pm=(r,e,t,n)=>Mm[r];function Gn(r){return(e,t)=>{const n=t?.context?String(t.context):"standalone";let s;if(n==="formatting"&&r.formattingValues){const a=r.defaultFormattingWidth||r.defaultWidth,o=t?.width?String(t.width):a;s=r.formattingValues[o]||r.formattingValues[a]}else{const a=r.defaultWidth,o=t?.width?String(t.width):r.defaultWidth;s=r.values[o]||r.values[a]}const i=r.argumentCallback?r.argumentCallback(e):e;return s[i]}}const jm={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},Lm={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},$m={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},Fm={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},Um={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},Hm={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},Bm=(r,e)=>{const t=Number(r),n=t%100;if(n>20||n<10)switch(n%10){case 1:return t+"st";case 2:return t+"nd";case 3:return t+"rd"}return t+"th"},zm={ordinalNumber:Bm,era:Gn({values:jm,defaultWidth:"wide"}),quarter:Gn({values:Lm,defaultWidth:"wide",argumentCallback:r=>r-1}),month:Gn({values:$m,defaultWidth:"wide"}),day:Gn({values:Fm,defaultWidth:"wide"}),dayPeriod:Gn({values:Um,defaultWidth:"wide",formattingValues:Hm,defaultFormattingWidth:"wide"})};function Kn(r){return(e,t={})=>{const n=t.width,s=n&&r.matchPatterns[n]||r.matchPatterns[r.defaultMatchWidth],i=e.match(s);if(!i)return null;const a=i[0],o=n&&r.parsePatterns[n]||r.parsePatterns[r.defaultParseWidth],l=Array.isArray(o)?qm(o,u=>u.test(a)):Wm(o,u=>u.test(a));let c;c=r.valueCallback?r.valueCallback(l):l,c=t.valueCallback?t.valueCallback(c):c;const d=e.slice(a.length);return{value:c,rest:d}}}function Wm(r,e){for(const t in r)if(Object.prototype.hasOwnProperty.call(r,t)&&e(r[t]))return t}function qm(r,e){for(let t=0;t<r.length;t++)if(e(r[t]))return t}function Vm(r){return(e,t={})=>{const n=e.match(r.matchPattern);if(!n)return null;const s=n[0],i=e.match(r.parsePattern);if(!i)return null;let a=r.valueCallback?r.valueCallback(i[0]):i[0];a=t.valueCallback?t.valueCallback(a):a;const o=e.slice(s.length);return{value:a,rest:o}}}const Gm=/^(\d+)(th|st|nd|rd)?/i,Km=/\d+/i,Ym={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},Xm={any:[/^b/i,/^(a|c)/i]},Qm={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},Jm={any:[/1/i,/2/i,/3/i,/4/i]},Zm={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},ep={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},tp={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},rp={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},np={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},sp={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},ip={ordinalNumber:Vm({matchPattern:Gm,parsePattern:Km,valueCallback:r=>parseInt(r,10)}),era:Kn({matchPatterns:Ym,defaultMatchWidth:"wide",parsePatterns:Xm,defaultParseWidth:"any"}),quarter:Kn({matchPatterns:Qm,defaultMatchWidth:"wide",parsePatterns:Jm,defaultParseWidth:"any",valueCallback:r=>r+1}),month:Kn({matchPatterns:Zm,defaultMatchWidth:"wide",parsePatterns:ep,defaultParseWidth:"any"}),day:Kn({matchPatterns:tp,defaultMatchWidth:"wide",parsePatterns:rp,defaultParseWidth:"any"}),dayPeriod:Kn({matchPatterns:np,defaultMatchWidth:"any",parsePatterns:sp,defaultParseWidth:"any"})},ap={code:"en-US",formatDistance:km,formatLong:Im,formatRelative:Pm,localize:zm,match:ip,options:{weekStartsOn:0,firstWeekContainsDate:1}};function op(r,e){const t=$t(r,e?.in);return Em(t,Om(t))+1}function lp(r,e){const t=$t(r,e?.in),n=+fi(t)-+Tm(t);return Math.round(n/vd)+1}function Ed(r,e){const t=$t(r,e?.in),n=t.getFullYear(),s=Pi(),i=e?.firstWeekContainsDate??e?.locale?.options?.firstWeekContainsDate??s.firstWeekContainsDate??s.locale?.options?.firstWeekContainsDate??1,a=Or(e?.in||r,0);a.setFullYear(n+1,0,i),a.setHours(0,0,0,0);const o=gs(a,e),l=Or(e?.in||r,0);l.setFullYear(n,0,i),l.setHours(0,0,0,0);const c=gs(l,e);return+t>=+o?n+1:+t>=+c?n:n-1}function cp(r,e){const t=Pi(),n=e?.firstWeekContainsDate??e?.locale?.options?.firstWeekContainsDate??t.firstWeekContainsDate??t.locale?.options?.firstWeekContainsDate??1,s=Ed(r,e),i=Or(e?.in||r,0);return i.setFullYear(s,0,n),i.setHours(0,0,0,0),gs(i,e)}function dp(r,e){const t=$t(r,e?.in),n=+gs(t,e)-+cp(t,e);return Math.round(n/vd)+1}function De(r,e){const t=r<0?"-":"",n=Math.abs(r).toString().padStart(e,"0");return t+n}const Ir={y(r,e){const t=r.getFullYear(),n=t>0?t:1-t;return De(e==="yy"?n%100:n,e.length)},M(r,e){const t=r.getMonth();return e==="M"?String(t+1):De(t+1,2)},d(r,e){return De(r.getDate(),e.length)},a(r,e){const t=r.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return t.toUpperCase();case"aaa":return t;case"aaaaa":return t[0];case"aaaa":default:return t==="am"?"a.m.":"p.m."}},h(r,e){return De(r.getHours()%12||12,e.length)},H(r,e){return De(r.getHours(),e.length)},m(r,e){return De(r.getMinutes(),e.length)},s(r,e){return De(r.getSeconds(),e.length)},S(r,e){const t=e.length,n=r.getMilliseconds(),s=Math.trunc(n*Math.pow(10,t-3));return De(s,e.length)}},gn={midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},nl={G:function(r,e,t){const n=r.getFullYear()>0?1:0;switch(e){case"G":case"GG":case"GGG":return t.era(n,{width:"abbreviated"});case"GGGGG":return t.era(n,{width:"narrow"});case"GGGG":default:return t.era(n,{width:"wide"})}},y:function(r,e,t){if(e==="yo"){const n=r.getFullYear(),s=n>0?n:1-n;return t.ordinalNumber(s,{unit:"year"})}return Ir.y(r,e)},Y:function(r,e,t,n){const s=Ed(r,n),i=s>0?s:1-s;if(e==="YY"){const a=i%100;return De(a,2)}return e==="Yo"?t.ordinalNumber(i,{unit:"year"}):De(i,e.length)},R:function(r,e){const t=Sd(r);return De(t,e.length)},u:function(r,e){const t=r.getFullYear();return De(t,e.length)},Q:function(r,e,t){const n=Math.ceil((r.getMonth()+1)/3);switch(e){case"Q":return String(n);case"QQ":return De(n,2);case"Qo":return t.ordinalNumber(n,{unit:"quarter"});case"QQQ":return t.quarter(n,{width:"abbreviated",context:"formatting"});case"QQQQQ":return t.quarter(n,{width:"narrow",context:"formatting"});case"QQQQ":default:return t.quarter(n,{width:"wide",context:"formatting"})}},q:function(r,e,t){const n=Math.ceil((r.getMonth()+1)/3);switch(e){case"q":return String(n);case"qq":return De(n,2);case"qo":return t.ordinalNumber(n,{unit:"quarter"});case"qqq":return t.quarter(n,{width:"abbreviated",context:"standalone"});case"qqqqq":return t.quarter(n,{width:"narrow",context:"standalone"});case"qqqq":default:return t.quarter(n,{width:"wide",context:"standalone"})}},M:function(r,e,t){const n=r.getMonth();switch(e){case"M":case"MM":return Ir.M(r,e);case"Mo":return t.ordinalNumber(n+1,{unit:"month"});case"MMM":return t.month(n,{width:"abbreviated",context:"formatting"});case"MMMMM":return t.month(n,{width:"narrow",context:"formatting"});case"MMMM":default:return t.month(n,{width:"wide",context:"formatting"})}},L:function(r,e,t){const n=r.getMonth();switch(e){case"L":return String(n+1);case"LL":return De(n+1,2);case"Lo":return t.ordinalNumber(n+1,{unit:"month"});case"LLL":return t.month(n,{width:"abbreviated",context:"standalone"});case"LLLLL":return t.month(n,{width:"narrow",context:"standalone"});case"LLLL":default:return t.month(n,{width:"wide",context:"standalone"})}},w:function(r,e,t,n){const s=dp(r,n);return e==="wo"?t.ordinalNumber(s,{unit:"week"}):De(s,e.length)},I:function(r,e,t){const n=lp(r);return e==="Io"?t.ordinalNumber(n,{unit:"week"}):De(n,e.length)},d:function(r,e,t){return e==="do"?t.ordinalNumber(r.getDate(),{unit:"date"}):Ir.d(r,e)},D:function(r,e,t){const n=op(r);return e==="Do"?t.ordinalNumber(n,{unit:"dayOfYear"}):De(n,e.length)},E:function(r,e,t){const n=r.getDay();switch(e){case"E":case"EE":case"EEE":return t.day(n,{width:"abbreviated",context:"formatting"});case"EEEEE":return t.day(n,{width:"narrow",context:"formatting"});case"EEEEEE":return t.day(n,{width:"short",context:"formatting"});case"EEEE":default:return t.day(n,{width:"wide",context:"formatting"})}},e:function(r,e,t,n){const s=r.getDay(),i=(s-n.weekStartsOn+8)%7||7;switch(e){case"e":return String(i);case"ee":return De(i,2);case"eo":return t.ordinalNumber(i,{unit:"day"});case"eee":return t.day(s,{width:"abbreviated",context:"formatting"});case"eeeee":return t.day(s,{width:"narrow",context:"formatting"});case"eeeeee":return t.day(s,{width:"short",context:"formatting"});case"eeee":default:return t.day(s,{width:"wide",context:"formatting"})}},c:function(r,e,t,n){const s=r.getDay(),i=(s-n.weekStartsOn+8)%7||7;switch(e){case"c":return String(i);case"cc":return De(i,e.length);case"co":return t.ordinalNumber(i,{unit:"day"});case"ccc":return t.day(s,{width:"abbreviated",context:"standalone"});case"ccccc":return t.day(s,{width:"narrow",context:"standalone"});case"cccccc":return t.day(s,{width:"short",context:"standalone"});case"cccc":default:return t.day(s,{width:"wide",context:"standalone"})}},i:function(r,e,t){const n=r.getDay(),s=n===0?7:n;switch(e){case"i":return String(s);case"ii":return De(s,e.length);case"io":return t.ordinalNumber(s,{unit:"day"});case"iii":return t.day(n,{width:"abbreviated",context:"formatting"});case"iiiii":return t.day(n,{width:"narrow",context:"formatting"});case"iiiiii":return t.day(n,{width:"short",context:"formatting"});case"iiii":default:return t.day(n,{width:"wide",context:"formatting"})}},a:function(r,e,t){const s=r.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return t.dayPeriod(s,{width:"abbreviated",context:"formatting"});case"aaa":return t.dayPeriod(s,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return t.dayPeriod(s,{width:"narrow",context:"formatting"});case"aaaa":default:return t.dayPeriod(s,{width:"wide",context:"formatting"})}},b:function(r,e,t){const n=r.getHours();let s;switch(n===12?s=gn.noon:n===0?s=gn.midnight:s=n/12>=1?"pm":"am",e){case"b":case"bb":return t.dayPeriod(s,{width:"abbreviated",context:"formatting"});case"bbb":return t.dayPeriod(s,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return t.dayPeriod(s,{width:"narrow",context:"formatting"});case"bbbb":default:return t.dayPeriod(s,{width:"wide",context:"formatting"})}},B:function(r,e,t){const n=r.getHours();let s;switch(n>=17?s=gn.evening:n>=12?s=gn.afternoon:n>=4?s=gn.morning:s=gn.night,e){case"B":case"BB":case"BBB":return t.dayPeriod(s,{width:"abbreviated",context:"formatting"});case"BBBBB":return t.dayPeriod(s,{width:"narrow",context:"formatting"});case"BBBB":default:return t.dayPeriod(s,{width:"wide",context:"formatting"})}},h:function(r,e,t){if(e==="ho"){let n=r.getHours()%12;return n===0&&(n=12),t.ordinalNumber(n,{unit:"hour"})}return Ir.h(r,e)},H:function(r,e,t){return e==="Ho"?t.ordinalNumber(r.getHours(),{unit:"hour"}):Ir.H(r,e)},K:function(r,e,t){const n=r.getHours()%12;return e==="Ko"?t.ordinalNumber(n,{unit:"hour"}):De(n,e.length)},k:function(r,e,t){let n=r.getHours();return n===0&&(n=24),e==="ko"?t.ordinalNumber(n,{unit:"hour"}):De(n,e.length)},m:function(r,e,t){return e==="mo"?t.ordinalNumber(r.getMinutes(),{unit:"minute"}):Ir.m(r,e)},s:function(r,e,t){return e==="so"?t.ordinalNumber(r.getSeconds(),{unit:"second"}):Ir.s(r,e)},S:function(r,e){return Ir.S(r,e)},X:function(r,e,t){const n=r.getTimezoneOffset();if(n===0)return"Z";switch(e){case"X":return il(n);case"XXXX":case"XX":return Kr(n);case"XXXXX":case"XXX":default:return Kr(n,":")}},x:function(r,e,t){const n=r.getTimezoneOffset();switch(e){case"x":return il(n);case"xxxx":case"xx":return Kr(n);case"xxxxx":case"xxx":default:return Kr(n,":")}},O:function(r,e,t){const n=r.getTimezoneOffset();switch(e){case"O":case"OO":case"OOO":return"GMT"+sl(n,":");case"OOOO":default:return"GMT"+Kr(n,":")}},z:function(r,e,t){const n=r.getTimezoneOffset();switch(e){case"z":case"zz":case"zzz":return"GMT"+sl(n,":");case"zzzz":default:return"GMT"+Kr(n,":")}},t:function(r,e,t){const n=Math.trunc(+r/1e3);return De(n,e.length)},T:function(r,e,t){return De(+r,e.length)}};function sl(r,e=""){const t=r>0?"-":"+",n=Math.abs(r),s=Math.trunc(n/60),i=n%60;return i===0?t+String(s):t+String(s)+e+De(i,2)}function il(r,e){return r%60===0?(r>0?"-":"+")+De(Math.abs(r)/60,2):Kr(r,e)}function Kr(r,e=""){const t=r>0?"-":"+",n=Math.abs(r),s=De(Math.trunc(n/60),2),i=De(n%60,2);return t+s+e+i}const al=(r,e)=>{switch(r){case"P":return e.date({width:"short"});case"PP":return e.date({width:"medium"});case"PPP":return e.date({width:"long"});case"PPPP":default:return e.date({width:"full"})}},Td=(r,e)=>{switch(r){case"p":return e.time({width:"short"});case"pp":return e.time({width:"medium"});case"ppp":return e.time({width:"long"});case"pppp":default:return e.time({width:"full"})}},up=(r,e)=>{const t=r.match(/(P+)(p+)?/)||[],n=t[1],s=t[2];if(!s)return al(r,e);let i;switch(n){case"P":i=e.dateTime({width:"short"});break;case"PP":i=e.dateTime({width:"medium"});break;case"PPP":i=e.dateTime({width:"long"});break;case"PPPP":default:i=e.dateTime({width:"full"});break}return i.replace("{{date}}",al(n,e)).replace("{{time}}",Td(s,e))},hp={p:Td,P:up},fp=/^D+$/,gp=/^Y+$/,mp=["D","DD","YY","YYYY"];function pp(r){return fp.test(r)}function bp(r){return gp.test(r)}function yp(r,e,t){const n=vp(r,e,t);if(console.warn(n),mp.includes(r))throw new RangeError(n)}function vp(r,e,t){const n=r[0]==="Y"?"years":"days of the month";return`Use \`${r.toLowerCase()}\` instead of \`${r}\` (in \`${e}\`) for formatting ${n} to the input \`${t}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const wp=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,_p=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,Sp=/^'([^]*?)'?$/,xp=/''/g,Ep=/[a-zA-Z]/;function Tp(r,e,t){const n=Pi(),s=n.locale??ap,i=n.firstWeekContainsDate??n.locale?.options?.firstWeekContainsDate??1,a=n.weekStartsOn??n.locale?.options?.weekStartsOn??0,o=$t(r,t?.in);if(!xd(o))throw new RangeError("Invalid time value");let l=e.match(_p).map(d=>{const u=d[0];if(u==="p"||u==="P"){const f=hp[u];return f(d,s.formatLong)}return d}).join("").match(wp).map(d=>{if(d==="''")return{isToken:!1,value:"'"};const u=d[0];if(u==="'")return{isToken:!1,value:Rp(d)};if(nl[u])return{isToken:!0,value:d};if(u.match(Ep))throw new RangeError("Format string contains an unescaped latin alphabet character `"+u+"`");return{isToken:!1,value:d}});s.localize.preprocessor&&(l=s.localize.preprocessor(o,l));const c={firstWeekContainsDate:i,weekStartsOn:a,locale:s};return l.map(d=>{if(!d.isToken)return d.value;const u=d.value;(bp(u)||pp(u))&&yp(u,e,String(r));const f=nl[u[0]];return f(o,u,s.localize,c)}).join("")}function Rp(r){const e=r.match(Sp);return e?e[1].replace(xp,"'"):r}function Op(r,e){const t=()=>Or(e?.in,NaN),s=Np(r);let i;if(s.date){const c=Ap(s.date,2);i=Ip(c.restDateString,c.year)}if(!i||isNaN(+i))return t();const a=+i;let o=0,l;if(s.time&&(o=Mp(s.time),isNaN(o)))return t();if(s.timezone){if(l=Pp(s.timezone),isNaN(l))return t()}else{const c=new Date(a+o),d=$t(0,e?.in);return d.setFullYear(c.getUTCFullYear(),c.getUTCMonth(),c.getUTCDate()),d.setHours(c.getUTCHours(),c.getUTCMinutes(),c.getUTCSeconds(),c.getUTCMilliseconds()),d}return $t(a+o+l,e?.in)}const js={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},Cp=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,kp=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,Dp=/^([+-])(\d{2})(?::?(\d{2}))?$/;function Np(r){const e={},t=r.split(js.dateTimeDelimiter);let n;if(t.length>2)return e;if(/:/.test(t[0])?n=t[0]:(e.date=t[0],n=t[1],js.timeZoneDelimiter.test(e.date)&&(e.date=r.split(js.timeZoneDelimiter)[0],n=r.substr(e.date.length,r.length))),n){const s=js.timezone.exec(n);s?(e.time=n.replace(s[1],""),e.timezone=s[1]):e.time=n}return e}function Ap(r,e){const t=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+e)+"})|(\\d{2}|[+-]\\d{"+(2+e)+"})$)"),n=r.match(t);if(!n)return{year:NaN,restDateString:""};const s=n[1]?parseInt(n[1]):null,i=n[2]?parseInt(n[2]):null;return{year:i===null?s:i*100,restDateString:r.slice((n[1]||n[2]).length)}}function Ip(r,e){if(e===null)return new Date(NaN);const t=r.match(Cp);if(!t)return new Date(NaN);const n=!!t[4],s=Yn(t[1]),i=Yn(t[2])-1,a=Yn(t[3]),o=Yn(t[4]),l=Yn(t[5])-1;if(n)return Up(e,o,l)?jp(e,o,l):new Date(NaN);{const c=new Date(0);return!$p(e,i,a)||!Fp(e,s)?new Date(NaN):(c.setUTCFullYear(e,i,Math.max(s,a)),c)}}function Yn(r){return r?parseInt(r):1}function Mp(r){const e=r.match(kp);if(!e)return NaN;const t=na(e[1]),n=na(e[2]),s=na(e[3]);return Hp(t,n,s)?t*_d+n*wd+s*1e3:NaN}function na(r){return r&&parseFloat(r.replace(",","."))||0}function Pp(r){if(r==="Z")return 0;const e=r.match(Dp);if(!e)return 0;const t=e[1]==="+"?-1:1,n=parseInt(e[2]),s=e[3]&&parseInt(e[3])||0;return Bp(n,s)?t*(n*_d+s*wd):NaN}function jp(r,e,t){const n=new Date(0);n.setUTCFullYear(r,0,4);const s=n.getUTCDay()||7,i=(e-1)*7+t+1-s;return n.setUTCDate(n.getUTCDate()+i),n}const Lp=[31,null,31,30,31,30,31,31,30,31,30,31];function Rd(r){return r%400===0||r%4===0&&r%100!==0}function $p(r,e,t){return e>=0&&e<=11&&t>=1&&t<=(Lp[e]||(Rd(r)?29:28))}function Fp(r,e){return e>=1&&e<=(Rd(r)?366:365)}function Up(r,e,t){return e>=1&&e<=53&&t>=0&&t<=6}function Hp(r,e,t){return r===24?e===0&&t===0:t>=0&&t<60&&e>=0&&e<60&&r>=0&&r<25}function Bp(r,e){return e>=0&&e<=59}const ol=r=>typeof r=="boolean"?`${r}`:r===0?"0":r,ll=fd,zp=(r,e)=>t=>{var n;if(e?.variants==null)return ll(r,t?.class,t?.className);const{variants:s,defaultVariants:i}=e,a=Object.keys(s).map(c=>{const d=t?.[c],u=i?.[c];if(d===null)return null;const f=ol(d)||ol(u);return s[c][f]}),o=t&&Object.entries(t).reduce((c,d)=>{let[u,f]=d;return f===void 0||(c[u]=f),c},{}),l=e==null||(n=e.compoundVariants)===null||n===void 0?void 0:n.reduce((c,d)=>{let{class:u,className:f,...g}=d;return Object.entries(g).every(b=>{let[m,y]=b;return Array.isArray(y)?y.includes({...i,...o}[m]):{...i,...o}[m]===y})?[...c,u,f]:c},[]);return ll(r,a,l,t?.class,t?.className)},Wp={},cl=r=>{let e;const t=new Set,n=(d,u)=>{const f=typeof d=="function"?d(e):d;if(!Object.is(f,e)){const g=e;e=u??(typeof f!="object"||f===null)?f:Object.assign({},e,f),t.forEach(b=>b(e,g))}},s=()=>e,l={setState:n,getState:s,getInitialState:()=>c,subscribe:d=>(t.add(d),()=>t.delete(d)),destroy:()=>{(Wp?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),t.clear()}},c=e=r(n,s,l);return l},qp=r=>r?cl(r):cl;var sa={exports:{}},ia={};/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var dl;function Vp(){if(dl)return ia;dl=1;var r=xh(),e=Eh();function t(c,d){return c===d&&(c!==0||1/c===1/d)||c!==c&&d!==d}var n=typeof Object.is=="function"?Object.is:t,s=e.useSyncExternalStore,i=r.useRef,a=r.useEffect,o=r.useMemo,l=r.useDebugValue;return ia.useSyncExternalStoreWithSelector=function(c,d,u,f,g){var b=i(null);if(b.current===null){var m={hasValue:!1,value:null};b.current=m}else m=b.current;b=o(function(){function v(E){if(!p){if(p=!0,w=E,E=f(E),g!==void 0&&m.hasValue){var T=m.value;if(g(T,E))return S=T}return S=E}if(T=S,n(w,E))return T;var R=f(E);return g!==void 0&&g(T,R)?(w=E,T):(w=E,S=R)}var p=!1,w,S,x=u===void 0?null:u;return[function(){return v(d())},x===null?void 0:function(){return v(x())}]},[d,u,f,g]);var y=s(c,b[0],b[1]);return a(function(){m.hasValue=!0,m.value=y},[y]),l(y),y},ia}var ul;function Gp(){return ul||(ul=1,sa.exports=Vp()),sa.exports}var Kp=Gp();const Yp=co(Kp),Od={},{useDebugValue:Xp}=N,{useSyncExternalStoreWithSelector:Qp}=Yp;let hl=!1;const Jp=r=>r;function Zp(r,e=Jp,t){(Od?"production":void 0)!=="production"&&t&&!hl&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),hl=!0);const n=Qp(r.subscribe,r.getState,r.getServerState||r.getInitialState,e,t);return Xp(n),n}const fl=r=>{(Od?"production":void 0)!=="production"&&typeof r!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const e=typeof r=="function"?qp(r):r,t=(n,s)=>Zp(e,n,s);return Object.assign(t,e),t},ms=r=>r?fl(r):fl,eb="modulepreload",tb=function(r){return"/scheduler_demo/"+r},gl={},hr=function(e,t,n){let s=Promise.resolve();if(t&&t.length>0){let l=function(c){return Promise.all(c.map(d=>Promise.resolve(d).then(u=>({status:"fulfilled",value:u}),u=>({status:"rejected",reason:u}))))};document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),o=a?.nonce||a?.getAttribute("nonce");s=l(t.map(c=>{if(c=tb(c),c in gl)return;gl[c]=!0;const d=c.endsWith(".css"),u=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${u}`))return;const f=document.createElement("link");if(f.rel=d?"stylesheet":eb,d||(f.as="script"),f.crossOrigin="",f.href=c,o&&f.setAttribute("nonce",o),document.head.appendChild(f),d)return new Promise((g,b)=>{f.addEventListener("load",g),f.addEventListener("error",()=>b(new Error(`Unable to preload CSS for ${c}`)))})}))}function i(a){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=a,window.dispatchEvent(o),!o.defaultPrevented)throw a}return s.then(a=>{for(const o of a||[])o.status==="rejected"&&i(o.reason);return e().catch(i)})},rb=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>hr(async()=>{const{default:n}=await Promise.resolve().then(()=>ln);return{default:n}},void 0).then(({default:n})=>n(...t)):e=fetch,(...t)=>e(...t)};class So extends Error{constructor(e,t="FunctionsError",n){super(e),this.name=t,this.context=n}}class ml extends So{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class pl extends So{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class bl extends So{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var La;(function(r){r.Any="any",r.ApNortheast1="ap-northeast-1",r.ApNortheast2="ap-northeast-2",r.ApSouth1="ap-south-1",r.ApSoutheast1="ap-southeast-1",r.ApSoutheast2="ap-southeast-2",r.CaCentral1="ca-central-1",r.EuCentral1="eu-central-1",r.EuWest1="eu-west-1",r.EuWest2="eu-west-2",r.EuWest3="eu-west-3",r.SaEast1="sa-east-1",r.UsEast1="us-east-1",r.UsWest1="us-west-1",r.UsWest2="us-west-2"})(La||(La={}));class nb{constructor(e,{headers:t={},customFetch:n,region:s=La.Any}={}){this.url=e,this.headers=t,this.region=s,this.fetch=rb(n)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e){return W(this,arguments,void 0,function*(t,n={}){var s;try{const{headers:i,method:a,body:o,signal:l}=n;let c={},{region:d}=n;d||(d=this.region);const u=new URL(`${this.url}/${t}`);d&&d!=="any"&&(c["x-region"]=d,u.searchParams.set("forceFunctionRegion",d));let f;o&&(i&&!Object.prototype.hasOwnProperty.call(i,"Content-Type")||!i)?typeof Blob<"u"&&o instanceof Blob||o instanceof ArrayBuffer?(c["Content-Type"]="application/octet-stream",f=o):typeof o=="string"?(c["Content-Type"]="text/plain",f=o):typeof FormData<"u"&&o instanceof FormData?f=o:(c["Content-Type"]="application/json",f=JSON.stringify(o)):f=o;const g=yield this.fetch(u.toString(),{method:a||"POST",headers:Object.assign(Object.assign(Object.assign({},c),this.headers),i),body:f,signal:l}).catch(v=>{throw v.name==="AbortError"?v:new ml(v)}),b=g.headers.get("x-relay-error");if(b&&b==="true")throw new pl(g);if(!g.ok)throw new bl(g);let m=((s=g.headers.get("Content-Type"))!==null&&s!==void 0?s:"text/plain").split(";")[0].trim(),y;return m==="application/json"?y=yield g.json():m==="application/octet-stream"||m==="application/pdf"?y=yield g.blob():m==="text/event-stream"?y=g:m==="multipart/form-data"?y=yield g.formData():y=yield g.text(),{data:y,error:null,response:g}}catch(i){return i instanceof Error&&i.name==="AbortError"?{data:null,error:new ml(i)}:{data:null,error:i,response:i instanceof bl||i instanceof pl?i.context:void 0}}})}}var wt={};const $n=Fc(Th);var Ls={},$s={},Fs={},Us={},Hs={},sb=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},Pn=sb();const ib=Pn.fetch,Cd=Pn.fetch.bind(Pn),kd=Pn.Headers,ab=Pn.Request,ob=Pn.Response,ln=Object.freeze(Object.defineProperty({__proto__:null,Headers:kd,Request:ab,Response:ob,default:Cd,fetch:ib},Symbol.toStringTag,{value:"Module"})),lb=Fc(ln);var Bs={},yl;function Dd(){if(yl)return Bs;yl=1,Object.defineProperty(Bs,"__esModule",{value:!0});class r extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}}return Bs.default=r,Bs}var vl;function Nd(){if(vl)return Hs;vl=1,Object.defineProperty(Hs,"__esModule",{value:!0});const r=$n,e=r.__importDefault(lb),t=r.__importDefault(Dd());class n{constructor(i){var a,o;this.shouldThrowOnError=!1,this.method=i.method,this.url=i.url,this.headers=new Headers(i.headers),this.schema=i.schema,this.body=i.body,this.shouldThrowOnError=(a=i.shouldThrowOnError)!==null&&a!==void 0?a:!1,this.signal=i.signal,this.isMaybeSingle=(o=i.isMaybeSingle)!==null&&o!==void 0?o:!1,i.fetch?this.fetch=i.fetch:typeof fetch>"u"?this.fetch=e.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(i,a){return this.headers=new Headers(this.headers),this.headers.set(i,a),this}then(i,a){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const o=this.fetch;let l=o(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async c=>{var d,u,f,g;let b=null,m=null,y=null,v=c.status,p=c.statusText;if(c.ok){if(this.method!=="HEAD"){const E=await c.text();E===""||(this.headers.get("Accept")==="text/csv"||this.headers.get("Accept")&&(!((d=this.headers.get("Accept"))===null||d===void 0)&&d.includes("application/vnd.pgrst.plan+text"))?m=E:m=JSON.parse(E))}const S=(u=this.headers.get("Prefer"))===null||u===void 0?void 0:u.match(/count=(exact|planned|estimated)/),x=(f=c.headers.get("content-range"))===null||f===void 0?void 0:f.split("/");S&&x&&x.length>1&&(y=parseInt(x[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(m)&&(m.length>1?(b={code:"PGRST116",details:`Results contain ${m.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},m=null,y=null,v=406,p="Not Acceptable"):m.length===1?m=m[0]:m=null)}else{const S=await c.text();try{b=JSON.parse(S),Array.isArray(b)&&c.status===404&&(m=[],b=null,v=200,p="OK")}catch{c.status===404&&S===""?(v=204,p="No Content"):b={message:S}}if(b&&this.isMaybeSingle&&(!((g=b?.details)===null||g===void 0)&&g.includes("0 rows"))&&(b=null,v=200,p="OK"),b&&this.shouldThrowOnError)throw new t.default(b)}return{error:b,data:m,count:y,status:v,statusText:p}});return this.shouldThrowOnError||(l=l.catch(c=>{var d,u,f;return{error:{message:`${(d=c?.name)!==null&&d!==void 0?d:"FetchError"}: ${c?.message}`,details:`${(u=c?.stack)!==null&&u!==void 0?u:""}`,hint:"",code:`${(f=c?.code)!==null&&f!==void 0?f:""}`},data:null,count:null,status:0,statusText:""}})),l.then(i,a)}returns(){return this}overrideTypes(){return this}}return Hs.default=n,Hs}var wl;function Ad(){if(wl)return Us;wl=1,Object.defineProperty(Us,"__esModule",{value:!0});const e=$n.__importDefault(Nd());class t extends e.default{select(s){let i=!1;const a=(s??"*").split("").map(o=>/\s/.test(o)&&!i?"":(o==='"'&&(i=!i),o)).join("");return this.url.searchParams.set("select",a),this.headers.append("Prefer","return=representation"),this}order(s,{ascending:i=!0,nullsFirst:a,foreignTable:o,referencedTable:l=o}={}){const c=l?`${l}.order`:"order",d=this.url.searchParams.get(c);return this.url.searchParams.set(c,`${d?`${d},`:""}${s}.${i?"asc":"desc"}${a===void 0?"":a?".nullsfirst":".nullslast"}`),this}limit(s,{foreignTable:i,referencedTable:a=i}={}){const o=typeof a>"u"?"limit":`${a}.limit`;return this.url.searchParams.set(o,`${s}`),this}range(s,i,{foreignTable:a,referencedTable:o=a}={}){const l=typeof o>"u"?"offset":`${o}.offset`,c=typeof o>"u"?"limit":`${o}.limit`;return this.url.searchParams.set(l,`${s}`),this.url.searchParams.set(c,`${i-s+1}`),this}abortSignal(s){return this.signal=s,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:s=!1,verbose:i=!1,settings:a=!1,buffers:o=!1,wal:l=!1,format:c="text"}={}){var d;const u=[s?"analyze":null,i?"verbose":null,a?"settings":null,o?"buffers":null,l?"wal":null].filter(Boolean).join("|"),f=(d=this.headers.get("Accept"))!==null&&d!==void 0?d:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${c}; for="${f}"; options=${u};`),c==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(s){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${s}`),this}}return Us.default=t,Us}var _l;function xo(){if(_l)return Fs;_l=1,Object.defineProperty(Fs,"__esModule",{value:!0});const e=$n.__importDefault(Ad());class t extends e.default{eq(s,i){return this.url.searchParams.append(s,`eq.${i}`),this}neq(s,i){return this.url.searchParams.append(s,`neq.${i}`),this}gt(s,i){return this.url.searchParams.append(s,`gt.${i}`),this}gte(s,i){return this.url.searchParams.append(s,`gte.${i}`),this}lt(s,i){return this.url.searchParams.append(s,`lt.${i}`),this}lte(s,i){return this.url.searchParams.append(s,`lte.${i}`),this}like(s,i){return this.url.searchParams.append(s,`like.${i}`),this}likeAllOf(s,i){return this.url.searchParams.append(s,`like(all).{${i.join(",")}}`),this}likeAnyOf(s,i){return this.url.searchParams.append(s,`like(any).{${i.join(",")}}`),this}ilike(s,i){return this.url.searchParams.append(s,`ilike.${i}`),this}ilikeAllOf(s,i){return this.url.searchParams.append(s,`ilike(all).{${i.join(",")}}`),this}ilikeAnyOf(s,i){return this.url.searchParams.append(s,`ilike(any).{${i.join(",")}}`),this}is(s,i){return this.url.searchParams.append(s,`is.${i}`),this}in(s,i){const a=Array.from(new Set(i)).map(o=>typeof o=="string"&&new RegExp("[,()]").test(o)?`"${o}"`:`${o}`).join(",");return this.url.searchParams.append(s,`in.(${a})`),this}contains(s,i){return typeof i=="string"?this.url.searchParams.append(s,`cs.${i}`):Array.isArray(i)?this.url.searchParams.append(s,`cs.{${i.join(",")}}`):this.url.searchParams.append(s,`cs.${JSON.stringify(i)}`),this}containedBy(s,i){return typeof i=="string"?this.url.searchParams.append(s,`cd.${i}`):Array.isArray(i)?this.url.searchParams.append(s,`cd.{${i.join(",")}}`):this.url.searchParams.append(s,`cd.${JSON.stringify(i)}`),this}rangeGt(s,i){return this.url.searchParams.append(s,`sr.${i}`),this}rangeGte(s,i){return this.url.searchParams.append(s,`nxl.${i}`),this}rangeLt(s,i){return this.url.searchParams.append(s,`sl.${i}`),this}rangeLte(s,i){return this.url.searchParams.append(s,`nxr.${i}`),this}rangeAdjacent(s,i){return this.url.searchParams.append(s,`adj.${i}`),this}overlaps(s,i){return typeof i=="string"?this.url.searchParams.append(s,`ov.${i}`):this.url.searchParams.append(s,`ov.{${i.join(",")}}`),this}textSearch(s,i,{config:a,type:o}={}){let l="";o==="plain"?l="pl":o==="phrase"?l="ph":o==="websearch"&&(l="w");const c=a===void 0?"":`(${a})`;return this.url.searchParams.append(s,`${l}fts${c}.${i}`),this}match(s){return Object.entries(s).forEach(([i,a])=>{this.url.searchParams.append(i,`eq.${a}`)}),this}not(s,i,a){return this.url.searchParams.append(s,`not.${i}.${a}`),this}or(s,{foreignTable:i,referencedTable:a=i}={}){const o=a?`${a}.or`:"or";return this.url.searchParams.append(o,`(${s})`),this}filter(s,i,a){return this.url.searchParams.append(s,`${i}.${a}`),this}}return Fs.default=t,Fs}var Sl;function Id(){if(Sl)return $s;Sl=1,Object.defineProperty($s,"__esModule",{value:!0});const e=$n.__importDefault(xo());class t{constructor(s,{headers:i={},schema:a,fetch:o}){this.url=s,this.headers=new Headers(i),this.schema=a,this.fetch=o}select(s,i){const{head:a=!1,count:o}=i??{},l=a?"HEAD":"GET";let c=!1;const d=(s??"*").split("").map(u=>/\s/.test(u)&&!c?"":(u==='"'&&(c=!c),u)).join("");return this.url.searchParams.set("select",d),o&&this.headers.append("Prefer",`count=${o}`),new e.default({method:l,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(s,{count:i,defaultToNull:a=!0}={}){var o;const l="POST";if(i&&this.headers.append("Prefer",`count=${i}`),a||this.headers.append("Prefer","missing=default"),Array.isArray(s)){const c=s.reduce((d,u)=>d.concat(Object.keys(u)),[]);if(c.length>0){const d=[...new Set(c)].map(u=>`"${u}"`);this.url.searchParams.set("columns",d.join(","))}}return new e.default({method:l,url:this.url,headers:this.headers,schema:this.schema,body:s,fetch:(o=this.fetch)!==null&&o!==void 0?o:fetch})}upsert(s,{onConflict:i,ignoreDuplicates:a=!1,count:o,defaultToNull:l=!0}={}){var c;const d="POST";if(this.headers.append("Prefer",`resolution=${a?"ignore":"merge"}-duplicates`),i!==void 0&&this.url.searchParams.set("on_conflict",i),o&&this.headers.append("Prefer",`count=${o}`),l||this.headers.append("Prefer","missing=default"),Array.isArray(s)){const u=s.reduce((f,g)=>f.concat(Object.keys(g)),[]);if(u.length>0){const f=[...new Set(u)].map(g=>`"${g}"`);this.url.searchParams.set("columns",f.join(","))}}return new e.default({method:d,url:this.url,headers:this.headers,schema:this.schema,body:s,fetch:(c=this.fetch)!==null&&c!==void 0?c:fetch})}update(s,{count:i}={}){var a;const o="PATCH";return i&&this.headers.append("Prefer",`count=${i}`),new e.default({method:o,url:this.url,headers:this.headers,schema:this.schema,body:s,fetch:(a=this.fetch)!==null&&a!==void 0?a:fetch})}delete({count:s}={}){var i;const a="DELETE";return s&&this.headers.append("Prefer",`count=${s}`),new e.default({method:a,url:this.url,headers:this.headers,schema:this.schema,fetch:(i=this.fetch)!==null&&i!==void 0?i:fetch})}}return $s.default=t,$s}var xl;function cb(){if(xl)return Ls;xl=1,Object.defineProperty(Ls,"__esModule",{value:!0});const r=$n,e=r.__importDefault(Id()),t=r.__importDefault(xo());class n{constructor(i,{headers:a={},schema:o,fetch:l}={}){this.url=i,this.headers=new Headers(a),this.schemaName=o,this.fetch=l}from(i){const a=new URL(`${this.url}/${i}`);return new e.default(a,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(i){return new n(this.url,{headers:this.headers,schema:i,fetch:this.fetch})}rpc(i,a={},{head:o=!1,get:l=!1,count:c}={}){var d;let u;const f=new URL(`${this.url}/rpc/${i}`);let g;o||l?(u=o?"HEAD":"GET",Object.entries(a).filter(([m,y])=>y!==void 0).map(([m,y])=>[m,Array.isArray(y)?`{${y.join(",")}}`:`${y}`]).forEach(([m,y])=>{f.searchParams.append(m,y)})):(u="POST",g=a);const b=new Headers(this.headers);return c&&b.set("Prefer",`count=${c}`),new t.default({method:u,url:f,headers:b,schema:this.schemaName,body:g,fetch:(d=this.fetch)!==null&&d!==void 0?d:fetch})}}return Ls.default=n,Ls}var El;function db(){if(El)return wt;El=1,Object.defineProperty(wt,"__esModule",{value:!0}),wt.PostgrestError=wt.PostgrestBuilder=wt.PostgrestTransformBuilder=wt.PostgrestFilterBuilder=wt.PostgrestQueryBuilder=wt.PostgrestClient=void 0;const r=$n,e=r.__importDefault(cb());wt.PostgrestClient=e.default;const t=r.__importDefault(Id());wt.PostgrestQueryBuilder=t.default;const n=r.__importDefault(xo());wt.PostgrestFilterBuilder=n.default;const s=r.__importDefault(Ad());wt.PostgrestTransformBuilder=s.default;const i=r.__importDefault(Nd());wt.PostgrestBuilder=i.default;const a=r.__importDefault(Dd());return wt.PostgrestError=a.default,wt.default={PostgrestClient:e.default,PostgrestQueryBuilder:t.default,PostgrestFilterBuilder:n.default,PostgrestTransformBuilder:s.default,PostgrestBuilder:i.default,PostgrestError:a.default},wt}var ub=db();const hb=co(ub),{PostgrestClient:fb,PostgrestQueryBuilder:YR,PostgrestFilterBuilder:XR,PostgrestTransformBuilder:QR,PostgrestBuilder:JR,PostgrestError:ZR}=hb;class gb{static detectEnvironment(){var e;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((e=navigator.userAgent)===null||e===void 0)&&e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"){const t=process.versions;if(t&&t.node){const n=t.node,s=parseInt(n.replace(/^v/,"").split(".")[0]);return s>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${s} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${s} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let t=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(t+=`

Suggested solution: ${e.workaround}`),new Error(t)}static createWebSocket(e,t){const n=this.getWebSocketConstructor();return new n(e,t)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return e.type==="native"||e.type==="ws"}catch{return!1}}}const mb="2.76.1",pb=`realtime-js/${mb}`,bb="1.0.0",$a=1e4,yb=1e3,vb=100;var ss;(function(r){r[r.connecting=0]="connecting",r[r.open=1]="open",r[r.closing=2]="closing",r[r.closed=3]="closed"})(ss||(ss={}));var rt;(function(r){r.closed="closed",r.errored="errored",r.joined="joined",r.joining="joining",r.leaving="leaving"})(rt||(rt={}));var er;(function(r){r.close="phx_close",r.error="phx_error",r.join="phx_join",r.reply="phx_reply",r.leave="phx_leave",r.access_token="access_token"})(er||(er={}));var Fa;(function(r){r.websocket="websocket"})(Fa||(Fa={}));var Qr;(function(r){r.Connecting="connecting",r.Open="open",r.Closing="closing",r.Closed="closed"})(Qr||(Qr={}));class wb{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),n=new TextDecoder;return this._decodeBroadcast(e,t,n)}_decodeBroadcast(e,t,n){const s=t.getUint8(1),i=t.getUint8(2);let a=this.HEADER_LENGTH+2;const o=n.decode(e.slice(a,a+s));a=a+s;const l=n.decode(e.slice(a,a+i));a=a+i;const c=JSON.parse(n.decode(e.slice(a,e.byteLength)));return{ref:null,topic:o,event:l,payload:c}}}class Md{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var $e;(function(r){r.abstime="abstime",r.bool="bool",r.date="date",r.daterange="daterange",r.float4="float4",r.float8="float8",r.int2="int2",r.int4="int4",r.int4range="int4range",r.int8="int8",r.int8range="int8range",r.json="json",r.jsonb="jsonb",r.money="money",r.numeric="numeric",r.oid="oid",r.reltime="reltime",r.text="text",r.time="time",r.timestamp="timestamp",r.timestamptz="timestamptz",r.timetz="timetz",r.tsrange="tsrange",r.tstzrange="tstzrange"})($e||($e={}));const Tl=(r,e,t={})=>{var n;const s=(n=t.skipTypes)!==null&&n!==void 0?n:[];return e?Object.keys(e).reduce((i,a)=>(i[a]=_b(a,r,e,s),i),{}):{}},_b=(r,e,t,n)=>{const s=e.find(o=>o.name===r),i=s?.type,a=t[r];return i&&!n.includes(i)?Pd(i,a):Ua(a)},Pd=(r,e)=>{if(r.charAt(0)==="_"){const t=r.slice(1,r.length);return Tb(e,t)}switch(r){case $e.bool:return Sb(e);case $e.float4:case $e.float8:case $e.int2:case $e.int4:case $e.int8:case $e.numeric:case $e.oid:return xb(e);case $e.json:case $e.jsonb:return Eb(e);case $e.timestamp:return Rb(e);case $e.abstime:case $e.date:case $e.daterange:case $e.int4range:case $e.int8range:case $e.money:case $e.reltime:case $e.text:case $e.time:case $e.timestamptz:case $e.timetz:case $e.tsrange:case $e.tstzrange:return Ua(e);default:return Ua(e)}},Ua=r=>r,Sb=r=>{switch(r){case"t":return!0;case"f":return!1;default:return r}},xb=r=>{if(typeof r=="string"){const e=parseFloat(r);if(!Number.isNaN(e))return e}return r},Eb=r=>{if(typeof r=="string")try{return JSON.parse(r)}catch(e){return console.log(`JSON parse error: ${e}`),r}return r},Tb=(r,e)=>{if(typeof r!="string")return r;const t=r.length-1,n=r[t];if(r[0]==="{"&&n==="}"){let i;const a=r.slice(1,t);try{i=JSON.parse("["+a+"]")}catch{i=a?a.split(","):[]}return i.map(o=>Pd(e,o))}return r},Rb=r=>typeof r=="string"?r.replace(" ","T"):r,jd=r=>{const e=new URL(r);return e.protocol=e.protocol.replace(/^ws/i,"http"),e.pathname=e.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),e.pathname===""||e.pathname==="/"?e.pathname="/api/broadcast":e.pathname=e.pathname+"/api/broadcast",e.href};class aa{constructor(e,t,n={},s=$a){this.channel=e,this.event=t,this.payload=n,this.timeout=s,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var n;return this._hasReceived(e)&&t((n=this.receivedResp)===null||n===void 0?void 0:n.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(n=>n.status===e).forEach(n=>n.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var Rl;(function(r){r.SYNC="sync",r.JOIN="join",r.LEAVE="leave"})(Rl||(Rl={}));class is{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const n=t?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(n.state,{},s=>{const{onJoin:i,onLeave:a,onSync:o}=this.caller;this.joinRef=this.channel._joinRef(),this.state=is.syncState(this.state,s,i,a),this.pendingDiffs.forEach(l=>{this.state=is.syncDiff(this.state,l,i,a)}),this.pendingDiffs=[],o()}),this.channel._on(n.diff,{},s=>{const{onJoin:i,onLeave:a,onSync:o}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(s):(this.state=is.syncDiff(this.state,s,i,a),o())}),this.onJoin((s,i,a)=>{this.channel._trigger("presence",{event:"join",key:s,currentPresences:i,newPresences:a})}),this.onLeave((s,i,a)=>{this.channel._trigger("presence",{event:"leave",key:s,currentPresences:i,leftPresences:a})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,n,s){const i=this.cloneDeep(e),a=this.transformState(t),o={},l={};return this.map(i,(c,d)=>{a[c]||(l[c]=d)}),this.map(a,(c,d)=>{const u=i[c];if(u){const f=d.map(y=>y.presence_ref),g=u.map(y=>y.presence_ref),b=d.filter(y=>g.indexOf(y.presence_ref)<0),m=u.filter(y=>f.indexOf(y.presence_ref)<0);b.length>0&&(o[c]=b),m.length>0&&(l[c]=m)}else o[c]=d}),this.syncDiff(i,{joins:o,leaves:l},n,s)}static syncDiff(e,t,n,s){const{joins:i,leaves:a}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return n||(n=()=>{}),s||(s=()=>{}),this.map(i,(o,l)=>{var c;const d=(c=e[o])!==null&&c!==void 0?c:[];if(e[o]=this.cloneDeep(l),d.length>0){const u=e[o].map(g=>g.presence_ref),f=d.filter(g=>u.indexOf(g.presence_ref)<0);e[o].unshift(...f)}n(o,d,l)}),this.map(a,(o,l)=>{let c=e[o];if(!c)return;const d=l.map(u=>u.presence_ref);c=c.filter(u=>d.indexOf(u.presence_ref)<0),e[o]=c,s(o,c,l),c.length===0&&delete e[o]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(n=>t(n,e[n]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,n)=>{const s=e[n];return"metas"in s?t[n]=s.metas.map(i=>(i.presence_ref=i.phx_ref,delete i.phx_ref,delete i.phx_ref_prev,i)):t[n]=s,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var Ol;(function(r){r.ALL="*",r.INSERT="INSERT",r.UPDATE="UPDATE",r.DELETE="DELETE"})(Ol||(Ol={}));var as;(function(r){r.BROADCAST="broadcast",r.PRESENCE="presence",r.POSTGRES_CHANGES="postgres_changes",r.SYSTEM="system"})(as||(as={}));var vr;(function(r){r.SUBSCRIBED="SUBSCRIBED",r.TIMED_OUT="TIMED_OUT",r.CLOSED="CLOSED",r.CHANNEL_ERROR="CHANNEL_ERROR"})(vr||(vr={}));class Eo{constructor(e,t={config:{}},n){var s,i;if(this.topic=e,this.params=t,this.socket=n,this.bindings={},this.state=rt.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new aa(this,er.join,this.params,this.timeout),this.rejoinTimer=new Md(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=rt.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(a=>a.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=rt.closed,this.socket._remove(this)}),this._onError(a=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,a),this.state=rt.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=rt.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",a=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,a),this.state=rt.errored,this.rejoinTimer.scheduleTimeout())}),this._on(er.reply,{},(a,o)=>{this._trigger(this._replyEventName(o),a)}),this.presence=new is(this),this.broadcastEndpointURL=jd(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((i=(s=this.params.config)===null||s===void 0?void 0:s.broadcast)===null||i===void 0)&&i.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(e,t=this.timeout){var n,s,i;if(this.socket.isConnected()||this.socket.connect(),this.state==rt.closed){const{config:{broadcast:a,presence:o,private:l}}=this.params,c=(s=(n=this.bindings.postgres_changes)===null||n===void 0?void 0:n.map(g=>g.filter))!==null&&s!==void 0?s:[],d=!!this.bindings[as.PRESENCE]&&this.bindings[as.PRESENCE].length>0||((i=this.params.config.presence)===null||i===void 0?void 0:i.enabled)===!0,u={},f={broadcast:a,presence:Object.assign(Object.assign({},o),{enabled:d}),postgres_changes:c,private:l};this.socket.accessTokenValue&&(u.access_token=this.socket.accessTokenValue),this._onError(g=>e?.(vr.CHANNEL_ERROR,g)),this._onClose(()=>e?.(vr.CLOSED)),this.updateJoinPayload(Object.assign({config:f},u)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:g})=>{var b;if(this.socket.setAuth(),g===void 0){e?.(vr.SUBSCRIBED);return}else{const m=this.bindings.postgres_changes,y=(b=m?.length)!==null&&b!==void 0?b:0,v=[];for(let p=0;p<y;p++){const w=m[p],{filter:{event:S,schema:x,table:E,filter:T}}=w,R=g&&g[p];if(R&&R.event===S&&R.schema===x&&R.table===E&&R.filter===T)v.push(Object.assign(Object.assign({},w),{id:R.id}));else{this.unsubscribe(),this.state=rt.errored,e?.(vr.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=v,e&&e(vr.SUBSCRIBED);return}}).receive("error",g=>{this.state=rt.errored,e?.(vr.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(g).join(", ")||"error")))}).receive("timeout",()=>{e?.(vr.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,n){return this.state===rt.joined&&e===as.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(e,t,n)}async httpSend(e,t,n={}){var s;const i=this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"";if(t==null)return Promise.reject("Payload is required for httpSend()");const a={method:"POST",headers:{Authorization:i,apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:e,payload:t,private:this.private}]})},o=await this._fetchWithTimeout(this.broadcastEndpointURL,a,(s=n.timeout)!==null&&s!==void 0?s:this.timeout);if(o.status===202)return{success:!0};let l=o.statusText;try{const c=await o.json();l=c.error||c.message||l}catch{}return Promise.reject(new Error(l))}async send(e,t={}){var n,s;if(!this._canPush()&&e.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:i,payload:a}=e,l={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:a,private:this.private}]})};try{const c=await this._fetchWithTimeout(this.broadcastEndpointURL,l,(n=t.timeout)!==null&&n!==void 0?n:this.timeout);return await((s=c.body)===null||s===void 0?void 0:s.cancel()),c.ok?"ok":"error"}catch(c){return c.name==="AbortError"?"timed out":"error"}}else return new Promise(i=>{var a,o,l;const c=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((l=(o=(a=this.params)===null||a===void 0?void 0:a.config)===null||o===void 0?void 0:o.broadcast)===null||l===void 0)&&l.ack)&&i("ok"),c.receive("ok",()=>i("ok")),c.receive("error",()=>i("error")),c.receive("timeout",()=>i("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=rt.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(er.close,"leave",this._joinRef())};this.joinPush.destroy();let n=null;return new Promise(s=>{n=new aa(this,er.leave,{},e),n.receive("ok",()=>{t(),s("ok")}).receive("timeout",()=>{t(),s("timed out")}).receive("error",()=>{s("error")}),n.send(),this._canPush()||n.trigger("ok",{})}).finally(()=>{n?.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=rt.closed,this.bindings={}}async _fetchWithTimeout(e,t,n){const s=new AbortController,i=setTimeout(()=>s.abort(),n),a=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:s.signal}));return clearTimeout(i),a}_push(e,t,n=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let s=new aa(this,e,t,n);return this._canPush()?s.send():this._addToPushBuffer(s),s}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>vb){const t=this.pushBuffer.shift();t&&(t.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${t.event}`,t.payload))}}_onMessage(e,t,n){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,n){var s,i;const a=e.toLocaleLowerCase(),{close:o,error:l,leave:c,join:d}=er;if(n&&[o,l,c,d].indexOf(a)>=0&&n!==this._joinRef())return;let f=this._onMessage(a,t,n);if(t&&!f)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(a)?(s=this.bindings.postgres_changes)===null||s===void 0||s.filter(g=>{var b,m,y;return((b=g.filter)===null||b===void 0?void 0:b.event)==="*"||((y=(m=g.filter)===null||m===void 0?void 0:m.event)===null||y===void 0?void 0:y.toLocaleLowerCase())===a}).map(g=>g.callback(f,n)):(i=this.bindings[a])===null||i===void 0||i.filter(g=>{var b,m,y,v,p,w;if(["broadcast","presence","postgres_changes"].includes(a))if("id"in g){const S=g.id,x=(b=g.filter)===null||b===void 0?void 0:b.event;return S&&((m=t.ids)===null||m===void 0?void 0:m.includes(S))&&(x==="*"||x?.toLocaleLowerCase()===((y=t.data)===null||y===void 0?void 0:y.type.toLocaleLowerCase()))}else{const S=(p=(v=g?.filter)===null||v===void 0?void 0:v.event)===null||p===void 0?void 0:p.toLocaleLowerCase();return S==="*"||S===((w=t?.event)===null||w===void 0?void 0:w.toLocaleLowerCase())}else return g.type.toLocaleLowerCase()===a}).map(g=>{if(typeof f=="object"&&"ids"in f){const b=f.data,{schema:m,table:y,commit_timestamp:v,type:p,errors:w}=b;f=Object.assign(Object.assign({},{schema:m,table:y,commit_timestamp:v,eventType:p,new:{},old:{},errors:w}),this._getPayloadRecords(b))}g.callback(f,n)})}_isClosed(){return this.state===rt.closed}_isJoined(){return this.state===rt.joined}_isJoining(){return this.state===rt.joining}_isLeaving(){return this.state===rt.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,n){const s=e.toLocaleLowerCase(),i={type:s,filter:t,callback:n};return this.bindings[s]?this.bindings[s].push(i):this.bindings[s]=[i],this}_off(e,t){const n=e.toLocaleLowerCase();return this.bindings[n]&&(this.bindings[n]=this.bindings[n].filter(s=>{var i;return!(((i=s.type)===null||i===void 0?void 0:i.toLocaleLowerCase())===n&&Eo.isEqual(s.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const n in e)if(e[n]!==t[n])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(er.close,{},e)}_onError(e){this._on(er.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=rt.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=Tl(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=Tl(e.columns,e.old_record)),t}}const oa=()=>{},zs={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},Ob=[1e3,2e3,5e3,1e4],Cb=1e4,kb=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class Db{constructor(e,t){var n;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=$a,this.transport=null,this.heartbeatIntervalMs=zs.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=oa,this.ref=0,this.reconnectTimer=null,this.logger=oa,this.conn=null,this.sendBuffer=[],this.serializer=new wb,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=s=>{let i;return s?i=s:typeof fetch>"u"?i=(...a)=>hr(async()=>{const{default:o}=await Promise.resolve().then(()=>ln);return{default:o}},void 0).then(({default:o})=>o(...a)).catch(o=>{throw new Error(`Failed to load @supabase/node-fetch: ${o.message}. This is required for HTTP requests in Node.js environments without native fetch.`)}):i=fetch,(...a)=>i(...a)},!(!((n=t?.params)===null||n===void 0)&&n.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=t.params.apikey,this.endPoint=`${e}/${Fa.websocket}`,this.httpEndpoint=jd(e),this._initializeOptions(t),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(t?.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=gb.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const t=e.message;throw t.includes("Node.js")?new Error(`${t}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${t}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:bb}))}disconnect(e,t){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const n=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(n),this._setConnectionState("disconnected")},e?this.conn.close(e,t??""):this.conn.close(),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,n){this.logger(e,t,n)}connectionState(){switch(this.conn&&this.conn.readyState){case ss.connecting:return Qr.Connecting;case ss.open:return Qr.Open;case ss.closing:return Qr.Closing;default:return Qr.Closed}}isConnected(){return this.connectionState()===Qr.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(e,t={config:{}}){const n=`realtime:${e}`,s=this.getChannels().find(i=>i.topic===n);if(s)return s;{const i=new Eo(`realtime:${e}`,t,this);return this.channels.push(i),i}}push(e){const{topic:t,event:n,payload:s,ref:i}=e,a=()=>{this.encode(e,o=>{var l;(l=this.conn)===null||l===void 0||l.send(o)})};this.log("push",`${t} ${n} (${i})`,s),this.isConnected()?a():this.sendBuffer.push(a)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var e;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(t){this.log("error","error in heartbeat callback",t)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(t){this.log("error","error in heartbeat callback",t)}this._wasManualDisconnect=!1,(e=this.conn)===null||e===void 0||e.close(yb,"heartbeat timeout"),setTimeout(()=>{var t;this.isConnected()||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout()},zs.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(t){this.log("error","error in heartbeat callback",t)}this._setAuthSafely("heartbeat")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(n=>n.topic===e&&(n._isJoined()||n._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,t=>{if(t.topic==="phoenix"&&t.event==="phx_reply")try{this.heartbeatCallback(t.payload.status==="ok"?"ok":"error")}catch(c){this.log("error","error in heartbeat callback",c)}t.ref&&t.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:n,event:s,payload:i,ref:a}=t,o=a?`(${a})`:"",l=i.status||"";this.log("receive",`${l} ${n} ${s} ${o}`.trim(),i),this.channels.filter(c=>c._isMember(n)).forEach(c=>c._trigger(s,i,a)),this._triggerStateCallbacks("message",t)})}_clearTimer(e){var t;e==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):e==="reconnect"&&((t=this.reconnectTimer)===null||t===void 0||t.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_teardownConnection(){this.conn&&(this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null),this._clearAllTimers(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){var t;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(er.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const n=e.match(/\?/)?"&":"?",s=new URLSearchParams(t);return`${e}${n}${s}`}_workerObjectUrl(e){let t;if(e)t=e;else{const n=new Blob([kb],{type:"application/javascript"});t=URL.createObjectURL(n)}return t}_setConnectionState(e,t=!1){this._connectionState=e,e==="connecting"?this._wasManualDisconnect=!1:e==="disconnecting"&&(this._wasManualDisconnect=t)}async _performAuth(e=null){let t;e?t=e:this.accessToken?t=await this.accessToken():t=this.accessTokenValue,this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(n=>{const s={access_token:t,version:pb};t&&n.updateJoinPayload(s),n.joinedOnce&&n._isJoined()&&n._push(er.access_token,{access_token:t})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this.setAuth().catch(t=>{this.log("error",`error setting auth in ${e}`,t)})}_triggerStateCallbacks(e,t){try{this.stateChangeCallbacks[e].forEach(n=>{try{n(t)}catch(s){this.log("error",`error in ${e} callback`,s)}})}catch(n){this.log("error",`error triggering ${e} callbacks`,n)}}_setupReconnectionTimer(){this.reconnectTimer=new Md(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},zs.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(e){var t,n,s,i,a,o,l,c,d;if(this.transport=(t=e?.transport)!==null&&t!==void 0?t:null,this.timeout=(n=e?.timeout)!==null&&n!==void 0?n:$a,this.heartbeatIntervalMs=(s=e?.heartbeatIntervalMs)!==null&&s!==void 0?s:zs.HEARTBEAT_INTERVAL,this.worker=(i=e?.worker)!==null&&i!==void 0?i:!1,this.accessToken=(a=e?.accessToken)!==null&&a!==void 0?a:null,this.heartbeatCallback=(o=e?.heartbeatCallback)!==null&&o!==void 0?o:oa,e?.params&&(this.params=e.params),e?.logger&&(this.logger=e.logger),(e?.logLevel||e?.log_level)&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(l=e?.reconnectAfterMs)!==null&&l!==void 0?l:(u=>Ob[u-1]||Cb),this.encode=(c=e?.encode)!==null&&c!==void 0?c:((u,f)=>f(JSON.stringify(u))),this.decode=(d=e?.decode)!==null&&d!==void 0?d:this.serializer.decode.bind(this.serializer),this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=e?.workerUrl}}}class To extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function ze(r){return typeof r=="object"&&r!==null&&"__isStorageError"in r}class Nb extends To{constructor(e,t,n){super(e),this.name="StorageApiError",this.status=t,this.statusCode=n}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class Ha extends To{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}const Ro=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>hr(async()=>{const{default:n}=await Promise.resolve().then(()=>ln);return{default:n}},void 0).then(({default:n})=>n(...t)):e=fetch,(...t)=>e(...t)},Ab=()=>W(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield hr(()=>Promise.resolve().then(()=>ln),void 0)).Response:Response}),Ba=r=>{if(Array.isArray(r))return r.map(t=>Ba(t));if(typeof r=="function"||r!==Object(r))return r;const e={};return Object.entries(r).forEach(([t,n])=>{const s=t.replace(/([-_][a-z])/gi,i=>i.toUpperCase().replace(/[-_]/g,""));e[s]=Ba(n)}),e},Ib=r=>{if(typeof r!="object"||r===null)return!1;const e=Object.getPrototypeOf(r);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in r)&&!(Symbol.iterator in r)},la=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),Mb=(r,e,t)=>W(void 0,void 0,void 0,function*(){const n=yield Ab();r instanceof n&&!t?.noResolveJson?r.json().then(s=>{const i=r.status||500,a=s?.statusCode||i+"";e(new Nb(la(s),i,a))}).catch(s=>{e(new Ha(la(s),s))}):e(new Ha(la(r),r))}),Pb=(r,e,t,n)=>{const s={method:r,headers:e?.headers||{}};return r==="GET"||!n?s:(Ib(n)?(s.headers=Object.assign({"Content-Type":"application/json"},e?.headers),s.body=JSON.stringify(n)):s.body=n,e?.duplex&&(s.duplex=e.duplex),Object.assign(Object.assign({},s),t))};function Es(r,e,t,n,s,i){return W(this,void 0,void 0,function*(){return new Promise((a,o)=>{r(t,Pb(e,n,s,i)).then(l=>{if(!l.ok)throw l;return n?.noResolveJson?l:l.json()}).then(l=>a(l)).catch(l=>Mb(l,o,n))})})}function ps(r,e,t,n){return W(this,void 0,void 0,function*(){return Es(r,"GET",e,t,n)})}function Zt(r,e,t,n,s){return W(this,void 0,void 0,function*(){return Es(r,"POST",e,n,s,t)})}function za(r,e,t,n,s){return W(this,void 0,void 0,function*(){return Es(r,"PUT",e,n,s,t)})}function jb(r,e,t,n){return W(this,void 0,void 0,function*(){return Es(r,"HEAD",e,Object.assign(Object.assign({},t),{noResolveJson:!0}),n)})}function Oo(r,e,t,n,s){return W(this,void 0,void 0,function*(){return Es(r,"DELETE",e,n,s,t)})}class Lb{constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t}then(e,t){return this.execute().then(e,t)}execute(){return W(this,void 0,void 0,function*(){try{return{data:(yield this.downloadFn()).body,error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(ze(e))return{data:null,error:e};throw e}})}}var Ld;class $b{constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t,this[Ld]="BlobDownloadBuilder",this.promise=null}asStream(){return new Lb(this.downloadFn,this.shouldThrowOnError)}then(e,t){return this.getPromise().then(e,t)}catch(e){return this.getPromise().catch(e)}finally(e){return this.getPromise().finally(e)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}execute(){return W(this,void 0,void 0,function*(){try{return{data:yield(yield this.downloadFn()).blob(),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(ze(e))return{data:null,error:e};throw e}})}}Ld=Symbol.toStringTag;const Fb={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Cl={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class Ub{constructor(e,t={},n,s){this.shouldThrowOnError=!1,this.url=e,this.headers=t,this.bucketId=n,this.fetch=Ro(s)}throwOnError(){return this.shouldThrowOnError=!0,this}uploadOrUpdate(e,t,n,s){return W(this,void 0,void 0,function*(){try{let i;const a=Object.assign(Object.assign({},Cl),s);let o=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(a.upsert)});const l=a.metadata;typeof Blob<"u"&&n instanceof Blob?(i=new FormData,i.append("cacheControl",a.cacheControl),l&&i.append("metadata",this.encodeMetadata(l)),i.append("",n)):typeof FormData<"u"&&n instanceof FormData?(i=n,i.append("cacheControl",a.cacheControl),l&&i.append("metadata",this.encodeMetadata(l))):(i=n,o["cache-control"]=`max-age=${a.cacheControl}`,o["content-type"]=a.contentType,l&&(o["x-metadata"]=this.toBase64(this.encodeMetadata(l)))),s?.headers&&(o=Object.assign(Object.assign({},o),s.headers));const c=this._removeEmptyFolders(t),d=this._getFinalPath(c),u=yield(e=="PUT"?za:Zt)(this.fetch,`${this.url}/object/${d}`,i,Object.assign({headers:o},a?.duplex?{duplex:a.duplex}:{}));return{data:{path:c,id:u.Id,fullPath:u.Key},error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(ze(i))return{data:null,error:i};throw i}})}upload(e,t,n){return W(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,n)})}uploadToSignedUrl(e,t,n,s){return W(this,void 0,void 0,function*(){const i=this._removeEmptyFolders(e),a=this._getFinalPath(i),o=new URL(this.url+`/object/upload/sign/${a}`);o.searchParams.set("token",t);try{let l;const c=Object.assign({upsert:Cl.upsert},s),d=Object.assign(Object.assign({},this.headers),{"x-upsert":String(c.upsert)});typeof Blob<"u"&&n instanceof Blob?(l=new FormData,l.append("cacheControl",c.cacheControl),l.append("",n)):typeof FormData<"u"&&n instanceof FormData?(l=n,l.append("cacheControl",c.cacheControl)):(l=n,d["cache-control"]=`max-age=${c.cacheControl}`,d["content-type"]=c.contentType);const u=yield za(this.fetch,o.toString(),l,{headers:d});return{data:{path:i,fullPath:u.Key},error:null}}catch(l){if(this.shouldThrowOnError)throw l;if(ze(l))return{data:null,error:l};throw l}})}createSignedUploadUrl(e,t){return W(this,void 0,void 0,function*(){try{let n=this._getFinalPath(e);const s=Object.assign({},this.headers);t?.upsert&&(s["x-upsert"]="true");const i=yield Zt(this.fetch,`${this.url}/object/upload/sign/${n}`,{},{headers:s}),a=new URL(this.url+i.url),o=a.searchParams.get("token");if(!o)throw new To("No token returned by API");return{data:{signedUrl:a.toString(),path:e,token:o},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(ze(n))return{data:null,error:n};throw n}})}update(e,t,n){return W(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,n)})}move(e,t,n){return W(this,void 0,void 0,function*(){try{return{data:yield Zt(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:n?.destinationBucket},{headers:this.headers}),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(ze(s))return{data:null,error:s};throw s}})}copy(e,t,n){return W(this,void 0,void 0,function*(){try{return{data:{path:(yield Zt(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:n?.destinationBucket},{headers:this.headers})).Key},error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(ze(s))return{data:null,error:s};throw s}})}createSignedUrl(e,t,n){return W(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e),i=yield Zt(this.fetch,`${this.url}/object/sign/${s}`,Object.assign({expiresIn:t},n?.transform?{transform:n.transform}:{}),{headers:this.headers});const a=n?.download?`&download=${n.download===!0?"":n.download}`:"";return i={signedUrl:encodeURI(`${this.url}${i.signedURL}${a}`)},{data:i,error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(ze(s))return{data:null,error:s};throw s}})}createSignedUrls(e,t,n){return W(this,void 0,void 0,function*(){try{const s=yield Zt(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),i=n?.download?`&download=${n.download===!0?"":n.download}`:"";return{data:s.map(a=>Object.assign(Object.assign({},a),{signedUrl:a.signedURL?encodeURI(`${this.url}${a.signedURL}${i}`):null})),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(ze(s))return{data:null,error:s};throw s}})}download(e,t){const s=typeof t?.transform<"u"?"render/image/authenticated":"object",i=this.transformOptsToQueryString(t?.transform||{}),a=i?`?${i}`:"",o=this._getFinalPath(e),l=()=>ps(this.fetch,`${this.url}/${s}/${o}${a}`,{headers:this.headers,noResolveJson:!0});return new $b(l,this.shouldThrowOnError)}info(e){return W(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const n=yield ps(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:Ba(n),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(ze(n))return{data:null,error:n};throw n}})}exists(e){return W(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield jb(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(ze(n)&&n instanceof Ha){const s=n.originalError;if([400,404].includes(s?.status))return{data:!1,error:n}}throw n}})}getPublicUrl(e,t){const n=this._getFinalPath(e),s=[],i=t?.download?`download=${t.download===!0?"":t.download}`:"";i!==""&&s.push(i);const o=typeof t?.transform<"u"?"render/image":"object",l=this.transformOptsToQueryString(t?.transform||{});l!==""&&s.push(l);let c=s.join("&");return c!==""&&(c=`?${c}`),{data:{publicUrl:encodeURI(`${this.url}/${o}/public/${n}${c}`)}}}remove(e){return W(this,void 0,void 0,function*(){try{return{data:yield Oo(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(ze(t))return{data:null,error:t};throw t}})}list(e,t,n){return W(this,void 0,void 0,function*(){try{const s=Object.assign(Object.assign(Object.assign({},Fb),t),{prefix:e||""});return{data:yield Zt(this.fetch,`${this.url}/object/list/${this.bucketId}`,s,{headers:this.headers},n),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(ze(s))return{data:null,error:s};throw s}})}listV2(e,t){return W(this,void 0,void 0,function*(){try{const n=Object.assign({},e);return{data:yield Zt(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,n,{headers:this.headers},t),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(ze(n))return{data:null,error:n};throw n}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e.replace(/^\/+/,"")}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const $d="2.76.1",Fd={"X-Client-Info":`storage-js/${$d}`};class Hb{constructor(e,t={},n,s){this.shouldThrowOnError=!1;const i=new URL(e);s?.useNewHostname&&/supabase\.(co|in|red)$/.test(i.hostname)&&!i.hostname.includes("storage.supabase.")&&(i.hostname=i.hostname.replace("supabase.","storage.supabase.")),this.url=i.href.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},Fd),t),this.fetch=Ro(n)}throwOnError(){return this.shouldThrowOnError=!0,this}listBuckets(){return W(this,void 0,void 0,function*(){try{return{data:yield ps(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(ze(e))return{data:null,error:e};throw e}})}getBucket(e){return W(this,void 0,void 0,function*(){try{return{data:yield ps(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(ze(t))return{data:null,error:t};throw t}})}createBucket(e){return W(this,arguments,void 0,function*(t,n={public:!1}){try{return{data:yield Zt(this.fetch,`${this.url}/bucket`,{id:t,name:t,type:n.type,public:n.public,file_size_limit:n.fileSizeLimit,allowed_mime_types:n.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(ze(s))return{data:null,error:s};throw s}})}updateBucket(e,t){return W(this,void 0,void 0,function*(){try{return{data:yield za(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(ze(n))return{data:null,error:n};throw n}})}emptyBucket(e){return W(this,void 0,void 0,function*(){try{return{data:yield Zt(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(ze(t))return{data:null,error:t};throw t}})}deleteBucket(e){return W(this,void 0,void 0,function*(){try{return{data:yield Oo(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(ze(t))return{data:null,error:t};throw t}})}}class Bb{constructor(e,t={},n){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},Fd),t),this.fetch=Ro(n)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(e){return W(this,void 0,void 0,function*(){try{return{data:yield Zt(this.fetch,`${this.url}/bucket`,{name:e},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(ze(t))return{data:null,error:t};throw t}})}listBuckets(e){return W(this,void 0,void 0,function*(){try{const t=new URLSearchParams;e?.limit!==void 0&&t.set("limit",e.limit.toString()),e?.offset!==void 0&&t.set("offset",e.offset.toString()),e?.sortColumn&&t.set("sortColumn",e.sortColumn),e?.sortOrder&&t.set("sortOrder",e.sortOrder),e?.search&&t.set("search",e.search);const n=t.toString(),s=n?`${this.url}/bucket?${n}`:`${this.url}/bucket`,i=yield ps(this.fetch,s,{headers:this.headers});return{data:Array.isArray(i)?i.filter(o=>o.type==="ANALYTICS"):[],error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(ze(t))return{data:null,error:t};throw t}})}deleteBucket(e){return W(this,void 0,void 0,function*(){try{return{data:yield Oo(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(ze(t))return{data:null,error:t};throw t}})}}const Co={"X-Client-Info":`storage-js/${$d}`,"Content-Type":"application/json"};class Ud extends Error{constructor(e){super(e),this.__isStorageVectorsError=!0,this.name="StorageVectorsError"}}function Pt(r){return typeof r=="object"&&r!==null&&"__isStorageVectorsError"in r}class ca extends Ud{constructor(e,t,n){super(e),this.name="StorageVectorsApiError",this.status=t,this.statusCode=n}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class zb extends Ud{constructor(e,t){super(e),this.name="StorageVectorsUnknownError",this.originalError=t}}var kl;(function(r){r.InternalError="InternalError",r.S3VectorConflictException="S3VectorConflictException",r.S3VectorNotFoundException="S3VectorNotFoundException",r.S3VectorBucketNotEmpty="S3VectorBucketNotEmpty",r.S3VectorMaxBucketsExceeded="S3VectorMaxBucketsExceeded",r.S3VectorMaxIndexesExceeded="S3VectorMaxIndexesExceeded"})(kl||(kl={}));const ko=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>hr(async()=>{const{default:n}=await Promise.resolve().then(()=>ln);return{default:n}},void 0).then(({default:n})=>n(...t)):e=fetch,(...t)=>e(...t)},Wb=r=>{if(typeof r!="object"||r===null)return!1;const e=Object.getPrototypeOf(r);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in r)&&!(Symbol.iterator in r)},Dl=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),qb=(r,e,t)=>W(void 0,void 0,void 0,function*(){if(r&&typeof r=="object"&&"status"in r&&"ok"in r&&typeof r.status=="number"&&!t?.noResolveJson){const s=r.status||500,i=r;if(typeof i.json=="function")i.json().then(a=>{const o=a?.statusCode||a?.code||s+"";e(new ca(Dl(a),s,o))}).catch(()=>{const a=s+"",o=i.statusText||`HTTP ${s} error`;e(new ca(o,s,a))});else{const a=s+"",o=i.statusText||`HTTP ${s} error`;e(new ca(o,s,a))}}else e(new zb(Dl(r),r))}),Vb=(r,e,t,n)=>{const s={method:r,headers:e?.headers||{}};return n?(Wb(n)?(s.headers=Object.assign({"Content-Type":"application/json"},e?.headers),s.body=JSON.stringify(n)):s.body=n,Object.assign(Object.assign({},s),t)):s};function Gb(r,e,t,n,s,i){return W(this,void 0,void 0,function*(){return new Promise((a,o)=>{r(t,Vb(e,n,s,i)).then(l=>{if(!l.ok)throw l;if(n?.noResolveJson)return l;const c=l.headers.get("content-type");return!c||!c.includes("application/json")?{}:l.json()}).then(l=>a(l)).catch(l=>qb(l,o,n))})})}function jt(r,e,t,n,s){return W(this,void 0,void 0,function*(){return Gb(r,"POST",e,n,s,t)})}class Kb{constructor(e,t={},n){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},Co),t),this.fetch=ko(n)}throwOnError(){return this.shouldThrowOnError=!0,this}createIndex(e){return W(this,void 0,void 0,function*(){try{return{data:(yield jt(this.fetch,`${this.url}/CreateIndex`,e,{headers:this.headers}))||{},error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Pt(t))return{data:null,error:t};throw t}})}getIndex(e,t){return W(this,void 0,void 0,function*(){try{return{data:yield jt(this.fetch,`${this.url}/GetIndex`,{vectorBucketName:e,indexName:t},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Pt(n))return{data:null,error:n};throw n}})}listIndexes(e){return W(this,void 0,void 0,function*(){try{return{data:yield jt(this.fetch,`${this.url}/ListIndexes`,e,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Pt(t))return{data:null,error:t};throw t}})}deleteIndex(e,t){return W(this,void 0,void 0,function*(){try{return{data:(yield jt(this.fetch,`${this.url}/DeleteIndex`,{vectorBucketName:e,indexName:t},{headers:this.headers}))||{},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Pt(n))return{data:null,error:n};throw n}})}}class Yb{constructor(e,t={},n){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},Co),t),this.fetch=ko(n)}throwOnError(){return this.shouldThrowOnError=!0,this}putVectors(e){return W(this,void 0,void 0,function*(){try{if(e.vectors.length<1||e.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return{data:(yield jt(this.fetch,`${this.url}/PutVectors`,e,{headers:this.headers}))||{},error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Pt(t))return{data:null,error:t};throw t}})}getVectors(e){return W(this,void 0,void 0,function*(){try{return{data:yield jt(this.fetch,`${this.url}/GetVectors`,e,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Pt(t))return{data:null,error:t};throw t}})}listVectors(e){return W(this,void 0,void 0,function*(){try{if(e.segmentCount!==void 0){if(e.segmentCount<1||e.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(e.segmentIndex!==void 0&&(e.segmentIndex<0||e.segmentIndex>=e.segmentCount))throw new Error(`segmentIndex must be between 0 and ${e.segmentCount-1}`)}return{data:yield jt(this.fetch,`${this.url}/ListVectors`,e,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Pt(t))return{data:null,error:t};throw t}})}queryVectors(e){return W(this,void 0,void 0,function*(){try{return{data:yield jt(this.fetch,`${this.url}/QueryVectors`,e,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Pt(t))return{data:null,error:t};throw t}})}deleteVectors(e){return W(this,void 0,void 0,function*(){try{if(e.keys.length<1||e.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return{data:(yield jt(this.fetch,`${this.url}/DeleteVectors`,e,{headers:this.headers}))||{},error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Pt(t))return{data:null,error:t};throw t}})}}class Xb{constructor(e,t={},n){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},Co),t),this.fetch=ko(n)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(e){return W(this,void 0,void 0,function*(){try{return{data:(yield jt(this.fetch,`${this.url}/CreateVectorBucket`,{vectorBucketName:e},{headers:this.headers}))||{},error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Pt(t))return{data:null,error:t};throw t}})}getBucket(e){return W(this,void 0,void 0,function*(){try{return{data:yield jt(this.fetch,`${this.url}/GetVectorBucket`,{vectorBucketName:e},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Pt(t))return{data:null,error:t};throw t}})}listBuckets(){return W(this,arguments,void 0,function*(e={}){try{return{data:yield jt(this.fetch,`${this.url}/ListVectorBuckets`,e,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Pt(t))return{data:null,error:t};throw t}})}deleteBucket(e){return W(this,void 0,void 0,function*(){try{return{data:(yield jt(this.fetch,`${this.url}/DeleteVectorBucket`,{vectorBucketName:e},{headers:this.headers}))||{},error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Pt(t))return{data:null,error:t};throw t}})}}class Qb extends Xb{constructor(e,t={}){super(e,t.headers||{},t.fetch)}from(e){return new Jb(this.url,this.headers,e,this.fetch)}}class Jb extends Kb{constructor(e,t,n,s){super(e,t,s),this.vectorBucketName=n}createIndex(e){const t=Object.create(null,{createIndex:{get:()=>super.createIndex}});return W(this,void 0,void 0,function*(){return t.createIndex.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName}))})}listIndexes(){const e=Object.create(null,{listIndexes:{get:()=>super.listIndexes}});return W(this,arguments,void 0,function*(t={}){return e.listIndexes.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName}))})}getIndex(e){const t=Object.create(null,{getIndex:{get:()=>super.getIndex}});return W(this,void 0,void 0,function*(){return t.getIndex.call(this,this.vectorBucketName,e)})}deleteIndex(e){const t=Object.create(null,{deleteIndex:{get:()=>super.deleteIndex}});return W(this,void 0,void 0,function*(){return t.deleteIndex.call(this,this.vectorBucketName,e)})}index(e){return new Zb(this.url,this.headers,this.vectorBucketName,e,this.fetch)}}class Zb extends Yb{constructor(e,t,n,s,i){super(e,t,i),this.vectorBucketName=n,this.indexName=s}putVectors(e){const t=Object.create(null,{putVectors:{get:()=>super.putVectors}});return W(this,void 0,void 0,function*(){return t.putVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}getVectors(e){const t=Object.create(null,{getVectors:{get:()=>super.getVectors}});return W(this,void 0,void 0,function*(){return t.getVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}listVectors(){const e=Object.create(null,{listVectors:{get:()=>super.listVectors}});return W(this,arguments,void 0,function*(t={}){return e.listVectors.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}queryVectors(e){const t=Object.create(null,{queryVectors:{get:()=>super.queryVectors}});return W(this,void 0,void 0,function*(){return t.queryVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}deleteVectors(e){const t=Object.create(null,{deleteVectors:{get:()=>super.deleteVectors}});return W(this,void 0,void 0,function*(){return t.deleteVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}}class ey extends Hb{constructor(e,t={},n,s){super(e,t,n,s)}from(e){return new Ub(this.url,this.headers,e,this.fetch)}get vectors(){return new Qb(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new Bb(this.url+"/iceberg",this.headers,this.fetch)}}const ty="2.76.1";let es="";typeof Deno<"u"?es="deno":typeof document<"u"?es="web":typeof navigator<"u"&&navigator.product==="ReactNative"?es="react-native":es="node";const ry={"X-Client-Info":`supabase-js-${es}/${ty}`},ny={headers:ry},sy={schema:"public"},iy={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},ay={},oy=r=>{let e;return r?e=r:typeof fetch>"u"?e=Cd:e=fetch,(...t)=>e(...t)},ly=()=>typeof Headers>"u"?kd:Headers,cy=(r,e,t)=>{const n=oy(t),s=ly();return async(i,a)=>{var o;const l=(o=await e())!==null&&o!==void 0?o:r;let c=new s(a?.headers);return c.has("apikey")||c.set("apikey",r),c.has("Authorization")||c.set("Authorization",`Bearer ${l}`),n(i,Object.assign(Object.assign({},a),{headers:c}))}};function dy(r){return r.endsWith("/")?r:r+"/"}function uy(r,e){var t,n;const{db:s,auth:i,realtime:a,global:o}=r,{db:l,auth:c,realtime:d,global:u}=e,f={db:Object.assign(Object.assign({},l),s),auth:Object.assign(Object.assign({},c),i),realtime:Object.assign(Object.assign({},d),a),storage:{},global:Object.assign(Object.assign(Object.assign({},u),o),{headers:Object.assign(Object.assign({},(t=u?.headers)!==null&&t!==void 0?t:{}),(n=o?.headers)!==null&&n!==void 0?n:{})}),accessToken:async()=>""};return r.accessToken?f.accessToken=r.accessToken:delete f.accessToken,f}function hy(r){const e=r?.trim();if(!e)throw new Error("supabaseUrl is required.");if(!e.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(dy(e))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}const Hd="2.76.1",Sn=30*1e3,Wa=3,da=Wa*Sn,fy="http://localhost:9999",gy="supabase.auth.token",my={"X-Client-Info":`gotrue-js/${Hd}`},qa="X-Supabase-Api-Version",Bd={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},py=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,by=600*1e3;class bs extends Error{constructor(e,t,n){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=n}}function X(r){return typeof r=="object"&&r!==null&&"__isAuthError"in r}class yy extends bs{constructor(e,t,n){super(e,t,n),this.name="AuthApiError",this.status=t,this.code=n}}function vy(r){return X(r)&&r.name==="AuthApiError"}class Jr extends bs{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class Br extends bs{constructor(e,t,n,s){super(e,n,s),this.name=t,this.status=n}}class jr extends Br{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function wy(r){return X(r)&&r.name==="AuthSessionMissingError"}class mn extends Br{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Ws extends Br{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class qs extends Br{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function _y(r){return X(r)&&r.name==="AuthImplicitGrantRedirectError"}class Nl extends Br{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Va extends Br{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function ua(r){return X(r)&&r.name==="AuthRetryableFetchError"}class Al extends Br{constructor(e,t,n){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=n}}class Ga extends Br{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const gi="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),Il=` 	
\r=`.split(""),Sy=(()=>{const r=new Array(128);for(let e=0;e<r.length;e+=1)r[e]=-1;for(let e=0;e<Il.length;e+=1)r[Il[e].charCodeAt(0)]=-2;for(let e=0;e<gi.length;e+=1)r[gi[e].charCodeAt(0)]=e;return r})();function Ml(r,e,t){if(r!==null)for(e.queue=e.queue<<8|r,e.queuedBits+=8;e.queuedBits>=6;){const n=e.queue>>e.queuedBits-6&63;t(gi[n]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const n=e.queue>>e.queuedBits-6&63;t(gi[n]),e.queuedBits-=6}}function zd(r,e,t){const n=Sy[r];if(n>-1)for(e.queue=e.queue<<6|n,e.queuedBits+=6;e.queuedBits>=8;)t(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(n===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(r)}"`)}}function Pl(r){const e=[],t=a=>{e.push(String.fromCodePoint(a))},n={utf8seq:0,codepoint:0},s={queue:0,queuedBits:0},i=a=>{Ty(a,n,t)};for(let a=0;a<r.length;a+=1)zd(r.charCodeAt(a),s,i);return e.join("")}function xy(r,e){if(r<=127){e(r);return}else if(r<=2047){e(192|r>>6),e(128|r&63);return}else if(r<=65535){e(224|r>>12),e(128|r>>6&63),e(128|r&63);return}else if(r<=1114111){e(240|r>>18),e(128|r>>12&63),e(128|r>>6&63),e(128|r&63);return}throw new Error(`Unrecognized Unicode codepoint: ${r.toString(16)}`)}function Ey(r,e){for(let t=0;t<r.length;t+=1){let n=r.charCodeAt(t);if(n>55295&&n<=56319){const s=(n-55296)*1024&65535;n=(r.charCodeAt(t+1)-56320&65535|s)+65536,t+=1}xy(n,e)}}function Ty(r,e,t){if(e.utf8seq===0){if(r<=127){t(r);return}for(let n=1;n<6;n+=1)if((r>>7-n&1)===0){e.utf8seq=n;break}if(e.utf8seq===2)e.codepoint=r&31;else if(e.utf8seq===3)e.codepoint=r&15;else if(e.utf8seq===4)e.codepoint=r&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(r<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|r&63,e.utf8seq-=1,e.utf8seq===0&&t(e.codepoint)}}function Cn(r){const e=[],t={queue:0,queuedBits:0},n=s=>{e.push(s)};for(let s=0;s<r.length;s+=1)zd(r.charCodeAt(s),t,n);return new Uint8Array(e)}function Ry(r){const e=[];return Ey(r,t=>e.push(t)),new Uint8Array(e)}function rn(r){const e=[],t={queue:0,queuedBits:0},n=s=>{e.push(s)};return r.forEach(s=>Ml(s,t,n)),Ml(null,t,n),e.join("")}function Oy(r){return Math.round(Date.now()/1e3)+r}function Cy(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(r){const e=Math.random()*16|0;return(r=="x"?e:e&3|8).toString(16)})}const Mt=()=>typeof window<"u"&&typeof document<"u",qr={tested:!1,writable:!1},Wd=()=>{if(!Mt())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(qr.tested)return qr.writable;const r=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(r,r),globalThis.localStorage.removeItem(r),qr.tested=!0,qr.writable=!0}catch{qr.tested=!0,qr.writable=!1}return qr.writable};function ky(r){const e={},t=new URL(r);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((s,i)=>{e[i]=s})}catch{}return t.searchParams.forEach((n,s)=>{e[s]=n}),e}const qd=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>hr(async()=>{const{default:n}=await Promise.resolve().then(()=>ln);return{default:n}},void 0).then(({default:n})=>n(...t)):e=fetch,(...t)=>e(...t)},Dy=r=>typeof r=="object"&&r!==null&&"status"in r&&"ok"in r&&"json"in r&&typeof r.json=="function",xn=async(r,e,t)=>{await r.setItem(e,JSON.stringify(t))},Vr=async(r,e)=>{const t=await r.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},Mr=async(r,e)=>{await r.removeItem(e)};class ji{constructor(){this.promise=new ji.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}ji.promiseConstructor=Promise;function ha(r){const e=r.split(".");if(e.length!==3)throw new Ga("Invalid JWT structure");for(let n=0;n<e.length;n++)if(!py.test(e[n]))throw new Ga("JWT not in base64url format");return{header:JSON.parse(Pl(e[0])),payload:JSON.parse(Pl(e[1])),signature:Cn(e[2]),raw:{header:e[0],payload:e[1]}}}async function Ny(r){return await new Promise(e=>{setTimeout(()=>e(null),r)})}function Ay(r,e){return new Promise((n,s)=>{(async()=>{for(let i=0;i<1/0;i++)try{const a=await r(i);if(!e(i,null,a)){n(a);return}}catch(a){if(!e(i,a)){s(a);return}}})()})}function Iy(r){return("0"+r.toString(16)).substr(-2)}function My(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",n=t.length;let s="";for(let i=0;i<56;i++)s+=t.charAt(Math.floor(Math.random()*n));return s}return crypto.getRandomValues(e),Array.from(e,Iy).join("")}async function Py(r){const t=new TextEncoder().encode(r),n=await crypto.subtle.digest("SHA-256",t),s=new Uint8Array(n);return Array.from(s).map(i=>String.fromCharCode(i)).join("")}async function jy(r){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),r;const t=await Py(r);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function pn(r,e,t=!1){const n=My();let s=n;t&&(s+="/PASSWORD_RECOVERY"),await xn(r,`${e}-code-verifier`,s);const i=await jy(n);return[i,n===i?"plain":"s256"]}const Ly=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function $y(r){const e=r.headers.get(qa);if(!e||!e.match(Ly))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function Fy(r){if(!r)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(r<=e)throw new Error("JWT has expired")}function Uy(r){switch(r){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const Hy=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function bn(r){if(!Hy.test(r))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function fa(){const r={};return new Proxy(r,{get:(e,t)=>{if(t==="__isUserNotAvailableProxy")return!0;if(typeof t=="symbol"){const n=t.toString();if(n==="Symbol(Symbol.toPrimitive)"||n==="Symbol(Symbol.toStringTag)"||n==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${t}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function jl(r){return JSON.parse(JSON.stringify(r))}const Yr=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),By=[502,503,504];async function Ll(r){var e;if(!Dy(r))throw new Va(Yr(r),0);if(By.includes(r.status))throw new Va(Yr(r),r.status);let t;try{t=await r.json()}catch(i){throw new Jr(Yr(i),i)}let n;const s=$y(r);if(s&&s.getTime()>=Bd["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?n=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(n=t.error_code),n){if(n==="weak_password")throw new Al(Yr(t),r.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(n==="session_not_found")throw new jr}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((i,a)=>i&&typeof a=="string",!0))throw new Al(Yr(t),r.status,t.weak_password.reasons);throw new yy(Yr(t),r.status||500,n)}const zy=(r,e,t,n)=>{const s={method:r,headers:e?.headers||{}};return r==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e?.headers),s.body=JSON.stringify(n),Object.assign(Object.assign({},s),t))};async function te(r,e,t,n){var s;const i=Object.assign({},n?.headers);i[qa]||(i[qa]=Bd["2024-01-01"].name),n?.jwt&&(i.Authorization=`Bearer ${n.jwt}`);const a=(s=n?.query)!==null&&s!==void 0?s:{};n?.redirectTo&&(a.redirect_to=n.redirectTo);const o=Object.keys(a).length?"?"+new URLSearchParams(a).toString():"",l=await Wy(r,e,t+o,{headers:i,noResolveJson:n?.noResolveJson},{},n?.body);return n?.xform?n?.xform(l):{data:Object.assign({},l),error:null}}async function Wy(r,e,t,n,s,i){const a=zy(e,n,s,i);let o;try{o=await r(t,Object.assign({},a))}catch(l){throw console.error(l),new Va(Yr(l),0)}if(o.ok||await Ll(o),n?.noResolveJson)return o;try{return await o.json()}catch(l){await Ll(l)}}function Qt(r){var e;let t=null;Gy(r)&&(t=Object.assign({},r),r.expires_at||(t.expires_at=Oy(r.expires_in)));const n=(e=r.user)!==null&&e!==void 0?e:r;return{data:{session:t,user:n},error:null}}function $l(r){const e=Qt(r);return!e.error&&r.weak_password&&typeof r.weak_password=="object"&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.message&&typeof r.weak_password.message=="string"&&r.weak_password.reasons.reduce((t,n)=>t&&typeof n=="string",!0)&&(e.data.weak_password=r.weak_password),e}function Ur(r){var e;return{data:{user:(e=r.user)!==null&&e!==void 0?e:r},error:null}}function qy(r){return{data:r,error:null}}function Vy(r){const{action_link:e,email_otp:t,hashed_token:n,redirect_to:s,verification_type:i}=r,a=ki(r,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),o={action_link:e,email_otp:t,hashed_token:n,redirect_to:s,verification_type:i},l=Object.assign({},a);return{data:{properties:o,user:l},error:null}}function Fl(r){return r}function Gy(r){return r.access_token&&r.refresh_token&&r.expires_in}const ga=["global","local","others"];class Ky{constructor({url:e="",headers:t={},fetch:n}){this.url=e,this.headers=t,this.fetch=qd(n),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(e,t=ga[0]){if(ga.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${ga.join(", ")}`);try{return await te(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(n){if(X(n))return{data:null,error:n};throw n}}async inviteUserByEmail(e,t={}){try{return await te(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:Ur})}catch(n){if(X(n))return{data:{user:null},error:n};throw n}}async generateLink(e){try{const{options:t}=e,n=ki(e,["options"]),s=Object.assign(Object.assign({},n),t);return"newEmail"in n&&(s.new_email=n?.newEmail,delete s.newEmail),await te(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:s,headers:this.headers,xform:Vy,redirectTo:t?.redirectTo})}catch(t){if(X(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await te(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:Ur})}catch(t){if(X(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,n,s,i,a,o,l;try{const c={nextPage:null,lastPage:0,total:0},d=await te(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(n=(t=e?.page)===null||t===void 0?void 0:t.toString())!==null&&n!==void 0?n:"",per_page:(i=(s=e?.perPage)===null||s===void 0?void 0:s.toString())!==null&&i!==void 0?i:""},xform:Fl});if(d.error)throw d.error;const u=await d.json(),f=(a=d.headers.get("x-total-count"))!==null&&a!==void 0?a:0,g=(l=(o=d.headers.get("link"))===null||o===void 0?void 0:o.split(","))!==null&&l!==void 0?l:[];return g.length>0&&(g.forEach(b=>{const m=parseInt(b.split(";")[0].split("=")[1].substring(0,1)),y=JSON.parse(b.split(";")[1].split("=")[1]);c[`${y}Page`]=m}),c.total=parseInt(f)),{data:Object.assign(Object.assign({},u),c),error:null}}catch(c){if(X(c))return{data:{users:[]},error:c};throw c}}async getUserById(e){bn(e);try{return await te(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:Ur})}catch(t){if(X(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){bn(e);try{return await te(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:Ur})}catch(n){if(X(n))return{data:{user:null},error:n};throw n}}async deleteUser(e,t=!1){bn(e);try{return await te(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:Ur})}catch(n){if(X(n))return{data:{user:null},error:n};throw n}}async _listFactors(e){bn(e.userId);try{const{data:t,error:n}=await te(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:s=>({data:{factors:s},error:null})});return{data:t,error:n}}catch(t){if(X(t))return{data:null,error:t};throw t}}async _deleteFactor(e){bn(e.userId),bn(e.id);try{return{data:await te(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(X(t))return{data:null,error:t};throw t}}async _listOAuthClients(e){var t,n,s,i,a,o,l;try{const c={nextPage:null,lastPage:0,total:0},d=await te(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(n=(t=e?.page)===null||t===void 0?void 0:t.toString())!==null&&n!==void 0?n:"",per_page:(i=(s=e?.perPage)===null||s===void 0?void 0:s.toString())!==null&&i!==void 0?i:""},xform:Fl});if(d.error)throw d.error;const u=await d.json(),f=(a=d.headers.get("x-total-count"))!==null&&a!==void 0?a:0,g=(l=(o=d.headers.get("link"))===null||o===void 0?void 0:o.split(","))!==null&&l!==void 0?l:[];return g.length>0&&(g.forEach(b=>{const m=parseInt(b.split(";")[0].split("=")[1].substring(0,1)),y=JSON.parse(b.split(";")[1].split("=")[1]);c[`${y}Page`]=m}),c.total=parseInt(f)),{data:Object.assign(Object.assign({},u),c),error:null}}catch(c){if(X(c))return{data:{clients:[]},error:c};throw c}}async _createOAuthClient(e){try{return await te(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:e,headers:this.headers,xform:t=>({data:t,error:null})})}catch(t){if(X(t))return{data:null,error:t};throw t}}async _getOAuthClient(e){try{return await te(this.fetch,"GET",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,xform:t=>({data:t,error:null})})}catch(t){if(X(t))return{data:null,error:t};throw t}}async _deleteOAuthClient(e){try{return await te(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,xform:t=>({data:t,error:null})})}catch(t){if(X(t))return{data:null,error:t};throw t}}async _regenerateOAuthClientSecret(e){try{return await te(this.fetch,"POST",`${this.url}/admin/oauth/clients/${e}/regenerate_secret`,{headers:this.headers,xform:t=>({data:t,error:null})})}catch(t){if(X(t))return{data:null,error:t};throw t}}}function Ul(r={}){return{getItem:e=>r[e]||null,setItem:(e,t)=>{r[e]=t},removeItem:e=>{delete r[e]}}}const yn={debug:!!(globalThis&&Wd()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class Vd extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class Yy extends Vd{}async function Xy(r,e,t){yn.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",r,e);const n=new globalThis.AbortController;return e>0&&setTimeout(()=>{n.abort(),yn.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",r)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(r,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:n.signal},async s=>{if(s){yn.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",r,s.name);try{return await t()}finally{yn.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",r,s.name)}}else{if(e===0)throw yn.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",r),new Yy(`Acquiring an exclusive Navigator LockManager lock "${r}" immediately failed`);if(yn.debug)try{const i=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(i,null,"  "))}catch(i){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",i)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}}))}function Qy(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function Gd(r){if(!/^0x[a-fA-F0-9]{40}$/.test(r))throw new Error(`@supabase/auth-js: Address "${r}" is invalid.`);return r.toLowerCase()}function Jy(r){return parseInt(r,16)}function Zy(r){const e=new TextEncoder().encode(r);return"0x"+Array.from(e,n=>n.toString(16).padStart(2,"0")).join("")}function ev(r){var e;const{chainId:t,domain:n,expirationTime:s,issuedAt:i=new Date,nonce:a,notBefore:o,requestId:l,resources:c,scheme:d,uri:u,version:f}=r;{if(!Number.isInteger(t))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${t}`);if(!n)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(a&&a.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${a}`);if(!u)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(f!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${f}`);if(!((e=r.statement)===null||e===void 0)&&e.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${r.statement}`)}const g=Gd(r.address),b=d?`${d}://${n}`:n,m=r.statement?`${r.statement}
`:"",y=`${b} wants you to sign in with your Ethereum account:
${g}

${m}`;let v=`URI: ${u}
Version: ${f}
Chain ID: ${t}${a?`
Nonce: ${a}`:""}
Issued At: ${i.toISOString()}`;if(s&&(v+=`
Expiration Time: ${s.toISOString()}`),o&&(v+=`
Not Before: ${o.toISOString()}`),l&&(v+=`
Request ID: ${l}`),c){let p=`
Resources:`;for(const w of c){if(!w||typeof w!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${w}`);p+=`
- ${w}`}v+=p}return`${y}
${v}`}class Je extends Error{constructor({message:e,code:t,cause:n,name:s}){var i;super(e,{cause:n}),this.__isWebAuthnError=!0,this.name=(i=s??(n instanceof Error?n.name:void 0))!==null&&i!==void 0?i:"Unknown Error",this.code=t}}class mi extends Je{constructor(e,t){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t,message:e}),this.name="WebAuthnUnknownError",this.originalError=t}}function tv({error:r,options:e}){var t,n,s;const{publicKey:i}=e;if(!i)throw Error("options was missing required publicKey property");if(r.name==="AbortError"){if(e.signal instanceof AbortSignal)return new Je({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:r})}else if(r.name==="ConstraintError"){if(((t=i.authenticatorSelection)===null||t===void 0?void 0:t.requireResidentKey)===!0)return new Je({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:r});if(e.mediation==="conditional"&&((n=i.authenticatorSelection)===null||n===void 0?void 0:n.userVerification)==="required")return new Je({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:r});if(((s=i.authenticatorSelection)===null||s===void 0?void 0:s.userVerification)==="required")return new Je({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:r})}else{if(r.name==="InvalidStateError")return new Je({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:r});if(r.name==="NotAllowedError")return new Je({message:r.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:r});if(r.name==="NotSupportedError")return i.pubKeyCredParams.filter(o=>o.type==="public-key").length===0?new Je({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:r}):new Je({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:r});if(r.name==="SecurityError"){const a=window.location.hostname;if(Kd(a)){if(i.rp.id!==a)return new Je({message:`The RP ID "${i.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:r})}else return new Je({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:r})}else if(r.name==="TypeError"){if(i.user.id.byteLength<1||i.user.id.byteLength>64)return new Je({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:r})}else if(r.name==="UnknownError")return new Je({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:r})}return new Je({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:r})}function rv({error:r,options:e}){const{publicKey:t}=e;if(!t)throw Error("options was missing required publicKey property");if(r.name==="AbortError"){if(e.signal instanceof AbortSignal)return new Je({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:r})}else{if(r.name==="NotAllowedError")return new Je({message:r.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:r});if(r.name==="SecurityError"){const n=window.location.hostname;if(Kd(n)){if(t.rpId!==n)return new Je({message:`The RP ID "${t.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:r})}else return new Je({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:r})}else if(r.name==="UnknownError")return new Je({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:r})}return new Je({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:r})}class nv{createNewAbortSignal(){if(this.controller){const t=new Error("Cancelling existing WebAuthn API call for new one");t.name="AbortError",this.controller.abort(t)}const e=new AbortController;return this.controller=e,e.signal}cancelCeremony(){if(this.controller){const e=new Error("Manually cancelling existing WebAuthn API call");e.name="AbortError",this.controller.abort(e),this.controller=void 0}}}const sv=new nv;function iv(r){if(!r)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(r);const{challenge:e,user:t,excludeCredentials:n}=r,s=ki(r,["challenge","user","excludeCredentials"]),i=Cn(e).buffer,a=Object.assign(Object.assign({},t),{id:Cn(t.id).buffer}),o=Object.assign(Object.assign({},s),{challenge:i,user:a});if(n&&n.length>0){o.excludeCredentials=new Array(n.length);for(let l=0;l<n.length;l++){const c=n[l];o.excludeCredentials[l]=Object.assign(Object.assign({},c),{id:Cn(c.id).buffer,type:c.type||"public-key",transports:c.transports})}}return o}function av(r){if(!r)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(r);const{challenge:e,allowCredentials:t}=r,n=ki(r,["challenge","allowCredentials"]),s=Cn(e).buffer,i=Object.assign(Object.assign({},n),{challenge:s});if(t&&t.length>0){i.allowCredentials=new Array(t.length);for(let a=0;a<t.length;a++){const o=t[a];i.allowCredentials[a]=Object.assign(Object.assign({},o),{id:Cn(o.id).buffer,type:o.type||"public-key",transports:o.transports})}}return i}function ov(r){var e;if("toJSON"in r&&typeof r.toJSON=="function")return r.toJSON();const t=r;return{id:r.id,rawId:r.id,response:{attestationObject:rn(new Uint8Array(r.response.attestationObject)),clientDataJSON:rn(new Uint8Array(r.response.clientDataJSON))},type:"public-key",clientExtensionResults:r.getClientExtensionResults(),authenticatorAttachment:(e=t.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function lv(r){var e;if("toJSON"in r&&typeof r.toJSON=="function")return r.toJSON();const t=r,n=r.getClientExtensionResults(),s=r.response;return{id:r.id,rawId:r.id,response:{authenticatorData:rn(new Uint8Array(s.authenticatorData)),clientDataJSON:rn(new Uint8Array(s.clientDataJSON)),signature:rn(new Uint8Array(s.signature)),userHandle:s.userHandle?rn(new Uint8Array(s.userHandle)):void 0},type:"public-key",clientExtensionResults:n,authenticatorAttachment:(e=t.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function Kd(r){return r==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(r)}function Hl(){var r,e;return!!(Mt()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((r=navigator?.credentials)===null||r===void 0?void 0:r.create)=="function"&&typeof((e=navigator?.credentials)===null||e===void 0?void 0:e.get)=="function")}async function cv(r){try{const e=await navigator.credentials.create(r);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new mi("Browser returned unexpected credential type",e)}:{data:null,error:new mi("Empty credential response",e)}}catch(e){return{data:null,error:tv({error:e,options:r})}}}async function dv(r){try{const e=await navigator.credentials.get(r);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new mi("Browser returned unexpected credential type",e)}:{data:null,error:new mi("Empty credential response",e)}}catch(e){return{data:null,error:rv({error:e,options:r})}}}const uv={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"none"},hv={userVerification:"preferred",hints:["security-key"]};function pi(...r){const e=s=>s!==null&&typeof s=="object"&&!Array.isArray(s),t=s=>s instanceof ArrayBuffer||ArrayBuffer.isView(s),n={};for(const s of r)if(s)for(const i in s){const a=s[i];if(a!==void 0)if(Array.isArray(a))n[i]=a;else if(t(a))n[i]=a;else if(e(a)){const o=n[i];e(o)?n[i]=pi(o,a):n[i]=pi(a)}else n[i]=a}return n}function fv(r,e){return pi(uv,r,e||{})}function gv(r,e){return pi(hv,r,e||{})}class mv{constructor(e){this.client=e,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(e){return this.client.mfa.enroll(Object.assign(Object.assign({},e),{factorType:"webauthn"}))}async _challenge({factorId:e,webauthn:t,friendlyName:n,signal:s},i){try{const{data:a,error:o}=await this.client.mfa.challenge({factorId:e,webauthn:t});if(!a)return{data:null,error:o};const l=s??sv.createNewAbortSignal();if(a.webauthn.type==="create"){const{user:c}=a.webauthn.credential_options.publicKey;c.name||(c.name=`${c.id}:${n}`),c.displayName||(c.displayName=c.name)}switch(a.webauthn.type){case"create":{const c=fv(a.webauthn.credential_options.publicKey,i?.create),{data:d,error:u}=await cv({publicKey:c,signal:l});return d?{data:{factorId:e,challengeId:a.id,webauthn:{type:a.webauthn.type,credential_response:d}},error:null}:{data:null,error:u}}case"request":{const c=gv(a.webauthn.credential_options.publicKey,i?.request),{data:d,error:u}=await dv(Object.assign(Object.assign({},a.webauthn.credential_options),{publicKey:c,signal:l}));return d?{data:{factorId:e,challengeId:a.id,webauthn:{type:a.webauthn.type,credential_response:d}},error:null}:{data:null,error:u}}}}catch(a){return X(a)?{data:null,error:a}:{data:null,error:new Jr("Unexpected error in challenge",a)}}}async _verify({challengeId:e,factorId:t,webauthn:n}){return this.client.mfa.verify({factorId:t,challengeId:e,webauthn:n})}async _authenticate({factorId:e,webauthn:{rpId:t=typeof window<"u"?window.location.hostname:void 0,rpOrigins:n=typeof window<"u"?[window.location.origin]:void 0,signal:s}},i){if(!t)return{data:null,error:new bs("rpId is required for WebAuthn authentication")};try{if(!Hl())return{data:null,error:new Jr("Browser does not support WebAuthn",null)};const{data:a,error:o}=await this.challenge({factorId:e,webauthn:{rpId:t,rpOrigins:n},signal:s},{request:i});if(!a)return{data:null,error:o};const{webauthn:l}=a;return this._verify({factorId:e,challengeId:a.challengeId,webauthn:{type:l.type,rpId:t,rpOrigins:n,credential_response:l.credential_response}})}catch(a){return X(a)?{data:null,error:a}:{data:null,error:new Jr("Unexpected error in authenticate",a)}}}async _register({friendlyName:e,rpId:t=typeof window<"u"?window.location.hostname:void 0,rpOrigins:n=typeof window<"u"?[window.location.origin]:void 0,signal:s},i){if(!t)return{data:null,error:new bs("rpId is required for WebAuthn registration")};try{if(!Hl())return{data:null,error:new Jr("Browser does not support WebAuthn",null)};const{data:a,error:o}=await this._enroll({friendlyName:e});if(!a)return await this.client.mfa.listFactors().then(d=>{var u;return(u=d.data)===null||u===void 0?void 0:u.all.find(f=>f.factor_type==="webauthn"&&f.friendly_name===e&&f.status!=="unverified")}).then(d=>d?this.client.mfa.unenroll({factorId:d?.id}):void 0),{data:null,error:o};const{data:l,error:c}=await this._challenge({factorId:a.id,friendlyName:a.friendly_name,webauthn:{rpId:t,rpOrigins:n},signal:s},{create:i});return l?this._verify({factorId:a.id,challengeId:l.challengeId,webauthn:{rpId:t,rpOrigins:n,type:l.webauthn.type,credential_response:l.webauthn.credential_response}}):{data:null,error:c}}catch(a){return X(a)?{data:null,error:a}:{data:null,error:new Jr("Unexpected error in register",a)}}}}Qy();const pv={url:fy,storageKey:gy,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:my,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function Bl(r,e,t){return await t()}const vn={};class ys{get jwks(){var e,t;return(t=(e=vn[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&t!==void 0?t:{keys:[]}}set jwks(e){vn[this.storageKey]=Object.assign(Object.assign({},vn[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,t;return(t=(e=vn[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&t!==void 0?t:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){vn[this.storageKey]=Object.assign(Object.assign({},vn[this.storageKey]),{cachedAt:e})}constructor(e){var t,n;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=ys.nextInstanceID,ys.nextInstanceID+=1,this.instanceID>0&&Mt()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const s=Object.assign(Object.assign({},pv),e);if(this.logDebugMessages=!!s.debug,typeof s.debug=="function"&&(this.logger=s.debug),this.persistSession=s.persistSession,this.storageKey=s.storageKey,this.autoRefreshToken=s.autoRefreshToken,this.admin=new Ky({url:s.url,headers:s.headers,fetch:s.fetch}),this.url=s.url,this.headers=s.headers,this.fetch=qd(s.fetch),this.lock=s.lock||Bl,this.detectSessionInUrl=s.detectSessionInUrl,this.flowType=s.flowType,this.hasCustomAuthorizationHeader=s.hasCustomAuthorizationHeader,s.lock?this.lock=s.lock:Mt()&&(!((t=globalThis?.navigator)===null||t===void 0)&&t.locks)?this.lock=Xy:this.lock=Bl,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new mv(this)},this.persistSession?(s.storage?this.storage=s.storage:Wd()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=Ul(this.memoryStorage)),s.userStorage&&(this.userStorage=s.userStorage)):(this.memoryStorage={},this.storage=Ul(this.memoryStorage)),Mt()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(i){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",i)}(n=this.broadcastChannel)===null||n===void 0||n.addEventListener("message",async i=>{this._debug("received broadcast notification from other tab or client",i),await this._notifyAllSubscribers(i.data.event,i.data.session,!1)})}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${Hd}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{const t=ky(window.location.href);let n="none";if(this._isImplicitGrantCallback(t)?n="implicit":await this._isPKCECallback(t)&&(n="pkce"),Mt()&&this.detectSessionInUrl&&n!=="none"){const{data:s,error:i}=await this._getSessionFromURL(t,n);if(i){if(this._debug("#_initialize()","error detecting session from URL",i),_y(i)){const l=(e=i.details)===null||e===void 0?void 0:e.code;if(l==="identity_already_exists"||l==="identity_not_found"||l==="single_identity_not_deletable")return{error:i}}return await this._removeSession(),{error:i}}const{session:a,redirectType:o}=s;return this._debug("#_initialize()","detected session in URL",a,"redirect type",o),await this._saveSession(a),setTimeout(async()=>{o==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",a):await this._notifyAllSubscribers("SIGNED_IN",a)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return X(t)?{error:t}:{error:new Jr("Unexpected error during initialization",t)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,n,s;try{const i=await te(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(n=(t=e?.options)===null||t===void 0?void 0:t.data)!==null&&n!==void 0?n:{},gotrue_meta_security:{captcha_token:(s=e?.options)===null||s===void 0?void 0:s.captchaToken}},xform:Qt}),{data:a,error:o}=i;if(o||!a)return{data:{user:null,session:null},error:o};const l=a.session,c=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:c,session:l},error:null}}catch(i){if(X(i))return{data:{user:null,session:null},error:i};throw i}}async signUp(e){var t,n,s;try{let i;if("email"in e){const{email:d,password:u,options:f}=e;let g=null,b=null;this.flowType==="pkce"&&([g,b]=await pn(this.storage,this.storageKey)),i=await te(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:f?.emailRedirectTo,body:{email:d,password:u,data:(t=f?.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:f?.captchaToken},code_challenge:g,code_challenge_method:b},xform:Qt})}else if("phone"in e){const{phone:d,password:u,options:f}=e;i=await te(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:d,password:u,data:(n=f?.data)!==null&&n!==void 0?n:{},channel:(s=f?.channel)!==null&&s!==void 0?s:"sms",gotrue_meta_security:{captcha_token:f?.captchaToken}},xform:Qt})}else throw new Ws("You must provide either an email or phone number and a password");const{data:a,error:o}=i;if(o||!a)return{data:{user:null,session:null},error:o};const l=a.session,c=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:c,session:l},error:null}}catch(i){if(X(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithPassword(e){try{let t;if("email"in e){const{email:i,password:a,options:o}=e;t=await te(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:i,password:a,gotrue_meta_security:{captcha_token:o?.captchaToken}},xform:$l})}else if("phone"in e){const{phone:i,password:a,options:o}=e;t=await te(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:i,password:a,gotrue_meta_security:{captcha_token:o?.captchaToken}},xform:$l})}else throw new Ws("You must provide either an email or phone number and a password");const{data:n,error:s}=t;return s?{data:{user:null,session:null},error:s}:!n||!n.session||!n.user?{data:{user:null,session:null},error:new mn}:(n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",n.session)),{data:Object.assign({user:n.user,session:n.session},n.weak_password?{weakPassword:n.weak_password}:null),error:s})}catch(t){if(X(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,n,s,i;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(n=e.options)===null||n===void 0?void 0:n.scopes,queryParams:(s=e.options)===null||s===void 0?void 0:s.queryParams,skipBrowserRedirect:(i=e.options)===null||i===void 0?void 0:i.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:t}=e;switch(t){case"ethereum":return await this.signInWithEthereum(e);case"solana":return await this.signInWithSolana(e);default:throw new Error(`@supabase/auth-js: Unsupported chain "${t}"`)}}async signInWithEthereum(e){var t,n,s,i,a,o,l,c,d,u,f;let g,b;if("message"in e)g=e.message,b=e.signature;else{const{chain:m,wallet:y,statement:v,options:p}=e;let w;if(Mt())if(typeof y=="object")w=y;else{const k=window;if("ethereum"in k&&typeof k.ethereum=="object"&&"request"in k.ethereum&&typeof k.ethereum.request=="function")w=k.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof y!="object"||!p?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");w=y}const S=new URL((t=p?.url)!==null&&t!==void 0?t:window.location.href),x=await w.request({method:"eth_requestAccounts"}).then(k=>k).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!x||x.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const E=Gd(x[0]);let T=(n=p?.signInWithEthereum)===null||n===void 0?void 0:n.chainId;if(!T){const k=await w.request({method:"eth_chainId"});T=Jy(k)}const R={domain:S.host,address:E,statement:v,uri:S.href,version:"1",chainId:T,nonce:(s=p?.signInWithEthereum)===null||s===void 0?void 0:s.nonce,issuedAt:(a=(i=p?.signInWithEthereum)===null||i===void 0?void 0:i.issuedAt)!==null&&a!==void 0?a:new Date,expirationTime:(o=p?.signInWithEthereum)===null||o===void 0?void 0:o.expirationTime,notBefore:(l=p?.signInWithEthereum)===null||l===void 0?void 0:l.notBefore,requestId:(c=p?.signInWithEthereum)===null||c===void 0?void 0:c.requestId,resources:(d=p?.signInWithEthereum)===null||d===void 0?void 0:d.resources};g=ev(R),b=await w.request({method:"personal_sign",params:[Zy(g),E]})}try{const{data:m,error:y}=await te(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:g,signature:b},!((u=e.options)===null||u===void 0)&&u.captchaToken?{gotrue_meta_security:{captcha_token:(f=e.options)===null||f===void 0?void 0:f.captchaToken}}:null),xform:Qt});if(y)throw y;return!m||!m.session||!m.user?{data:{user:null,session:null},error:new mn}:(m.session&&(await this._saveSession(m.session),await this._notifyAllSubscribers("SIGNED_IN",m.session)),{data:Object.assign({},m),error:y})}catch(m){if(X(m))return{data:{user:null,session:null},error:m};throw m}}async signInWithSolana(e){var t,n,s,i,a,o,l,c,d,u,f,g;let b,m;if("message"in e)b=e.message,m=e.signature;else{const{chain:y,wallet:v,statement:p,options:w}=e;let S;if(Mt())if(typeof v=="object")S=v;else{const E=window;if("solana"in E&&typeof E.solana=="object"&&("signIn"in E.solana&&typeof E.solana.signIn=="function"||"signMessage"in E.solana&&typeof E.solana.signMessage=="function"))S=E.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof v!="object"||!w?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");S=v}const x=new URL((t=w?.url)!==null&&t!==void 0?t:window.location.href);if("signIn"in S&&S.signIn){const E=await S.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},w?.signInWithSolana),{version:"1",domain:x.host,uri:x.href}),p?{statement:p}:null));let T;if(Array.isArray(E)&&E[0]&&typeof E[0]=="object")T=E[0];else if(E&&typeof E=="object"&&"signedMessage"in E&&"signature"in E)T=E;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in T&&"signature"in T&&(typeof T.signedMessage=="string"||T.signedMessage instanceof Uint8Array)&&T.signature instanceof Uint8Array)b=typeof T.signedMessage=="string"?T.signedMessage:new TextDecoder().decode(T.signedMessage),m=T.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in S)||typeof S.signMessage!="function"||!("publicKey"in S)||typeof S!="object"||!S.publicKey||!("toBase58"in S.publicKey)||typeof S.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");b=[`${x.host} wants you to sign in with your Solana account:`,S.publicKey.toBase58(),...p?["",p,""]:[""],"Version: 1",`URI: ${x.href}`,`Issued At: ${(s=(n=w?.signInWithSolana)===null||n===void 0?void 0:n.issuedAt)!==null&&s!==void 0?s:new Date().toISOString()}`,...!((i=w?.signInWithSolana)===null||i===void 0)&&i.notBefore?[`Not Before: ${w.signInWithSolana.notBefore}`]:[],...!((a=w?.signInWithSolana)===null||a===void 0)&&a.expirationTime?[`Expiration Time: ${w.signInWithSolana.expirationTime}`]:[],...!((o=w?.signInWithSolana)===null||o===void 0)&&o.chainId?[`Chain ID: ${w.signInWithSolana.chainId}`]:[],...!((l=w?.signInWithSolana)===null||l===void 0)&&l.nonce?[`Nonce: ${w.signInWithSolana.nonce}`]:[],...!((c=w?.signInWithSolana)===null||c===void 0)&&c.requestId?[`Request ID: ${w.signInWithSolana.requestId}`]:[],...!((u=(d=w?.signInWithSolana)===null||d===void 0?void 0:d.resources)===null||u===void 0)&&u.length?["Resources",...w.signInWithSolana.resources.map(T=>`- ${T}`)]:[]].join(`
`);const E=await S.signMessage(new TextEncoder().encode(b),"utf8");if(!E||!(E instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");m=E}}try{const{data:y,error:v}=await te(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:b,signature:rn(m)},!((f=e.options)===null||f===void 0)&&f.captchaToken?{gotrue_meta_security:{captcha_token:(g=e.options)===null||g===void 0?void 0:g.captchaToken}}:null),xform:Qt});if(v)throw v;return!y||!y.session||!y.user?{data:{user:null,session:null},error:new mn}:(y.session&&(await this._saveSession(y.session),await this._notifyAllSubscribers("SIGNED_IN",y.session)),{data:Object.assign({},y),error:v})}catch(y){if(X(y))return{data:{user:null,session:null},error:y};throw y}}async _exchangeCodeForSession(e){const t=await Vr(this.storage,`${this.storageKey}-code-verifier`),[n,s]=(t??"").split("/");try{const{data:i,error:a}=await te(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:n},xform:Qt});if(await Mr(this.storage,`${this.storageKey}-code-verifier`),a)throw a;return!i||!i.session||!i.user?{data:{user:null,session:null,redirectType:null},error:new mn}:(i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",i.session)),{data:Object.assign(Object.assign({},i),{redirectType:s??null}),error:a})}catch(i){if(X(i))return{data:{user:null,session:null,redirectType:null},error:i};throw i}}async signInWithIdToken(e){try{const{options:t,provider:n,token:s,access_token:i,nonce:a}=e,o=await te(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:n,id_token:s,access_token:i,nonce:a,gotrue_meta_security:{captcha_token:t?.captchaToken}},xform:Qt}),{data:l,error:c}=o;return c?{data:{user:null,session:null},error:c}:!l||!l.session||!l.user?{data:{user:null,session:null},error:new mn}:(l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),{data:l,error:c})}catch(t){if(X(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,n,s,i,a;try{if("email"in e){const{email:o,options:l}=e;let c=null,d=null;this.flowType==="pkce"&&([c,d]=await pn(this.storage,this.storageKey));const{error:u}=await te(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:o,data:(t=l?.data)!==null&&t!==void 0?t:{},create_user:(n=l?.shouldCreateUser)!==null&&n!==void 0?n:!0,gotrue_meta_security:{captcha_token:l?.captchaToken},code_challenge:c,code_challenge_method:d},redirectTo:l?.emailRedirectTo});return{data:{user:null,session:null},error:u}}if("phone"in e){const{phone:o,options:l}=e,{data:c,error:d}=await te(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:o,data:(s=l?.data)!==null&&s!==void 0?s:{},create_user:(i=l?.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:l?.captchaToken},channel:(a=l?.channel)!==null&&a!==void 0?a:"sms"}});return{data:{user:null,session:null,messageId:c?.message_id},error:d}}throw new Ws("You must provide either an email or phone number.")}catch(o){if(X(o))return{data:{user:null,session:null},error:o};throw o}}async verifyOtp(e){var t,n;try{let s,i;"options"in e&&(s=(t=e.options)===null||t===void 0?void 0:t.redirectTo,i=(n=e.options)===null||n===void 0?void 0:n.captchaToken);const{data:a,error:o}=await te(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:i}}),redirectTo:s,xform:Qt});if(o)throw o;if(!a)throw new Error("An error occurred on token verification.");const l=a.session,c=a.user;return l?.access_token&&(await this._saveSession(l),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",l)),{data:{user:c,session:l},error:null}}catch(s){if(X(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithSSO(e){var t,n,s;try{let i=null,a=null;return this.flowType==="pkce"&&([i,a]=await pn(this.storage,this.storageKey)),await te(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(n=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&n!==void 0?n:void 0}),!((s=e?.options)===null||s===void 0)&&s.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:i,code_challenge_method:a}),headers:this.headers,xform:qy})}catch(i){if(X(i))return{data:null,error:i};throw i}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:n}=e;if(n)throw n;if(!t)throw new jr;const{error:s}=await te(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:s}})}catch(e){if(X(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:n,type:s,options:i}=e,{error:a}=await te(this.fetch,"POST",t,{headers:this.headers,body:{email:n,type:s,gotrue_meta_security:{captcha_token:i?.captchaToken}},redirectTo:i?.emailRedirectTo});return{data:{user:null,session:null},error:a}}else if("phone"in e){const{phone:n,type:s,options:i}=e,{data:a,error:o}=await te(this.fetch,"POST",t,{headers:this.headers,body:{phone:n,type:s,gotrue_meta_security:{captcha_token:i?.captchaToken}}});return{data:{user:null,session:null,messageId:a?.message_id},error:o}}throw new Ws("You must provide either an email or phone number and a type")}catch(t){if(X(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const n=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),s=(async()=>(await n,await t()))();return this.pendingInLock.push((async()=>{try{await s}catch{}})()),s}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const n=t();for(this.pendingInLock.push((async()=>{try{await n}catch{}})()),await n;this.pendingInLock.length;){const s=[...this.pendingInLock];await Promise.all(s),this.pendingInLock.splice(0,s.length)}return await n}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await Vr(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const n=e.expires_at?e.expires_at*1e3-Date.now()<da:!1;if(this._debug("#__loadSession()",`session has${n?"":" not"} expired`,"expires_at",e.expires_at),!n){if(this.userStorage){const a=await Vr(this.userStorage,this.storageKey+"-user");a?.user?e.user=a.user:e.user=fa()}if(this.storage.isServer&&e.user){let a=this.suppressGetSessionWarning;e=new Proxy(e,{get:(l,c,d)=>(!a&&c==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),a=!0,this.suppressGetSessionWarning=!0),Reflect.get(l,c,d))})}return{data:{session:e},error:null}}const{data:s,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{session:null},error:i}:{data:{session:s},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await te(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:Ur}):await this._useSession(async t=>{var n,s,i;const{data:a,error:o}=t;if(o)throw o;return!(!((n=a.session)===null||n===void 0)&&n.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new jr}:await te(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(i=(s=a.session)===null||s===void 0?void 0:s.access_token)!==null&&i!==void 0?i:void 0,xform:Ur})})}catch(t){if(X(t))return wy(t)&&(await this._removeSession(),await Mr(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async n=>{const{data:s,error:i}=n;if(i)throw i;if(!s.session)throw new jr;const a=s.session;let o=null,l=null;this.flowType==="pkce"&&e.email!=null&&([o,l]=await pn(this.storage,this.storageKey));const{data:c,error:d}=await te(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t?.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:o,code_challenge_method:l}),jwt:a.access_token,xform:Ur});if(d)throw d;return a.user=c.user,await this._saveSession(a),await this._notifyAllSubscribers("USER_UPDATED",a),{data:{user:a.user},error:null}})}catch(n){if(X(n))return{data:{user:null},error:n};throw n}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new jr;const t=Date.now()/1e3;let n=t,s=!0,i=null;const{payload:a}=ha(e.access_token);if(a.exp&&(n=a.exp,s=n<=t),s){const{data:o,error:l}=await this._callRefreshToken(e.refresh_token);if(l)return{data:{user:null,session:null},error:l};if(!o)return{data:{user:null,session:null},error:null};i=o}else{const{data:o,error:l}=await this._getUser(e.access_token);if(l)throw l;i={access_token:e.access_token,refresh_token:e.refresh_token,user:o.user,token_type:"bearer",expires_in:n-t,expires_at:n},await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)}return{data:{user:i.user,session:i},error:null}}catch(t){if(X(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var n;if(!e){const{data:a,error:o}=t;if(o)throw o;e=(n=a.session)!==null&&n!==void 0?n:void 0}if(!e?.refresh_token)throw new jr;const{data:s,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{user:null,session:null},error:i}:s?{data:{user:s.user,session:s},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(X(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e,t){try{if(!Mt())throw new qs("No browser detected.");if(e.error||e.error_description||e.error_code)throw new qs(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new Nl("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new qs("Not a valid implicit grant flow url.");break;default:}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new Nl("No code detected.");const{data:p,error:w}=await this._exchangeCodeForSession(e.code);if(w)throw w;const S=new URL(window.location.href);return S.searchParams.delete("code"),window.history.replaceState(window.history.state,"",S.toString()),{data:{session:p.session,redirectType:null},error:null}}const{provider_token:n,provider_refresh_token:s,access_token:i,refresh_token:a,expires_in:o,expires_at:l,token_type:c}=e;if(!i||!o||!a||!c)throw new qs("No session defined in URL");const d=Math.round(Date.now()/1e3),u=parseInt(o);let f=d+u;l&&(f=parseInt(l));const g=f-d;g*1e3<=Sn&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${g}s, should have been closer to ${u}s`);const b=f-u;d-b>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",b,f,d):d-b<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",b,f,d);const{data:m,error:y}=await this._getUser(i);if(y)throw y;const v={provider_token:n,provider_refresh_token:s,access_token:i,expires_in:u,expires_at:f,refresh_token:a,token_type:c,user:m.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:v,redirectType:e.type},error:null}}catch(n){if(X(n))return{data:{session:null,redirectType:null},error:n};throw n}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await Vr(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var n;const{data:s,error:i}=t;if(i)return{error:i};const a=(n=s.session)===null||n===void 0?void 0:n.access_token;if(a){const{error:o}=await this.admin.signOut(a,e);if(o&&!(vy(o)&&(o.status===404||o.status===401||o.status===403)))return{error:o}}return e!=="others"&&(await this._removeSession(),await Mr(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const t=Cy(),n={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,n),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:n}}}async _emitInitialSession(e){return await this._useSession(async t=>{var n,s;try{const{data:{session:i},error:a}=t;if(a)throw a;await((n=this.stateChangeEmitters.get(e))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",i)),this._debug("INITIAL_SESSION","callback id",e,"session",i)}catch(i){await((s=this.stateChangeEmitters.get(e))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",i),console.error(i)}})}async resetPasswordForEmail(e,t={}){let n=null,s=null;this.flowType==="pkce"&&([n,s]=await pn(this.storage,this.storageKey,!0));try{return await te(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:n,code_challenge_method:s,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(i){if(X(i))return{data:null,error:i};throw i}}async getUserIdentities(){var e;try{const{data:t,error:n}=await this.getUser();if(n)throw n;return{data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(t){if(X(t))return{data:null,error:t};throw t}}async linkIdentity(e){return"token"in e?this.linkIdentityIdToken(e):this.linkIdentityOAuth(e)}async linkIdentityOAuth(e){var t;try{const{data:n,error:s}=await this._useSession(async i=>{var a,o,l,c,d;const{data:u,error:f}=i;if(f)throw f;const g=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(a=e.options)===null||a===void 0?void 0:a.redirectTo,scopes:(o=e.options)===null||o===void 0?void 0:o.scopes,queryParams:(l=e.options)===null||l===void 0?void 0:l.queryParams,skipBrowserRedirect:!0});return await te(this.fetch,"GET",g,{headers:this.headers,jwt:(d=(c=u.session)===null||c===void 0?void 0:c.access_token)!==null&&d!==void 0?d:void 0})});if(s)throw s;return Mt()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(n?.url),{data:{provider:e.provider,url:n?.url},error:null}}catch(n){if(X(n))return{data:{provider:e.provider,url:null},error:n};throw n}}async linkIdentityIdToken(e){return await this._useSession(async t=>{var n;try{const{error:s,data:{session:i}}=t;if(s)throw s;const{options:a,provider:o,token:l,access_token:c,nonce:d}=e,u=await te(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(n=i?.access_token)!==null&&n!==void 0?n:void 0,body:{provider:o,id_token:l,access_token:c,nonce:d,link_identity:!0,gotrue_meta_security:{captcha_token:a?.captchaToken}},xform:Qt}),{data:f,error:g}=u;return g?{data:{user:null,session:null},error:g}:!f||!f.session||!f.user?{data:{user:null,session:null},error:new mn}:(f.session&&(await this._saveSession(f.session),await this._notifyAllSubscribers("USER_UPDATED",f.session)),{data:f,error:g})}catch(s){if(X(s))return{data:{user:null,session:null},error:s};throw s}})}async unlinkIdentity(e){try{return await this._useSession(async t=>{var n,s;const{data:i,error:a}=t;if(a)throw a;return await te(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(s=(n=i.session)===null||n===void 0?void 0:n.access_token)!==null&&s!==void 0?s:void 0})})}catch(t){if(X(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const n=Date.now();return await Ay(async s=>(s>0&&await Ny(200*Math.pow(2,s-1)),this._debug(t,"refreshing attempt",s),await te(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:Qt})),(s,i)=>{const a=200*Math.pow(2,s);return i&&ua(i)&&Date.now()+a-n<Sn})}catch(n){if(this._debug(t,"error",n),X(n))return{data:{session:null,user:null},error:n};throw n}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const n=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",n),Mt()&&!t.skipBrowserRedirect&&window.location.assign(n),{data:{provider:e,url:n},error:null}}async _recoverAndRefresh(){var e,t;const n="#_recoverAndRefresh()";this._debug(n,"begin");try{const s=await Vr(this.storage,this.storageKey);if(s&&this.userStorage){let a=await Vr(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!a&&(a={user:s.user},await xn(this.userStorage,this.storageKey+"-user",a)),s.user=(e=a?.user)!==null&&e!==void 0?e:fa()}else if(s&&!s.user&&!s.user){const a=await Vr(this.storage,this.storageKey+"-user");a&&a?.user?(s.user=a.user,await Mr(this.storage,this.storageKey+"-user"),await xn(this.storage,this.storageKey,s)):s.user=fa()}if(this._debug(n,"session from storage",s),!this._isValidSession(s)){this._debug(n,"session is not valid"),s!==null&&await this._removeSession();return}const i=((t=s.expires_at)!==null&&t!==void 0?t:1/0)*1e3-Date.now()<da;if(this._debug(n,`session has${i?"":" not"} expired with margin of ${da}s`),i){if(this.autoRefreshToken&&s.refresh_token){const{error:a}=await this._callRefreshToken(s.refresh_token);a&&(console.error(a),ua(a)||(this._debug(n,"refresh failed with a non-retryable error, removing the session",a),await this._removeSession()))}}else if(s.user&&s.user.__isUserNotAvailableProxy===!0)try{const{data:a,error:o}=await this._getUser(s.access_token);!o&&a?.user?(s.user=a.user,await this._saveSession(s),await this._notifyAllSubscribers("SIGNED_IN",s)):this._debug(n,"could not get user data, skipping SIGNED_IN notification")}catch(a){console.error("Error getting user data:",a),this._debug(n,"error getting user data, skipping SIGNED_IN notification",a)}else await this._notifyAllSubscribers("SIGNED_IN",s)}catch(s){this._debug(n,"error",s),console.error(s);return}finally{this._debug(n,"end")}}async _callRefreshToken(e){var t,n;if(!e)throw new jr;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const s=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(s,"begin");try{this.refreshingDeferred=new ji;const{data:i,error:a}=await this._refreshAccessToken(e);if(a)throw a;if(!i.session)throw new jr;await this._saveSession(i.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",i.session);const o={data:i.session,error:null};return this.refreshingDeferred.resolve(o),o}catch(i){if(this._debug(s,"error",i),X(i)){const a={data:null,error:i};return ua(i)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(a),a}throw(n=this.refreshingDeferred)===null||n===void 0||n.reject(i),i}finally{this.refreshingDeferred=null,this._debug(s,"end")}}async _notifyAllSubscribers(e,t,n=!0){const s=`#_notifyAllSubscribers(${e})`;this._debug(s,"begin",t,`broadcast = ${n}`);try{this.broadcastChannel&&n&&this.broadcastChannel.postMessage({event:e,session:t});const i=[],a=Array.from(this.stateChangeEmitters.values()).map(async o=>{try{await o.callback(e,t)}catch(l){i.push(l)}});if(await Promise.all(a),i.length>0){for(let o=0;o<i.length;o+=1)console.error(i[o]);throw i[0]}}finally{this._debug(s,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0;const t=Object.assign({},e),n=t.user&&t.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!n&&t.user&&await xn(this.userStorage,this.storageKey+"-user",{user:t.user});const s=Object.assign({},t);delete s.user;const i=jl(s);await xn(this.storage,this.storageKey,i)}else{const s=jl(t);await xn(this.storage,this.storageKey,s)}}async _removeSession(){this._debug("#_removeSession()"),await Mr(this.storage,this.storageKey),await Mr(this.storage,this.storageKey+"-code-verifier"),await Mr(this.storage,this.storageKey+"-user"),this.userStorage&&await Mr(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&Mt()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),Sn);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:n}}=t;if(!n||!n.refresh_token||!n.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const s=Math.floor((n.expires_at*1e3-e)/Sn);this._debug("#_autoRefreshTokenTick()",`access token expires in ${s} ticks, a tick lasts ${Sn}ms, refresh threshold is ${Wa} ticks`),s<=Wa&&await this._callRefreshToken(n.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof Vd)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!Mt()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,n){const s=[`provider=${encodeURIComponent(t)}`];if(n?.redirectTo&&s.push(`redirect_to=${encodeURIComponent(n.redirectTo)}`),n?.scopes&&s.push(`scopes=${encodeURIComponent(n.scopes)}`),this.flowType==="pkce"){const[i,a]=await pn(this.storage,this.storageKey),o=new URLSearchParams({code_challenge:`${encodeURIComponent(i)}`,code_challenge_method:`${encodeURIComponent(a)}`});s.push(o.toString())}if(n?.queryParams){const i=new URLSearchParams(n.queryParams);s.push(i.toString())}return n?.skipBrowserRedirect&&s.push(`skip_http_redirect=${n.skipBrowserRedirect}`),`${e}?${s.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var n;const{data:s,error:i}=t;return i?{data:null,error:i}:await te(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(n=s?.session)===null||n===void 0?void 0:n.access_token})})}catch(t){if(X(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var n,s;const{data:i,error:a}=t;if(a)return{data:null,error:a};const o=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:e.factorType==="totp"?{issuer:e.issuer}:{}),{data:l,error:c}=await te(this.fetch,"POST",`${this.url}/factors`,{body:o,headers:this.headers,jwt:(n=i?.session)===null||n===void 0?void 0:n.access_token});return c?{data:null,error:c}:(e.factorType==="totp"&&l.type==="totp"&&(!((s=l?.totp)===null||s===void 0)&&s.qr_code)&&(l.totp.qr_code=`data:image/svg+xml;utf-8,${l.totp.qr_code}`),{data:l,error:null})})}catch(t){if(X(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var n;const{data:s,error:i}=t;if(i)return{data:null,error:i};const a=Object.assign({challenge_id:e.challengeId},"webauthn"in e?{webauthn:Object.assign(Object.assign({},e.webauthn),{credential_response:e.webauthn.type==="create"?ov(e.webauthn.credential_response):lv(e.webauthn.credential_response)})}:{code:e.code}),{data:o,error:l}=await te(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:a,headers:this.headers,jwt:(n=s?.session)===null||n===void 0?void 0:n.access_token});return l?{data:null,error:l}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+o.expires_in},o)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",o),{data:o,error:l})})}catch(t){if(X(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var n;const{data:s,error:i}=t;if(i)return{data:null,error:i};const a=await te(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:e,headers:this.headers,jwt:(n=s?.session)===null||n===void 0?void 0:n.access_token});if(a.error)return a;const{data:o}=a;if(o.type!=="webauthn")return{data:o,error:null};switch(o.webauthn.type){case"create":return{data:Object.assign(Object.assign({},o),{webauthn:Object.assign(Object.assign({},o.webauthn),{credential_options:Object.assign(Object.assign({},o.webauthn.credential_options),{publicKey:iv(o.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},o),{webauthn:Object.assign(Object.assign({},o.webauthn),{credential_options:Object.assign(Object.assign({},o.webauthn.credential_options),{publicKey:av(o.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(t){if(X(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:n}=await this._challenge({factorId:e.factorId});return n?{data:null,error:n}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){var e;const{data:{user:t},error:n}=await this.getUser();if(n)return{data:null,error:n};const s={all:[],phone:[],totp:[],webauthn:[]};for(const i of(e=t?.factors)!==null&&e!==void 0?e:[])s.all.push(i),i.status==="verified"&&s[i.factor_type].push(i);return{data:s,error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,n;const{data:{session:s},error:i}=e;if(i)return{data:null,error:i};if(!s)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:a}=ha(s.access_token);let o=null;a.aal&&(o=a.aal);let l=o;((n=(t=s.user.factors)===null||t===void 0?void 0:t.filter(u=>u.status==="verified"))!==null&&n!==void 0?n:[]).length>0&&(l="aal2");const d=a.amr||[];return{data:{currentLevel:o,nextLevel:l,currentAuthenticationMethods:d},error:null}}))}async fetchJwk(e,t={keys:[]}){let n=t.keys.find(o=>o.kid===e);if(n)return n;const s=Date.now();if(n=this.jwks.keys.find(o=>o.kid===e),n&&this.jwks_cached_at+by>s)return n;const{data:i,error:a}=await te(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(a)throw a;return!i.keys||i.keys.length===0||(this.jwks=i,this.jwks_cached_at=s,n=i.keys.find(o=>o.kid===e),!n)?null:n}async getClaims(e,t={}){try{let n=e;if(!n){const{data:g,error:b}=await this.getSession();if(b||!g.session)return{data:null,error:b};n=g.session.access_token}const{header:s,payload:i,signature:a,raw:{header:o,payload:l}}=ha(n);t?.allowExpired||Fy(i.exp);const c=!s.alg||s.alg.startsWith("HS")||!s.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(s.kid,t?.keys?{keys:t.keys}:t?.jwks);if(!c){const{error:g}=await this.getUser(n);if(g)throw g;return{data:{claims:i,header:s,signature:a},error:null}}const d=Uy(s.alg),u=await crypto.subtle.importKey("jwk",c,d,!0,["verify"]);if(!await crypto.subtle.verify(d,u,a,Ry(`${o}.${l}`)))throw new Ga("Invalid JWT signature");return{data:{claims:i,header:s,signature:a},error:null}}catch(n){if(X(n))return{data:null,error:n};throw n}}}ys.nextInstanceID=0;const bv=ys;class yv extends bv{constructor(e){super(e)}}class vv{constructor(e,t,n){var s,i,a;this.supabaseUrl=e,this.supabaseKey=t;const o=hy(e);if(!t)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",o),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",o),this.storageUrl=new URL("storage/v1",o),this.functionsUrl=new URL("functions/v1",o);const l=`sb-${o.hostname.split(".")[0]}-auth-token`,c={db:sy,realtime:ay,auth:Object.assign(Object.assign({},iy),{storageKey:l}),global:ny},d=uy(n??{},c);this.storageKey=(s=d.auth.storageKey)!==null&&s!==void 0?s:"",this.headers=(i=d.global.headers)!==null&&i!==void 0?i:{},d.accessToken?(this.accessToken=d.accessToken,this.auth=new Proxy({},{get:(u,f)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(f)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((a=d.auth)!==null&&a!==void 0?a:{},this.headers,d.global.fetch),this.fetch=cy(t,this._getAccessToken.bind(this),d.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},d.realtime)),this.rest=new fb(new URL("rest/v1",o).href,{headers:this.headers,schema:d.db.schema,fetch:this.fetch}),this.storage=new ey(this.storageUrl.href,this.headers,this.fetch,n?.storage),d.accessToken||this._listenForAuthEvents()}get functions(){return new nb(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},n={head:!1,get:!1,count:void 0}){return this.rest.rpc(e,t,n)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var e,t;if(this.accessToken)return await this.accessToken();const{data:n}=await this.auth.getSession();return(t=(e=n.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:this.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:n,storage:s,userStorage:i,storageKey:a,flowType:o,lock:l,debug:c},d,u){const f={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new yv({url:this.authUrl.href,headers:Object.assign(Object.assign({},f),d),storageKey:a,autoRefreshToken:e,persistSession:t,detectSessionInUrl:n,storage:s,userStorage:i,flowType:o,lock:l,debug:c,fetch:u,hasCustomAuthorizationHeader:Object.keys(this.headers).some(g=>g.toLowerCase()==="authorization")})}_initRealtimeClient(e){return new Db(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,n)=>{this._handleTokenChanged(t,"CLIENT",n?.access_token)})}_handleTokenChanged(e,t,n){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==n?(this.changedAccessToken=n,this.realtime.setAuth(n)):e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const wv=(r,e,t)=>new vv(r,e,t);function _v(){if(typeof window<"u"||typeof process>"u")return!1;const r=process.version;if(r==null)return!1;const e=r.match(/^v(\d+)\./);return e?parseInt(e[1],10)<=18:!1}_v()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const Sv={};function xv(r,e){let t;try{t=r()}catch{return}return{getItem:s=>{var i;const a=l=>l===null?null:JSON.parse(l,void 0),o=(i=t.getItem(s))!=null?i:null;return o instanceof Promise?o.then(a):a(o)},setItem:(s,i)=>t.setItem(s,JSON.stringify(i,void 0)),removeItem:s=>t.removeItem(s)}}const vs=r=>e=>{try{const t=r(e);return t instanceof Promise?t:{then(n){return vs(n)(t)},catch(n){return this}}}catch(t){return{then(n){return this},catch(n){return vs(n)(t)}}}},Ev=(r,e)=>(t,n,s)=>{let i={getStorage:()=>localStorage,serialize:JSON.stringify,deserialize:JSON.parse,partialize:y=>y,version:0,merge:(y,v)=>({...v,...y}),...e},a=!1;const o=new Set,l=new Set;let c;try{c=i.getStorage()}catch{}if(!c)return r((...y)=>{console.warn(`[zustand persist middleware] Unable to update item '${i.name}', the given storage is currently unavailable.`),t(...y)},n,s);const d=vs(i.serialize),u=()=>{const y=i.partialize({...n()});let v;const p=d({state:y,version:i.version}).then(w=>c.setItem(i.name,w)).catch(w=>{v=w});if(v)throw v;return p},f=s.setState;s.setState=(y,v)=>{f(y,v),u()};const g=r((...y)=>{t(...y),u()},n,s);let b;const m=()=>{var y;if(!c)return;a=!1,o.forEach(p=>p(n()));const v=((y=i.onRehydrateStorage)==null?void 0:y.call(i,n()))||void 0;return vs(c.getItem.bind(c))(i.name).then(p=>{if(p)return i.deserialize(p)}).then(p=>{if(p)if(typeof p.version=="number"&&p.version!==i.version){if(i.migrate)return i.migrate(p.state,p.version);console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return p.state}).then(p=>{var w;return b=i.merge(p,(w=n())!=null?w:g),t(b,!0),u()}).then(()=>{v?.(b,void 0),a=!0,l.forEach(p=>p(b))}).catch(p=>{v?.(void 0,p)})};return s.persist={setOptions:y=>{i={...i,...y},y.getStorage&&(c=y.getStorage())},clearStorage:()=>{c?.removeItem(i.name)},getOptions:()=>i,rehydrate:()=>m(),hasHydrated:()=>a,onHydrate:y=>(o.add(y),()=>{o.delete(y)}),onFinishHydration:y=>(l.add(y),()=>{l.delete(y)})},m(),b||g},Tv=(r,e)=>(t,n,s)=>{let i={storage:xv(()=>localStorage),partialize:m=>m,version:0,merge:(m,y)=>({...y,...m}),...e},a=!1;const o=new Set,l=new Set;let c=i.storage;if(!c)return r((...m)=>{console.warn(`[zustand persist middleware] Unable to update item '${i.name}', the given storage is currently unavailable.`),t(...m)},n,s);const d=()=>{const m=i.partialize({...n()});return c.setItem(i.name,{state:m,version:i.version})},u=s.setState;s.setState=(m,y)=>{u(m,y),d()};const f=r((...m)=>{t(...m),d()},n,s);s.getInitialState=()=>f;let g;const b=()=>{var m,y;if(!c)return;a=!1,o.forEach(p=>{var w;return p((w=n())!=null?w:f)});const v=((y=i.onRehydrateStorage)==null?void 0:y.call(i,(m=n())!=null?m:f))||void 0;return vs(c.getItem.bind(c))(i.name).then(p=>{if(p)if(typeof p.version=="number"&&p.version!==i.version){if(i.migrate)return[!0,i.migrate(p.state,p.version)];console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,p.state];return[!1,void 0]}).then(p=>{var w;const[S,x]=p;if(g=i.merge(x,(w=n())!=null?w:f),t(g,!0),S)return d()}).then(()=>{v?.(g,void 0),g=n(),a=!0,l.forEach(p=>p(g))}).catch(p=>{v?.(void 0,p)})};return s.persist={setOptions:m=>{i={...i,...m},m.storage&&(c=m.storage)},clearStorage:()=>{c?.removeItem(i.name)},getOptions:()=>i,rehydrate:()=>b(),hasHydrated:()=>a,onHydrate:m=>(o.add(m),()=>{o.delete(m)}),onFinishHydration:m=>(l.add(m),()=>{l.delete(m)})},i.skipHydration||b(),g||f},Rv=(r,e)=>"getStorage"in e||"serialize"in e||"deserialize"in e?((Sv?"production":void 0)!=="production"&&console.warn("[DEPRECATED] `getStorage`, `serialize` and `deserialize` options are deprecated. Use `storage` option instead."),Ev(r,e)):Tv(r,e),Yd=Rv;var Ov=r=>{if(!r||Array.isArray(r)&&r.length===0)return;let e;if(Array.isArray(r)){const t=r.filter(n=>n&&n.trim().length>0);if(t.length===0)return;t.length===1?e=t[0]:e=`There are ${t.length} validation errors:

 ${t.join(`
 `)}`}else e=r;xs.error(e,{duration:1e4,position:"top-right",style:{maxWidth:"400px",whiteSpace:"pre-line"}})},cn=r=>{xs.success(r)},Sr=r=>{xs.error(r)},ts=r=>{xs.warning(r)},Jt=(r,e)=>xs(r,e),Xd={DISPLAY:"dd/MM/yyyy"},Cv=(r,e=Xd.DISPLAY)=>{if(!r)return"";try{const t=typeof r=="string"?Op(r):r;return xd(t)?Tp(t,e):""}catch(t){return console.warn("Date formatting error:",t),""}},ma=r=>Cv(r,Xd.DISPLAY);function bt(...r){return fm(fd(r))}var Ka=r=>confirm(r),kv=(r,e)=>{if(!(!r||!e))return e.indexOf(".")===-1?r[e]:e.split(".").reduce((t,n)=>t&&t[n]!==void 0?t[n]:void 0,r)},zl=()=>`ID_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,Zr=(r,e={})=>{let t="An unexpected error occurred";if(r.response)switch(r.response.status){case 400:t="Invalid request data";break;case 401:t="Authentication required";break;case 403:t="Access denied";break;case 404:t="Resource not found";break;case 500:case 502:case 503:t="Server error occurred";break;default:t="Network error occurred"}else r.request?t="Network connection failed":r.message&&(t=r.message);return new Error(t)},Dv=zp("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40",outline:"border border-solid border-gray-300 bg-gray-100 text-gray-900 shadow-sm hover:bg-gray-200 hover:text-gray-900 dark:bg-gray-100 dark:border-gray-300 dark:text-gray-900 dark:hover:bg-gray-200",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}}),Te=_.forwardRef(({className:r,variant:e,size:t,asChild:n=!1,...s},i)=>{const a=n?Rh:"button";return h.jsx(a,{"data-slot":"button",className:bt(Dv({variant:e,size:t,className:r})),ref:i,...s})});Te.displayName="Button";var ct=_.forwardRef(({className:r,type:e,...t},n)=>h.jsx("input",{type:e,"data-slot":"input",className:bt("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",r),ref:n,...t}));ct.displayName="Input";var Et=_.forwardRef(({className:r,...e},t)=>h.jsx("label",{ref:t,"data-slot":"label",className:bt("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",r),...e}));Et.displayName="Label";function Ft({className:r,...e}){return h.jsx("div",{"data-slot":"card",className:bt("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6",r),...e})}function Ut({className:r,...e}){return h.jsx("div",{"data-slot":"card-header",className:bt("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",r),...e})}function Ht({className:r,...e}){return h.jsx("div",{"data-slot":"card-title",className:bt("leading-none font-semibold",r),...e})}function Bt({className:r,...e}){return h.jsx("div",{"data-slot":"card-content",className:bt("px-6",r),...e})}var Qd=_.createContext(null);function pa(r){const e=document.documentElement,t=window.matchMedia("(prefers-color-scheme: dark)").matches,n=r==="dark"||r==="system"&&t;e.classList.toggle("dark",n)}var Nv=({defaultTheme:r="system",children:e})=>{const[t,n]=_.useState(r);_.useEffect(()=>{const a=localStorage.getItem("theme")||r;n(a),pa(a);const o=window.matchMedia("(prefers-color-scheme: dark)"),l=()=>{(localStorage.getItem("theme")||"system")==="system"&&pa("system")};return o.addEventListener?.("change",l),()=>o.removeEventListener?.("change",l)},[r]);const s=a=>{localStorage.setItem("theme",a),n(a),pa(a)},i=_.useMemo(()=>({theme:t,setTheme:s}),[t]);return h.jsx(Qd.Provider,{value:i,children:e})},Av=()=>{const r=_.useContext(Qd);if(!r)throw new Error("useTheme must be used within ThemeProvider");return r},Iv=({className:r})=>{const{theme:e,setTheme:t}=Av();return h.jsx("div",{className:"inline-flex gap-2 items-center",children:h.jsxs("select",{"aria-label":"Theme",value:e,onChange:n=>t(n.target.value),className:bt("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive","w-36",r),children:[h.jsx("option",{value:"light",children:"Light"}),h.jsx("option",{value:"dark",children:"Dark"}),h.jsx("option",{value:"system",children:"System"})]})})},Mv=({children:r,className:e,...t})=>h.jsx("table",{className:`w-full border-collapse border border-border table-auto ${e||""}`,...t,children:r}),Pv=({children:r})=>h.jsx("thead",{className:"bg-muted",children:r}),jv=({children:r})=>h.jsx("tbody",{className:"divide-y divide-gray-200",children:r}),Vs=({children:r,onClick:e,className:t})=>h.jsx("tr",{onClick:e,className:`${e?"cursor-pointer hover:bg-muted/50":""} ${t||""}`,children:r}),Lv=({children:r})=>h.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider border-b border-border min-w-0",children:r}),ba=({children:r,colSpan:e,className:t})=>h.jsx("td",{colSpan:e,className:`px-4 py-3 text-sm text-foreground border-b border-border min-w-0 max-w-xs ${t||""}`,children:h.jsx("div",{className:"truncate",title:typeof r=="string"?r:"",children:r})});function Jd({data:r,columns:e,onEditRow:t,onDeleteRow:n,onRowClick:s,enableFiltering:i=!1,filterableColumns:a=[],stickyColumns:o=[],onBulkDelete:l,onBulkExport:c,initialPageSize:d=Qo.PAGE_SIZE,pageSizeOptions:u=[...Qo.PAGE_SIZE_OPTIONS],enableGlobalSearch:f=!0,enableColumnVisibility:g=!1,enableRowSelection:b=!1,loading:m=!1,emptyMessage:y="No results found.",className:v}){const[p,w]=_.useState({}),[S,x]=_.useState(0),[E,T]=_.useState(d),[R,k]=_.useState(new Set),[O,D]=_.useState(""),[A,P]=_.useState([]),[Q,he]=_.useState({}),[H,J]=_.useState(!1),Oe=_.useMemo(()=>{const F=b?{id:"select",header:({table:q})=>{const fe=q.getRowModel().rows.map(Ae=>Ae.original),B=fe.length>0&&fe.every(Ae=>R.has(Ae.id));return h.jsx("div",{className:"w-8",children:h.jsx("input",{type:"checkbox","aria-label":"Select all",checked:B,onChange:Ae=>{const Ce=new Set(R);Ae.target.checked?fe.forEach(vt=>Ce.add(vt.id)):fe.forEach(vt=>Ce.delete(vt.id)),k(Ce)},className:"h-4 w-4 rounded border-border text-primary focus:ring-ring"})})},cell:({row:q})=>h.jsx("div",{className:"flex w-8",children:h.jsx("input",{type:"checkbox","aria-label":"Select row",checked:R.has(q.original.id),onChange:fe=>{const B=new Set(R);fe.target.checked?B.add(q.original.id):B.delete(q.original.id),k(B)},className:"h-4 w-4 rounded border-border text-primary focus:ring-ring"})})}:null,V=t||n?{id:"actions",header:"Actions",cell:({row:q})=>h.jsxs("div",{className:"flex gap-2",children:[t&&h.jsx(Te,{variant:"outline",size:"sm",onClick:()=>t(q.original),children:"Edit"}),n&&h.jsx(Te,{variant:"destructive",size:"sm",onClick:()=>{Ka("Are you sure you want to delete this item?")&&n(q.original)},children:"Delete"})]})}:null;return[F,...e,V].filter(Boolean)},[e,t,n,b,R]),L=_.useMemo(()=>{let F=r;return i&&Object.keys(p).length>0&&(F=F.filter(V=>Object.entries(p).every(([q,fe])=>{if(!fe)return!0;const B=kv(V,q);return String(B).toLowerCase().includes(fe.toLowerCase())}))),f&&O&&(F=F.filter(V=>Object.values(V).some(q=>String(q).toLowerCase().includes(O.toLowerCase())))),F},[r,p,O,i,f]),Z=_.useMemo(()=>{const F=S*E,V=F+E;return L.slice(F,V)},[L,S,E]),ee=Math.ceil(L.length/E),Le=Oh({data:Z,columns:Oe,state:{sorting:A,columnVisibility:Q},onSortingChange:P,onColumnVisibilityChange:he,getCoreRowModel:Nh(),getSortedRowModel:Dh(),getFilteredRowModel:kh()}),G=()=>{w({}),D(""),x(0)};return h.jsxs("div",{className:`w-full space-y-1 ${v||""}`,children:[h.jsxs("div",{className:"flex items-center justify-between gap-4",children:[f&&h.jsx("div",{className:"flex-1 max-w-sm",children:h.jsx("input",{type:"text",placeholder:"Search all columns...",value:O,onChange:F=>{D(F.target.value),x(0)},className:"w-full px-3 py-2 border border-input rounded-md bg-background text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring"})}),h.jsxs("div",{className:"flex items-center gap-2",children:[O&&h.jsx(Te,{variant:"outline",size:"sm",onClick:G,children:"Clear Search"}),g&&h.jsxs("div",{className:"relative",children:[h.jsx(Te,{variant:"outline",size:"sm",onClick:()=>J(!H),children:"Columns "}),H&&h.jsxs(h.Fragment,{children:[h.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>J(!1)}),h.jsx("div",{className:"absolute right-0 mt-2 w-48 bg-popover border border-border rounded-md shadow-lg z-20 p-2",children:Le.getAllColumns().filter(F=>F.getCanHide()).map(F=>h.jsxs("label",{className:"flex items-center gap-2 p-1 hover:bg-accent rounded cursor-pointer",children:[h.jsx("input",{type:"checkbox",checked:F.getIsVisible(),onChange:F.getToggleVisibilityHandler(),className:"h-4 w-4 rounded border-border"}),h.jsx("span",{className:"text-sm capitalize",children:F.id.replace(/([A-Z])/g," $1").replace(/^./,V=>V.toUpperCase())})]},F.id))})]})]})]})]}),h.jsx("div",{className:"rounded-md border border-border overflow-hidden shadow-sm",children:h.jsx("div",{className:"overflow-x-auto",children:h.jsxs(Mv,{className:"min-w-full",children:[h.jsx(Pv,{children:Le.getHeaderGroups().map(F=>h.jsx(Vs,{children:F.headers.map(V=>h.jsx(Lv,{children:V.isPlaceholder?null:h.jsxs("div",{className:V.column.getCanSort()?"cursor-pointer select-none flex items-center gap-2":"",onClick:V.column.getToggleSortingHandler(),children:[qo(V.column.columnDef.header,V.getContext()),V.column.getCanSort()&&h.jsx("span",{className:"ml-1",children:{asc:"",desc:""}[V.column.getIsSorted()]??""})]})},V.id))},F.id))}),h.jsx(jv,{children:m?h.jsx(Vs,{children:h.jsx(ba,{colSpan:Oe.length,className:"h-24 text-center",children:h.jsxs("div",{className:"flex items-center justify-center gap-2",children:[h.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-foreground"}),"Loading..."]})})}):Le.getRowModel().rows.length?Le.getRowModel().rows.map(F=>h.jsx(Vs,{onClick:()=>s&&s(F.original),className:s?"cursor-pointer hover:bg-muted/50":"",children:F.getVisibleCells().map(V=>h.jsx(ba,{children:qo(V.column.columnDef.cell,V.getContext())},V.id))},F.id)):h.jsx(Vs,{children:h.jsx(ba,{colSpan:Oe.length,className:"h-24 text-center text-muted-foreground",children:h.jsxs("div",{className:"flex flex-col items-center gap-2",children:[h.jsx("div",{className:"text-4xl",children:""}),h.jsx("div",{children:y})]})})})})]})})}),h.jsxs("div",{className:"flex items-center justify-between",children:[h.jsxs("div",{className:"text-sm text-muted-foreground",children:["Showing ",S*E+1," to ",Math.min((S+1)*E,L.length)," of ",L.length," results"]}),h.jsxs("div",{className:"flex items-center space-x-2",children:[h.jsx(Te,{variant:"outline",size:"sm",onClick:()=>x(Math.max(0,S-1)),disabled:S===0,children:"Previous"}),h.jsxs("span",{className:"text-sm",children:["Page ",S+1," of ",ee]}),h.jsx(Te,{variant:"outline",size:"sm",onClick:()=>x(Math.min(ee-1,S+1)),disabled:S>=ee-1,children:"Next"})]})]}),R.size>0&&(l||c)&&h.jsx("div",{className:"sticky bottom-0 bg-background border-t border-border p-4 -mx-4 -mb-4 rounded-b-md",children:h.jsxs("div",{className:"flex items-center justify-between gap-4",children:[h.jsxs("div",{className:"flex items-center gap-3",children:[h.jsx(Te,{variant:"ghost",size:"sm",onClick:()=>k(new Set),className:"h-8 w-8 p-0",children:""}),h.jsxs("span",{className:"text-sm font-medium",children:[R.size," item",R.size>1?"s":""," selected"]})]}),h.jsxs("div",{className:"flex gap-2",children:[c&&h.jsx(Te,{variant:"outline",size:"sm",onClick:()=>c(Array.from(R)),children:" Export"}),l&&h.jsx(Te,{variant:"destructive",size:"sm",onClick:()=>{Ka(`Delete ${R.size} selected items? This action cannot be undone.`)&&(l(Array.from(R)),k(new Set))},children:" Delete"})]})]})})]})}function Do({title:r,createButtonText:e,createButtonHref:t,entityName:n,data:s,columns:i,onRowClick:a,onEditRow:o,onDeleteRow:l,enableFiltering:c=!0,filterableColumns:d=[],enableGlobalSearch:u=!1,onBulkDelete:f,onBulkExport:g,loading:b=!1,emptyMessage:m,detailComponent:y,className:v}){const p=e||`+ New ${n||"Item"}`;return h.jsxs("div",{className:`space-y-1 ${v||""}`,children:[h.jsxs("div",{className:"flex items-center justify-between",children:[h.jsx("h1",{className:"text-2xl font-semibold text-foreground",children:r}),h.jsx(Nt,{to:t,children:h.jsx(Te,{variant:"outline",children:p})})]}),h.jsx(Jd,{data:s,columns:i,onRowClick:a,onEditRow:o,onDeleteRow:l,enableFiltering:c,filterableColumns:d,enableGlobalSearch:u,onBulkDelete:f,onBulkExport:g,loading:b,emptyMessage:m}),y]})}var ya=r=>console.error(r),$v=r=>console.warn(r),Fv=r=>console.info(r),Yt=(r={})=>{const{logErrors:e=!0,showUserMessages:t=!0,maxRetries:n=3,retryDelay:s=1e3,onError:i=null,onRetry:a=null,onFallback:o=null}=r,[l,c]=_.useState([]),[d,u]=_.useState(!1),f=_.useRef(0),g=_.useCallback(async(T,R="",k={})=>{const O={id:`ERR_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,message:T.message||"An unexpected error occurred",type:T.type||Ps.SERVER_ERROR,severity:T.severity||"medium",context:R,timestamp:new Date().toISOString(),userMessage:T.userMessage||T.message||"An unexpected error occurred"};if(c(D=>[...D,O]),e&&console.error(`[${R}] Error:`,T),t){const D=O.userMessage;switch(O.severity){case"low":$v(D);break;case"medium":ya(D);break;case"high":case"critical":ya(D);break;default:ya(D)}}return i&&await i(O,R),O},[e,t,i]),b=_.useCallback(async(T,R={})=>{const{context:k="",fallbackMessage:O="Operation failed",retry:D=!1,maxRetries:A=n}=R;try{return D?await m(T,A):await T()}catch(P){throw await g(P,k,{fallbackMessage:O})}},[n,g]),m=_.useCallback(async(T,R)=>{let k;for(let O=1;O<=R;O++)try{u(O>1),f.current=O-1;const D=await T();return u(!1),f.current=0,D}catch(D){if(k=D,O<R){const A=s*Math.pow(2,O-1);a&&await a(D,O,A),t&&Fv(`Retrying... (${O}/${R})`),await new Promise(P=>setTimeout(P,A))}}throw u(!1),f.current=0,k},[s,a,t]),y=_.useCallback((T,R={})=>{const k={message:T,type:Ps.VALIDATION_ERROR,severity:"medium",details:R,userMessage:T};return g(k,"validation")},[g]),v=_.useCallback((T="Network connection failed")=>{const R={message:T,type:Ps.NETWORK_ERROR,severity:"high",userMessage:T};return g(R,"network")},[g]),p=_.useCallback((T="Authentication failed")=>{const R={message:T,type:Ps.AUTHENTICATION_ERROR,severity:"high",userMessage:T};return g(R,"authentication")},[g]),w=_.useCallback(()=>{c([])},[]),S=_.useCallback(T=>{c(R=>R.filter(k=>k.id!==T))},[]),x=_.useCallback(T=>l.filter(R=>R.type===T),[l]),E=_.useCallback(()=>l.some(T=>T.severity==="critical"),[l]);return{handleError:g,handleAsync:b,handleValidationError:y,handleNetworkError:v,handleAuthError:p,clearErrors:w,clearError:S,getErrorsByType:x,hasCriticalErrors:E,errors:l,isRetrying:d,retryCount:f.current,retryOperation:m}},Uv=ms(r=>({isOpen:!0,toggle:()=>r(e=>({isOpen:!e.isOpen})),open:()=>r({isOpen:!0}),close:()=>r({isOpen:!1})})),Zd=_.createContext(null),Hv=({children:r,supabaseClient:e,onAuthStateChange:t})=>{const[n,s]=_.useState(null),[i,a]=_.useState(null),[o,l]=_.useState(!0),[c,d]=_.useState(null);_.useEffect(()=>{(async()=>{try{const{data:{session:p},error:w}=await e.auth.getSession();w?d("Failed to initialize authentication"):(a(p),s(p?.user??null),t?.(p?.user??null,p))}catch{d("Authentication initialization failed")}finally{l(!1)}})();const{data:{subscription:v}}=e.auth.onAuthStateChange(async(p,w)=>{a(w),s(w?.user??null),d(null),t?.(w?.user??null,w),p==="SIGNED_OUT"&&l(!1)});return()=>v.unsubscribe()},[e,t]);const m={user:n,session:i,loading:o,error:c,signIn:async(y,v)=>{try{d(null);const{error:p}=await e.auth.signInWithPassword({email:y,password:v});return p?(d(p.message),{error:p.message}):{}}catch{const w="Sign in failed";return d(w),{error:w}}},signUp:async(y,v,p)=>{try{d(null);const{error:w}=await e.auth.signUp({email:y,password:v,options:{data:p}});return w?(d(w.message),{error:w.message}):{}}catch{const S="Sign up failed";return d(S),{error:S}}},signOut:async()=>{try{d(null),await e.auth.signOut()}catch{d("Sign out failed")}},resetPassword:async y=>{try{d(null);const{error:v}=await e.auth.resetPasswordForEmail(y);return v?(d(v.message),{error:v.message}):{}}catch{const p="Password reset failed";return d(p),{error:p}}}};return h.jsx(Zd.Provider,{value:m,children:r})},Bv=()=>{const r=_.useContext(Zd);if(!r)throw new Error("useAuth must be used within an AuthProvider");return r},zv=r=>({all:[r],lists:()=>[r,"list"],list:e=>[r,"list",e],details:()=>[r,"detail"],detail:e=>[r,"detail",e],search:(e,t)=>[r,"search",e,t],count:e=>[r,"count",e],paginated:e=>[r,"paginated",e]});function Wv(r){const e=r.getTableName(),t=zv(e);return{useList:(p,w)=>Vt({queryKey:t.list(p?.filters),queryFn:()=>r.getAll(p),staleTime:300*1e3,...w}),usePaginatedList:(p,w)=>Vt({queryKey:t.paginated(p),queryFn:()=>r.getPaginated(p),staleTime:300*1e3,keepPreviousData:!0,...w}),useDetail:(p,w,S)=>Vt({queryKey:t.detail(p),queryFn:()=>r.getById(p,w),enabled:!!p,staleTime:300*1e3,...S}),useSearch:(p,w,S,x)=>Vt({queryKey:t.search(p,w),queryFn:()=>r.search(p,w,S),enabled:p.length>0,staleTime:120*1e3,...x}),useCount:(p,w)=>Vt({queryKey:t.count(p),queryFn:()=>r.count(p),staleTime:300*1e3,...w}),useCreate:p=>{const w=Ye();return St({mutationFn:S=>r.create(S),onSuccess:(S,x)=>{w.invalidateQueries({queryKey:t.lists()}),w.invalidateQueries({queryKey:t.count()}),w.setQueryData(t.detail(S.id),S),p?.onSuccess?.(S,x,void 0)},...p})},useCreateMany:p=>{const w=Ye();return St({mutationFn:S=>r.createMany(S),onSuccess:(S,x)=>{w.invalidateQueries({queryKey:t.lists()}),w.invalidateQueries({queryKey:t.count()}),S.forEach(E=>{w.setQueryData(t.detail(E.id),E)}),p?.onSuccess?.(S,x,void 0)},...p})},useUpdate:p=>{const w=Ye();return St({mutationFn:({id:S,data:x})=>r.update(S,x),onSuccess:(S,x)=>{w.setQueryData(t.detail(x.id),S),w.invalidateQueries({queryKey:t.lists()}),p?.onSuccess?.(S,x,void 0)},...p})},useUpdateMany:p=>{const w=Ye();return St({mutationFn:S=>r.updateMany(S),onSuccess:(S,x)=>{S.forEach((E,T)=>{w.setQueryData(t.detail(x[T].id),E)}),w.invalidateQueries({queryKey:t.lists()}),p?.onSuccess?.(S,x,void 0)},...p})},useUpsert:p=>{const w=Ye();return St({mutationFn:({data:S,onConflict:x})=>r.upsert(S,x),onSuccess:(S,x)=>{w.setQueryData(t.detail(S.id),S),w.invalidateQueries({queryKey:t.lists()}),w.invalidateQueries({queryKey:t.count()}),p?.onSuccess?.(S,x,void 0)},...p})},useDelete:p=>{const w=Ye();return St({mutationFn:S=>r.delete(S),onSuccess:(S,x)=>{w.removeQueries({queryKey:t.detail(x)}),w.invalidateQueries({queryKey:t.lists()}),w.invalidateQueries({queryKey:t.count()}),p?.onSuccess?.(S,x,void 0)},...p})},useBulkDelete:p=>{const w=Ye();return St({mutationFn:S=>r.bulkDelete(S),onSuccess:(S,x)=>{x.forEach(E=>{w.removeQueries({queryKey:t.detail(E)})}),w.invalidateQueries({queryKey:t.lists()}),w.invalidateQueries({queryKey:t.count()}),p?.onSuccess?.(S,x,void 0)},...p})},useOptimisticUpdate:()=>{const p=Ye();return{optimisticUpdate:(x,E)=>{p.setQueryData(t.detail(x),E)},rollbackOptimisticUpdate:x=>{p.invalidateQueries({queryKey:t.detail(x)})}}},useInvalidateAll:()=>{const p=Ye();return{invalidateAll:()=>{p.invalidateQueries({queryKey:t.all})},invalidateLists:()=>{p.invalidateQueries({queryKey:t.lists()})},invalidateDetail:E=>{p.invalidateQueries({queryKey:t.detail(E)})}}},usePrefetch:()=>{const p=Ye();return{prefetchList:x=>p.prefetchQuery({queryKey:t.list(x?.filters),queryFn:()=>r.getAll(x),staleTime:300*1e3}),prefetchDetail:(x,E)=>p.prefetchQuery({queryKey:t.detail(x),queryFn:()=>r.getById(x,E),staleTime:300*1e3})}},queryKeys:t}}function Fn(r){return Wv(r)}function qv({config:r,initialData:e={},onSubmit:t,onSuccess:n,onCancel:s,showCancel:i=!0,isEditMode:a=!1,isLoading:o=!1,customActions:l=null,customFieldRenderers:c={},className:d="bg-card rounded-lg shadow-sm border"}){const{handleAsync:u}=Yt("GenericForm"),f=_.useMemo(()=>{const O={};return r.sections.forEach(D=>{D.fields.forEach(A=>{A.name in e?O[A.name]=e[A.name]:A.defaultValue!==void 0?O[A.name]=A.defaultValue:O[A.name]=""})}),O},[r,e]),{register:g,handleSubmit:b,formState:{isSubmitting:m,errors:y},watch:v,setValue:p,getValues:w,reset:S,clearErrors:x}=Ch({defaultValues:f,mode:"onChange"}),E=async O=>{await u(async()=>{await t(O),n&&n(),S(f)},{context:a?r.editContext:r.addContext,fallbackMessage:a?r.editErrorMessage:r.addErrorMessage})},T=O=>{const D=v(O.name);if(O.conditional&&!O.conditional(D,v,w))return null;if(c[O.type])return c[O.type](O,{watch:v,setValue:p,getValues:w,register:g,isSubmitting:m,fieldValue:D});const A={id:O.name,placeholder:O.placeholder,disabled:O.disabled||m,className:O.className||"",...g(O.name,O.validation||{})};switch(O.type){case"select":return h.jsxs("div",{children:[h.jsxs("select",{...g(O.name,O.validation),disabled:O.disabled||m,className:bt("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",y[O.name]&&"border-destructive",O.className),children:[h.jsx("option",{value:"",children:O.placeholder||`Seleziona ${O.label.toLowerCase()}`}),O.options?.map(P=>h.jsx("option",{value:P.value,children:P.label},P.value))]}),y[O.name]&&h.jsx("p",{className:"text-sm text-destructive mt-1",children:y[O.name].message})]});case"textarea":return h.jsxs("div",{children:[h.jsx("textarea",{...A,rows:O.rows||3,className:bt("border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",y[O.name]&&"border-destructive",O.className)}),y[O.name]&&h.jsx("p",{className:"text-sm text-destructive mt-1",children:y[O.name].message})]});case"checkbox":return h.jsx("div",{className:"flex flex-wrap gap-2",children:O.options?.map(P=>h.jsxs("div",{className:"flex items-center space-x-2",children:[h.jsx("input",{type:"checkbox",id:`${O.name}_${P.value}`,value:P.value,checked:D?.includes(P.value)||!1,onChange:Q=>{const he=w(O.name)||[];Q.target.checked?p(O.name,[...he,P.value].sort(),{shouldValidate:!0}):p(O.name,he.filter(H=>H!==P.value),{shouldValidate:!0})},className:"h-4 w-4 text-primary border-gray-300 rounded focus:ring-primary"}),h.jsx(Et,{htmlFor:`${O.name}_${P.value}`,className:"text-[10px] font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:P.label})]},P.value))});case"datetime-local":return h.jsxs("div",{children:[h.jsx(ct,{type:"datetime-local",...A,className:`${A.className} ${y[O.name]?"border-red-500":""}`}),y[O.name]&&h.jsx("p",{className:"text-sm text-destructive mt-1",children:y[O.name].message})]});case"date":return h.jsxs("div",{children:[h.jsx(ct,{type:"date",...A,className:`${A.className} ${y[O.name]?"border-red-500":""}`}),y[O.name]&&h.jsx("p",{className:"text-sm text-destructive mt-1",children:y[O.name].message})]});case"time":return h.jsxs("div",{children:[h.jsx(ct,{type:"time",...A,className:`${A.className} ${y[O.name]?"border-red-500":""}`}),y[O.name]&&h.jsx("p",{className:"text-sm text-destructive mt-1",children:y[O.name].message})]});case"number":return h.jsxs("div",{children:[h.jsx(ct,{type:"number",...A,className:`${A.className} ${y[O.name]?"border-red-500":""}`}),y[O.name]&&h.jsx("p",{className:"text-sm text-destructive mt-1",children:y[O.name].message})]});case"text":default:return h.jsxs("div",{children:[h.jsx(ct,{type:"text",...A,className:`${A.className} ${y[O.name]?"border-red-500":""}`}),y[O.name]&&h.jsx("p",{className:"text-sm text-destructive mt-1",children:y[O.name].message})]})}},R=O=>{const D=O.fields.filter(A=>!A.conditional||A.conditional(v(A.name),v,w));return D.length===0?null:h.jsxs("div",{className:"space-y-6",children:[h.jsx("h2",{className:"text-xl font-semibold text-foreground border-b border-border pb-2",children:O.title}),h.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:D.map(A=>h.jsxs("div",{className:"space-y-2",children:[h.jsxs(Et,{htmlFor:A.name,className:"text-sm font-medium text-foreground",children:[A.label," ",A.required&&h.jsx("span",{className:"text-destructive",children:"*"})]}),T(A),A.helpText&&h.jsx("p",{className:"text-xs text-muted-foreground",children:A.helpText})]},A.name))})]},O.title)},k=O=>c[O]?c[O]():null;return h.jsx("div",{className:"bg-card rounded-lg border border-border shadow-sm",children:h.jsxs("form",{onSubmit:b(E),noValidate:!0,className:"p-6 space-y-8",children:[r.sections.map(R),r.customFields&&Object.keys(r.customFields).map(O=>h.jsx("div",{children:k(O)},O)),l&&h.jsx("div",{className:"space-y-4",children:l}),h.jsxs("div",{className:`flex pt-6 border-t border-border ${i?"justify-end gap-2":"justify-end"}`,children:[i&&h.jsx(Te,{type:"button",variant:"ghost",onClick:s||(()=>window.history.back()),disabled:o||m,className:"px-6 py-2",children:"Cancel"}),h.jsx(Te,{type:"submit",disabled:o||m,className:"px-6 py-2",children:o||m?a?r.editLoadingText:r.addLoadingText:a?r.editButtonText:r.addButtonText})]})]})})}var Li=qv,Vv=class extends N.Component{constructor(r){super(r),this.handleRetry=()=>{const e=this.props.maxRetries||3;this.state.retryCount<e&&this.setState({hasError:!1,error:null,errorInfo:null,errorId:null,retryCount:this.state.retryCount+1})},this.handleReset=()=>{this.setState({hasError:!1,error:null,errorInfo:null,errorId:null,retryCount:0})},this.handleReportIssue=()=>{const e=encodeURIComponent(`App Error Report - ${this.state.errorId}`),t=encodeURIComponent(`
Error Report Details:
- Error ID: ${this.state.errorId}
- Error: ${this.state.error?.message||"Unknown error"}
- URL: ${window.location.href}
- User Agent: ${navigator.userAgent}
- Timestamp: ${new Date().toISOString()}

Please describe what you were doing when this error occurred:
    `);window.open(`mailto:support@company.com?subject=${e}&body=${t}`)},this.state={hasError:!1,error:null,errorInfo:null,errorId:null,retryCount:0}}static getDerivedStateFromError(r){return{hasError:!0,error:r,errorId:zl()}}componentDidCatch(r,e){this.setState({errorInfo:e,errorId:this.state.errorId||zl()}),this.props.onError&&this.props.onError(r,e)}render(){return this.state.hasError?this.props.fallback?this.props.fallback(this.state.error,this.state.errorInfo,{retry:this.handleRetry,reset:this.handleReset,retryCount:this.state.retryCount,maxRetries:this.props.maxRetries||3}):h.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background",children:h.jsxs("div",{className:"max-w-md w-full bg-card shadow-lg rounded-lg p-6 border",children:[h.jsxs("div",{className:"flex items-center mb-4",children:[h.jsx("div",{className:"flex-shrink-0",children:h.jsx("div",{className:"h-8 w-8 text-destructive text-2xl",children:""})}),h.jsx("div",{className:"ml-3",children:h.jsx("h3",{className:"text-lg font-medium text-foreground",children:"Something went wrong"})})]}),h.jsxs("div",{className:"mb-4",children:[h.jsx("p",{className:"text-sm text-muted-foreground",children:"We're sorry, but something unexpected happened. Our team has been notified and is working to fix this issue."}),this.state.errorId&&h.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:["Error ID: ",h.jsx("code",{className:"bg-muted px-1 rounded",children:this.state.errorId})]})]}),h.jsxs("div",{className:"flex space-x-3 mb-4",children:[this.state.retryCount<(this.props.maxRetries||3)&&h.jsxs("button",{onClick:this.handleRetry,className:"flex-1 bg-blue-600 text-white px-4 py-2 rounded-md text-sm font-medium hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500",children:["Try Again (",this.state.retryCount+1,"/",(this.props.maxRetries||3)+1,")"]}),h.jsx("button",{onClick:this.handleReset,className:"flex-1 bg-gray-600 text-white px-4 py-2 rounded-md text-sm font-medium hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-500",children:"Reset"})]}),h.jsx("button",{onClick:this.handleReportIssue,className:"w-full bg-gray-100 text-gray-900 px-4 py-2 rounded-md text-sm font-medium hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-gray-500 border border-gray-300",children:" Report Issue"}),!1]})}):this.props.children}};function Gv({className:r,...e}){return h.jsx(Mh,{"data-slot":"avatar",className:bt("relative flex size-8 shrink-0 overflow-hidden rounded-full",r),...e})}function Kv({className:r,...e}){return h.jsx(Ph,{"data-slot":"avatar-image",className:bt("aspect-square size-full",r),...e})}function Yv({className:r,...e}){return h.jsx(jh,{"data-slot":"avatar-fallback",className:bt("bg-muted flex size-full items-center justify-center rounded-full",r),...e})}function Xv({...r}){return h.jsx(Ah,{"data-slot":"dropdown-menu",...r})}function Qv({...r}){return h.jsx(Ih,{"data-slot":"dropdown-menu-trigger",...r})}function Jv({className:r,sideOffset:e=4,...t}){return h.jsx(Lh,{children:h.jsx($h,{"data-slot":"dropdown-menu-content",sideOffset:e,className:bt("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 max-h-(--radix-dropdown-menu-content-available-height) min-w-[8rem] origin-(--radix-dropdown-menu-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border p-1 shadow-md",r),...t})})}function Zv({className:r,inset:e,variant:t="default",...n}){return h.jsx(Hh,{"data-slot":"dropdown-menu-item","data-inset":e,"data-variant":t,className:bt("focus:bg-accent focus:text-accent-foreground data-[variant=destructive]:text-destructive data-[variant=destructive]:focus:bg-destructive/10 dark:data-[variant=destructive]:focus:bg-destructive/20 data-[variant=destructive]:focus:text-destructive data-[variant=destructive]:*:[svg]:!text-destructive [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 data-[inset]:pl-8 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",r),...n})}function ew({className:r,inset:e,...t}){return h.jsx(Fh,{"data-slot":"dropdown-menu-label","data-inset":e,className:bt("px-2 py-1.5 text-sm font-medium data-[inset]:pl-8",r),...t})}function tw({className:r,...e}){return h.jsx(Uh,{"data-slot":"dropdown-menu-separator",className:bt("bg-border -mx-1 my-1 h-px",r),...e})}N.createContext(void 0);N.createContext(void 0);var M={VALIDATION_ERROR:"VALIDATION_ERROR",REQUIRED_FIELD_ERROR:"REQUIRED_FIELD_ERROR",INVALID_FORMAT_ERROR:"INVALID_FORMAT_ERROR",INVALID_RANGE_ERROR:"INVALID_RANGE_ERROR",INVALID_TYPE_ERROR:"INVALID_TYPE_ERROR",NOT_FOUND:"NOT_FOUND",DUPLICATE_ERROR:"DUPLICATE_ERROR",CONFLICT_ERROR:"CONFLICT_ERROR",OUT_OF_SYNC_ERROR:"OUT_OF_SYNC_ERROR",PERMISSION_ERROR:"PERMISSION_ERROR",AUTHENTICATION_ERROR:"AUTHENTICATION_ERROR",AUTHORIZATION_ERROR:"AUTHORIZATION_ERROR",RATE_LIMIT_ERROR:"RATE_LIMIT_ERROR",BUSINESS_LOGIC_ERROR:"BUSINESS_LOGIC_ERROR",INSUFFICIENT_STOCK_ERROR:"INSUFFICIENT_STOCK_ERROR",CAPACITY_EXCEEDED_ERROR:"CAPACITY_EXCEEDED_ERROR",INVALID_OPERATION_ERROR:"INVALID_OPERATION_ERROR",WORKFLOW_ERROR:"WORKFLOW_ERROR",SERVER_ERROR:"SERVER_ERROR",DATABASE_ERROR:"DATABASE_ERROR",NETWORK_ERROR:"NETWORK_ERROR",TIMEOUT_ERROR:"TIMEOUT_ERROR",CONNECTION_ERROR:"CONNECTION_ERROR",EXTERNAL_SERVICE_ERROR:"EXTERNAL_SERVICE_ERROR",API_ERROR:"API_ERROR",INTEGRATION_ERROR:"INTEGRATION_ERROR",CONFIGURATION_ERROR:"CONFIGURATION_ERROR",ENVIRONMENT_ERROR:"ENVIRONMENT_ERROR",RESOURCE_EXHAUSTED_ERROR:"RESOURCE_EXHAUSTED_ERROR",QUOTA_EXCEEDED_ERROR:"QUOTA_EXCEEDED_ERROR",STORAGE_ERROR:"STORAGE_ERROR",USER_INPUT_ERROR:"USER_INPUT_ERROR",UI_ERROR:"UI_ERROR",NAVIGATION_ERROR:"NAVIGATION_ERROR",RECOVERY_ERROR:"RECOVERY_ERROR",RETRY_ERROR:"RETRY_ERROR",FALLBACK_ERROR:"FALLBACK_ERROR"},Ya=class extends Error{constructor(r,e=M.SERVER_ERROR,t=500,n=null,s="",i={}){super(r),this.name="ServiceError",this.type=e,this.statusCode=t,this.originalError=n,this.context=s,this.timestamp=new Date().toISOString(),this.id=i.id||this.generateErrorId(),this.severity=i.severity||this.getDefaultSeverity(e),this.retryable=i.retryable!==void 0?i.retryable:this.isRetryable(e),this.userMessage=i.userMessage||this.getDefaultUserMessage(e,r),this.details=i.details||{},this.metadata=i.metadata||{},n?.stack&&(this.stack=n.stack)}generateErrorId(){return`err_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}getDefaultSeverity(r){return{[M.VALIDATION_ERROR]:"low",[M.REQUIRED_FIELD_ERROR]:"low",[M.INVALID_FORMAT_ERROR]:"low",[M.INVALID_RANGE_ERROR]:"low",[M.INVALID_TYPE_ERROR]:"low",[M.USER_INPUT_ERROR]:"low",[M.UI_ERROR]:"low",[M.NAVIGATION_ERROR]:"low",[M.NOT_FOUND]:"medium",[M.DUPLICATE_ERROR]:"medium",[M.CONFLICT_ERROR]:"medium",[M.BUSINESS_LOGIC_ERROR]:"medium",[M.INSUFFICIENT_STOCK_ERROR]:"medium",[M.CAPACITY_EXCEEDED_ERROR]:"medium",[M.INVALID_OPERATION_ERROR]:"medium",[M.WORKFLOW_ERROR]:"medium",[M.PERMISSION_ERROR]:"high",[M.AUTHENTICATION_ERROR]:"high",[M.AUTHORIZATION_ERROR]:"high",[M.RATE_LIMIT_ERROR]:"high",[M.CONFIGURATION_ERROR]:"high",[M.ENVIRONMENT_ERROR]:"high",[M.SERVER_ERROR]:"critical",[M.DATABASE_ERROR]:"critical",[M.NETWORK_ERROR]:"critical",[M.CONNECTION_ERROR]:"critical",[M.EXTERNAL_SERVICE_ERROR]:"critical",[M.API_ERROR]:"critical",[M.INTEGRATION_ERROR]:"critical",[M.RESOURCE_EXHAUSTED_ERROR]:"critical",[M.QUOTA_EXCEEDED_ERROR]:"critical",[M.STORAGE_ERROR]:"critical"}[r]||"medium"}isRetryable(r){return[M.NETWORK_ERROR,M.CONNECTION_ERROR,M.TIMEOUT_ERROR,M.SERVER_ERROR,M.EXTERNAL_SERVICE_ERROR,M.API_ERROR,M.RATE_LIMIT_ERROR].includes(r)}getDefaultUserMessage(r,e){return{[M.VALIDATION_ERROR]:"Please check your input and try again.",[M.REQUIRED_FIELD_ERROR]:"Please fill in all required fields.",[M.INVALID_FORMAT_ERROR]:"Please check the format of your input.",[M.INVALID_RANGE_ERROR]:"Please enter a value within the allowed range.",[M.INVALID_TYPE_ERROR]:"Please enter the correct type of data.",[M.NOT_FOUND]:"The requested item was not found.",[M.DUPLICATE_ERROR]:"This item already exists.",[M.CONFLICT_ERROR]:"There was a conflict with your request.",[M.PERMISSION_ERROR]:"You do not have permission to perform this action.",[M.AUTHENTICATION_ERROR]:"Please log in to continue.",[M.AUTHORIZATION_ERROR]:"You are not authorized to perform this action.",[M.BUSINESS_LOGIC_ERROR]:"This operation cannot be completed due to business rules.",[M.INSUFFICIENT_STOCK_ERROR]:"Insufficient stock available.",[M.CAPACITY_EXCEEDED_ERROR]:"Capacity limit exceeded.",[M.INVALID_OPERATION_ERROR]:"This operation is not allowed.",[M.SERVER_ERROR]:"A server error occurred. Please try again later.",[M.DATABASE_ERROR]:"A database error occurred. Please try again later.",[M.NETWORK_ERROR]:"Network connection failed. Please check your connection.",[M.CONNECTION_ERROR]:"Connection failed. Please try again.",[M.TIMEOUT_ERROR]:"The operation timed out. Please try again.",[M.EXTERNAL_SERVICE_ERROR]:"External service is temporarily unavailable.",[M.API_ERROR]:"API request failed. Please try again later.",[M.CONFIGURATION_ERROR]:"System configuration error. Please contact support.",[M.ENVIRONMENT_ERROR]:"Environment configuration error. Please contact support.",[M.RESOURCE_EXHAUSTED_ERROR]:"System resources are exhausted. Please try again later.",[M.QUOTA_EXCEEDED_ERROR]:"Quota exceeded. Please try again later.",[M.STORAGE_ERROR]:"Storage error occurred. Please try again later.",[M.USER_INPUT_ERROR]:"Please check your input and try again.",[M.UI_ERROR]:"A user interface error occurred.",[M.NAVIGATION_ERROR]:"Navigation error occurred.",[M.RECOVERY_ERROR]:"Error recovery failed.",[M.RETRY_ERROR]:"Retry operation failed.",[M.FALLBACK_ERROR]:"Fallback operation failed."}[r]||"An unexpected error occurred. Please try again."}toUserFriendly(){return{message:this.userMessage,type:this.type,severity:this.severity,retryable:this.retryable,timestamp:this.timestamp}}},rw=r=>{if(!r)return{type:M.SERVER_ERROR,message:"Unknown error occurred"};switch(r.code){case"23505":return{type:M.DUPLICATE_ERROR,message:"A record with this information already exists",details:{constraint:r.constraint,table:r.table}};case"23503":return{type:M.CONFLICT_ERROR,message:"Cannot perform this action due to related records",details:{constraint:r.constraint,table:r.table}};case"23502":return{type:M.REQUIRED_FIELD_ERROR,message:"Required fields are missing",details:{column:r.column,table:r.table}};case"23514":return{type:M.VALIDATION_ERROR,message:"Data validation failed",details:{constraint:r.constraint,table:r.table}};case"42P01":return{type:M.DATABASE_ERROR,message:"Database table not found",details:{table:r.table}};case"42703":return{type:M.DATABASE_ERROR,message:"Database column not found",details:{column:r.column,table:r.table}};case"PGRST301":case"PGRST302":return{type:M.AUTHENTICATION_ERROR,message:"Authentication expired. Please log in again."};case"PGRST001":return{type:M.AUTHORIZATION_ERROR,message:"You do not have permission to perform this action."};case"PGRST116":return{type:M.NOT_FOUND,message:"Record not found"};default:return r.message?.includes("JWT")?{type:M.AUTHENTICATION_ERROR,message:"Authentication error. Please refresh the page"}:r.message?.includes("network")?{type:M.NETWORK_ERROR,message:"Network connection failed"}:r.message?.includes("timeout")?{type:M.TIMEOUT_ERROR,message:"Request timed out"}:{type:M.SERVER_ERROR,message:r.message||"An unexpected error occurred"}}},_t=async(r,e="unknown")=>{try{return await r()}catch(t){if(t instanceof Ya)throw t;const n=rw(t);throw new Ya(n.message,n.type,500,t,e,{details:n.details})}},Un=class{constructor(r,e){this.realtimeChannels=new Map,this.client=r,this.tableName=e}async init(){return _t(async()=>{const{error:r}=await this.client.from(this.tableName).select("count").limit(1);if(r)throw r;return!0},`${this.tableName}.init`)}async getAll(r={}){return _t(async()=>{let e=this.client.from(this.tableName).select(r.select||"*").order(r.orderBy||"created_at",{ascending:r.ascending!==!1});if(r.filters&&Object.entries(r.filters).forEach(([s,i])=>{i!=null&&i!==""&&(Array.isArray(i)?e=e.in(s,i):typeof i=="string"&&i.includes("%")?e=e.like(s,i):e=e.eq(s,i))}),r.dateRange){const{startDate:s,endDate:i,dateField:a="created_at"}=r.dateRange;s&&(e=e.gte(a,`${s}T00:00:00.000Z`)),i&&(e=e.lte(a,`${i}T23:59:59.999Z`))}r.limit&&(e=e.limit(r.limit)),r.offset&&(e=e.range(r.offset,r.offset+(r.limit||10)-1));const{data:t,error:n}=await e;if(n)throw n;return t||[]},`${this.tableName}.getAll`)}async getPaginated(r={}){const e=r.page||1,t=r.perPage||10,n=(e-1)*t,[s,i]=await Promise.all([this.count(r.filters),this.getAll({...r,limit:t,offset:n})]);return{data:i,total:s,page:e,perPage:t,totalPages:Math.ceil(s/t)}}async getById(r,e="*"){return _t(async()=>{const{data:t,error:n}=await this.client.from(this.tableName).select(e).eq("id",r).single();if(n)throw n;return t},`${this.tableName}.getById`)}async getByField(r,e,t={}){return _t(async()=>{let n=this.client.from(this.tableName).select(t.select||"*").eq(r,e);t.orderBy&&(n=n.order(t.orderBy,{ascending:t.ascending!==!1})),t.limit&&(n=n.limit(t.limit));const{data:s,error:i}=await n;if(i)throw i;return s||[]},`${this.tableName}.getByField`)}async create(r){return _t(async()=>{const{data:e,error:t}=await this.client.from(this.tableName).insert(r).select().single();if(t)throw t;return e},`${this.tableName}.create`)}async createMany(r){return _t(async()=>{const{data:e,error:t}=await this.client.from(this.tableName).insert(r).select();if(t)throw t;return e||[]},`${this.tableName}.createMany`)}async update(r,e){return _t(async()=>{const{data:t,error:n}=await this.client.from(this.tableName).update(e).eq("id",r).select().single();if(n)throw n;return t},`${this.tableName}.update`)}async updateMany(r){return _t(async()=>{const e=r.map(({id:t,data:n})=>this.update(t,n));return Promise.all(e)},`${this.tableName}.updateMany`)}async upsert(r,e){return _t(async()=>{let t=this.client.from(this.tableName).upsert(r).select().single();e&&(t=t.onConflict(e));const{data:n,error:s}=await t;if(s)throw s;return n},`${this.tableName}.upsert`)}async delete(r){return _t(async()=>{const{error:e}=await this.client.from(this.tableName).delete().eq("id",r);if(e)throw e},`${this.tableName}.delete`)}async bulkDelete(r){return _t(async()=>{const{error:e}=await this.client.from(this.tableName).delete().in("id",r);if(e)throw e},`${this.tableName}.bulkDelete`)}async count(r){return _t(async()=>{let e=this.client.from(this.tableName).select("*",{count:"exact",head:!0});r&&Object.entries(r).forEach(([s,i])=>{i!=null&&i!==""&&(Array.isArray(i)?e=e.in(s,i):e=e.eq(s,i))});const{count:t,error:n}=await e;if(n)throw n;return t||0},`${this.tableName}.count`)}async exists(r){return _t(async()=>{const{data:e,error:t}=await this.client.from(this.tableName).select("id").eq("id",r).single();if(t&&t.code!=="PGRST116")throw t;return!!e},`${this.tableName}.exists`)}async search(r,e=["name"],t={}){return _t(async()=>{let n=this.client.from(this.tableName).select(t.select||"*");if(e.length===1)n=n.ilike(e[0],`%${r}%`);else{const a=e.map(o=>`${o}.ilike.%${r}%`).join(",");n=n.or(a)}t.filters&&Object.entries(t.filters).forEach(([a,o])=>{o!=null&&o!==""&&(n=n.eq(a,o))}),n=n.order(t.orderBy||"created_at",{ascending:t.ascending!==!1}),t.limit&&(n=n.limit(t.limit));const{data:s,error:i}=await n;if(i)throw i;return s||[]},`${this.tableName}.search`)}async getByDateRange(r,e,t="created_at",n={}){return this.getAll({...n,dateRange:{startDate:r,endDate:e,dateField:t}})}async executeRpc(r,e){return _t(async()=>{const{data:t,error:n}=await this.client.rpc(r,e);if(n)throw n;return t},`${this.tableName}.executeRpc`)}setupRealtimeSubscription(r,e={},t){const n=t||`${this.tableName}_realtime_${Date.now()}`;let s=this.client.channel(n).on("postgres_changes",{event:e.event||"*",schema:e.schema||"public",table:this.tableName,filter:e.filter},r).subscribe();return this.realtimeChannels.set(n,s),s}removeRealtimeSubscription(r){const e=this.realtimeChannels.get(r);e&&(this.client.removeChannel(e),this.realtimeChannels.delete(r))}removeAllRealtimeSubscriptions(){this.realtimeChannels.forEach((r,e)=>{this.client.removeChannel(r)}),this.realtimeChannels.clear()}async bulkOperation(r){return _t(async()=>{const e=[];for(const t of r){let n;switch(t.type){case"insert":n=await this.create(t.data);break;case"update":n=await this.update(t.id,t.data);break;case"delete":await this.delete(t.id),n={deleted:!0,id:t.id};break;case"upsert":n=await this.upsert(t.data);break;default:throw new Ya(`Unknown operation type: ${t.type}`,M.INVALID_OPERATION_ERROR)}e.push(n)}return e},`${this.tableName}.bulkOperation`)}getTableName(){return this.tableName}getClient(){return this.client}},nw=r=>{const e={auth:{persistSession:!0,autoRefreshToken:!0},realtime:{params:{eventsPerSecond:10}}};return wv(r.url,r.anonKey,{...e,...r.options})},sw=(r,e="")=>r.code==="23505"?"This record already exists":r.code==="23503"?"Cannot perform this operation due to related records":r.code==="PGRST116"?"No records found":r.message?.includes("JWT")?"Authentication error. Please refresh the page":r.message||"An unexpected error occurred",iw=r=>e=>({getEntities:()=>e().entities,getEntityById:t=>e().entities.find(n=>n.id===t),getEntitiesByField:(t,n)=>e().entities.filter(s=>s[t]===n),getEntitiesCount:()=>e().entities.length,getLoadingState:()=>e().loading,getErrorState:()=>e().error,isInitialized:()=>e().initialized}),aw=r=>(e,t)=>({setEntities:n=>e({entities:n}),addEntity:n=>{const s=t();e({entities:[n,...s.entities]})},updateEntity:(n,s)=>{const a=t().entities.map(o=>o.id===n?{...o,...s}:o);e({entities:a})},removeEntity:n=>{const i=t().entities.filter(a=>a.id!==n);e({entities:i})},setLoading:n=>e({loading:n}),setError:n=>e({error:n}),setInitialized:n=>e({initialized:n}),reset:()=>e({entities:[],loading:!1,error:null,initialized:!1}),cleanupDuplicates:()=>{const n=t(),s=[],i=new Set;n.entities.forEach(a=>{i.has(a.id)||(i.add(a.id),s.push(a))}),e({entities:s})},sortEntitiesByDate:(n=!1)=>{const i=[...t().entities].sort((a,o)=>{const l=new Date(a.created_at||0),c=new Date(o.created_at||0);return n?l.getTime()-c.getTime():c.getTime()-l.getTime()});e({entities:i})},sortEntitiesByField:(n,s=!0)=>{const a=[...t().entities].sort((o,l)=>{const c=o[n],d=l[n];return c<d?s?-1:1:c>d?s?1:-1:0});e({entities:a})},filterEntitiesByDateRange:(n,s,i="created_at")=>{const a=t(),o=new Date(n),l=new Date(s);return a.entities.filter(c=>{const d=new Date(c[i]);return d>=o&&d<=l})}});function $i(r,e,t,n){const s={entities:[],loading:!1,error:null,initialized:!1},i=(a,o)=>({...s,...iw()(o),...aw()(a,o),...e?e(a,o):{},...t?t(o):{}});return n?ms()(Yd(i,{name:`${r}-store`,...n})):ms()(i)}function ow(r,e){const t={loading:!1,loadingStates:{},error:null,errors:{},modals:{},forms:{},filters:{},notifications:[],sidebarOpen:!1,theme:"system",initialized:!1},n=(s,i)=>({...t,setLoading:a=>s({loading:a}),setLoadingState:(a,o)=>{const l=i();s({loadingStates:{...l.loadingStates,[a]:o}})},getLoadingState:a=>{const o=i();return a?o.loadingStates[a]||!1:o.loading},setError:a=>s({error:a}),setErrorState:(a,o)=>{const l=i();s({errors:{...l.errors,[a]:o}})},getErrorState:a=>{const o=i();return a?o.errors[a]||null:o.error},clearErrors:()=>s({error:null,errors:{}}),openModal:a=>{const o=i();s({modals:{...o.modals,[a]:!0}})},closeModal:a=>{const o=i();s({modals:{...o.modals,[a]:!1}})},toggleModal:a=>{const o=i(),l=o.modals[a]||!1;s({modals:{...o.modals,[a]:!l}})},isModalOpen:a=>i().modals[a]||!1,closeAllModals:()=>s({modals:{}}),setFormData:(a,o)=>{const l=i();s({forms:{...l.forms,[a]:o}})},getFormData:a=>i().forms[a],clearFormData:a=>{const o=i(),{[a]:l,...c}=o.forms;s({forms:c})},clearAllForms:()=>s({forms:{}}),setFilter:(a,o)=>{const l=i();s({filters:{...l.filters,[a]:o}})},getFilter:a=>i().filters[a],clearFilter:a=>{const o=i(),{[a]:l,...c}=o.filters;s({filters:c})},clearAllFilters:()=>s({filters:{}}),addNotification:a=>{const o=i(),l={...a,id:`notification_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,timestamp:Date.now()};s({notifications:[...o.notifications,l]})},removeNotification:a=>{const o=i();s({notifications:o.notifications.filter(l=>l.id!==a)})},clearNotifications:()=>s({notifications:[]}),setSidebarOpen:a=>s({sidebarOpen:a}),toggleSidebar:()=>{const a=i();s({sidebarOpen:!a.sidebarOpen})},setTheme:a=>s({theme:a}),setInitialized:a=>s({initialized:a}),reset:()=>s(t),...r?r(s,i):{}});return e?ms()(Yd(n,{name:"ui-store",...e})):ms()(n)}const lw="https://wufsjkzyjxgvualcaftn.supabase.co",cw="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Ind1ZnNqa3p5anhndnVhbGNhZnRuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE0NzAyNzAsImV4cCI6MjA3NzA0NjI3MH0.cq8pGstXbA3OzgPbkJNRrQT39ROA4t9N3czLSIWpjUs",Me=nw({url:lw,anonKey:cw}),tt=sw,dw=({children:r})=>h.jsx(Hv,{supabaseClient:Me,children:r}),dn=Bv;function uw(){const{user:r}=dn(),e=Bh(),{isOpen:t}=Uv(),n=[{href:"/",label:"Dashboard",icon:zh},{href:"/backlog",label:"Backlog",icon:Wh},{href:"/machinery",label:"Macchinari",icon:qh},{href:"/phases",label:"Fasi",icon:Vh},{href:"/scheduler",label:"Scheduler",icon:Gh}];return r?t?h.jsxs("nav",{className:"w-64 bg-secondary shadow-sm border-r border-border h-screen flex flex-col flex-shrink-0 sticky left-0 z-30",children:[h.jsx("div",{className:"p-4 border-b border-border",children:h.jsx(Nt,{to:"/",className:"flex items-center justify-center",children:h.jsx("img",{className:"h-6",src:"/scheduler-logo.png",alt:"Scheduler"})})}),h.jsxs("div",{className:"flex-1 p-4",children:[h.jsx("h2",{className:"text-xl font-semibold text-secondary-foreground mb-6",children:"Navigation"}),h.jsx("nav",{className:"space-y-2",children:n.map(s=>{const i=e.pathname===s.href,a=s.icon;return h.jsxs(Nt,{to:s.href,className:`flex items-center space-x-3 px-3 py-2 rounded-lg transition-colors ${i?"bg-primary/10 text-primary":"text-muted-foreground hover:text-foreground hover:bg-accent"}`,children:[h.jsx(a,{className:"h-5 w-5"}),h.jsx("span",{className:"text-sm font-medium",children:s.label})]},s.href)})})]})]}):h.jsx("div",{className:"w-16 bg-secondary shadow-sm border-r border-border min-h-screen",children:h.jsx("div",{className:"flex flex-col items-center py-4 space-y-4",children:n.map(s=>{const i=s.icon,a=e.pathname===s.href;return h.jsx(Nt,{to:s.href,className:`p-3 rounded-lg transition-colors ${a?"bg-primary/10 text-primary":"text-muted-foreground hover:text-foreground hover:bg-accent"}`,title:s.label,children:h.jsx(i,{className:"h-6 w-6"})},s.href)})})}):h.jsxs("nav",{className:"w-64 bg-secondary shadow-sm border-r border-border h-screen flex flex-col",children:[h.jsx("div",{className:"p-4 border-b border-border",children:h.jsx(Nt,{to:"/",className:"flex items-center justify-center",children:h.jsx("img",{className:"h-6",src:"/scheduler-logo.png",alt:"Scheduler"})})}),h.jsxs("div",{className:"flex-1 p-4",children:[h.jsx("h3",{className:"text-xs font-semibold text-secondary-foreground uppercase tracking-wider mb-4",children:"NAVIGATION"}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Nt,{to:"/login",className:"flex items-center space-x-3 px-3 py-2 rounded-lg text-muted-foreground hover:text-foreground hover:bg-accent transition-colors",children:h.jsx("span",{className:"font-medium",children:"Accedi"})}),h.jsx(Nt,{to:"/signup",className:"flex items-center space-x-3 px-3 py-2 rounded-lg text-muted-foreground hover:text-foreground hover:bg-accent transition-colors",children:h.jsx("span",{className:"font-medium",children:"Registrati"})})]})]})]})}const hw=({onRefresh:r,loading:e=!1})=>{const t=()=>{r?r():window.location.reload()};return h.jsx(Te,{onClick:t,variant:"ghost",size:"icon",className:"hidden sm:inline-flex",children:e?h.jsx(Kh,{className:"animate-spin"}):h.jsx(Yh,{})})},fw=({user:r,onLogout:e})=>{const[t,n]=_.useState(!1),s=_.useCallback(()=>{n(a=>!a)},[]),i=()=>{e&&e(),n(!1)};return h.jsxs(Xv,{open:t,onOpenChange:s,children:[h.jsx(Qv,{asChild:!0,children:h.jsx(Te,{variant:"ghost",className:"relative h-8 w-8 ml-2 rounded-full",children:h.jsxs(Gv,{className:"h-8 w-8",children:[h.jsx(Kv,{src:r?.avatar,role:"presentation"}),h.jsx(Yv,{children:r?.name?.charAt(0)||"U"})]})})}),h.jsxs(Jv,{className:"w-56",align:"end",forceMount:!0,children:[h.jsx(ew,{className:"font-normal",children:h.jsxs("div",{className:"flex flex-col space-y-1",children:[h.jsx("p",{className:"text-sm font-medium leading-none",children:r?.name||"User"}),r?.email&&h.jsx("p",{className:"text-xs text-muted-foreground",children:r.email})]})}),h.jsx(tw,{}),h.jsxs(Zv,{onClick:i,className:"cursor-pointer",children:[h.jsx(Xh,{}),"Log out"]})]})]})};function gw(){const{user:r,signOut:e}=dn();return h.jsx("header",{className:"bg-secondary border-b border-border",children:h.jsx("div",{className:"px-4",children:h.jsxs("div",{className:"flex justify-between items-center flex-1 h-12",children:[h.jsxs(Nt,{to:"/",className:"flex items-center gap-2 text-secondary-foreground no-underline",children:[h.jsx("img",{className:"h-6",src:"/scheduler-logo.png",alt:"Scheduler"}),h.jsx("h1",{className:"text-xl font-semibold",children:"Scheduler"})]}),h.jsxs("div",{className:"flex items-center",children:[h.jsx(Iv,{}),h.jsx(hw,{onRefresh:()=>window.location.reload(),loading:!1}),h.jsx(fw,{user:{name:r?.email?.split("@")[0]||"User",email:r?.email,avatar:r?.avatar},onLogout:()=>e()})]})]})})})}const ur=$i("machines",(r,e)=>({getMachinesByWorkCenter:t=>{const n=e();return t==="BOTH"?n.entities:n.entities.filter(s=>s.work_center===t)},getAvailableMachines:()=>e().entities.filter(n=>n.status==="available"),getMachineById:t=>e().entities.find(s=>s.id===t),updateMachineStatus:(t,n)=>{const i=e().entities.map(a=>a.id===t?{...a,status:n,updated_at:new Date().toISOString()}:a);r({entities:i})},getMachineStats:()=>{const t=e(),n={total:t.entities.length,byStatus:{},byWorkCenter:{}};return t.entities.forEach(s=>{n.byStatus[s.status]=(n.byStatus[s.status]||0)+1,n.byWorkCenter[s.work_center]=(n.byWorkCenter[s.work_center]||0)+1}),n}}),r=>({}),{partialize:r=>({entities:r.entities,initialized:r.initialized})}),dt=$i("orders",(r,e)=>({getScheduledOrders:()=>e().entities.filter(n=>n.status==="SCHEDULED"),getUnscheduledOrders:()=>e().entities.filter(n=>n.status!=="SCHEDULED"&&n.duration>0&&n.cost>0),getOrdersByWorkCenter:t=>{const n=e();return t==="BOTH"?n.entities:n.entities.filter(s=>s.work_center===t)},getOrderById:t=>e().entities.find(s=>s.id===t),scheduleOrder:(t,n)=>{const i=e().entities.map(a=>a.id===t?{...a,...n,status:"SCHEDULED",updated_at:new Date().toISOString()}:a);r({entities:i})},unscheduleOrder:t=>{const s=e().entities.map(i=>i.id===t?{...i,status:"NOT SCHEDULED",scheduled_start_time:null,scheduled_end_time:null,machine_id:null,updated_at:new Date().toISOString()}:i);r({entities:s})},bulkScheduleOrders:t=>{const s=e().entities.map(i=>{const a=t.find(o=>o.id===i.id);return a?{...i,...a.data,status:"SCHEDULED",updated_at:new Date().toISOString()}:i});r({entities:s})},getOrderStats:()=>{const t=e(),n={total:t.entities.length,scheduled:0,unscheduled:0,byWorkCenter:{}};return t.entities.forEach(s=>{s.status==="SCHEDULED"?n.scheduled++:n.unscheduled++,n.byWorkCenter[s.work_center]=(n.byWorkCenter[s.work_center]||0)+1}),n}}),r=>({}),{partialize:r=>({entities:r.entities,initialized:r.initialized})}),bi=$i("phases",(r,e)=>({getPhasesByWorkCenter:t=>e().entities.filter(s=>s.work_center===t),getPhaseById:t=>e().entities.find(s=>s.id===t),searchPhases:t=>{const n=e();if(!t)return n.entities;const s=t.toLowerCase();return n.entities.filter(i=>i.phase_name?.toLowerCase().includes(s)||i.description?.toLowerCase().includes(s))},updatePhaseDetails:(t,n)=>{const i=e().entities.map(a=>a.id===t?{...a,...n,updated_at:new Date().toISOString()}:a);r({entities:i})},getPhaseStats:()=>{const t=e(),n={total:t.entities.length,byWorkCenter:{}};return t.entities.forEach(s=>{n.byWorkCenter[s.work_center]=(n.byWorkCenter[s.work_center]||0)+1}),n}}),r=>({}),{partialize:r=>({entities:r.entities,initialized:r.initialized})}),Ve=ow((r,e)=>({selectedWorkCenter:"BOTH",isEditMode:!1,schedulingLoading:{isScheduling:!1,isRescheduling:!1,isShunting:!1,taskId:null},conflictDialog:{isOpen:!1,conflictingTasks:[],newTask:null},dragPreview:{isActive:!1,startSlot:null,durationSlots:0,machineId:null},setSelectedWorkCenter:t=>r({selectedWorkCenter:t}),setEditMode:t=>r({isEditMode:t}),toggleEditMode:()=>r(t=>({isEditMode:!t.isEditMode})),setSchedulingLoading:t=>{const n=e();r({schedulingLoading:{...n.schedulingLoading,...t}})},startSchedulingOperation:(t=null,n=null)=>{r({schedulingLoading:{isScheduling:t==="schedule",isRescheduling:t==="reschedule",isShunting:t==="shunt",isNavigating:t==="navigate",operationType:t,taskId:n}})},stopSchedulingOperation:()=>{r({schedulingLoading:{isScheduling:!1,isRescheduling:!1,isShunting:!1,isNavigating:!1,operationType:null,taskId:null}})},setConflictDialog:t=>{const n=e();r({conflictDialog:{...n.conflictDialog,...t}})},setDragPreview:t=>{r({dragPreview:t})},clearDragPreview:()=>{r({dragPreview:{isActive:!1,startSlot:null,durationSlots:0,machineId:null}})},openConflictDialog:(t,n)=>{r({conflictDialog:{isOpen:!0,conflictingTasks:t,newTask:n}})},closeConflictDialog:()=>{r({conflictDialog:{isOpen:!1,conflictingTasks:[],newTask:null}})},showConflictDialog:t=>{r({conflictDialog:{isOpen:!0,details:t}})},hideConflictDialog:()=>{r({conflictDialog:{isOpen:!1,details:null}})},showSchedulerAlert:(t,n="info",s=5e3)=>{const i=e(),a={type:n,message:t,timestamp:Date.now()};i.addNotification(a),s>0&&setTimeout(()=>{i.removeNotification(a.id)},s)},showConfirmDialog:(t,n,s,i="info")=>{const a=e();a.setFormData("confirmDialog",{isOpen:!0,title:t,message:n,onConfirm:s,type:i}),a.openModal("confirmDialog")},closeConfirmDialog:()=>{const t=e();t.clearFormData("confirmDialog"),t.closeModal("confirmDialog")},getInitializationState:()=>e().initialized,getLoadingState:t=>{const n=e();return t?n.loadingStates[t]||!1:n.loading}}),{partialize:r=>({selectedWorkCenter:r.selectedWorkCenter,theme:r.theme,sidebarOpen:r.sidebarOpen,filters:r.filters})}),zr=$i("main",(r,e)=>({init:async()=>{try{const t=Ve.getState();t.setLoading(!0),t.setInitialized(!0),t.setLoading(!1),t.showSchedulerAlert("Application initialized successfully with modern architecture","success")}catch(t){const n=Ve.getState();throw n.setLoading(!1),n.showSchedulerAlert("Failed to initialize application","error"),t}},refreshData:()=>{console.warn("refreshData is deprecated. Use React Query invalidation instead.")},reset:()=>{ur.getState().reset(),dt.getState().reset(),bi.getState().reset(),Ve.getState().reset()},cleanup:()=>{console.log("Cleanup handled by modern architecture")},getState:()=>{const t=ur.getState(),n=dt.getState(),s=bi.getState(),i=Ve.getState();return{machines:t.entities,odpOrders:n.entities,phases:s.entities,isLoading:i.loading,isInitialized:i.initialized}}})),mw={APP:{FIRST_DAY_OF_WEEK:1}},pw=Object.prototype.toString;function bw(r,e){return pw.call(r)===`[object ${e}]`}function eu(r){return bw(r,"Object")}function No(r){return!!(r&&r.then&&typeof r.then=="function")}function yw(r){return typeof r=="number"&&r!==r}function Gs(r){return r&&r.Math==Math?r:void 0}const pt=typeof globalThis=="object"&&Gs(globalThis)||typeof window=="object"&&Gs(window)||typeof self=="object"&&Gs(self)||typeof global=="object"&&Gs(global)||(function(){return this})()||{};function tu(r,e,t){const n=t||pt,s=n.__SENTRY__=n.__SENTRY__||{};return s[r]||(s[r]=e())}const ru=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__,vw="Sentry Logger ",Wl=["debug","info","warn","error","log","assert","trace"],ql={};function nu(r){if(!("console"in pt))return r();const e=pt.console,t={},n=Object.keys(ql);n.forEach(s=>{const i=ql[s];t[s]=e[s],e[s]=i});try{return r()}finally{n.forEach(s=>{e[s]=t[s]})}}function ww(){let r=!1;const e={enable:()=>{r=!0},disable:()=>{r=!1},isEnabled:()=>r};return ru?Wl.forEach(t=>{e[t]=(...n)=>{r&&nu(()=>{pt.console[t](`${vw}[${t}]:`,...n)})}}):Wl.forEach(t=>{e[t]=()=>{}}),e}const Ge=ww();function tr(r){return Xa(r,new Map)}function Xa(r,e){if(_w(r)){const t=e.get(r);if(t!==void 0)return t;const n={};e.set(r,n);for(const s of Object.keys(r))typeof r[s]<"u"&&(n[s]=Xa(r[s],e));return n}if(Array.isArray(r)){const t=e.get(r);if(t!==void 0)return t;const n=[];return e.set(r,n),r.forEach(s=>{n.push(Xa(s,e))}),n}return r}function _w(r){if(!eu(r))return!1;try{const e=Object.getPrototypeOf(r).constructor.name;return!e||e==="Object"}catch{return!0}}const va="<anonymous>";function Sw(r){try{return!r||typeof r!="function"?va:r.name||va}catch{return va}}const ii={},Vl={};function su(r,e){ii[r]=ii[r]||[],ii[r].push(e)}function iu(r,e){Vl[r]||(e(),Vl[r]=!0)}function au(r,e){const t=r&&ii[r];if(t)for(const n of t)try{n(e)}catch(s){ru&&Ge.error(`Error while triggering instrumentation handler.
Type: ${r}
Name: ${Sw(n)}
Error:`,s)}}function At(){const r=pt,e=r.crypto||r.msCrypto;let t=()=>Math.random()*16;try{if(e&&e.randomUUID)return e.randomUUID().replace(/-/g,"");e&&e.getRandomValues&&(t=()=>{const n=new Uint8Array(1);return e.getRandomValues(n),n[0]})}catch{}return("10000000100040008000"+1e11).replace(/[018]/g,n=>(n^(t()&15)>>n/4).toString(16))}function xw(r){return Array.isArray(r)?r:[r]}let Ks=null;function Ew(r){const e="error";su(e,r),iu(e,Tw)}function Tw(){Ks=pt.onerror,pt.onerror=function(r,e,t,n,s){return au("error",{column:n,error:s,line:t,msg:r,url:e}),Ks&&!Ks.__SENTRY_LOADER__?Ks.apply(this,arguments):!1},pt.onerror.__SENTRY_INSTRUMENTED__=!0}let Ys=null;function Rw(r){const e="unhandledrejection";su(e,r),iu(e,Ow)}function Ow(){Ys=pt.onunhandledrejection,pt.onunhandledrejection=function(r){return au("unhandledrejection",r),Ys&&!Ys.__SENTRY_LOADER__?Ys.apply(this,arguments):!0},pt.onunhandledrejection.__SENTRY_INSTRUMENTED__=!0}function Cw(){return typeof __SENTRY_BROWSER_BUNDLE__<"u"&&!!__SENTRY_BROWSER_BUNDLE__}function kw(){return!Cw()&&Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]"}function nn(r,e){return r.require(e)}function Dw(r){let e;try{e=nn(module,r)}catch{}try{const{cwd:t}=nn(module,"process");e=nn(module,`${t()}/node_modules/${r}`)}catch{}return e}var wr;(function(r){r[r.PENDING=0]="PENDING";const t=1;r[r.RESOLVED=t]="RESOLVED";const n=2;r[r.REJECTED=n]="REJECTED"})(wr||(wr={}));class $r{constructor(e){$r.prototype.__init.call(this),$r.prototype.__init2.call(this),$r.prototype.__init3.call(this),$r.prototype.__init4.call(this),this._state=wr.PENDING,this._handlers=[];try{e(this._resolve,this._reject)}catch(t){this._reject(t)}}then(e,t){return new $r((n,s)=>{this._handlers.push([!1,i=>{if(!e)n(i);else try{n(e(i))}catch(a){s(a)}},i=>{if(!t)s(i);else try{n(t(i))}catch(a){s(a)}}]),this._executeHandlers()})}catch(e){return this.then(t=>t,e)}finally(e){return new $r((t,n)=>{let s,i;return this.then(a=>{i=!1,s=a,e&&e()},a=>{i=!0,s=a,e&&e()}).then(()=>{if(i){n(s);return}t(s)})})}__init(){this._resolve=e=>{this._setResult(wr.RESOLVED,e)}}__init2(){this._reject=e=>{this._setResult(wr.REJECTED,e)}}__init3(){this._setResult=(e,t)=>{if(this._state===wr.PENDING){if(No(t)){t.then(this._resolve,this._reject);return}this._state=e,this._value=t,this._executeHandlers()}}}__init4(){this._executeHandlers=()=>{if(this._state===wr.PENDING)return;const e=this._handlers.slice();this._handlers=[],e.forEach(t=>{t[0]||(this._state===wr.RESOLVED&&t[1](this._value),this._state===wr.REJECTED&&t[2](this._value),t[0]=!0)})}}}const ou=1e3;function Ao(){return Date.now()/ou}function Nw(){const{performance:r}=pt;if(!r||!r.now)return Ao;const e=Date.now()-r.now(),t=r.timeOrigin==null?e:r.timeOrigin;return()=>(t+r.now())/ou}const Fi=Nw();(()=>{const{performance:r}=pt;if(!r||!r.now)return;const e=3600*1e3,t=r.now(),n=Date.now(),s=r.timeOrigin?Math.abs(r.timeOrigin+t-n):e,i=s<e,a=r.timing&&r.timing.navigationStart,l=typeof a=="number"?Math.abs(a+t-n):e,c=l<e;return i||c?s<=l?r.timeOrigin:a:n})();function Aw(r=At(),e=At().substring(16),t){let n="";return t!==void 0&&(n=t?"-1":"-0"),`${r}-${e}${n}`}const ut=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__,lu="production";function Iw(){return tu("globalEventProcessors",()=>[])}function Qa(r,e,t,n=0){return new $r((s,i)=>{const a=r[n];if(e===null||typeof a!="function")s(e);else{const o=a({...e},t);ut&&a.id&&o===null&&Ge.log(`Event processor "${a.id}" dropped event`),No(o)?o.then(l=>Qa(r,l,t,n+1).then(s)).then(null,i):Qa(r,o,t,n+1).then(s).then(null,i)}})}function Mw(r){const e=Fi(),t={sid:At(),init:!0,timestamp:e,started:e,duration:0,status:"ok",errors:0,ignoreDuration:!1,toJSON:()=>jw(t)};return r&&Ui(t,r),t}function Ui(r,e={}){if(e.user&&(!r.ipAddress&&e.user.ip_address&&(r.ipAddress=e.user.ip_address),!r.did&&!e.did&&(r.did=e.user.id||e.user.email||e.user.username)),r.timestamp=e.timestamp||Fi(),e.abnormal_mechanism&&(r.abnormal_mechanism=e.abnormal_mechanism),e.ignoreDuration&&(r.ignoreDuration=e.ignoreDuration),e.sid&&(r.sid=e.sid.length===32?e.sid:At()),e.init!==void 0&&(r.init=e.init),!r.did&&e.did&&(r.did=`${e.did}`),typeof e.started=="number"&&(r.started=e.started),r.ignoreDuration)r.duration=void 0;else if(typeof e.duration=="number")r.duration=e.duration;else{const t=r.timestamp-r.started;r.duration=t>=0?t:0}e.release&&(r.release=e.release),e.environment&&(r.environment=e.environment),!r.ipAddress&&e.ipAddress&&(r.ipAddress=e.ipAddress),!r.userAgent&&e.userAgent&&(r.userAgent=e.userAgent),typeof e.errors=="number"&&(r.errors=e.errors),e.status&&(r.status=e.status)}function Pw(r,e){let t={};r.status==="ok"&&(t={status:"exited"}),Ui(r,t)}function jw(r){return tr({sid:`${r.sid}`,init:r.init,started:new Date(r.started*1e3).toISOString(),timestamp:new Date(r.timestamp*1e3).toISOString(),status:r.status,errors:r.errors,did:typeof r.did=="number"||typeof r.did=="string"?`${r.did}`:void 0,duration:r.duration,abnormal_mechanism:r.abnormal_mechanism,attrs:{release:r.release,environment:r.environment,ip_address:r.ipAddress,user_agent:r.userAgent}})}const Lw=0,cu=1;function Io(r){const{spanId:e,traceId:t}=r.spanContext(),{data:n,op:s,parent_span_id:i,status:a,tags:o,origin:l}=Hr(r);return tr({data:n,op:s,parent_span_id:i,span_id:e,status:a,tags:o,trace_id:t,origin:l})}function du(r){const{traceId:e,spanId:t}=r.spanContext(),n=hu(r);return Aw(e,t,n)}function uu(r){return typeof r=="number"?Gl(r):Array.isArray(r)?r[0]+r[1]/1e9:r instanceof Date?Gl(r.getTime()):Fi()}function Gl(r){return r>9999999999?r/1e3:r}function Hr(r){return $w(r)?r.getSpanJSON():typeof r.toJSON=="function"?r.toJSON():{}}function $w(r){return typeof r.getSpanJSON=="function"}function hu(r){const{traceFlags:e}=r.spanContext();return!!(e&cu)}function fu(){return Hi().getClient()}function Fw(){return Hi().getScope()}function yi(r){return r.transaction}function Uw(r,e,t){const n=e.getOptions(),{publicKey:s}=e.getDsn()||{},{segment:i}=t&&t.getUser()||{},a=tr({environment:n.environment||lu,release:n.release,user_segment:i,public_key:s,trace_id:r});return e.emit&&e.emit("createDsc",a),a}function Ja(r){const e=fu();if(!e)return{};const t=Uw(Hr(r).trace_id||"",e,Fw()),n=yi(r);if(!n)return t;const s=n&&n._frozenDynamicSamplingContext;if(s)return s;const{sampleRate:i,source:a}=n.metadata;i!=null&&(t.sample_rate=`${i}`);const o=Hr(n);return a&&a!=="url"&&(t.transaction=o.description),t.sampled=String(hu(n)),e.emit&&e.emit("createDsc",t),t}function Hw(r,e){const{fingerprint:t,span:n,breadcrumbs:s,sdkProcessingMetadata:i}=e;Bw(r,e),n&&qw(r,n),Vw(r,t),zw(r,s),Ww(r,i)}function Bw(r,e){const{extra:t,tags:n,user:s,contexts:i,level:a,transactionName:o}=e,l=tr(t);l&&Object.keys(l).length&&(r.extra={...l,...r.extra});const c=tr(n);c&&Object.keys(c).length&&(r.tags={...c,...r.tags});const d=tr(s);d&&Object.keys(d).length&&(r.user={...d,...r.user});const u=tr(i);u&&Object.keys(u).length&&(r.contexts={...u,...r.contexts}),a&&(r.level=a),o&&(r.transaction=o)}function zw(r,e){const t=[...r.breadcrumbs||[],...e];r.breadcrumbs=t.length?t:void 0}function Ww(r,e){r.sdkProcessingMetadata={...r.sdkProcessingMetadata,...e}}function qw(r,e){r.contexts={trace:Io(e),...r.contexts};const t=yi(e);if(t){r.sdkProcessingMetadata={dynamicSamplingContext:Ja(e),...r.sdkProcessingMetadata};const n=Hr(t).description;n&&(r.tags={transaction:n,...r.tags})}}function Vw(r,e){r.fingerprint=r.fingerprint?xw(r.fingerprint):[],e&&(r.fingerprint=r.fingerprint.concat(e)),r.fingerprint&&!r.fingerprint.length&&delete r.fingerprint}const Gw=100;class kn{constructor(){this._notifyingListeners=!1,this._scopeListeners=[],this._eventProcessors=[],this._breadcrumbs=[],this._attachments=[],this._user={},this._tags={},this._extra={},this._contexts={},this._sdkProcessingMetadata={},this._propagationContext=Kl()}static clone(e){return e?e.clone():new kn}clone(){const e=new kn;return e._breadcrumbs=[...this._breadcrumbs],e._tags={...this._tags},e._extra={...this._extra},e._contexts={...this._contexts},e._user=this._user,e._level=this._level,e._span=this._span,e._session=this._session,e._transactionName=this._transactionName,e._fingerprint=this._fingerprint,e._eventProcessors=[...this._eventProcessors],e._requestSession=this._requestSession,e._attachments=[...this._attachments],e._sdkProcessingMetadata={...this._sdkProcessingMetadata},e._propagationContext={...this._propagationContext},e._client=this._client,e}setClient(e){this._client=e}getClient(){return this._client}addScopeListener(e){this._scopeListeners.push(e)}addEventProcessor(e){return this._eventProcessors.push(e),this}setUser(e){return this._user=e||{email:void 0,id:void 0,ip_address:void 0,segment:void 0,username:void 0},this._session&&Ui(this._session,{user:e}),this._notifyScopeListeners(),this}getUser(){return this._user}getRequestSession(){return this._requestSession}setRequestSession(e){return this._requestSession=e,this}setTags(e){return this._tags={...this._tags,...e},this._notifyScopeListeners(),this}setTag(e,t){return this._tags={...this._tags,[e]:t},this._notifyScopeListeners(),this}setExtras(e){return this._extra={...this._extra,...e},this._notifyScopeListeners(),this}setExtra(e,t){return this._extra={...this._extra,[e]:t},this._notifyScopeListeners(),this}setFingerprint(e){return this._fingerprint=e,this._notifyScopeListeners(),this}setLevel(e){return this._level=e,this._notifyScopeListeners(),this}setTransactionName(e){return this._transactionName=e,this._notifyScopeListeners(),this}setContext(e,t){return t===null?delete this._contexts[e]:this._contexts[e]=t,this._notifyScopeListeners(),this}setSpan(e){return this._span=e,this._notifyScopeListeners(),this}getSpan(){return this._span}getTransaction(){const e=this._span;return e&&e.transaction}setSession(e){return e?this._session=e:delete this._session,this._notifyScopeListeners(),this}getSession(){return this._session}update(e){if(!e)return this;const t=typeof e=="function"?e(this):e;if(t instanceof kn){const n=t.getScopeData();this._tags={...this._tags,...n.tags},this._extra={...this._extra,...n.extra},this._contexts={...this._contexts,...n.contexts},n.user&&Object.keys(n.user).length&&(this._user=n.user),n.level&&(this._level=n.level),n.fingerprint.length&&(this._fingerprint=n.fingerprint),t.getRequestSession()&&(this._requestSession=t.getRequestSession()),n.propagationContext&&(this._propagationContext=n.propagationContext)}else if(eu(t)){const n=e;this._tags={...this._tags,...n.tags},this._extra={...this._extra,...n.extra},this._contexts={...this._contexts,...n.contexts},n.user&&(this._user=n.user),n.level&&(this._level=n.level),n.fingerprint&&(this._fingerprint=n.fingerprint),n.requestSession&&(this._requestSession=n.requestSession),n.propagationContext&&(this._propagationContext=n.propagationContext)}return this}clear(){return this._breadcrumbs=[],this._tags={},this._extra={},this._user={},this._contexts={},this._level=void 0,this._transactionName=void 0,this._fingerprint=void 0,this._requestSession=void 0,this._span=void 0,this._session=void 0,this._notifyScopeListeners(),this._attachments=[],this._propagationContext=Kl(),this}addBreadcrumb(e,t){const n=typeof t=="number"?t:Gw;if(n<=0)return this;const s={timestamp:Ao(),...e},i=this._breadcrumbs;return i.push(s),this._breadcrumbs=i.length>n?i.slice(-n):i,this._notifyScopeListeners(),this}getLastBreadcrumb(){return this._breadcrumbs[this._breadcrumbs.length-1]}clearBreadcrumbs(){return this._breadcrumbs=[],this._notifyScopeListeners(),this}addAttachment(e){return this._attachments.push(e),this}getAttachments(){return this.getScopeData().attachments}clearAttachments(){return this._attachments=[],this}getScopeData(){const{_breadcrumbs:e,_attachments:t,_contexts:n,_tags:s,_extra:i,_user:a,_level:o,_fingerprint:l,_eventProcessors:c,_propagationContext:d,_sdkProcessingMetadata:u,_transactionName:f,_span:g}=this;return{breadcrumbs:e,attachments:t,contexts:n,tags:s,extra:i,user:a,level:o,fingerprint:l||[],eventProcessors:c,propagationContext:d,sdkProcessingMetadata:u,transactionName:f,span:g}}applyToEvent(e,t={},n=[]){Hw(e,this.getScopeData());const s=[...n,...Iw(),...this._eventProcessors];return Qa(s,e,t)}setSDKProcessingMetadata(e){return this._sdkProcessingMetadata={...this._sdkProcessingMetadata,...e},this}setPropagationContext(e){return this._propagationContext=e,this}getPropagationContext(){return this._propagationContext}captureException(e,t){const n=t&&t.event_id?t.event_id:At();if(!this._client)return Ge.warn("No client configured on scope - will not capture exception!"),n;const s=new Error("Sentry syntheticException");return this._client.captureException(e,{originalException:e,syntheticException:s,...t,event_id:n},this),n}captureMessage(e,t,n){const s=n&&n.event_id?n.event_id:At();if(!this._client)return Ge.warn("No client configured on scope - will not capture message!"),s;const i=new Error(e);return this._client.captureMessage(e,t,{originalException:e,syntheticException:i,...n,event_id:s},this),s}captureEvent(e,t){const n=t&&t.event_id?t.event_id:At();return this._client?(this._client.captureEvent(e,{...t,event_id:n},this),n):(Ge.warn("No client configured on scope - will not capture event!"),n)}_notifyScopeListeners(){this._notifyingListeners||(this._notifyingListeners=!0,this._scopeListeners.forEach(e=>{e(this)}),this._notifyingListeners=!1)}}function Kl(){return{traceId:At(),spanId:At().substring(16)}}const Kw="7.120.4",gu=parseFloat(Kw),Yw=100;class mu{constructor(e,t,n,s=gu){this._version=s;let i;t?i=t:(i=new kn,i.setClient(e));let a;n?a=n:(a=new kn,a.setClient(e)),this._stack=[{scope:i}],e&&this.bindClient(e),this._isolationScope=a}isOlderThan(e){return this._version<e}bindClient(e){const t=this.getStackTop();t.client=e,t.scope.setClient(e),e&&e.setupIntegrations&&e.setupIntegrations()}pushScope(){const e=this.getScope().clone();return this.getStack().push({client:this.getClient(),scope:e}),e}popScope(){return this.getStack().length<=1?!1:!!this.getStack().pop()}withScope(e){const t=this.pushScope();let n;try{n=e(t)}catch(s){throw this.popScope(),s}return No(n)?n.then(s=>(this.popScope(),s),s=>{throw this.popScope(),s}):(this.popScope(),n)}getClient(){return this.getStackTop().client}getScope(){return this.getStackTop().scope}getIsolationScope(){return this._isolationScope}getStack(){return this._stack}getStackTop(){return this._stack[this._stack.length-1]}captureException(e,t){const n=this._lastEventId=t&&t.event_id?t.event_id:At(),s=new Error("Sentry syntheticException");return this.getScope().captureException(e,{originalException:e,syntheticException:s,...t,event_id:n}),n}captureMessage(e,t,n){const s=this._lastEventId=n&&n.event_id?n.event_id:At(),i=new Error(e);return this.getScope().captureMessage(e,t,{originalException:e,syntheticException:i,...n,event_id:s}),s}captureEvent(e,t){const n=t&&t.event_id?t.event_id:At();return e.type||(this._lastEventId=n),this.getScope().captureEvent(e,{...t,event_id:n}),n}lastEventId(){return this._lastEventId}addBreadcrumb(e,t){const{scope:n,client:s}=this.getStackTop();if(!s)return;const{beforeBreadcrumb:i=null,maxBreadcrumbs:a=Yw}=s.getOptions&&s.getOptions()||{};if(a<=0)return;const l={timestamp:Ao(),...e},c=i?nu(()=>i(l,t)):l;c!==null&&(s.emit&&s.emit("beforeAddBreadcrumb",c,t),n.addBreadcrumb(c,a))}setUser(e){this.getScope().setUser(e),this.getIsolationScope().setUser(e)}setTags(e){this.getScope().setTags(e),this.getIsolationScope().setTags(e)}setExtras(e){this.getScope().setExtras(e),this.getIsolationScope().setExtras(e)}setTag(e,t){this.getScope().setTag(e,t),this.getIsolationScope().setTag(e,t)}setExtra(e,t){this.getScope().setExtra(e,t),this.getIsolationScope().setExtra(e,t)}setContext(e,t){this.getScope().setContext(e,t),this.getIsolationScope().setContext(e,t)}configureScope(e){const{scope:t,client:n}=this.getStackTop();n&&e(t)}run(e){const t=Yl(this);try{e(this)}finally{Yl(t)}}getIntegration(e){const t=this.getClient();if(!t)return null;try{return t.getIntegration(e)}catch{return ut&&Ge.warn(`Cannot retrieve integration ${e.id} from the current Hub`),null}}startTransaction(e,t){const n=this._callExtensionMethod("startTransaction",e,t);return ut&&!n&&(this.getClient()?Ge.warn(`Tracing extension 'startTransaction' has not been added. Call 'addTracingExtensions' before calling 'init':
Sentry.addTracingExtensions();
Sentry.init({...});
`):Ge.warn("Tracing extension 'startTransaction' is missing. You should 'init' the SDK before calling 'startTransaction'")),n}traceHeaders(){return this._callExtensionMethod("traceHeaders")}captureSession(e=!1){if(e)return this.endSession();this._sendSessionUpdate()}endSession(){const t=this.getStackTop().scope,n=t.getSession();n&&Pw(n),this._sendSessionUpdate(),t.setSession()}startSession(e){const{scope:t,client:n}=this.getStackTop(),{release:s,environment:i=lu}=n&&n.getOptions()||{},{userAgent:a}=pt.navigator||{},o=Mw({release:s,environment:i,user:t.getUser(),...a&&{userAgent:a},...e}),l=t.getSession&&t.getSession();return l&&l.status==="ok"&&Ui(l,{status:"exited"}),this.endSession(),t.setSession(o),o}shouldSendDefaultPii(){const e=this.getClient(),t=e&&e.getOptions();return!!(t&&t.sendDefaultPii)}_sendSessionUpdate(){const{scope:e,client:t}=this.getStackTop(),n=e.getSession();n&&t&&t.captureSession&&t.captureSession(n)}_callExtensionMethod(e,...t){const s=Hn().__SENTRY__;if(s&&s.extensions&&typeof s.extensions[e]=="function")return s.extensions[e].apply(this,t);ut&&Ge.warn(`Extension method ${e} couldn't be found, doing nothing.`)}}function Hn(){return pt.__SENTRY__=pt.__SENTRY__||{extensions:{},hub:void 0},pt}function Yl(r){const e=Hn(),t=Za(e);return pu(e,r),t}function Hi(){const r=Hn();if(r.__SENTRY__&&r.__SENTRY__.acs){const e=r.__SENTRY__.acs.getCurrentHub();if(e)return e}return Xw(r)}function Xw(r=Hn()){return(!Qw(r)||Za(r).isOlderThan(gu))&&pu(r,new mu),Za(r)}function Qw(r){return!!(r&&r.__SENTRY__&&r.__SENTRY__.hub)}function Za(r){return tu("hub",()=>new mu,r)}function pu(r,e){if(!r)return!1;const t=r.__SENTRY__=r.__SENTRY__||{};return t.hub=e,!0}function Jw(r){return(r||Hi()).getScope().getTransaction()}let Xl=!1;function Zw(){Xl||(Xl=!0,Ew(eo),Rw(eo))}function eo(){const r=Jw();if(r){const e="internal_error";ut&&Ge.log(`[Tracing] Transaction: ${e} -> Global error occured`),r.setStatus(e)}}eo.tag="sentry_tracingErrorCallback";var Ql;(function(r){r.Ok="ok";const t="deadline_exceeded";r.DeadlineExceeded=t;const n="unauthenticated";r.Unauthenticated=n;const s="permission_denied";r.PermissionDenied=s;const i="not_found";r.NotFound=i;const a="resource_exhausted";r.ResourceExhausted=a;const o="invalid_argument";r.InvalidArgument=o;const l="unimplemented";r.Unimplemented=l;const c="unavailable";r.Unavailable=c;const d="internal_error";r.InternalError=d;const u="unknown_error";r.UnknownError=u;const f="cancelled";r.Cancelled=f;const g="already_exists";r.AlreadyExists=g;const b="failed_precondition";r.FailedPrecondition=b;const m="aborted";r.Aborted=m;const y="out_of_range";r.OutOfRange=y;const v="data_loss";r.DataLoss=v})(Ql||(Ql={}));function e0(r){if(r<400&&r>=100)return"ok";if(r>=400&&r<500)switch(r){case 401:return"unauthenticated";case 403:return"permission_denied";case 404:return"not_found";case 409:return"already_exists";case 413:return"failed_precondition";case 429:return"resource_exhausted";default:return"invalid_argument"}if(r>=500&&r<600)switch(r){case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline_exceeded";default:return"internal_error"}return"unknown_error"}function t0(r,e){r.setTag("http.status_code",String(e)),r.setData("http.response.status_code",e);const t=e0(e);t!=="unknown_error"&&r.setStatus(t)}function r0(r){if(typeof __SENTRY_TRACING__=="boolean"&&!__SENTRY_TRACING__)return!1;const e=fu(),t=r||e&&e.getOptions();return!!t&&(t.enableTracing||"tracesSampleRate"in t||"tracesSampler"in t)}const n0="_sentryScope",s0="_sentryIsolationScope";function i0(r){return{scope:r[n0],isolationScope:r[s0]}}const wa="sentry.source",Tn="sentry.sample_rate",Xs="sentry.op",Qs="sentry.origin",a0="profile_id";class o0{constructor(e=1e3){this._maxlen=e,this.spans=[]}add(e){this.spans.length>this._maxlen?e.spanRecorder=void 0:this.spans.push(e)}}class Mo{constructor(e={}){this._traceId=e.traceId||At(),this._spanId=e.spanId||At().substring(16),this._startTime=e.startTimestamp||Fi(),this.tags=e.tags?{...e.tags}:{},this.data=e.data?{...e.data}:{},this.instrumenter=e.instrumenter||"sentry",this._attributes={},this.setAttributes({[Qs]:e.origin||"manual",[Xs]:e.op,...e.attributes}),this._name=e.name||e.description,e.parentSpanId&&(this._parentSpanId=e.parentSpanId),"sampled"in e&&(this._sampled=e.sampled),e.status&&(this._status=e.status),e.endTimestamp&&(this._endTime=e.endTimestamp),e.exclusiveTime!==void 0&&(this._exclusiveTime=e.exclusiveTime),this._measurements=e.measurements?{...e.measurements}:{}}get name(){return this._name||""}set name(e){this.updateName(e)}get description(){return this._name}set description(e){this._name=e}get traceId(){return this._traceId}set traceId(e){this._traceId=e}get spanId(){return this._spanId}set spanId(e){this._spanId=e}set parentSpanId(e){this._parentSpanId=e}get parentSpanId(){return this._parentSpanId}get sampled(){return this._sampled}set sampled(e){this._sampled=e}get attributes(){return this._attributes}set attributes(e){this._attributes=e}get startTimestamp(){return this._startTime}set startTimestamp(e){this._startTime=e}get endTimestamp(){return this._endTime}set endTimestamp(e){this._endTime=e}get status(){return this._status}set status(e){this._status=e}get op(){return this._attributes[Xs]}set op(e){this.setAttribute(Xs,e)}get origin(){return this._attributes[Qs]}set origin(e){this.setAttribute(Qs,e)}spanContext(){const{_spanId:e,_traceId:t,_sampled:n}=this;return{spanId:e,traceId:t,traceFlags:n?cu:Lw}}startChild(e){const t=new Mo({...e,parentSpanId:this._spanId,sampled:this._sampled,traceId:this._traceId});t.spanRecorder=this.spanRecorder,t.spanRecorder&&t.spanRecorder.add(t);const n=yi(this);if(t.transaction=n,ut&&n){const s=e&&e.op||"< unknown op >",i=Hr(t).description||"< unknown name >",a=n.spanContext().spanId,o=`[Tracing] Starting '${s}' span on transaction '${i}' (${a}).`;Ge.log(o),this._logMessage=o}return t}setTag(e,t){return this.tags={...this.tags,[e]:t},this}setData(e,t){return this.data={...this.data,[e]:t},this}setAttribute(e,t){t===void 0?delete this._attributes[e]:this._attributes[e]=t}setAttributes(e){Object.keys(e).forEach(t=>this.setAttribute(t,e[t]))}setStatus(e){return this._status=e,this}setHttpStatus(e){return t0(this,e),this}setName(e){this.updateName(e)}updateName(e){return this._name=e,this}isSuccess(){return this._status==="ok"}finish(e){return this.end(e)}end(e){if(this._endTime)return;const t=yi(this);if(ut&&t&&t.spanContext().spanId!==this._spanId){const n=this._logMessage;n&&Ge.log(n.replace("Starting","Finishing"))}this._endTime=uu(e)}toTraceparent(){return du(this)}toContext(){return tr({data:this._getData(),description:this._name,endTimestamp:this._endTime,op:this.op,parentSpanId:this._parentSpanId,sampled:this._sampled,spanId:this._spanId,startTimestamp:this._startTime,status:this._status,tags:this.tags,traceId:this._traceId})}updateWithContext(e){return this.data=e.data||{},this._name=e.name||e.description,this._endTime=e.endTimestamp,this.op=e.op,this._parentSpanId=e.parentSpanId,this._sampled=e.sampled,this._spanId=e.spanId||this._spanId,this._startTime=e.startTimestamp||this._startTime,this._status=e.status,this.tags=e.tags||{},this._traceId=e.traceId||this._traceId,this}getTraceContext(){return Io(this)}getSpanJSON(){return tr({data:this._getData(),description:this._name,op:this._attributes[Xs],parent_span_id:this._parentSpanId,span_id:this._spanId,start_timestamp:this._startTime,status:this._status,tags:Object.keys(this.tags).length>0?this.tags:void 0,timestamp:this._endTime,trace_id:this._traceId,origin:this._attributes[Qs],_metrics_summary:void 0,profile_id:this._attributes[a0],exclusive_time:this._exclusiveTime,measurements:Object.keys(this._measurements).length>0?this._measurements:void 0})}isRecording(){return!this._endTime&&!!this._sampled}toJSON(){return this.getSpanJSON()}_getData(){const{data:e,_attributes:t}=this,n=Object.keys(e).length>0,s=Object.keys(t).length>0;if(!(!n&&!s))return n&&s?{...e,...t}:n?e:t}}class l0 extends Mo{constructor(e,t){super(e),this._contexts={},this._hub=t||Hi(),this._name=e.name||"",this._metadata={...e.metadata},this._trimEnd=e.trimEnd,this.transaction=this;const n=this._metadata.dynamicSamplingContext;n&&(this._frozenDynamicSamplingContext={...n})}get name(){return this._name}set name(e){this.setName(e)}get metadata(){return{source:"custom",spanMetadata:{},...this._metadata,...this._attributes[wa]&&{source:this._attributes[wa]},...this._attributes[Tn]&&{sampleRate:this._attributes[Tn]}}}set metadata(e){this._metadata=e}setName(e,t="custom"){this._name=e,this.setAttribute(wa,t)}updateName(e){return this._name=e,this}initSpanRecorder(e=1e3){this.spanRecorder||(this.spanRecorder=new o0(e)),this.spanRecorder.add(this)}setContext(e,t){t===null?delete this._contexts[e]:this._contexts[e]=t}setMeasurement(e,t,n=""){this._measurements[e]={value:t,unit:n}}setMetadata(e){this._metadata={...this._metadata,...e}}end(e){const t=uu(e),n=this._finishTransaction(t);if(n)return this._hub.captureEvent(n)}toContext(){const e=super.toContext();return tr({...e,name:this._name,trimEnd:this._trimEnd})}updateWithContext(e){return super.updateWithContext(e),this._name=e.name||"",this._trimEnd=e.trimEnd,this}getDynamicSamplingContext(){return Ja(this)}setHub(e){this._hub=e}getProfileId(){if(this._contexts!==void 0&&this._contexts.profile!==void 0)return this._contexts.profile.profile_id}_finishTransaction(e){if(this._endTime!==void 0)return;this._name||(ut&&Ge.warn("Transaction has no name, falling back to `<unlabeled transaction>`."),this._name="<unlabeled transaction>"),super.end(e);const t=this._hub.getClient();if(t&&t.emit&&t.emit("finishTransaction",this),this._sampled!==!0){ut&&Ge.log("[Tracing] Discarding transaction because its trace was not chosen to be sampled."),t&&t.recordDroppedEvent("sample_rate","transaction");return}const n=this.spanRecorder?this.spanRecorder.spans.filter(d=>d!==this&&Hr(d).timestamp):[];if(this._trimEnd&&n.length>0){const d=n.map(u=>Hr(u).timestamp).filter(Boolean);this._endTime=d.reduce((u,f)=>u>f?u:f)}const{scope:s,isolationScope:i}=i0(this),{metadata:a}=this,{source:o}=a,l={contexts:{...this._contexts,trace:Io(this)},spans:n,start_timestamp:this._startTime,tags:this.tags,timestamp:this._endTime,transaction:this._name,type:"transaction",sdkProcessingMetadata:{...a,capturedSpanScope:s,capturedSpanIsolationScope:i,...tr({dynamicSamplingContext:Ja(this)})},_metrics_summary:void 0,...o&&{transaction_info:{source:o}}};return Object.keys(this._measurements).length>0&&(ut&&Ge.log("[Measurements] Adding measurements to transaction",JSON.stringify(this._measurements,void 0,2)),l.measurements=this._measurements),ut&&Ge.log(`[Tracing] Finishing ${this.op} transaction: ${this._name}.`),l}}function c0(r,e,t){if(!r0(e))return r.sampled=!1,r;if(r.sampled!==void 0)return r.setAttribute(Tn,Number(r.sampled)),r;let n;return typeof e.tracesSampler=="function"?(n=e.tracesSampler(t),r.setAttribute(Tn,Number(n))):t.parentSampled!==void 0?n=t.parentSampled:typeof e.tracesSampleRate<"u"?(n=e.tracesSampleRate,r.setAttribute(Tn,Number(n))):(n=1,r.setAttribute(Tn,n)),d0(n)?n?(r.sampled=Math.random()<n,r.sampled?(ut&&Ge.log(`[Tracing] starting ${r.op} transaction - ${Hr(r).description}`),r):(ut&&Ge.log(`[Tracing] Discarding transaction because it's not included in the random sample (sampling rate = ${Number(n)})`),r)):(ut&&Ge.log(`[Tracing] Discarding transaction because ${typeof e.tracesSampler=="function"?"tracesSampler returned 0 or false":"a negative sampling decision was inherited or tracesSampleRate is set to 0"}`),r.sampled=!1,r):(ut&&Ge.warn("[Tracing] Discarding transaction because of invalid sample rate."),r.sampled=!1,r)}function d0(r){return yw(r)||!(typeof r=="number"||typeof r=="boolean")?(ut&&Ge.warn(`[Tracing] Given sample rate is invalid. Sample rate must be a boolean or a number between 0 and 1. Got ${JSON.stringify(r)} of type ${JSON.stringify(typeof r)}.`),!1):r<0||r>1?(ut&&Ge.warn(`[Tracing] Given sample rate is invalid. Sample rate must be between 0 and 1. Got ${r}.`),!1):!0}function u0(){const e=this.getScope().getSpan();return e?{"sentry-trace":du(e)}:{}}function h0(r,e){const t=this.getClient(),n=t&&t.getOptions()||{},s=n.instrumenter||"sentry",i=r.instrumenter||"sentry";s!==i&&(ut&&Ge.error(`A transaction was started with instrumenter=\`${i}\`, but the SDK is configured with the \`${s}\` instrumenter.
The transaction will not be sampled. Please use the ${s} instrumentation to start transactions.`),r.sampled=!1);let a=new l0(r,this);return a=c0(a,n,{name:r.name,parentSampled:r.parentSampled,transactionContext:r,attributes:{...r.data,...r.attributes},...e}),a.isRecording()&&a.initSpanRecorder(n._experiments&&n._experiments.maxSpans),t&&t.emit&&t.emit("startTransaction",a),a}function f0(){const r=Hn();r.__SENTRY__&&(r.__SENTRY__.extensions=r.__SENTRY__.extensions||{},r.__SENTRY__.extensions.startTransaction||(r.__SENTRY__.extensions.startTransaction=h0),r.__SENTRY__.extensions.traceHeaders||(r.__SENTRY__.extensions.traceHeaders=u0),Zw())}function g0(){const r=Hn();if(!r.__SENTRY__)return;const e={mongodb(){const n=nn(module,"./node/integrations/mongo");return new n.Mongo},mongoose(){const n=nn(module,"./node/integrations/mongo");return new n.Mongo},mysql(){const n=nn(module,"./node/integrations/mysql");return new n.Mysql},pg(){const n=nn(module,"./node/integrations/postgres");return new n.Postgres}},t=Object.keys(e).filter(n=>!!Dw(n)).map(n=>{try{return e[n]()}catch{return}}).filter(n=>n);t.length>0&&(r.__SENTRY__.integrations=[...r.__SENTRY__.integrations||[],...t])}function m0(){f0(),kw()&&g0()}(typeof __SENTRY_TRACING__>"u"||__SENTRY_TRACING__)&&m0();const se={VALIDATION_ERROR:"VALIDATION_ERROR",NETWORK_ERROR:"NETWORK_ERROR",AUTHENTICATION_ERROR:"AUTHENTICATION_ERROR",AUTHORIZATION_ERROR:"AUTHORIZATION_ERROR",NOT_FOUND_ERROR:"NOT_FOUND_ERROR",SERVER_ERROR:"SERVER_ERROR",BUSINESS_LOGIC_ERROR:"BUSINESS_LOGIC_ERROR",UNKNOWN_ERROR:"UNKNOWN_ERROR"},Jl={[se.VALIDATION_ERROR]:"I dati inseriti non sono validi. Controlla i campi evidenziati.",[se.NETWORK_ERROR]:"Errore di connessione. Verifica la tua connessione internet.",[se.AUTHENTICATION_ERROR]:"Sessione scaduta. Effettua nuovamente l'accesso.",[se.AUTHORIZATION_ERROR]:"Non hai i permessi per eseguire questa operazione.",[se.NOT_FOUND_ERROR]:"La risorsa richiesta non  stata trovata.",[se.SERVER_ERROR]:"Errore del server. Riprova pi tardi.",[se.BUSINESS_LOGIC_ERROR]:"Operazione non consentita dalle regole di business.",[se.UNKNOWN_ERROR]:"Si  verificato un errore imprevisto."};class ye extends Error{constructor(e,t=se.UNKNOWN_ERROR,n=500,s={}){super(e),this.name="AppError",this.type=t,this.statusCode=n,this.context=s,this.timestamp=new Date().toISOString(),this.userMessage=Jl[t]||Jl[se.UNKNOWN_ERROR]}toJSON(){return{message:this.message,type:this.type,statusCode:this.statusCode,context:this.context,timestamp:this.timestamp,userMessage:this.userMessage}}}const bu=6048e5,p0=864e5,b0=36e5,Zl=Symbol.for("constructDateFrom");function fr(r,e){return typeof r=="function"?r(e):r&&typeof r=="object"&&Zl in r?r[Zl](e):r instanceof Date?new r.constructor(e):new Date(e)}function yt(r,e){return fr(e||r,r)}function Ts(r,e,t){const n=yt(r,t?.in);return isNaN(e)?fr(r,NaN):(e&&n.setDate(n.getDate()+e),n)}function y0(r,e,t){return fr(r,+yt(r)+e)}function ec(r,e,t){return y0(r,e*b0)}let v0={};function Bi(){return v0}function on(r,e){const t=Bi(),n=e?.weekStartsOn??e?.locale?.options?.weekStartsOn??t.weekStartsOn??t.locale?.options?.weekStartsOn??0,s=yt(r,e?.in),i=s.getDay(),a=(i<n?7:0)+i-n;return s.setDate(s.getDate()-a),s.setHours(0,0,0,0),s}function vi(r,e){return on(r,{...e,weekStartsOn:1})}function yu(r,e){const t=yt(r,e?.in),n=t.getFullYear(),s=fr(t,0);s.setFullYear(n+1,0,4),s.setHours(0,0,0,0);const i=vi(s),a=fr(t,0);a.setFullYear(n,0,4),a.setHours(0,0,0,0);const o=vi(a);return t.getTime()>=i.getTime()?n+1:t.getTime()>=o.getTime()?n:n-1}function tc(r){const e=yt(r),t=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return t.setUTCFullYear(e.getFullYear()),+r-+t}function w0(r,...e){const t=fr.bind(null,e.find(n=>typeof n=="object"));return e.map(t)}function rc(r,e){const t=yt(r,e?.in);return t.setHours(0,0,0,0),t}function _0(r,e,t){const[n,s]=w0(t?.in,r,e),i=rc(n),a=rc(s),o=+i-tc(i),l=+a-tc(a);return Math.round((o-l)/p0)}function S0(r,e){const t=yu(r,e),n=fr(r,0);return n.setFullYear(t,0,4),n.setHours(0,0,0,0),vi(n)}function vu(r,e,t){return Ts(r,e*7,t)}function x0(r){return r instanceof Date||typeof r=="object"&&Object.prototype.toString.call(r)==="[object Date]"}function E0(r){return!(!x0(r)&&typeof r!="number"||isNaN(+yt(r)))}function T0(r,e){const t=yt(r,e?.in),n=t.getFullYear();return t.setFullYear(n+1,0,0),t.setHours(23,59,59,999),t}function wu(r,e){const t=yt(r,e?.in);return t.setFullYear(t.getFullYear(),0,1),t.setHours(0,0,0,0),t}const R0={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},O0=(r,e,t)=>{let n;const s=R0[r];return typeof s=="string"?n=s:e===1?n=s.one:n=s.other.replace("{{count}}",e.toString()),t?.addSuffix?t.comparison&&t.comparison>0?"in "+n:n+" ago":n};function _a(r){return(e={})=>{const t=e.width?String(e.width):r.defaultWidth;return r.formats[t]||r.formats[r.defaultWidth]}}const C0={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},k0={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},D0={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},N0={date:_a({formats:C0,defaultWidth:"full"}),time:_a({formats:k0,defaultWidth:"full"}),dateTime:_a({formats:D0,defaultWidth:"full"})},A0={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},I0=(r,e,t,n)=>A0[r];function Xn(r){return(e,t)=>{const n=t?.context?String(t.context):"standalone";let s;if(n==="formatting"&&r.formattingValues){const a=r.defaultFormattingWidth||r.defaultWidth,o=t?.width?String(t.width):a;s=r.formattingValues[o]||r.formattingValues[a]}else{const a=r.defaultWidth,o=t?.width?String(t.width):r.defaultWidth;s=r.values[o]||r.values[a]}const i=r.argumentCallback?r.argumentCallback(e):e;return s[i]}}const M0={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},P0={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},j0={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},L0={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},$0={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},F0={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},U0=(r,e)=>{const t=Number(r),n=t%100;if(n>20||n<10)switch(n%10){case 1:return t+"st";case 2:return t+"nd";case 3:return t+"rd"}return t+"th"},H0={ordinalNumber:U0,era:Xn({values:M0,defaultWidth:"wide"}),quarter:Xn({values:P0,defaultWidth:"wide",argumentCallback:r=>r-1}),month:Xn({values:j0,defaultWidth:"wide"}),day:Xn({values:L0,defaultWidth:"wide"}),dayPeriod:Xn({values:$0,defaultWidth:"wide",formattingValues:F0,defaultFormattingWidth:"wide"})};function Qn(r){return(e,t={})=>{const n=t.width,s=n&&r.matchPatterns[n]||r.matchPatterns[r.defaultMatchWidth],i=e.match(s);if(!i)return null;const a=i[0],o=n&&r.parsePatterns[n]||r.parsePatterns[r.defaultParseWidth],l=Array.isArray(o)?z0(o,u=>u.test(a)):B0(o,u=>u.test(a));let c;c=r.valueCallback?r.valueCallback(l):l,c=t.valueCallback?t.valueCallback(c):c;const d=e.slice(a.length);return{value:c,rest:d}}}function B0(r,e){for(const t in r)if(Object.prototype.hasOwnProperty.call(r,t)&&e(r[t]))return t}function z0(r,e){for(let t=0;t<r.length;t++)if(e(r[t]))return t}function W0(r){return(e,t={})=>{const n=e.match(r.matchPattern);if(!n)return null;const s=n[0],i=e.match(r.parsePattern);if(!i)return null;let a=r.valueCallback?r.valueCallback(i[0]):i[0];a=t.valueCallback?t.valueCallback(a):a;const o=e.slice(s.length);return{value:a,rest:o}}}const q0=/^(\d+)(th|st|nd|rd)?/i,V0=/\d+/i,G0={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},K0={any:[/^b/i,/^(a|c)/i]},Y0={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},X0={any:[/1/i,/2/i,/3/i,/4/i]},Q0={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},J0={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},Z0={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},e_={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},t_={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},r_={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},n_={ordinalNumber:W0({matchPattern:q0,parsePattern:V0,valueCallback:r=>parseInt(r,10)}),era:Qn({matchPatterns:G0,defaultMatchWidth:"wide",parsePatterns:K0,defaultParseWidth:"any"}),quarter:Qn({matchPatterns:Y0,defaultMatchWidth:"wide",parsePatterns:X0,defaultParseWidth:"any",valueCallback:r=>r+1}),month:Qn({matchPatterns:Q0,defaultMatchWidth:"wide",parsePatterns:J0,defaultParseWidth:"any"}),day:Qn({matchPatterns:Z0,defaultMatchWidth:"wide",parsePatterns:e_,defaultParseWidth:"any"}),dayPeriod:Qn({matchPatterns:t_,defaultMatchWidth:"any",parsePatterns:r_,defaultParseWidth:"any"})},s_={code:"en-US",formatDistance:O0,formatLong:N0,formatRelative:I0,localize:H0,match:n_,options:{weekStartsOn:0,firstWeekContainsDate:1}};function i_(r,e){const t=yt(r,e?.in);return _0(t,wu(t))+1}function a_(r,e){const t=yt(r,e?.in),n=+vi(t)-+S0(t);return Math.round(n/bu)+1}function _u(r,e){const t=yt(r,e?.in),n=t.getFullYear(),s=Bi(),i=e?.firstWeekContainsDate??e?.locale?.options?.firstWeekContainsDate??s.firstWeekContainsDate??s.locale?.options?.firstWeekContainsDate??1,a=fr(e?.in||r,0);a.setFullYear(n+1,0,i),a.setHours(0,0,0,0);const o=on(a,e),l=fr(e?.in||r,0);l.setFullYear(n,0,i),l.setHours(0,0,0,0);const c=on(l,e);return+t>=+o?n+1:+t>=+c?n:n-1}function o_(r,e){const t=Bi(),n=e?.firstWeekContainsDate??e?.locale?.options?.firstWeekContainsDate??t.firstWeekContainsDate??t.locale?.options?.firstWeekContainsDate??1,s=_u(r,e),i=fr(e?.in||r,0);return i.setFullYear(s,0,n),i.setHours(0,0,0,0),on(i,e)}function l_(r,e){const t=yt(r,e?.in),n=+on(t,e)-+o_(t,e);return Math.round(n/bu)+1}function Ne(r,e){const t=r<0?"-":"",n=Math.abs(r).toString().padStart(e,"0");return t+n}const Pr={y(r,e){const t=r.getFullYear(),n=t>0?t:1-t;return Ne(e==="yy"?n%100:n,e.length)},M(r,e){const t=r.getMonth();return e==="M"?String(t+1):Ne(t+1,2)},d(r,e){return Ne(r.getDate(),e.length)},a(r,e){const t=r.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return t.toUpperCase();case"aaa":return t;case"aaaaa":return t[0];case"aaaa":default:return t==="am"?"a.m.":"p.m."}},h(r,e){return Ne(r.getHours()%12||12,e.length)},H(r,e){return Ne(r.getHours(),e.length)},m(r,e){return Ne(r.getMinutes(),e.length)},s(r,e){return Ne(r.getSeconds(),e.length)},S(r,e){const t=e.length,n=r.getMilliseconds(),s=Math.trunc(n*Math.pow(10,t-3));return Ne(s,e.length)}},wn={midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},nc={G:function(r,e,t){const n=r.getFullYear()>0?1:0;switch(e){case"G":case"GG":case"GGG":return t.era(n,{width:"abbreviated"});case"GGGGG":return t.era(n,{width:"narrow"});case"GGGG":default:return t.era(n,{width:"wide"})}},y:function(r,e,t){if(e==="yo"){const n=r.getFullYear(),s=n>0?n:1-n;return t.ordinalNumber(s,{unit:"year"})}return Pr.y(r,e)},Y:function(r,e,t,n){const s=_u(r,n),i=s>0?s:1-s;if(e==="YY"){const a=i%100;return Ne(a,2)}return e==="Yo"?t.ordinalNumber(i,{unit:"year"}):Ne(i,e.length)},R:function(r,e){const t=yu(r);return Ne(t,e.length)},u:function(r,e){const t=r.getFullYear();return Ne(t,e.length)},Q:function(r,e,t){const n=Math.ceil((r.getMonth()+1)/3);switch(e){case"Q":return String(n);case"QQ":return Ne(n,2);case"Qo":return t.ordinalNumber(n,{unit:"quarter"});case"QQQ":return t.quarter(n,{width:"abbreviated",context:"formatting"});case"QQQQQ":return t.quarter(n,{width:"narrow",context:"formatting"});case"QQQQ":default:return t.quarter(n,{width:"wide",context:"formatting"})}},q:function(r,e,t){const n=Math.ceil((r.getMonth()+1)/3);switch(e){case"q":return String(n);case"qq":return Ne(n,2);case"qo":return t.ordinalNumber(n,{unit:"quarter"});case"qqq":return t.quarter(n,{width:"abbreviated",context:"standalone"});case"qqqqq":return t.quarter(n,{width:"narrow",context:"standalone"});case"qqqq":default:return t.quarter(n,{width:"wide",context:"standalone"})}},M:function(r,e,t){const n=r.getMonth();switch(e){case"M":case"MM":return Pr.M(r,e);case"Mo":return t.ordinalNumber(n+1,{unit:"month"});case"MMM":return t.month(n,{width:"abbreviated",context:"formatting"});case"MMMMM":return t.month(n,{width:"narrow",context:"formatting"});case"MMMM":default:return t.month(n,{width:"wide",context:"formatting"})}},L:function(r,e,t){const n=r.getMonth();switch(e){case"L":return String(n+1);case"LL":return Ne(n+1,2);case"Lo":return t.ordinalNumber(n+1,{unit:"month"});case"LLL":return t.month(n,{width:"abbreviated",context:"standalone"});case"LLLLL":return t.month(n,{width:"narrow",context:"standalone"});case"LLLL":default:return t.month(n,{width:"wide",context:"standalone"})}},w:function(r,e,t,n){const s=l_(r,n);return e==="wo"?t.ordinalNumber(s,{unit:"week"}):Ne(s,e.length)},I:function(r,e,t){const n=a_(r);return e==="Io"?t.ordinalNumber(n,{unit:"week"}):Ne(n,e.length)},d:function(r,e,t){return e==="do"?t.ordinalNumber(r.getDate(),{unit:"date"}):Pr.d(r,e)},D:function(r,e,t){const n=i_(r);return e==="Do"?t.ordinalNumber(n,{unit:"dayOfYear"}):Ne(n,e.length)},E:function(r,e,t){const n=r.getDay();switch(e){case"E":case"EE":case"EEE":return t.day(n,{width:"abbreviated",context:"formatting"});case"EEEEE":return t.day(n,{width:"narrow",context:"formatting"});case"EEEEEE":return t.day(n,{width:"short",context:"formatting"});case"EEEE":default:return t.day(n,{width:"wide",context:"formatting"})}},e:function(r,e,t,n){const s=r.getDay(),i=(s-n.weekStartsOn+8)%7||7;switch(e){case"e":return String(i);case"ee":return Ne(i,2);case"eo":return t.ordinalNumber(i,{unit:"day"});case"eee":return t.day(s,{width:"abbreviated",context:"formatting"});case"eeeee":return t.day(s,{width:"narrow",context:"formatting"});case"eeeeee":return t.day(s,{width:"short",context:"formatting"});case"eeee":default:return t.day(s,{width:"wide",context:"formatting"})}},c:function(r,e,t,n){const s=r.getDay(),i=(s-n.weekStartsOn+8)%7||7;switch(e){case"c":return String(i);case"cc":return Ne(i,e.length);case"co":return t.ordinalNumber(i,{unit:"day"});case"ccc":return t.day(s,{width:"abbreviated",context:"standalone"});case"ccccc":return t.day(s,{width:"narrow",context:"standalone"});case"cccccc":return t.day(s,{width:"short",context:"standalone"});case"cccc":default:return t.day(s,{width:"wide",context:"standalone"})}},i:function(r,e,t){const n=r.getDay(),s=n===0?7:n;switch(e){case"i":return String(s);case"ii":return Ne(s,e.length);case"io":return t.ordinalNumber(s,{unit:"day"});case"iii":return t.day(n,{width:"abbreviated",context:"formatting"});case"iiiii":return t.day(n,{width:"narrow",context:"formatting"});case"iiiiii":return t.day(n,{width:"short",context:"formatting"});case"iiii":default:return t.day(n,{width:"wide",context:"formatting"})}},a:function(r,e,t){const s=r.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return t.dayPeriod(s,{width:"abbreviated",context:"formatting"});case"aaa":return t.dayPeriod(s,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return t.dayPeriod(s,{width:"narrow",context:"formatting"});case"aaaa":default:return t.dayPeriod(s,{width:"wide",context:"formatting"})}},b:function(r,e,t){const n=r.getHours();let s;switch(n===12?s=wn.noon:n===0?s=wn.midnight:s=n/12>=1?"pm":"am",e){case"b":case"bb":return t.dayPeriod(s,{width:"abbreviated",context:"formatting"});case"bbb":return t.dayPeriod(s,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return t.dayPeriod(s,{width:"narrow",context:"formatting"});case"bbbb":default:return t.dayPeriod(s,{width:"wide",context:"formatting"})}},B:function(r,e,t){const n=r.getHours();let s;switch(n>=17?s=wn.evening:n>=12?s=wn.afternoon:n>=4?s=wn.morning:s=wn.night,e){case"B":case"BB":case"BBB":return t.dayPeriod(s,{width:"abbreviated",context:"formatting"});case"BBBBB":return t.dayPeriod(s,{width:"narrow",context:"formatting"});case"BBBB":default:return t.dayPeriod(s,{width:"wide",context:"formatting"})}},h:function(r,e,t){if(e==="ho"){let n=r.getHours()%12;return n===0&&(n=12),t.ordinalNumber(n,{unit:"hour"})}return Pr.h(r,e)},H:function(r,e,t){return e==="Ho"?t.ordinalNumber(r.getHours(),{unit:"hour"}):Pr.H(r,e)},K:function(r,e,t){const n=r.getHours()%12;return e==="Ko"?t.ordinalNumber(n,{unit:"hour"}):Ne(n,e.length)},k:function(r,e,t){let n=r.getHours();return n===0&&(n=24),e==="ko"?t.ordinalNumber(n,{unit:"hour"}):Ne(n,e.length)},m:function(r,e,t){return e==="mo"?t.ordinalNumber(r.getMinutes(),{unit:"minute"}):Pr.m(r,e)},s:function(r,e,t){return e==="so"?t.ordinalNumber(r.getSeconds(),{unit:"second"}):Pr.s(r,e)},S:function(r,e){return Pr.S(r,e)},X:function(r,e,t){const n=r.getTimezoneOffset();if(n===0)return"Z";switch(e){case"X":return ic(n);case"XXXX":case"XX":return Xr(n);case"XXXXX":case"XXX":default:return Xr(n,":")}},x:function(r,e,t){const n=r.getTimezoneOffset();switch(e){case"x":return ic(n);case"xxxx":case"xx":return Xr(n);case"xxxxx":case"xxx":default:return Xr(n,":")}},O:function(r,e,t){const n=r.getTimezoneOffset();switch(e){case"O":case"OO":case"OOO":return"GMT"+sc(n,":");case"OOOO":default:return"GMT"+Xr(n,":")}},z:function(r,e,t){const n=r.getTimezoneOffset();switch(e){case"z":case"zz":case"zzz":return"GMT"+sc(n,":");case"zzzz":default:return"GMT"+Xr(n,":")}},t:function(r,e,t){const n=Math.trunc(+r/1e3);return Ne(n,e.length)},T:function(r,e,t){return Ne(+r,e.length)}};function sc(r,e=""){const t=r>0?"-":"+",n=Math.abs(r),s=Math.trunc(n/60),i=n%60;return i===0?t+String(s):t+String(s)+e+Ne(i,2)}function ic(r,e){return r%60===0?(r>0?"-":"+")+Ne(Math.abs(r)/60,2):Xr(r,e)}function Xr(r,e=""){const t=r>0?"-":"+",n=Math.abs(r),s=Ne(Math.trunc(n/60),2),i=Ne(n%60,2);return t+s+e+i}const ac=(r,e)=>{switch(r){case"P":return e.date({width:"short"});case"PP":return e.date({width:"medium"});case"PPP":return e.date({width:"long"});case"PPPP":default:return e.date({width:"full"})}},Su=(r,e)=>{switch(r){case"p":return e.time({width:"short"});case"pp":return e.time({width:"medium"});case"ppp":return e.time({width:"long"});case"pppp":default:return e.time({width:"full"})}},c_=(r,e)=>{const t=r.match(/(P+)(p+)?/)||[],n=t[1],s=t[2];if(!s)return ac(r,e);let i;switch(n){case"P":i=e.dateTime({width:"short"});break;case"PP":i=e.dateTime({width:"medium"});break;case"PPP":i=e.dateTime({width:"long"});break;case"PPPP":default:i=e.dateTime({width:"full"});break}return i.replace("{{date}}",ac(n,e)).replace("{{time}}",Su(s,e))},d_={p:Su,P:c_},u_=/^D+$/,h_=/^Y+$/,f_=["D","DD","YY","YYYY"];function g_(r){return u_.test(r)}function m_(r){return h_.test(r)}function p_(r,e,t){const n=b_(r,e,t);if(console.warn(n),f_.includes(r))throw new RangeError(n)}function b_(r,e,t){const n=r[0]==="Y"?"years":"days of the month";return`Use \`${r.toLowerCase()}\` instead of \`${r}\` (in \`${e}\`) for formatting ${n} to the input \`${t}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const y_=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,v_=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,w_=/^'([^]*?)'?$/,__=/''/g,S_=/[a-zA-Z]/;function ht(r,e,t){const n=Bi(),s=n.locale??s_,i=n.firstWeekContainsDate??n.locale?.options?.firstWeekContainsDate??1,a=n.weekStartsOn??n.locale?.options?.weekStartsOn??0,o=yt(r,t?.in);if(!E0(o))throw new RangeError("Invalid time value");let l=e.match(v_).map(d=>{const u=d[0];if(u==="p"||u==="P"){const f=d_[u];return f(d,s.formatLong)}return d}).join("").match(y_).map(d=>{if(d==="''")return{isToken:!1,value:"'"};const u=d[0];if(u==="'")return{isToken:!1,value:x_(d)};if(nc[u])return{isToken:!0,value:d};if(u.match(S_))throw new RangeError("Format string contains an unescaped latin alphabet character `"+u+"`");return{isToken:!1,value:d}});s.localize.preprocessor&&(l=s.localize.preprocessor(o,l));const c={firstWeekContainsDate:i,weekStartsOn:a,locale:s};return l.map(d=>{if(!d.isToken)return d.value;const u=d.value;(m_(u)||g_(u))&&p_(u,e,String(r));const f=nc[u[0]];return f(o,u,s.localize,c)}).join("")}function x_(r){const e=r.match(w_);return e?e[1].replace(__,"'"):r}function E_(r,e){return yt(r,e?.in).getDay()}function T_(r,e){return+yt(r)>+yt(e)}function R_(r,e,t){return vu(r,-1,t)}class O_{async init(){try{const{error:e}=await Me.from("machines").select("count").limit(1);if(e)throw new ye(`API initialization failed: ${e.message}`,se.SERVER_ERROR,500,e,"API.init");return!0}catch(e){throw e instanceof ye?e:new ye(`API initialization failed: ${e.message}`,se.SERVER_ERROR,500,e,"API.init")}}async getMachines(){try{const{data:e,error:t}=await Me.from("machines").select("*").order("machine_name");if(t)throw t;return e||[]}catch(e){throw new ye(`Failed to get machines: ${e.message}`,se.SERVER_ERROR,500,e,"API.getMachines")}}async addMachine(e){try{const{data:t,error:n}=await Me.from("machines").insert([e]).select().single();if(n)throw n;return t}catch(t){throw new ye(`Failed to add machine: ${tt(t)}`,se.SERVER_ERROR,500,t,"API.addMachine")}}async updateMachine(e,t){try{const{data:n,error:s}=await Me.from("machines").update(t).eq("id",e).select().single();if(s)throw s;return n}catch(n){throw new ye(`Failed to update machine: ${tt(n)}`,se.SERVER_ERROR,500,n,"API.updateMachine")}}async removeMachine(e){try{const{error:t}=await Me.from("machines").delete().eq("id",e);if(t)throw t;return!0}catch(t){throw new ye(`Failed to remove machine: ${tt(t)}`,se.SERVER_ERROR,500,t,"API.removeMachine")}}async getOdpOrders(){try{const{data:e,error:t}=await Me.from("odp_orders").select("*").order("created_at",{ascending:!1});if(t)throw t;return e||[]}catch(e){throw new ye(`Failed to fetch ODP orders: ${tt(e)}`,se.SERVER_ERROR,500,e,"API.getOdpOrders")}}async getOdpOrder(e){try{const{data:t,error:n}=await Me.from("odp_orders").select("*").eq("id",e).single();if(n)throw n;return t}catch(t){throw new ye(`Failed to fetch ODP order: ${tt(t)}`,se.SERVER_ERROR,500,t,"API.getOdpOrder")}}async addOdpOrder(e){try{const{data:t,error:n}=await Me.from("odp_orders").insert([e]).select().single();if(n)throw n;return t}catch(t){throw new ye(`Failed to add ODP order: ${tt(t)}`,se.SERVER_ERROR,500,t,"API.addOdpOrder")}}async updateOdpOrder(e,t){try{const{data:n,error:s}=await Me.from("odp_orders").update(t).eq("id",e).select().single();if(s)throw s;return n}catch(n){throw new ye(`Failed to update ODP order: ${tt(n)}`,se.SERVER_ERROR,500,n,"API.updateOdpOrder")}}async removeOdpOrder(e){try{const{error:t}=await Me.from("odp_orders").delete().eq("id",e);if(t)throw t;return!0}catch(t){throw new ye(`Failed to remove ODP order: ${tt(t)}`,se.SERVER_ERROR,500,t,"API.removeOdpOrder")}}async getPhases(){try{const{data:e,error:t}=await Me.from("phases").select("*").order("name");if(t)throw t;return e||[]}catch(e){throw new ye(`Failed to fetch phases: ${tt(e)}`,se.SERVER_ERROR,500,e,"API.getPhases")}}async addPhase(e){try{const{data:t,error:n}=await Me.from("phases").insert([e]).select().single();if(n)throw n;return t}catch(t){throw new ye(`Failed to add phase: ${tt(t)}`,se.SERVER_ERROR,500,t,"API.addPhase")}}async updatePhase(e,t){try{const{data:n,error:s}=await Me.from("phases").update(t).eq("id",e).select().single();if(s)throw s;return n}catch(n){throw new ye(`Failed to update phase: ${tt(n)}`,se.SERVER_ERROR,500,n,"API.updatePhase")}}async removePhase(e){try{const{error:t}=await Me.from("phases").delete().eq("id",e);if(t)throw t;return!0}catch(t){throw new ye(`Failed to remove phase: ${tt(t)}`,se.SERVER_ERROR,500,t,"API.removePhase")}}async getMachineAvailabilityForDateRange(e,t,n){try{const{data:s,error:i}=await Me.from("machine_availability").select("*").eq("machine_id",e).gte("date",t).lte("date",n).order("date");if(i)throw i;return s||[]}catch(s){throw new ye(`Failed to fetch machine availability for date range: ${tt(s)}`,se.SERVER_ERROR,500,s,"API.getMachineAvailabilityForDateRange")}}async getMachineAvailabilityForDate(e,t){try{const{data:n,error:s}=await Me.from("machine_availability").select("*").eq("machine_id",e).eq("date",t).maybeSingle();if(s)throw s;return n||null}catch(n){throw new ye(`Failed to fetch machine availability: ${tt(n)}`,se.SERVER_ERROR,500,n,"API.getMachineAvailabilityForDate")}}async getMachineAvailability(e,t){try{return(await this.getMachineAvailabilityForDate(e,t))?.unavailable_hours||[]}catch{return[]}}async setMachineAvailability(e,t,n){try{const{data:s,error:i}=await Me.from("machine_availability").upsert([{machine_id:e,date:t,unavailable_hours:n}],{onConflict:"machine_id,date"}).select().single();if(i)throw i;return s}catch(s){throw new ye(`Failed to set machine availability: ${tt(s)}`,se.SERVER_ERROR,500,s,"API.setMachineAvailability")}}async getMachineAvailabilityForDateAllMachines(e){try{const{data:t,error:n}=await Me.from("machine_availability").select("*").eq("date",e);if(n)throw n;return t||[]}catch(t){throw new ye(`Failed to fetch machine availability for all machines: ${tt(t)}`,se.SERVER_ERROR,500,t,"API.getMachineAvailabilityForDateAllMachines")}}async getEventsByDate(e){try{const{data:t,error:n}=await Me.from("machine_availability").select("*").eq("date",e);if(n)throw n;return t||[]}catch(t){throw new ye(`Failed to fetch events by date: ${tt(t)}`,se.SERVER_ERROR,500,t,"API.getEventsByDate")}}async setUnavailableHoursForRange(e,t,n,s,i){try{const a=parseInt(s.split(":")[0]),o=parseInt(i.split(":")[0]),l=[];for(let g=a;g<o;g++)l.push(g.toString());const c=new Date(t),d=new Date(n);let u=new Date(c);const f=[];for(;u<=d;){const g=ht(u,"yyyy-MM-dd"),m=(await this.getMachineAvailabilityForDate(e,g))?.unavailable_hours||[],y=[...new Set([...m,...l])].sort((p,w)=>parseInt(p)-parseInt(w)),v=await this.setMachineAvailability(e,g,y);f.push(v),u=Ts(u,1)}return f}catch(a){throw new ye(`Failed to set unavailable hours for range: ${tt(a)}`,se.SERVER_ERROR,500,a,"API.setUnavailableHoursForRange")}}async bulkUpsertMachineAvailability(e){try{const{error:t}=await Me.from("machine_availability").upsert(e,{onConflict:"machine_id,date"});if(t)throw t;return{success:!0}}catch(t){throw new ye(`Failed to bulk set machine availability: ${tt(t)}`,se.SERVER_ERROR,500,t,"API.bulkUpsertMachineAvailability")}}setupRealtimeSubscriptions(e,t,n){return Me.channel("table-db-changes").on("postgres_changes",{event:"*",schema:"public",table:"odp_orders"},e).on("postgres_changes",{event:"*",schema:"public",table:"machines"},t).on("postgres_changes",{event:"*",schema:"public",table:"phases"},n).subscribe(i=>{})}cleanupRealtimeSubscriptions(e){if(e)try{e.unsubscribe()}catch{}}}const Re=new O_,to=Object.freeze(Object.defineProperty({__proto__:null,apiService:Re},Symbol.toStringTag,{value:"Module"})),Dn=Di((r,e)=>({odpOrders:[],getOdpOrders:()=>e().odpOrders,getOrderById:t=>e().odpOrders.find(n=>n.id===t),getScheduledOrders:()=>e().odpOrders.filter(t=>t.status==="SCHEDULED"),getUnscheduledOrders:()=>e().odpOrders.filter(t=>t.status==="NOT SCHEDULED"),getOdpOrdersByWorkCenter:t=>t==="BOTH"?e().odpOrders:e().odpOrders.filter(n=>n.work_center===t),setOdpOrders:t=>r({odpOrders:t||[]}),cleanupDuplicateOrders:()=>{const t=e(),n=[],s=new Set;t.odpOrders.forEach(i=>{s.has(i.id)||(s.add(i.id),n.push(i))}),r({odpOrders:n})},reset:()=>r({odpOrders:[]})}));Di((r,e)=>({machines:[],getMachines:()=>e().machines,getMachineById:t=>e().machines.find(n=>n.id===t),getMachinesByWorkCenter:t=>t==="BOTH"?e().machines:e().machines.filter(n=>n.work_center===t),setMachines:t=>r({machines:t||[]}),cleanupDuplicateMachines:()=>{const t=e(),n=[],s=new Set;t.machines.forEach(i=>{s.has(i.id)||(s.add(i.id),n.push(i))}),r({machines:n})},reset:()=>r({machines:[]})}));const Ue={MACHINE:{DEPARTMENT:"STAMPA",WORK_CENTER:"ZANICA",MIN_WEB_WIDTH:"100",MAX_WEB_WIDTH:"1000",MIN_BAG_HEIGHT:"50",MAX_BAG_HEIGHT:"500",SETUP_TIME_STANDARD:"0.5",CHANGEOVER_COLOR:"0.25",CHANGEOVER_MATERIAL:"0.75",ACTIVE_SHIFTS:["T1"],STATUS:"ACTIVE"},PHASE:{DEPARTMENT:"STAMPA",NUMERO_PERSONE:1,WORK_CENTER:"ZANICA",V_STAMPA:6e3,T_SETUP_STAMPA:.5,COSTO_H_STAMPA:50,V_CONF:1e3,T_SETUP_CONF:.25,COSTO_H_CONF:40},ORDER:{SEAL_SIDES:3,QUANTITY_COMPLETED:0},OFF_TIME:{START_TIME:"09:00",END_TIME:"17:00"}},C_={MAX_TASK_SEGMENTS:50},Js={MINUTES_PER_HOUR:60,MILLISECONDS_PER_MINUTE:60*1e3},dr=Di((r,e)=>({isLoading:!1,isInitialized:!1,selectedWorkCenter:localStorage.getItem("selectedWorkCenter")||ve.BOTH,isEditMode:!1,schedulingLoading:{isScheduling:!1,isRescheduling:!1,isShunting:!1,isNavigating:!1,operationType:null,taskId:null},confirmDialog:{isOpen:!1,title:"",message:"",onConfirm:null,type:"danger"},conflictDialog:{isOpen:!1,details:null},dragPreview:{isActive:!1,startSlot:null,durationSlots:0,machineId:null},getLoadingState:()=>e().isLoading,getInitializationState:()=>e().isInitialized,getSelectedWorkCenter:()=>e().selectedWorkCenter,getEditMode:()=>e().isEditMode,getConfirmDialog:()=>e().confirmDialog,getConflictDialog:()=>e().conflictDialog,getSchedulingLoading:()=>e().schedulingLoading,getDragPreview:()=>e().dragPreview,setLoading:t=>r({isLoading:t}),setInitialized:t=>r({isInitialized:t}),setSelectedWorkCenter:t=>{localStorage.setItem("selectedWorkCenter",t),r({selectedWorkCenter:t})},toggleEditMode:()=>r(t=>({isEditMode:!t.isEditMode})),setEditMode:t=>r({isEditMode:t}),setSchedulingLoading:t=>r({schedulingLoading:t}),startSchedulingOperation:(t,n=null)=>r({schedulingLoading:{isScheduling:t==="schedule",isRescheduling:t==="reschedule",isShunting:t==="shunt",isNavigating:t==="navigate",operationType:t,taskId:n}}),stopSchedulingOperation:()=>r({schedulingLoading:{isScheduling:!1,isRescheduling:!1,isShunting:!1,isNavigating:!1,operationType:null,taskId:null}}),showConfirmDialog:(t,n,s,i="danger")=>r({confirmDialog:{isOpen:!0,title:t,message:n,onConfirm:s,type:i}}),hideConfirmDialog:()=>r({confirmDialog:{isOpen:!1,title:"",message:"",onConfirm:null,type:"danger"}}),showConflictDialog:t=>r({conflictDialog:{isOpen:!0,details:t}}),hideConflictDialog:()=>r({conflictDialog:{isOpen:!1,details:null}}),setDragPreview:t=>r({dragPreview:t}),clearDragPreview:()=>r({dragPreview:{isActive:!1,startSlot:null,durationSlots:0,machineId:null}}),showAlert:(t,n="info")=>{Jt(t,n)},reset:()=>r({isLoading:!1,isInitialized:!1,selectedWorkCenter:ve.BOTH,isEditMode:!1,schedulingLoading:{isScheduling:!1,isRescheduling:!1,isShunting:!1,isNavigating:!1,operationType:null,taskId:null},confirmDialog:{isOpen:!1,title:"",message:"",onConfirm:null,type:"danger"},conflictDialog:{isOpen:!1,details:null},dragPreview:{isActive:!1,startSlot:null,durationSlots:0,machineId:null}})}));class k_{constructor(e,t){this.get=e,this.set=t}setSplitTaskInfo=(e,t)=>{this.set(n=>({splitTasksInfo:{...n.splitTasksInfo,[e]:t}}))};getSplitTaskInfo=e=>{const t=this.get().splitTasksInfo[e];if(t&&t.segments)return t;const{getOrderById:n}=dt.getState(),s=n(e);if(s&&s.description&&s.status==="SCHEDULED")try{const i=JSON.parse(s.description);if(i.segments&&Array.isArray(i.segments))return setTimeout(()=>{this.setSplitTaskInfo(e,i)},0),i}catch{}return null};clearSplitTaskInfo=e=>{this.set(t=>{const n={...t.splitTasksInfo};return delete n[e],{splitTasksInfo:n}})};updateTaskWithSplitInfo=async(e,t,n=null,s=null,i=null)=>{const{apiService:a}=await hr(async()=>{const{apiService:o}=await Promise.resolve().then(()=>to);return{apiService:o}},void 0);if(t){this.setSplitTaskInfo(e,t);const l={description:JSON.stringify(t),status:"SCHEDULED"};if(n&&(l.scheduled_start_time=n.toISOString()),s&&(l.scheduled_end_time=s.toISOString()),i&&(l.scheduled_machine_id=i),!(l.scheduled_start_time&&l.scheduled_end_time&&l.scheduled_machine_id))if(!l.scheduled_start_time&&!l.scheduled_end_time&&!l.scheduled_machine_id)delete l.scheduled_start_time,delete l.scheduled_end_time,delete l.scheduled_machine_id,l.status="NOT SCHEDULED";else{const{getOrderById:d}=dt.getState(),u=d(e);u&&(l.scheduled_start_time||(l.scheduled_start_time=u.scheduled_start_time),l.scheduled_end_time||(l.scheduled_end_time=u.scheduled_end_time),l.scheduled_machine_id||(l.scheduled_machine_id=u.scheduled_machine_id))}const c=await a.updateOdpOrder(e,l);this.updateSplitTaskInfo(e,c)}else{this.clearSplitTaskInfo(e);const o=await a.updateOdpOrder(e,{description:""});this.updateSplitTaskInfo(e,o)}};updateSplitTaskInfo=(e,t)=>{if(this.clearSplitTaskInfo(e),t.description&&t.status==="SCHEDULED")try{const n=JSON.parse(t.description);n.segments&&Array.isArray(n.segments)?this.validateSegments(n.segments.map(i=>({start:new Date(i.start),end:new Date(i.end),duration:i.duration}))).isValid?this.setSplitTaskInfo(e,n):this.clearSplitTaskInfo(e):this.clearSplitTaskInfo(e)}catch{this.clearSplitTaskInfo(e)}else this.clearSplitTaskInfo(e)};restoreSplitTaskInfo=()=>{const{getOdpOrders:e}=Dn.getState(),t=e(),n={};let s=0;t.forEach(i=>{if(i.description&&i.status==="SCHEDULED")try{const a=JSON.parse(i.description);a.segments&&Array.isArray(a.segments)&&(n[i.id]=a,s++)}catch{}}),this.set({splitTasksInfo:n})};validateSegments=e=>{if(!Array.isArray(e)||e.length===0)return{isValid:!1,error:"Segments must be a non-empty array"};for(let t=0;t<e.length;t++){const n=e[t];if(!n.start||!n.end||n.duration===void 0)return{isValid:!1,error:`Segment ${t} missing required properties (start, end, duration)`};const s=new Date(n.start),i=new Date(n.end);if(isNaN(s.getTime())||isNaN(i.getTime()))return{isValid:!1,error:`Segment ${t} has invalid date values`};if(i<=s)return{isValid:!1,error:`Segment ${t} end time must be after start time`};if(n.duration<=0)return{isValid:!1,error:`Segment ${t} duration must be positive`};if(t>0){const a=e[t-1],o=new Date(a.end);if(s<o)return{isValid:!1,error:`Segment ${t} overlaps with previous segment`}}}return{isValid:!0}};createSegmentInfo=(e,t)=>{const n=this.validateSegments(e);if(!n.isValid)throw new Error(`Invalid segments: ${n.error}`);return{totalSegments:e.length,segments:e.map(s=>({start:s.start.toISOString(),end:s.end.toISOString(),duration:s.duration})),originalDuration:t,wasSplit:e.length>1}};getTaskOccupiedSegments=e=>{const t=this.getSplitTaskInfo(e.id);if(t&&t.segments)return t.segments.map(n=>({start:new Date(n.start),end:new Date(n.end),duration:n.duration}));if(e.description)try{const n=JSON.parse(e.description);if(n.segments&&Array.isArray(n.segments))return n.segments.map(s=>({start:new Date(s.start),end:new Date(s.end),duration:s.duration}))}catch{}if(e.scheduled_start_time){const n=new Date(e.scheduled_start_time),s=e.time_remaining||e.duration||1,i=new Date(n.getTime()+s*60*60*1e3);return[{start:n,end:i,duration:s}]}return[]};doTimeRangesOverlap=(e,t,n,s)=>e<s&&t>n;checkTaskOverlap=(e,t,n)=>{const s=this.getTaskOccupiedSegments(n);for(const i of s)if(this.doTimeRangesOverlap(e,t,i.start,i.end))return{hasOverlap:!0,conflictingSegment:i,existingTask:n};return{hasOverlap:!1}};checkMachineOverlaps=(e,t,n,s=null,i=[])=>{const{getEntities:a}=dt.getState(),o=[s,...i].filter(d=>d);console.log(" SPLIT TASK MANAGER: Checking machine overlaps",{machineId:n,excludeTaskId:s,additionalExcludeIds:i,newTaskStart:e.toISOString(),newTaskEnd:t.toISOString()});const l=a().filter(d=>d.scheduled_machine_id===n&&d.status==="SCHEDULED"&&!o.includes(d.id)&&d.scheduled_start_time&&d.scheduled_end_time&&d.scheduled_machine_id);console.log(" SPLIT TASK MANAGER: Found existing tasks on machine:",{machineId:n,existingTasksCount:l.length,existingTasks:l.map(d=>({id:d.id,odp_number:d.odp_number,start:d.scheduled_start_time,end:d.scheduled_end_time}))});const c=l.sort((d,u)=>{const f=this.getTaskOccupiedSegments(d),g=this.getTaskOccupiedSegments(u),b=f.length>0?f[0].start:new Date(d.scheduled_start_time),m=g.length>0?g[0].start:new Date(u.scheduled_start_time);return b.getTime()-m.getTime()});for(const d of c){const u=this.checkTaskOverlap(e,t,d);if(u.hasOverlap)return{hasOverlap:!0,conflictingTask:d,conflictingSegment:u.conflictingSegment}}return{hasOverlap:!1}};migrateExistingTasksToSegmentFormat=async()=>{const{getOdpOrders:e}=Dn.getState(),t=e();for(const n of t)if(n.status==="SCHEDULED"&&n.scheduled_start_time){const s=this.getSplitTaskInfo(n.id);if(s&&s.segments)continue;if(n.description)try{const d=JSON.parse(n.description);if(d.segments&&Array.isArray(d.segments)){this.setSplitTaskInfo(n.id,d);continue}}catch{}const i=new Date(n.scheduled_start_time),a=n.time_remaining||n.duration||1,o=new Date(i.getTime()+a*60*60*1e3),l=[{start:i,end:o,duration:a}],c=this.createSegmentInfo(l,a);await this.updateTaskWithSplitInfo(n.id,c)}};verifyAllTasksHaveSegmentInfo=()=>{const{getOdpOrders:e}=Dn.getState(),n=e().filter(i=>i.status==="SCHEDULED"),s=[];for(const i of n){const a=this.getSplitTaskInfo(i.id);(!a||!a.segments)&&s.push({id:i.id,odp_number:i.odp_number,description:i.description})}return{totalScheduledTasks:n.length,tasksWithSegments:n.length-s.length,tasksWithoutSegments:s}}}class D_{constructor(e,t,n,s){this.get=e,this.set=t,this.splitTaskManager=n,this.machineAvailabilityManager=s}createAbsoluteDate=(e,t,n,s=0,i=0)=>new Date(Date.UTC(e,t-1,n,s,i,0,0));splitTaskAcrossAvailableSlots=(e,t,n,s)=>{try{const i=[];let a=new Date(e),o=t,l=!0;for(;l;){l=!1;for(const c of s)if(a>=c.start&&a<c.end){a=new Date(c.end),l=!0;break}}for(;o>0;){let c=null,d=null,u=null;for(const f of s){const g=new Date(f.start),b=new Date(f.end);g>=a&&(!c||g<d)&&(c=f,d=g,u=b)}if(c){const f=(d.getTime()-a.getTime())/36e5;if(f>0){const b=Math.min(f,o),m=new Date(a.getTime()+b*60*60*1e3);i.push({start:new Date(a),end:m,duration:b}),o-=b}a=new Date(u);let g=!0;for(;g;){g=!1;for(const b of s)if(a>=b.start&&a<b.end){a=new Date(b.end),g=!0;break}}}else{const f=new Date(a.getTime()+o*60*60*1e3);i.push({start:new Date(a),end:f,duration:o}),o=0}if(i.length>C_.MAX_TASK_SEGMENTS){console.warn("Task splitting exceeded maximum segments limit");break}}return i}catch(i){return console.error("Error in splitTaskAcrossAvailableSlots:",i),[]}};splitTaskAcrossAvailableSlotsBackward=(e,t,n,s)=>{try{const i=[];let a=new Date(e),o=t,l=!0;for(;l;){l=!1;for(const d of s)if(a>d.start&&a<=d.end){a=new Date(d.start),l=!0;break}}for(;o>0;){let d=null,u=null,f=null;for(const p of s){const w=new Date(p.start),S=new Date(p.end);S<=a&&(!d||S>f)&&(d=p,u=w,f=S)}let g;d?g=new Date(f):g=new Date(a.getTime()-o*60*60*1e3);let b=!0;for(;b;){b=!1;for(const p of s)if(g<p.end&&g>=p.start){g=new Date(p.end),b=!0;break}}const m=(a.getTime()-g.getTime())/(1e3*60*60);if(m<=0){a=d?new Date(u):new Date(a.getTime()-3600*1e3);continue}const y=Math.min(m,o),v=new Date(a.getTime()-y*60*60*1e3);i.push({start:v,end:new Date(a),duration:y}),o-=y,a=new Date(v)}return i.reverse()}catch(i){return console.error("Error in splitTaskAcrossAvailableSlotsBackward:",i),[]}};collectUnavailableSlots=(e,t,n)=>{const s=[],i=this.createAbsoluteDate(e.getUTCFullYear(),e.getUTCMonth()+1,e.getUTCDate()),a=this.createAbsoluteDate(t.getUTCFullYear(),t.getUTCMonth()+1,t.getUTCDate()),o=new Date(a);o.setUTCDate(o.getUTCDate()+7);let l=new Date(i);for(;l<=o;){const c=ht(l,"yyyy-MM-dd"),d=this.get().machineAvailability[c];if(d&&Array.isArray(d)){const u=d.find(f=>f.machine_id===n);if(u&&u.unavailable_hours&&Array.isArray(u.unavailable_hours)){const[f,g,b]=c.split("-").map(Number);for(const m of u.unavailable_hours){const y=this.createAbsoluteDate(f,g,b,parseInt(m),0),v=new Date(y.getTime()+3600*1e3);s.push({start:y,end:v,hour:parseInt(m),date:c})}}}l.setUTCDate(l.getUTCDate()+1)}return s.sort((c,d)=>c.start.getTime()-d.start.getTime())};loadMachineAvailabilityForExtendedRange=async(e,t,n)=>{const s=this.createAbsoluteDate(e.getUTCFullYear(),e.getUTCMonth()+1,e.getUTCDate()),i=new Date(e.getTime()+t*60*60*1e3),a=this.createAbsoluteDate(i.getUTCFullYear(),i.getUTCMonth()+1,i.getUTCDate()),o=new Date(a);o.setUTCDate(o.getUTCDate()+7);let l=new Date(s);for(;l<=o;){const c=ht(l,"yyyy-MM-dd");await this.machineAvailabilityManager.loadMachineAvailabilityForDate(c),l.setUTCDate(l.getUTCDate()+1)}return o};loadMachineAvailabilityForBackwardRange=async(e,t,n)=>{const s=this.createAbsoluteDate(e.getUTCFullYear(),e.getUTCMonth()+1,e.getUTCDate()),i=new Date(e.getTime()-t*60*60*1e3),a=this.createAbsoluteDate(i.getUTCFullYear(),i.getUTCMonth()+1,i.getUTCDate()),o=new Date(a);o.setUTCDate(o.getUTCDate()-7);let l=new Date(o);for(;l<=s;){const c=ht(l,"yyyy-MM-dd");await this.machineAvailabilityManager.loadMachineAvailabilityForDate(c),l.setUTCDate(l.getUTCDate()+1)}return{taskStartDateWithBuffer:o,taskEndDate:s}};checkSegmentsForOverlaps=(e,t,n,s=[])=>{[n,...s].filter(i=>i),console.log(" CHECKING SEGMENTS FOR OVERLAPS:",{segmentsCount:e.length,machineId:t,excludeTaskId:n,additionalExcludeIds:s});for(const i of e){const a=this.splitTaskManager.checkMachineOverlaps(i.start,i.end,t,n,s);if(a.hasOverlap)return console.log(" OVERLAP FOUND!",{segment:i,conflictingTask:a.conflictingTask?.odp_number,conflictingSegment:a.conflictingSegment}),{hasOverlap:!0,conflictingSegment:i,conflictingTask:a.conflictingTask,conflictingExistingSegment:a.conflictingSegment}}return{hasOverlap:!1}};scheduleTaskWithSplitting=async(e,t,n,s,i=[])=>{const a=await this.loadMachineAvailabilityForExtendedRange(t,n,s),o=this.collectUnavailableSlots(t,a,s),l=new Date(t.getTime()+n*60*60*1e3);if(o.some(d=>t<d.end&&l>d.start)){const d=this.splitTaskAcrossAvailableSlots(t,n,s,o);if(d.length>0){const u=this.checkSegmentsForOverlaps(d,s,e,i);if(u.hasOverlap)return console.log(" SCHEDULING LOGIC: Conflict detected in split segments!",{conflictingTask:u.conflictingTask?.odp_number,conflictingSegment:u.conflictingExistingSegment,proposedSegments:d}),{conflict:!0,conflictingTask:u.conflictingTask,conflictingSegment:u.conflictingExistingSegment,proposedSegments:d};const f=d[0],g=d[d.length-1];if(!f?.start||!g?.end)return console.error("Invalid segments returned from splitTaskAcrossAvailableSlots:",d),null;const b=this.splitTaskManager.createSegmentInfo(d,n);return await this.splitTaskManager.updateTaskWithSplitInfo(e,b,f.start,g.end,s),{startTime:f.start,endTime:g.end,wasSplit:!0,segments:d,originalDuration:n}}}else{const d=[{start:t,end:l,duration:n}],u=this.checkSegmentsForOverlaps(d,s,e,i);if(u.hasOverlap)return console.log(" SCHEDULING LOGIC: Conflict detected in simple scheduling!",{conflictingTask:u.conflictingTask?.odp_number,conflictingSegment:u.conflictingExistingSegment,proposedSegments:d}),{conflict:!0,conflictingTask:u.conflictingTask,conflictingSegment:u.conflictingExistingSegment,proposedSegments:d};const f=this.splitTaskManager.createSegmentInfo(d,n);return await this.splitTaskManager.updateTaskWithSplitInfo(e,f,t,l,s),{startTime:t,endTime:l,wasSplit:!1,segments:d,originalDuration:n}}return null};scheduleTaskEndingAtWithSplitting=async(e,t,n,s,i=[])=>{const{taskStartDateWithBuffer:a,taskEndDate:o}=await this.loadMachineAvailabilityForBackwardRange(t,n,s),l=this.collectUnavailableSlots(a,o,s),c=this.splitTaskAcrossAvailableSlotsBackward(t,n,s,l);if(c.length===0)return null;const d=this.checkSegmentsForOverlaps(c,s,e,i);if(d.hasOverlap)return{conflict:!0,conflictingTask:d.conflictingTask,conflictingSegment:d.conflictingExistingSegment,proposedSegments:c};const u=this.splitTaskManager.createSegmentInfo(c,n),f=c[0],g=c[c.length-1];return!f?.start||!g?.end?(console.error("Invalid segments returned from splitTaskAcrossAvailableSlotsBackward:",c),null):(await this.splitTaskManager.updateTaskWithSplitInfo(e,u,f.start,g.end,s),{startTime:f.start,endTime:g.end,wasSplit:c.length>1,segments:c,originalDuration:n})};handleTaskDurationShrinking=async(e,t,n,s={})=>{try{console.log(" DURATION SHRINKING: Starting cascading rescheduling for task",e),console.log(" DURATION SHRINKING: New duration:",t,"hours");const{getOrderById:i,getEntities:a}=dt.getState(),{getMachineById:o}=ur.getState(),l=i(e),c=o(n),d=a();if(!l||!c)return{success:!1,error:"Task or machine not found"};if(!l.scheduled_start_time||!l.scheduled_end_time)return{success:!1,error:"Task is not scheduled"};const u=new Date(l.scheduled_start_time),f=l.duration,g=new Date(u.getTime()+f*60*60*1e3);console.log(" DURATION SHRINKING: Original end time (pre-shrinking):",g.toISOString()),console.log(" DURATION SHRINKING: Original duration:",f,"New duration:",t);const b=this.findCascadingChain(e,g,n,d);console.log(" DURATION SHRINKING: Found cascading chain of",b.length,"tasks to reschedule"),console.log(" DURATION SHRINKING: Chain tasks:",b.map(R=>R.odp_number));const m=l.quantity_completed/l.quantity||0,y=t*(1-m);console.log(" DURATION SHRINKING: Calculated time_remaining:",y,"from new duration:",t,"and progress:",m),console.log(" DURATION SHRINKING: Progress calculation:",l.quantity_completed,"/",l.quantity,"=",m),console.log(" DURATION SHRINKING: Rescheduling original task with new time_remaining");const v=await this.scheduleTaskWithSplitting(e,u,y,n,[]);if(!v)return console.error(" DURATION SHRINKING: Failed to reschedule original task"),{success:!1,error:"Failed to reschedule original task. Not enough space available.",rescheduledTasks:[]};if(v.conflict)return console.error(" DURATION SHRINKING: Conflict detected while rescheduling original task"),{success:!1,error:"Conflict detected while rescheduling original task. Consider using conflict resolution.",rescheduledTasks:[]};await this.splitTaskManager.updateTaskWithSplitInfo(e,v.segments?{segments:v.segments,totalSegments:v.segments.length,originalDuration:v.originalDuration||y,wasSplit:v.wasSplit||!1}:null,v.startTime,v.endTime,n);const p={duration:t,time_remaining:y,...s};console.log(" DURATION SHRINKING: Final update data:",p),await Re.updateOdpOrder(e,p);const w=[{id:e,odp_number:l.odp_number,new_start_time:v.startTime.toISOString(),new_end_time:v.endTime.toISOString(),was_split:v.wasSplit}];let S=new Date(v.endTime);const x=S.getUTCMinutes(),E=Math.ceil(x/15)*15;E===60?S.setUTCHours(S.getUTCHours()+1,0,0,0):S.setUTCMinutes(E,0,0);for(const R of b){console.log(" DURATION SHRINKING: Rescheduling task",R.odp_number,"to start at",S.toISOString());const k=await this.scheduleTaskWithSplitting(R.id,S,R.time_remaining||R.duration||1,n,[e]);if(!k)return console.error(" DURATION SHRINKING: Failed to reschedule task",R.odp_number),{success:!1,error:`Failed to reschedule task ${R.odp_number}. Not enough space available.`,rescheduledTasks:w};if(k.conflict)return console.error(" DURATION SHRINKING: Conflict detected while rescheduling task",R.odp_number),{success:!1,error:`Conflict detected while rescheduling task ${R.odp_number}. Consider using conflict resolution.`,rescheduledTasks:w};await this.splitTaskManager.updateTaskWithSplitInfo(R.id,k.segments?{segments:k.segments,totalSegments:k.segments.length,originalDuration:k.originalDuration||R.time_remaining||R.duration||1,wasSplit:k.wasSplit||!1}:null,k.startTime,k.endTime,n),w.push({id:R.id,odp_number:R.odp_number,new_start_time:k.startTime.toISOString(),new_end_time:k.endTime.toISOString(),was_split:k.wasSplit}),S=new Date(k.endTime);const O=S.getUTCMinutes(),D=Math.ceil(O/15)*15;D===60?S.setUTCHours(S.getUTCHours()+1,0,0,0):S.setUTCMinutes(D,0,0)}console.log(" DURATION SHRINKING: Successfully rescheduled",w.length,"tasks");const T=dt.getState().getOrderById(e);return{success:!0,message:`Successfully rescheduled ${w.length} tasks due to duration reduction`,rescheduledTasks:w,updatedTask:T}}catch(i){return console.error(" DURATION SHRINKING ERROR:",i),{success:!1,error:i.message||"Unknown error during duration shrinking",rescheduledTasks:[]}}};findCascadingChain=(e,t,n,s)=>{const i=[],a=new Set,o=s.filter(d=>d.scheduled_machine_id===n&&d.status==="SCHEDULED"&&d.id!==e&&d.scheduled_start_time).sort((d,u)=>new Date(d.scheduled_start_time)-new Date(u.scheduled_start_time)),l=o.filter(d=>{const f=(new Date(d.scheduled_start_time).getTime()-t.getTime())/(1e3*60);return f>=0&&f<=15});console.log(" DURATION SHRINKING: Initial candidates within 15 minutes:",l.map(d=>d.odp_number));const c=d=>{for(const u of o){if(a.has(u.id))continue;const f=new Date(u.scheduled_start_time),g=(f.getTime()-d.getTime())/(1e3*60);if(g>=0&&g<=15){a.add(u.id),i.push(u);const b=u.time_remaining||u.duration||1,m=new Date(f.getTime()+b*60*60*1e3);console.log(" DURATION SHRINKING: Added to chain:",u.odp_number,"ends at",m.toISOString()),c(m)}}};return c(t),console.log(" DURATION SHRINKING: Complete chain found:",i.map(d=>d.odp_number)),i}}class N_{constructor(e,t,n,s){this.get=e,this.set=t,this.schedulingLogic=n,this.splitTaskManager=s}getTaskDurationMinutes=e=>Math.round((e.time_remaining||e.duration||1)*Js.MINUTES_PER_HOUR);getTaskEndTime=e=>{const t=new Date(e.scheduled_start_time),n=this.getTaskDurationMinutes(e);return new Date(t.getTime()+n*Js.MILLISECONDS_PER_MINUTE)};addMinutesToDate=(e,t)=>new Date(e.getTime()+t*Js.MILLISECONDS_PER_MINUTE);roundUpToNext15MinSlot=e=>{const t=e.getUTCMinutes(),n=e.getUTCHours(),s=Math.ceil(t/15)*15,i=new Date(e);return s===Js.MINUTES_PER_HOUR?i.setUTCHours(n+1,0,0,0):i.setUTCMinutes(s,0,0),i};scheduleTaskWithSplittingForShunt=async(e,t,n)=>await this.scheduleTaskWithSplittingForShuntExcluding(e,t,n,[e.id]);scheduleTaskWithSplittingForShuntExcluding=async(e,t,n,s,i=3)=>{const a=this.getTaskDurationMinutes(e)/60,o=s.filter(c=>c!==e.id),l=await this.schedulingLogic.scheduleTaskWithSplitting(e.id,t,a,n.id,o);return l&&!l.conflict?{startTime:l.startTime,endTime:l.endTime,wasSplit:l.wasSplit}:l&&l.conflict?(console.log(` CASCADING SHUNT: Task ${e.odp_number} conflicts with ${l.conflictingTask?.odp_number}, attempting cascading resolution`),i>0?await this.handleCascadingConflict(e,t,n,s,l,i-1):(console.warn(` CASCADING SHUNT: Max depth reached for task ${e.odp_number}, returning conflict info`),{conflict:!0,conflictingTask:l.conflictingTask,conflictingSegment:l.conflictingSegment,proposedSegments:l.proposedSegments})):l?{startTime:t,endTime:this.addMinutesToDate(t,this.getTaskDurationMinutes(e)),wasSplit:!1}:null};handleCascadingConflict=async(e,t,n,s,i,a)=>{const o=i.conflictingTask,l=i.conflictingSegment;console.log(` CASCADING SHUNT: Attempting to shunt conflicting task ${o?.odp_number} to resolve conflict with ${e.odp_number}`);const c=new Date(t.getTime()+this.getTaskDurationMinutes(e)*60*1e3),d=this.roundUpToNext15MinSlot(c),u=[...s,o.id];try{const f=await this.scheduleTaskWithSplittingForShuntExcluding(o,d,n,u,a);if(f&&!f.conflict){console.log(` CASCADING SHUNT: Successfully shunted conflicting task ${o.odp_number}`),await this.updateTaskSchedule(o.id,f.startTime,f.endTime);const g=await this.scheduleTaskWithSplittingForShuntExcluding(e,t,n,u,a);return g&&!g.conflict?(console.log(` CASCADING SHUNT: Successfully scheduled original task ${e.odp_number} after resolving conflicts`),g):(console.warn(` CASCADING SHUNT: Original task ${e.odp_number} still conflicts after shunting conflicting task`),g||{conflict:!0,conflictingTask:o,conflictingSegment:l,proposedSegments:i.proposedSegments})}else return console.warn(` CASCADING SHUNT: Could not shunt conflicting task ${o?.odp_number}`),f||{conflict:!0,conflictingTask:o,conflictingSegment:l,proposedSegments:i.proposedSegments}}catch(f){return console.error(" CASCADING SHUNT: Error during cascading conflict resolution:",f),{conflict:!0,conflictingTask:o,conflictingSegment:l,proposedSegments:i.proposedSegments}}};updateTaskSchedule=async(e,t,n)=>{try{const{updateOrder:s}=Dn.getState();await s(e,{scheduled_start_time:t.toISOString(),scheduled_end_time:n.toISOString()})}catch(s){console.error(` CASCADING SHUNT: Failed to update task ${e} schedule:`,s)}};checkShuntingOverlaps=(e,t,n,s=[])=>{const i=n.filter(a=>a.scheduled_machine_id===t&&a.status==="SCHEDULED"&&!s.includes(a.id));for(const a of e)for(const o of i){const l=this.splitTaskManager.checkTaskOverlap(a.start,a.end,o);if(l.hasOverlap)return{hasOverlap:!0,conflictingTask:o,conflictingSegment:l.conflictingSegment,newTaskSegment:a}}return{hasOverlap:!1}};resolveConflictByShunting=async(e,t,n,s)=>{try{const{conflictingTask:i,proposedStartTime:a,machine:o}=e,l=new Date(a),c=n.filter(x=>x.scheduled_machine_id===o.id&&x.status==="SCHEDULED"&&x.id!==s.id).sort((x,E)=>{const T=this.splitTaskManager.getTaskOccupiedSegments(x),R=this.splitTaskManager.getTaskOccupiedSegments(E),k=T.length>0?T[0].start:new Date(x.scheduled_start_time),O=R.length>0?R[0].start:new Date(E.scheduled_start_time);return k-O}),d=c.findIndex(x=>x.id===i.id);if(d===-1)throw new ye("Conflicting task not found",se.BUSINESS_LOGIC_ERROR,400,null,"ConflictResolution.resolveConflictByShunting");const u=this.getTaskDurationMinutes(s),f=[];let g=!1;if(t==="right")for(let x=d;x<c.length&&!g;x++){const E=c[x];if(f.push(E),x<c.length-1){const T=c[x+1],R=this.splitTaskManager.getTaskOccupiedSegments(E),k=this.splitTaskManager.getTaskOccupiedSegments(T);if(R.length>0&&k.length>0){const O=Math.max(...R.map(P=>P.end.getTime())),D=Math.min(...k.map(P=>P.start.getTime()));Math.floor((D-O)/(60*1e3))>=u&&(g=!0)}}else g=!0}else for(let x=d;x>=0&&!g;x--){const E=c[x];if(f.unshift(E),x>0){const T=c[x-1],R=this.splitTaskManager.getTaskOccupiedSegments(T),k=this.splitTaskManager.getTaskOccupiedSegments(E);if(R.length>0&&k.length>0){const O=Math.max(...R.map(P=>P.end.getTime())),D=Math.min(...k.map(P=>P.start.getTime()));Math.floor((D-O)/(60*1e3))>=u&&(g=!0)}}else{const T=this.splitTaskManager.getTaskOccupiedSegments(E);if(T.length>0){const R=Math.min(...T.map(D=>D.start.getTime())),k=new Date(R);if(k.setUTCHours(6,0,0,0),Math.floor((R-k.getTime())/(60*1e3))>=u)g=!0;else{const D=new Date(R),A=new Date(D);A.setUTCHours(6,0,0,0),D.getTime()>A.getTime()&&(g=!0)}}}}const b=new Set,m=new Set;for(const x of f)b.add(x.id),m.add(x.id);m.add(s.id);let y=0;const v=10;for(;y<v;){y++;let x=!1;const E=Array.from(b);for(const T of E){const R=c.find(P=>P.id===T)||s;if(!R)continue;let k;if(t==="right"){const P=new Date(l.getTime()+u*60*1e3);if(k=this.roundUpToNext15MinSlot(P),R.id!==s.id){const Q=Array.from(b).indexOf(T);if(Q>0){const he=Array.from(b)[Q-1],H=c.find(L=>L.id===he)||s,J=this.getTaskDurationMinutes(H),Oe=new Date(k.getTime()+J*60*1e3);k=this.roundUpToNext15MinSlot(Oe)}}}else{const P=l,Q=this.getTaskDurationMinutes(R);k=this.roundUpToNext15MinSlot(this.addMinutesToDate(P,-Q))}const O=this.getTaskDurationMinutes(R)/60,D=this.schedulingLogic.collectUnavailableSlots(k,new Date(k.getTime()+O*60*60*1e3),o.id);if(D.some(P=>k<P.end&&new Date(k.getTime()+O*60*60*1e3)>P.start)){const P=this.schedulingLogic.splitTaskAcrossAvailableSlots(k,O,o.id,D);for(const Q of P)for(const he of c)!m.has(he.id)&&he.id!==R.id&&this.splitTaskManager.checkTaskOverlap(Q.start,Q.end,he).hasOverlap&&(m.add(he.id),b.add(he.id),x=!0)}else{const P=new Date(k.getTime()+O*60*60*1e3);for(const Q of c)!m.has(Q.id)&&Q.id!==R.id&&this.splitTaskManager.checkTaskOverlap(k,P,Q).hasOverlap&&(m.add(Q.id),b.add(Q.id),x=!0)}}if(!x)break}if(y>=v)throw console.error(` SHUNTING ERROR: Maximum iterations (${v}) reached, possible infinite loop`),new ye("Too many conflicts detected during shunting",se.BUSINESS_LOGIC_ERROR,400,null,"ConflictResolution.resolveConflictByShunting");const p=c.filter(x=>b.has(x.id));if(f.length=0,f.push(...p),!g&&f.length===c.length){const x=this.getTaskDurationMinutes(s),E=f.length,T=o.machine_name||"Unknown Machine";console.warn(` SHUNTING WARNING: No gap found for ${x} minutes on machine ${T}`),console.warn(` All ${E} tasks on machine would need to be moved`),console.warn(" Attempting to schedule at earliest possible time...");const R=c[0],k=this.splitTaskManager.getTaskOccupiedSegments(R);if(k.length>0){const O=Math.min(...k.map(A=>A.start.getTime())),D=new Date(O);if(D.setUTCHours(6,0,0,0),D.getTime()<O)g=!0;else throw console.error(` SHUNTING FAILED: No space even at 6 AM on machine ${T}`),console.error(" Consider: 1) Moving to different machine, 2) Reducing task duration, 3) Scheduling on different day"),new ye(`Non c' spazio sufficiente per spostare i lavori. Il task ${s.odp_number} (${x} minuti) richiederebbe di spostare tutti i ${E} lavori sulla macchina ${T}. Prova a: 1) Spostare su una macchina diversa, 2) Ridurre la durata del task, 3) Programmare in un giorno diverso.`,se.BUSINESS_LOGIC_ERROR,400,null,"ConflictResolution.resolveConflictByShunting")}else throw new ye(`Non c' spazio sufficiente per spostare i lavori. Il task ${s.odp_number} (${x} minuti) richiederebbe di spostare tutti i ${E} lavori sulla macchina ${T}. Prova a: 1) Spostare su una macchina diversa, 2) Ridurre la durata del task, 3) Programmare in un giorno diverso.`,se.BUSINESS_LOGIC_ERROR,400,null,"ConflictResolution.resolveConflictByShunting")}const w=[];let S=null;if(t==="right"){const x=new Date(l),E=[...Array.from(m)];if(S=await this.scheduleTaskWithSplittingForShuntExcluding(s,x,o,E),S&&S.conflict)return console.warn(` CASCADING SHUNT: Dragged task ${s.odp_number} still has conflicts after cascading resolution`),{error:`Impossibile programmare il task ${s.odp_number} alla posizione richiesta. Conflitti non risolvibili automaticamente.`,conflict:S.conflict,conflictingTask:S.conflictingTask,conflictingSegment:S.conflictingSegment};let T=S.endTime?this.roundUpToNext15MinSlot(S.endTime):new Date;for(const R of f){const k=[...Array.from(m)],O=await this.scheduleTaskWithSplittingForShuntExcluding(R,T,o,k);if(!O)throw console.error(` Failed to schedule task ${R.odp_number} at ${T.toISOString()}`),new ye(`Impossibile programmare il task ${R.odp_number} alla posizione richiesta. Non c' spazio sufficiente.`,se.BUSINESS_LOGIC_ERROR,400,null,"ConflictResolution.resolveConflictByShunting");if(O&&O.conflict){console.warn(` CASCADING SHUNT: Task ${R.odp_number} still has conflicts after cascading resolution`);continue}w.push({id:R.id,scheduled_start_time:O.startTime?.toISOString(),scheduled_end_time:O.endTime?.toISOString()}),O.endTime&&(T=this.roundUpToNext15MinSlot(O.endTime))}}else{const x=new Date(l);let E=this.roundUpToNext15MinSlot(this.addMinutesToDate(x,-1));for(let T=f.length-1;T>=0;T--){const R=f[T],k=[...Array.from(m)],O=await this.schedulingLogic.scheduleTaskEndingAtWithSplitting(R.id,E,this.getTaskDurationMinutes(R)/60,o.id,k);if(!O)throw console.error(` Failed to schedule task ${R.odp_number} ending at ${E.toISOString()}`),new ye(`Impossibile programmare il task ${R.odp_number} alla posizione richiesta. Non c' spazio sufficiente.`,se.BUSINESS_LOGIC_ERROR,400,null,"ConflictResolution.resolveConflictByShunting");if(O&&O.conflict){console.warn(` CASCADING SHUNT: Task ${R.odp_number} still has conflicts after cascading resolution (LEFT direction)`);continue}w.push({id:R.id,scheduled_start_time:O.startTime?.toISOString(),scheduled_end_time:O.endTime?.toISOString()}),O.startTime&&(E=this.roundUpToNext15MinSlot(this.addMinutesToDate(O.startTime,-1)))}}if(!S){const x=new Date(l),E=[...Array.from(m)];S=await this.scheduleTaskWithSplittingForShuntExcluding(s,x,o,E)}if(!S)throw console.error(` Failed to schedule dragged task ${s.odp_number} at ${proposedStart.toISOString()}`),new ye(`Impossibile programmare il task ${s.odp_number} alla posizione richiesta. Non c' spazio sufficiente.`,se.BUSINESS_LOGIC_ERROR,400,null,"ConflictResolution.resolveConflictByShunting");w.push({id:s.id,scheduled_machine_id:o.id,scheduled_start_time:S.startTime?.toISOString(),scheduled_end_time:S.endTime?.toISOString(),status:"SCHEDULED"});for(const x of w)await Re.updateOdpOrder(x.id,x);return dr.getState().hideConflictDialog(),dr.getState().showAlert("Lavori riprogrammati con successo","success"),{success:!0}}catch(i){return console.error(" SHUNTING ERROR:",i),{error:(i instanceof ye?i:new ye(i.message||"Errore durante la riprogrammazione",se.BUSINESS_LOGIC_ERROR,400,i,"ConflictResolution.resolveConflictByShunting")).message}}}}class A_{constructor(e,t){this.get=e,this.set=t,this.updateLocks=new Map}getLockKey=(e,t)=>`${e}-${t}`;acquireLock=async(e,t)=>{const n=this.getLockKey(e,t);this.updateLocks.has(n)&&await this.updateLocks.get(n);let s;const i=new Promise(a=>{s=a});return this.updateLocks.set(n,i),s};releaseLock=(e,t)=>{const n=this.getLockKey(e,t);this.updateLocks.delete(n)};loadMachineAvailabilityForDate=async e=>{const{machineAvailability:t}=this.get();if(!t[e]?._loading&&!(t[e]&&t[e].length>=0)){this.set(n=>({machineAvailability:{...n.machineAvailability,[e]:{_loading:!0}}}));try{const n=await Re.getMachineAvailabilityForDateAllMachines(e);this.set(s=>({machineAvailability:{...s.machineAvailability,[e]:n||[]}}))}catch(n){throw this.set(s=>{const i={...s.machineAvailability};return i[e]&&delete i[e]._loading,{machineAvailability:i}}),n}}};loadMachineAvailabilityForDateRange=async(e,t,n)=>{const s=t instanceof Date?ht(t,"yyyy-MM-dd"):t,i=n instanceof Date?ht(n,"yyyy-MM-dd"):n;try{const a=await Re.getMachineAvailabilityForDateRange(e,s,i);return this.set(o=>{const l={...o.machineAvailability};return Array.isArray(a)&&a.forEach(c=>{if(c.date&&c.unavailable_hours){const d=c.date;l[d]||(l[d]=[]);const u=l[d].find(f=>f.machine_id===e);u?u.unavailable_hours=c.unavailable_hours:l[d].push({machine_id:e,date:d,unavailable_hours:c.unavailable_hours})}}),{machineAvailability:l}}),a}catch(a){throw a}};getMachineAvailability=async(e,t)=>{try{const n=this.get().machineAvailability[t];if(n&&Array.isArray(n)){const i=n.find(a=>a.machine_id===e);if(i)return i.unavailable_hours||[]}const s=await Re.getMachineAvailabilityForDate(e,t);if(s){const i=(s.unavailable_hours||[]).map(a=>a.toString());return this.set(a=>{const o={...a.machineAvailability};o[t]||(o[t]=[]);const l=o[t].find(c=>c.machine_id===e);return l?l.unavailable_hours=i:o[t].push({machine_id:e,date:t,unavailable_hours:i}),{machineAvailability:o}}),i}return[]}catch{return[]}};loadMachineAvailabilityForMachine=async(e,t,n)=>{const s={};try{try{await Re.getMachineAvailabilityForDate("test","2025-01-01")}catch{return{}}let i=new Date(t);for(;i<=n;){const a=ht(i,"yyyy-MM-dd");this.get().machineAvailability[a]||await this.loadMachineAvailabilityForDate(a);const l=this.get().machineAvailability[a];if(Array.isArray(l)){const c=l.find(d=>d.machine_id===e);c&&(s[a]=c.unavailable_hours||[])}i=Ts(i,1)}return s}catch{return{}}};isTimeSlotUnavailable=async(e,t,n)=>(await this.getMachineAvailability(e,t)).includes(n.toString());setMachineAvailability=async(e,t,n)=>{const s=await this.acquireLock(e,t);try{const{getOdpOrders:i}=Dn.getState(),a=i().filter(f=>f.scheduled_machine_id===e&&f.status==="SCHEDULED"&&f.scheduled_start_time&&f.scheduled_end_time),[o,l,c]=t.split("-").map(Number),d=new Date(Date.UTC(o,l-1,c)),u=new Date(d.getTime()+1440*60*1e3);for(const f of a){const g=new Date(f.scheduled_start_time),b=new Date(f.scheduled_end_time);if(g<u&&b>d)for(const m of n){const y=new Date(d.getTime()+parseInt(m)*60*60*1e3),v=new Date(y.getTime()+3600*1e3);if(y<b&&v>g)throw new ye(`Cannot set machine unavailable during scheduled task: ${f.odp_number}`,se.BUSINESS_LOGIC_ERROR,400,null,"MachineAvailabilityManager.setMachineUnavailability")}}return await Re.setMachineAvailability(e,t,n),this.set(f=>{const g={...f.machineAvailability};g[t]||(g[t]=[]);const b=g[t].find(m=>m.machine_id===e);return b?b.unavailable_hours=n:g[t].push({machine_id:e,date:t,unavailable_hours:n}),{machineAvailability:g}}),dr.getState().showAlert(`Machine availability updated successfully for ${t}`,"success"),!0}catch(i){const a=Zr(i,"Machine Availability");throw dr.getState().showAlert(a.message,"error"),a}finally{s(),this.releaseLock(e,t)}};toggleMachineHourAvailability=async(e,t,n)=>{const s=await this.acquireLock(e,t);try{const i=await this.getMachineAvailability(e,t),a=n.toString();let o;return i.includes(a)?o=i.filter(l=>l!==a):o=[...i,a].sort((l,c)=>parseInt(l)-parseInt(c)),await Re.setMachineAvailability(e,t,o),this.set(l=>{const c={...l.machineAvailability};c[t]||(c[t]=[]);const d=c[t].find(u=>u.machine_id===e);return d?d.unavailable_hours=o:c[t].push({machine_id:e,date:t,unavailable_hours:o}),{machineAvailability:c}}),dr.getState().showAlert(`Time slot ${a}:00 updated successfully`,"success"),!0}catch(i){const a=Zr(i,"Machine Availability");throw dr.getState().showAlert(a.message,"error"),a}finally{s(),this.releaseLock(e,t)}};setMachineUnavailability=async(e,t,n,s,i)=>{try{const a=await Re.setUnavailableHoursForRange(e,t,n,s,i),o=new Date(t),l=new Date(n),c=await this.loadMachineAvailabilityForDateRange(e,o,l);return c&&Array.isArray(c)&&this.set(d=>{const u={...d.machineAvailability};return c.forEach(f=>{if(f.date&&f.unavailable_hours){const g=ht(new Date(f.date),"yyyy-MM-dd");u[g]||(u[g]=[]);const b=u[g].find(m=>m.machine_id===e);b?b.unavailable_hours=f.unavailable_hours:u[g].push({machine_id:e,date:g,unavailable_hours:f.unavailable_hours})}}),{machineAvailability:u}}),a}catch(a){throw a}};isMachineAvailabilityAccessible=async()=>{try{return await Re.getMachineAvailabilityForDateAllMachines("2025-01-01"),!0}catch{return!1}};getMachineAvailabilityStatus=async()=>{try{const e=await this.isMachineAvailabilityAccessible();return{accessible:e,message:e?"Table is accessible":"Table is not accessible - check permissions or table existence"}}catch(e){return{accessible:!1,message:`Error checking table: ${e.message}`}}};initializeEmptyMachineAvailability=()=>{const{machineAvailability:e}=this.get(),t={...e};this.set({machineAvailability:t})}}const Rs=Di((r,e)=>{const t=new k_(e,r),n=new A_(e,r),s=new D_(e,r,t,n),i=new N_(e,r,s,t);return{machineAvailability:{},shuntPreview:null,splitTasksInfo:{},getMachineAvailabilityState:()=>e().machineAvailability,getSplitTaskInfo:a=>t.getSplitTaskInfo(a),setMachineAvailabilityState:a=>r({machineAvailability:a}),setShuntPreview:a=>r({shuntPreview:a}),clearShuntPreview:()=>r({shuntPreview:null}),setSplitTaskInfo:t.setSplitTaskInfo,clearSplitTaskInfo:t.clearSplitTaskInfo,updateSplitTaskInfo:t.updateSplitTaskInfo,restoreSplitTaskInfo:t.restoreSplitTaskInfo,updateTaskWithSplitInfo:t.updateTaskWithSplitInfo,getTaskOccupiedSegments:t.getTaskOccupiedSegments,checkTaskOverlap:t.checkTaskOverlap,checkMachineOverlaps:t.checkMachineOverlaps,migrateExistingTasksToSegmentFormat:t.migrateExistingTasksToSegmentFormat,verifyAllTasksHaveSegmentInfo:t.verifyAllTasksHaveSegmentInfo,createAbsoluteDate:s.createAbsoluteDate,splitTaskAcrossAvailableSlots:s.splitTaskAcrossAvailableSlots,collectUnavailableSlots:s.collectUnavailableSlots,scheduleTaskWithSplitting:s.scheduleTaskWithSplitting,findAdjacentTasksChain:s.findAdjacentTasksChain,handleTaskDurationShrinking:s.handleTaskDurationShrinking,scheduleTaskFromSlot:async(a,o,l,c,d,u=null,f=null)=>{const{startSchedulingOperation:g,stopSchedulingOperation:b}=dr.getState();try{g("schedule",a);const{getOrderById:m,getEntities:y}=dt.getState(),{getMachineById:v}=ur.getState(),p=m(a),w=v(o.id),S=y();if(!p||!w)return{error:"Task or machine not found"};const x=l.getUTCFullYear(),E=l.getUTCMonth()+1,T=l.getUTCDate(),R=s.createAbsoluteDate(x,E,T,c,d),k=u||p.time_remaining||p.duration||1;console.log(" SCHEDULER: Using duration:",k,"overrideDuration:",u);const O={machine:o.id,start_time:R.toISOString(),end_time:ec(R,k).toISOString()};console.log(" SCHEDULER: Calling scheduleTask with:",{taskId:a,scheduleData:O,overrideDuration:u});const D=await e().scheduleTask(a,O,S,u,f);return console.log(" SCHEDULER: scheduleTask result:",D),D}catch(m){return{error:Zr(m,"SchedulerStore.scheduleTaskFromSlot").message}}finally{b()}},rescheduleTaskToSlot:async(a,o,l,c,d,u=null)=>{const{startSchedulingOperation:f,stopSchedulingOperation:g}=dr.getState();try{f("reschedule",a);const{getOrderById:b,getEntities:m}=dt.getState(),{getMachineById:y}=ur.getState(),v=b(a),p=y(o.id),w=m();if(!v||!p)return{error:"Event or machine not found"};const S=l.getUTCFullYear(),x=l.getUTCMonth()+1,E=l.getUTCDate(),T=s.createAbsoluteDate(S,x,E,c,d),R=v.time_remaining||v.duration||1,k={machine:o.id,start_time:T.toISOString(),end_time:ec(T,R).toISOString()};return await e().scheduleTask(a,k,w,null,u)}catch(b){return{error:Zr(b,"SchedulerStore.rescheduleTaskToSlot").message}}finally{g()}},scheduleTask:async(a,o,l=null,c=null,d=null)=>{try{console.log(" SCHEDULER: scheduleTask called with:",{taskId:a,eventData:o,overrideDuration:c});const{getOrderById:u,getEntities:f}=dt.getState(),{getMachineById:g}=ur.getState(),b=u(a),m=g(o.machine),y=l||f();if(console.log(" SCHEDULER: Task found:",b?.odp_number,"Machine found:",m?.machine_name||m?.name),console.log(" SCHEDULER: Machine lookup debug:",{machineId:o.machine,machine:m,machineKeys:m?Object.keys(m):"null"}),b&&m&&b.work_center&&m.work_center&&b.work_center!==m.work_center)return{error:`Work center mismatch: task requires '${b.work_center}' but machine is '${m.work_center}'`};const v=new Date(o.start_time),p=c||b.time_remaining||b.duration||1;console.log(" SCHEDULER: scheduleTask using duration:",p,"overrideDuration:",c),console.log(" SCHEDULER: Calling scheduleTaskWithSplitting with:",{taskId:a,newStart:v.toISOString(),timeRemainingHours:p,machineId:o.machine});const w=await s.scheduleTaskWithSplitting(a,v,p,o.machine);if(console.log(" SCHEDULER: scheduleTaskWithSplitting result:",w),console.log(" SCHEDULER: Checking for conflict...",{hasConflict:!!w?.conflict,conflictDetails:w?.conflict?w:"No conflict detected"}),!w)return{error:"No available time slots found for this task"};if(w.conflict)return{conflict:!0,conflictingTask:w.conflictingTask,draggedTask:b,proposedStartTime:o.start_time,proposedEndTime:o.end_time,machine:m,conflictingSegment:w.conflictingSegment,proposedSegments:w.proposedSegments,tasks:y};o.start_time=w.startTime.toISOString(),o.end_time=w.endTime.toISOString();const S={scheduled_machine_id:o.machine,scheduled_start_time:o.start_time,scheduled_end_time:o.end_time,status:"SCHEDULED"};if(w.segments){const T={segments:w.segments,totalSegments:w.segments.length,originalDuration:w.originalDuration||b.time_remaining||b.duration||1,wasSplit:w.wasSplit||!1};S.description=JSON.stringify(T)}const{apiService:x}=await hr(async()=>{const{apiService:T}=await Promise.resolve().then(()=>to);return{apiService:T}},void 0),E=await x.updateOdpOrder(a,S);if(w.segments){const T={segments:w.segments,totalSegments:w.segments.length,originalDuration:w.originalDuration||b.time_remaining||b.duration||1,wasSplit:w.wasSplit||!1};t.setSplitTaskInfo(a,T)}return d&&(d.invalidateQueries({queryKey:["orders"]}),d.invalidateQueries({queryKey:["orders",a]})),{success:!0,updatedTask:E,schedulingResult:w}}catch(u){return{error:Zr(u,"SchedulerStore.scheduleTask").message}}},unscheduleTask:async(a,o=null)=>{const{startSchedulingOperation:l,stopSchedulingOperation:c}=dr.getState();try{l("unschedule",a),t.clearSplitTaskInfo(a);const d={scheduled_machine_id:null,scheduled_start_time:null,scheduled_end_time:null,status:"NOT SCHEDULED",description:""},{apiService:u}=await hr(async()=>{const{apiService:f}=await Promise.resolve().then(()=>to);return{apiService:f}},void 0);return await u.updateOdpOrder(a,d),o&&(o.invalidateQueries({queryKey:["orders"]}),o.invalidateQueries({queryKey:["orders",a]})),{success:!0}}catch(d){return{error:Zr(d,"SchedulerStore.unscheduleTask").message}}finally{c()}},loadMachineAvailabilityForDate:n.loadMachineAvailabilityForDate,loadMachineAvailabilityForDateRange:n.loadMachineAvailabilityForDateRange,getMachineAvailability:n.getMachineAvailability,loadMachineAvailabilityForMachine:n.loadMachineAvailabilityForMachine,isTimeSlotUnavailable:n.isTimeSlotUnavailable,setMachineAvailability:n.setMachineAvailability,toggleMachineHourAvailability:n.toggleMachineHourAvailability,setMachineUnavailability:n.setMachineUnavailability,isMachineAvailabilityAccessible:n.isMachineAvailabilityAccessible,getMachineAvailabilityStatus:n.getMachineAvailabilityStatus,initializeEmptyMachineAvailability:n.initializeEmptyMachineAvailability,resolveConflictByShunting:async(a,o,l=null)=>{const{startSchedulingOperation:c,stopSchedulingOperation:d}=dr.getState();try{c("shunt",a.draggedTask?.id);const{getEntities:u}=dt.getState(),f=u(),g=await i.resolveConflictByShunting(a,o,f,a.draggedTask);if(g&&!g.error&&l){console.log(" SHUNTING: Invalidating React Query cache to refresh UI");const b=[l.invalidateQueries({queryKey:["orders"]}),l.invalidateQueries({queryKey:["machines"]})];a.draggedTask?.id&&b.push(l.invalidateQueries({queryKey:["orders",a.draggedTask.id]})),await Promise.all(b)}return g}catch(u){return console.error(" SHUNTING ERROR in scheduler store:",u),{error:u.message||"Errore durante lo spostamento del task"}}finally{d()}},validateSlotAvailability:async(a,o,l,c)=>{try{const d=ht(o,"yyyy-MM-dd");if(await e().isTimeSlotUnavailable(a.id,d,l))return{error:"Cannot schedule task on unavailable time slot"};const{getOdpOrders:f}=Dn.getState(),g=new Date(o);g.setUTCHours(l,c,0,0);const b=new Date(g.getTime()+3600*1e3),m=f().filter(y=>y.scheduled_machine_id===a.id&&y.status==="SCHEDULED"&&y.scheduled_start_time);for(const y of m){const v=new Date(y.scheduled_start_time),p=y.time_remaining||y.duration||1,w=new Date(v.getTime()+p*60*60*1e3);if(g<w&&b>v)return{error:"Cannot schedule task on occupied time slot"}}return{success:!0}}catch(d){return{error:Zr(d,"SchedulerStore.validateSlotAvailability").message}}},getEventsByDate:async a=>{try{return await Re.getEventsByDate(a)}catch{return[]}},reset:()=>r({machineAvailability:{},shuntPreview:null,splitTasksInfo:{}})}}),xu=()=>{const r=_.useCallback(c=>{if(!c||!c.department)return{isValid:!1,error:"Invalid phase data"};const{department:d}=c;if(d==="STAMPA"){const u=parseFloat(c.v_stampa);if(isNaN(u)||u<=0)return{isValid:!1,error:"Velocit di stampa non valida. Inserisci un valore maggiore di zero."}}else if(d==="CONFEZIONAMENTO"){const u=parseFloat(c.v_conf);if(isNaN(u)||u<=0)return{isValid:!1,error:"Velocit di confezionamento non valida. Inserisci un valore maggiore di zero."}}else return{isValid:!1,error:"Reparto non riconosciuto"};return{isValid:!0}},[]),e=_.useCallback((c,d,u)=>{if(!c||!d||c.department==="STAMPA"&&!u||!r(c).isValid)return null;try{const{department:g}=c;if(g==="STAMPA"){const b=parseFloat(c.v_stampa),m=parseFloat(c.t_setup_stampa)||0,y=parseFloat(c.costo_h_stampa)||0;if(isNaN(b)||b<=0)return null;const p=u*d/1e3/b,w=p+m,S=w*y;return{totals:{duration:w,cost:S},breakdown:{print:{time:p,cost:p*y},setup:{time:m,cost:m*y}}}}else if(g==="CONFEZIONAMENTO"){const b=parseFloat(c.v_conf),m=parseFloat(c.t_setup_conf)||0,y=parseFloat(c.costo_h_conf)||0;if(isNaN(b)||b<=0)return null;const v=d/b,p=m,w=v+p,S=w*y;return{totals:{duration:w,cost:S},breakdown:{package:{time:v,cost:v*y},setup:{time:p,cost:p*y}}}}return null}catch{return null}},[r]),t=_.useCallback(c=>c&&(c.startsWith("P05")||c.startsWith("ISP05"))?"BUSTO_GAROLFO":"ZANICA",[]),n=_.useCallback(c=>c&&c.startsWith("P0")?"CONFEZIONAMENTO":"STAMPA",[]),s=_.useCallback(c=>({STAMPA:["DIGITAL_PRINT","FLEXO_PRINT","ROTOGRAVURE"],CONFEZIONAMENTO:["DOYPACK","PLURI_PIU","MONO_PIU","CONFEZIONAMENTO_TRADIZIONALE","CONFEZIONAMENTO_POLVERI"]})[c]||[],[]),i=_.useCallback((c,d)=>{const f={DIGITAL_PRINT:"DIGI",FLEXO_PRINT:"FLEX",ROTOGRAVURE:"ROTO",DOYPACK:"DOYP",PLURI_PIU:"PLUR",MONO_PIU:"MONO",CONFEZIONAMENTO_TRADIZIONALE:"CONFTRAD",CONFEZIONAMENTO_POLVERI:"CONFPOL"}[c]||"MACH",g=d==="BUSTO_GAROLFO"?"BGF":"ZAN",b=Date.now().toString(36);return`${f}_${g}_${b}`},[]),a=_.useCallback((c,d)=>!(d<0||d>c),[]),o=_.useCallback((c,d)=>!c||c===0?0:Math.round(d*100/c),[]),l=_.useCallback((c,d)=>!c||c===0?0:!d||d===0?c:Math.round(c*(1-d/100)*100)/100,[]);return{calculateProductionMetrics:e,validatePhaseParameters:r,autoDetermineWorkCenter:t,autoDetermineDepartment:n,getValidMachineTypes:s,generateMachineId:i,validateQuantityCompleted:a,calculateCompletionRate:o,calculateTimeRemaining:l}};var Sa,oc;function I_(){if(oc)return Sa;oc=1;function r(v){this._maxSize=v,this.clear()}r.prototype.clear=function(){this._size=0,this._values=Object.create(null)},r.prototype.get=function(v){return this._values[v]},r.prototype.set=function(v,p){return this._size>=this._maxSize&&this.clear(),v in this._values||this._size++,this._values[v]=p};var e=/[^.^\]^[]+|(?=\[\]|\.\.)/g,t=/^\d+$/,n=/^\d/,s=/[~`!#$%\^&*+=\-\[\]\\';,/{}|\\":<>\?]/g,i=/^\s*(['"]?)(.*?)(\1)\s*$/,a=512,o=new r(a),l=new r(a),c=new r(a);Sa={Cache:r,split:u,normalizePath:d,setter:function(v){var p=d(v);return l.get(v)||l.set(v,function(S,x){for(var E=0,T=p.length,R=S;E<T-1;){var k=p[E];if(k==="__proto__"||k==="constructor"||k==="prototype")return S;R=R[p[E++]]}R[p[E]]=x})},getter:function(v,p){var w=d(v);return c.get(v)||c.set(v,function(x){for(var E=0,T=w.length;E<T;)if(x!=null||!p)x=x[w[E++]];else return;return x})},join:function(v){return v.reduce(function(p,w){return p+(g(w)||t.test(w)?"["+w+"]":(p?".":"")+w)},"")},forEach:function(v,p,w){f(Array.isArray(v)?v:u(v),p,w)}};function d(v){return o.get(v)||o.set(v,u(v).map(function(p){return p.replace(i,"$2")}))}function u(v){return v.match(e)||[""]}function f(v,p,w){var S=v.length,x,E,T,R;for(E=0;E<S;E++)x=v[E],x&&(y(x)&&(x='"'+x+'"'),R=g(x),T=!R&&/^\d+$/.test(x),p.call(w,x,R,T,E,v))}function g(v){return typeof v=="string"&&v&&["'",'"'].indexOf(v.charAt(0))!==-1}function b(v){return v.match(n)&&!v.match(t)}function m(v){return s.test(v)}function y(v){return!g(v)&&(b(v)||m(v))}return Sa}var sn=I_(),xa,lc;function M_(){if(lc)return xa;lc=1;const r=/[A-Z\xc0-\xd6\xd8-\xde]?[a-z\xdf-\xf6\xf8-\xff]+(?:['](?:d|ll|m|re|s|t|ve))?(?=[\xac\xb1\xd7\xf7\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\xbf\u2000-\u206f \t\x0b\f\xa0\ufeff\n\r\u2028\u2029\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000]|[A-Z\xc0-\xd6\xd8-\xde]|$)|(?:[A-Z\xc0-\xd6\xd8-\xde]|[^\ud800-\udfff\xac\xb1\xd7\xf7\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\xbf\u2000-\u206f \t\x0b\f\xa0\ufeff\n\r\u2028\u2029\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\d+\u2700-\u27bfa-z\xdf-\xf6\xf8-\xffA-Z\xc0-\xd6\xd8-\xde])+(?:['](?:D|LL|M|RE|S|T|VE))?(?=[\xac\xb1\xd7\xf7\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\xbf\u2000-\u206f \t\x0b\f\xa0\ufeff\n\r\u2028\u2029\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000]|[A-Z\xc0-\xd6\xd8-\xde](?:[a-z\xdf-\xf6\xf8-\xff]|[^\ud800-\udfff\xac\xb1\xd7\xf7\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\xbf\u2000-\u206f \t\x0b\f\xa0\ufeff\n\r\u2028\u2029\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\d+\u2700-\u27bfa-z\xdf-\xf6\xf8-\xffA-Z\xc0-\xd6\xd8-\xde])|$)|[A-Z\xc0-\xd6\xd8-\xde]?(?:[a-z\xdf-\xf6\xf8-\xff]|[^\ud800-\udfff\xac\xb1\xd7\xf7\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\xbf\u2000-\u206f \t\x0b\f\xa0\ufeff\n\r\u2028\u2029\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\d+\u2700-\u27bfa-z\xdf-\xf6\xf8-\xffA-Z\xc0-\xd6\xd8-\xde])+(?:['](?:d|ll|m|re|s|t|ve))?|[A-Z\xc0-\xd6\xd8-\xde]+(?:['](?:D|LL|M|RE|S|T|VE))?|\d*(?:1ST|2ND|3RD|(?![123])\dTH)(?=\b|[a-z_])|\d*(?:1st|2nd|3rd|(?![123])\dth)(?=\b|[A-Z_])|\d+|(?:[\u2700-\u27bf]|(?:\ud83c[\udde6-\uddff]){2}|[\ud800-\udbff][\udc00-\udfff])[\ufe0e\ufe0f]?(?:[\u0300-\u036f\ufe20-\ufe2f\u20d0-\u20ff]|\ud83c[\udffb-\udfff])?(?:\u200d(?:[^\ud800-\udfff]|(?:\ud83c[\udde6-\uddff]){2}|[\ud800-\udbff][\udc00-\udfff])[\ufe0e\ufe0f]?(?:[\u0300-\u036f\ufe20-\ufe2f\u20d0-\u20ff]|\ud83c[\udffb-\udfff])?)*/g,e=d=>d.match(r)||[],t=d=>d[0].toUpperCase()+d.slice(1),n=(d,u)=>e(d).join(u).toLowerCase(),s=d=>e(d).reduce((u,f)=>`${u}${u?f[0].toUpperCase()+f.slice(1).toLowerCase():f.toLowerCase()}`,"");return xa={words:e,upperFirst:t,camelCase:s,pascalCase:d=>t(s(d)),snakeCase:d=>n(d,"_"),kebabCase:d=>n(d,"-"),sentenceCase:d=>t(n(d," ")),titleCase:d=>e(d).map(t).join(" ")},xa}var Ea=M_(),Zs={exports:{}},cc;function P_(){if(cc)return Zs.exports;cc=1,Zs.exports=function(s){return r(e(s),s)},Zs.exports.array=r;function r(s,i){var a=s.length,o=new Array(a),l={},c=a,d=t(i),u=n(s);for(i.forEach(function(g){if(!u.has(g[0])||!u.has(g[1]))throw new Error("Unknown node. There is an unknown node in the supplied edges.")});c--;)l[c]||f(s[c],c,new Set);return o;function f(g,b,m){if(m.has(g)){var y;try{y=", node was:"+JSON.stringify(g)}catch{y=""}throw new Error("Cyclic dependency"+y)}if(!u.has(g))throw new Error("Found unknown node. Make sure to provided all involved nodes. Unknown node: "+JSON.stringify(g));if(!l[b]){l[b]=!0;var v=d.get(g)||new Set;if(v=Array.from(v),b=v.length){m.add(g);do{var p=v[--b];f(p,u.get(p),m)}while(b);m.delete(g)}o[--a]=g}}}function e(s){for(var i=new Set,a=0,o=s.length;a<o;a++){var l=s[a];i.add(l[0]),i.add(l[1])}return Array.from(i)}function t(s){for(var i=new Map,a=0,o=s.length;a<o;a++){var l=s[a];i.has(l[0])||i.set(l[0],new Set),i.has(l[1])||i.set(l[1],new Set),i.get(l[0]).add(l[1])}return i}function n(s){for(var i=new Map,a=0,o=s.length;a<o;a++)i.set(s[a],a);return i}return Zs.exports}var j_=P_();const L_=co(j_),$_=Object.prototype.toString,F_=Error.prototype.toString,U_=RegExp.prototype.toString,H_=typeof Symbol<"u"?Symbol.prototype.toString:()=>"",B_=/^Symbol\((.*)\)(.*)$/;function z_(r){return r!=+r?"NaN":r===0&&1/r<0?"-0":""+r}function dc(r,e=!1){if(r==null||r===!0||r===!1)return""+r;const t=typeof r;if(t==="number")return z_(r);if(t==="string")return e?`"${r}"`:r;if(t==="function")return"[Function "+(r.name||"anonymous")+"]";if(t==="symbol")return H_.call(r).replace(B_,"Symbol($1)");const n=$_.call(r).slice(8,-1);return n==="Date"?isNaN(r.getTime())?""+r:r.toISOString(r):n==="Error"||r instanceof Error?"["+F_.call(r)+"]":n==="RegExp"?U_.call(r):null}function Tr(r,e){let t=dc(r,e);return t!==null?t:JSON.stringify(r,function(n,s){let i=dc(this[n],e);return i!==null?i:s},2)}function Eu(r){return r==null?[]:[].concat(r)}let Tu,Ru,Ou,W_=/\$\{\s*(\w+)\s*\}/g;Tu=Symbol.toStringTag;class uc{constructor(e,t,n,s){this.name=void 0,this.message=void 0,this.value=void 0,this.path=void 0,this.type=void 0,this.params=void 0,this.errors=void 0,this.inner=void 0,this[Tu]="Error",this.name="ValidationError",this.value=t,this.path=n,this.type=s,this.errors=[],this.inner=[],Eu(e).forEach(i=>{if(Rt.isError(i)){this.errors.push(...i.errors);const a=i.inner.length?i.inner:[i];this.inner.push(...a)}else this.errors.push(i)}),this.message=this.errors.length>1?`${this.errors.length} errors occurred`:this.errors[0]}}Ru=Symbol.hasInstance;Ou=Symbol.toStringTag;class Rt extends Error{static formatError(e,t){const n=t.label||t.path||"this";return t=Object.assign({},t,{path:n,originalPath:t.path}),typeof e=="string"?e.replace(W_,(s,i)=>Tr(t[i])):typeof e=="function"?e(t):e}static isError(e){return e&&e.name==="ValidationError"}constructor(e,t,n,s,i){const a=new uc(e,t,n,s);if(i)return a;super(),this.value=void 0,this.path=void 0,this.type=void 0,this.params=void 0,this.errors=[],this.inner=[],this[Ou]="Error",this.name=a.name,this.message=a.message,this.type=a.type,this.value=a.value,this.path=a.path,this.errors=a.errors,this.inner=a.inner,Error.captureStackTrace&&Error.captureStackTrace(this,Rt)}static[Ru](e){return uc[Symbol.hasInstance](e)||super[Symbol.hasInstance](e)}}let cr={default:"${path} is invalid",required:"${path} is a required field",defined:"${path} must be defined",notNull:"${path} cannot be null",oneOf:"${path} must be one of the following values: ${values}",notOneOf:"${path} must not be one of the following values: ${values}",notType:({path:r,type:e,value:t,originalValue:n})=>{const s=n!=null&&n!==t?` (cast from the value \`${Tr(n,!0)}\`).`:".";return e!=="mixed"?`${r} must be a \`${e}\` type, but the final value was: \`${Tr(t,!0)}\``+s:`${r} must match the configured type. The validated value was: \`${Tr(t,!0)}\``+s}},Ct={length:"${path} must be exactly ${length} characters",min:"${path} must be at least ${min} characters",max:"${path} must be at most ${max} characters",matches:'${path} must match the following: "${regex}"',email:"${path} must be a valid email",url:"${path} must be a valid URL",uuid:"${path} must be a valid UUID",datetime:"${path} must be a valid ISO date-time",datetime_precision:"${path} must be a valid ISO date-time with a sub-second precision of exactly ${precision} digits",datetime_offset:'${path} must be a valid ISO date-time with UTC "Z" timezone',trim:"${path} must be a trimmed string",lowercase:"${path} must be a lowercase string",uppercase:"${path} must be a upper case string"},Lr={min:"${path} must be greater than or equal to ${min}",max:"${path} must be less than or equal to ${max}",lessThan:"${path} must be less than ${less}",moreThan:"${path} must be greater than ${more}",positive:"${path} must be a positive number",negative:"${path} must be a negative number",integer:"${path} must be an integer"},ro={min:"${path} field must be later than ${min}",max:"${path} field must be at earlier than ${max}"},q_={isValue:"${path} field must be ${value}"},ai={noUnknown:"${path} field has unspecified keys: ${unknown}",exact:"${path} object contains unknown properties: ${properties}"},oi={min:"${path} field must have at least ${min} items",max:"${path} field must have less than or equal to ${max} items",length:"${path} must have ${length} items"},V_={notType:r=>{const{path:e,value:t,spec:n}=r,s=n.types.length;if(Array.isArray(t)){if(t.length<s)return`${e} tuple value has too few items, expected a length of ${s} but got ${t.length} for value: \`${Tr(t,!0)}\``;if(t.length>s)return`${e} tuple value has too many items, expected a length of ${s} but got ${t.length} for value: \`${Tr(t,!0)}\``}return Rt.formatError(cr.notType,r)}};Object.assign(Object.create(null),{mixed:cr,string:Ct,number:Lr,date:ro,object:ai,array:oi,boolean:q_,tuple:V_});const zi=r=>r&&r.__isYupSchema__;class wi{static fromOptions(e,t){if(!t.then&&!t.otherwise)throw new TypeError("either `then:` or `otherwise:` is required for `when()` conditions");let{is:n,then:s,otherwise:i}=t,a=typeof n=="function"?n:(...o)=>o.every(l=>l===n);return new wi(e,(o,l)=>{var c;let d=a(...o)?s:i;return(c=d?.(l))!=null?c:l})}constructor(e,t){this.fn=void 0,this.refs=e,this.refs=e,this.fn=t}resolve(e,t){let n=this.refs.map(i=>i.getValue(t?.value,t?.parent,t?.context)),s=this.fn(n,e,t);if(s===void 0||s===e)return e;if(!zi(s))throw new TypeError("conditions must return a schema object");return s.resolve(t)}}const ei={context:"$",value:"."};class un{constructor(e,t={}){if(this.key=void 0,this.isContext=void 0,this.isValue=void 0,this.isSibling=void 0,this.path=void 0,this.getter=void 0,this.map=void 0,typeof e!="string")throw new TypeError("ref must be a string, got: "+e);if(this.key=e.trim(),e==="")throw new TypeError("ref must be a non-empty string");this.isContext=this.key[0]===ei.context,this.isValue=this.key[0]===ei.value,this.isSibling=!this.isContext&&!this.isValue;let n=this.isContext?ei.context:this.isValue?ei.value:"";this.path=this.key.slice(n.length),this.getter=this.path&&sn.getter(this.path,!0),this.map=t.map}getValue(e,t,n){let s=this.isContext?n:this.isValue?e:t;return this.getter&&(s=this.getter(s||{})),this.map&&(s=this.map(s)),s}cast(e,t){return this.getValue(e,t?.parent,t?.context)}resolve(){return this}describe(){return{type:"ref",key:this.key}}toString(){return`Ref(${this.key})`}static isRef(e){return e&&e.__isYupRef}}un.prototype.__isYupRef=!0;const xr=r=>r==null;function _n(r){function e({value:t,path:n="",options:s,originalValue:i,schema:a},o,l){const{name:c,test:d,params:u,message:f,skipAbsent:g}=r;let{parent:b,context:m,abortEarly:y=a.spec.abortEarly,disableStackTrace:v=a.spec.disableStackTrace}=s;const p={value:t,parent:b,context:m};function w(D={}){const A=Cu(Object.assign({value:t,originalValue:i,label:a.spec.label,path:D.path||n,spec:a.spec,disableStackTrace:D.disableStackTrace||v},u,D.params),p),P=new Rt(Rt.formatError(D.message||f,A),t,A.path,D.type||c,A.disableStackTrace);return P.params=A,P}const S=y?o:l;let x={path:n,parent:b,type:c,from:s.from,createError:w,resolve(D){return ku(D,p)},options:s,originalValue:i,schema:a};const E=D=>{Rt.isError(D)?S(D):D?l(null):S(w())},T=D=>{Rt.isError(D)?S(D):o(D)};if(g&&xr(t))return E(!0);let k;try{var O;if(k=d.call(x,t,x),typeof((O=k)==null?void 0:O.then)=="function"){if(s.sync)throw new Error(`Validation test of type: "${x.type}" returned a Promise during a synchronous validate. This test will finish after the validate call has returned`);return Promise.resolve(k).then(E,T)}}catch(D){T(D);return}E(k)}return e.OPTIONS=r,e}function Cu(r,e){if(!r)return r;for(const t of Object.keys(r))r[t]=ku(r[t],e);return r}function ku(r,e){return un.isRef(r)?r.getValue(e.value,e.parent,e.context):r}function G_(r,e,t,n=t){let s,i,a;return e?(sn.forEach(e,(o,l,c)=>{let d=l?o.slice(1,o.length-1):o;r=r.resolve({context:n,parent:s,value:t});let u=r.type==="tuple",f=c?parseInt(d,10):0;if(r.innerType||u){if(u&&!c)throw new Error(`Yup.reach cannot implicitly index into a tuple type. the path part "${a}" must contain an index to the tuple element, e.g. "${a}[0]"`);if(t&&f>=t.length)throw new Error(`Yup.reach cannot resolve an array item at index: ${o}, in the path: ${e}. because there is no value at that index. `);s=t,t=t&&t[f],r=u?r.spec.types[f]:r.innerType}if(!c){if(!r.fields||!r.fields[d])throw new Error(`The schema does not contain the path: ${e}. (failed at: ${a} which is a type: "${r.type}")`);s=t,t=t&&t[d],r=r.fields[d]}i=d,a=l?"["+o+"]":"."+o}),{schema:r,parent:s,parentPath:i}):{parent:s,parentPath:e,schema:r}}class _i extends Set{describe(){const e=[];for(const t of this.values())e.push(un.isRef(t)?t.describe():t);return e}resolveAll(e){let t=[];for(const n of this.values())t.push(e(n));return t}clone(){return new _i(this.values())}merge(e,t){const n=this.clone();return e.forEach(s=>n.add(s)),t.forEach(s=>n.delete(s)),n}}function Rn(r,e=new Map){if(zi(r)||!r||typeof r!="object")return r;if(e.has(r))return e.get(r);let t;if(r instanceof Date)t=new Date(r.getTime()),e.set(r,t);else if(r instanceof RegExp)t=new RegExp(r),e.set(r,t);else if(Array.isArray(r)){t=new Array(r.length),e.set(r,t);for(let n=0;n<r.length;n++)t[n]=Rn(r[n],e)}else if(r instanceof Map){t=new Map,e.set(r,t);for(const[n,s]of r.entries())t.set(n,Rn(s,e))}else if(r instanceof Set){t=new Set,e.set(r,t);for(const n of r)t.add(Rn(n,e))}else if(r instanceof Object){t={},e.set(r,t);for(const[n,s]of Object.entries(r))t[n]=Rn(s,e)}else throw Error(`Unable to clone ${r}`);return t}function K_(r){if(!(r!=null&&r.length))return;const e=[];let t="",n=!1,s=!1;for(let i=0;i<r.length;i++){const a=r[i];if(a==="["&&!s){t&&(e.push(...t.split(".").filter(Boolean)),t=""),n=!0;continue}if(a==="]"&&!s){t&&(/^\d+$/.test(t)?e.push(t):e.push(t.replace(/^"|"$/g,"")),t=""),n=!1;continue}if(a==='"'){s=!s;continue}if(a==="."&&!n&&!s){t&&(e.push(t),t="");continue}t+=a}return t&&e.push(...t.split(".").filter(Boolean)),e}function Y_(r,e){const t=e?`${e}.${r.path}`:r.path;return r.errors.map(n=>({message:n,path:K_(t)}))}function Du(r,e){var t;if(!((t=r.inner)!=null&&t.length)&&r.errors.length)return Y_(r,e);const n=e?`${e}.${r.path}`:r.path;return r.inner.flatMap(s=>Du(s,n))}class Gt{constructor(e){this.type=void 0,this.deps=[],this.tests=void 0,this.transforms=void 0,this.conditions=[],this._mutate=void 0,this.internalTests={},this._whitelist=new _i,this._blacklist=new _i,this.exclusiveTests=Object.create(null),this._typeCheck=void 0,this.spec=void 0,this.tests=[],this.transforms=[],this.withMutation(()=>{this.typeError(cr.notType)}),this.type=e.type,this._typeCheck=e.check,this.spec=Object.assign({strip:!1,strict:!1,abortEarly:!0,recursive:!0,disableStackTrace:!1,nullable:!1,optional:!0,coerce:!0},e?.spec),this.withMutation(t=>{t.nonNullable()})}get _type(){return this.type}clone(e){if(this._mutate)return e&&Object.assign(this.spec,e),this;const t=Object.create(Object.getPrototypeOf(this));return t.type=this.type,t._typeCheck=this._typeCheck,t._whitelist=this._whitelist.clone(),t._blacklist=this._blacklist.clone(),t.internalTests=Object.assign({},this.internalTests),t.exclusiveTests=Object.assign({},this.exclusiveTests),t.deps=[...this.deps],t.conditions=[...this.conditions],t.tests=[...this.tests],t.transforms=[...this.transforms],t.spec=Rn(Object.assign({},this.spec,e)),t}label(e){let t=this.clone();return t.spec.label=e,t}meta(...e){if(e.length===0)return this.spec.meta;let t=this.clone();return t.spec.meta=Object.assign(t.spec.meta||{},e[0]),t}withMutation(e){let t=this._mutate;this._mutate=!0;let n=e(this);return this._mutate=t,n}concat(e){if(!e||e===this)return this;if(e.type!==this.type&&this.type!=="mixed")throw new TypeError(`You cannot \`concat()\` schema's of different types: ${this.type} and ${e.type}`);let t=this,n=e.clone();const s=Object.assign({},t.spec,n.spec);return n.spec=s,n.internalTests=Object.assign({},t.internalTests,n.internalTests),n._whitelist=t._whitelist.merge(e._whitelist,e._blacklist),n._blacklist=t._blacklist.merge(e._blacklist,e._whitelist),n.tests=t.tests,n.exclusiveTests=t.exclusiveTests,n.withMutation(i=>{e.tests.forEach(a=>{i.test(a.OPTIONS)})}),n.transforms=[...t.transforms,...n.transforms],n}isType(e){return e==null?!!(this.spec.nullable&&e===null||this.spec.optional&&e===void 0):this._typeCheck(e)}resolve(e){let t=this;if(t.conditions.length){let n=t.conditions;t=t.clone(),t.conditions=[],t=n.reduce((s,i)=>i.resolve(s,e),t),t=t.resolve(e)}return t}resolveOptions(e){var t,n,s,i;return Object.assign({},e,{from:e.from||[],strict:(t=e.strict)!=null?t:this.spec.strict,abortEarly:(n=e.abortEarly)!=null?n:this.spec.abortEarly,recursive:(s=e.recursive)!=null?s:this.spec.recursive,disableStackTrace:(i=e.disableStackTrace)!=null?i:this.spec.disableStackTrace})}cast(e,t={}){let n=this.resolve(Object.assign({},t,{value:e})),s=t.assert==="ignore-optionality",i=n._cast(e,t);if(t.assert!==!1&&!n.isType(i)){if(s&&xr(i))return i;let a=Tr(e),o=Tr(i);throw new TypeError(`The value of ${t.path||"field"} could not be cast to a value that satisfies the schema type: "${n.type}". 

attempted value: ${a} 
`+(o!==a?`result of cast: ${o}`:""))}return i}_cast(e,t){let n=e===void 0?e:this.transforms.reduce((s,i)=>i.call(this,s,e,this,t),e);return n===void 0&&(n=this.getDefault(t)),n}_validate(e,t={},n,s){let{path:i,originalValue:a=e,strict:o=this.spec.strict}=t,l=e;o||(l=this._cast(l,Object.assign({assert:!1},t)));let c=[];for(let d of Object.values(this.internalTests))d&&c.push(d);this.runTests({path:i,value:l,originalValue:a,options:t,tests:c},n,d=>{if(d.length)return s(d,l);this.runTests({path:i,value:l,originalValue:a,options:t,tests:this.tests},n,s)})}runTests(e,t,n){let s=!1,{tests:i,value:a,originalValue:o,path:l,options:c}=e,d=m=>{s||(s=!0,t(m,a))},u=m=>{s||(s=!0,n(m,a))},f=i.length,g=[];if(!f)return u([]);let b={value:a,originalValue:o,path:l,options:c,schema:this};for(let m=0;m<i.length;m++){const y=i[m];y(b,d,function(p){p&&(Array.isArray(p)?g.push(...p):g.push(p)),--f<=0&&u(g)})}}asNestedTest({key:e,index:t,parent:n,parentPath:s,originalParent:i,options:a}){const o=e??t;if(o==null)throw TypeError("Must include `key` or `index` for nested validations");const l=typeof o=="number";let c=n[o];const d=Object.assign({},a,{strict:!0,parent:n,value:c,originalValue:i[o],key:void 0,[l?"index":"key"]:o,path:l||o.includes(".")?`${s||""}[${l?o:`"${o}"`}]`:(s?`${s}.`:"")+e});return(u,f,g)=>this.resolve(d)._validate(c,d,f,g)}validate(e,t){var n;let s=this.resolve(Object.assign({},t,{value:e})),i=(n=t?.disableStackTrace)!=null?n:s.spec.disableStackTrace;return new Promise((a,o)=>s._validate(e,t,(l,c)=>{Rt.isError(l)&&(l.value=c),o(l)},(l,c)=>{l.length?o(new Rt(l,c,void 0,void 0,i)):a(c)}))}validateSync(e,t){var n;let s=this.resolve(Object.assign({},t,{value:e})),i,a=(n=t?.disableStackTrace)!=null?n:s.spec.disableStackTrace;return s._validate(e,Object.assign({},t,{sync:!0}),(o,l)=>{throw Rt.isError(o)&&(o.value=l),o},(o,l)=>{if(o.length)throw new Rt(o,e,void 0,void 0,a);i=l}),i}isValid(e,t){return this.validate(e,t).then(()=>!0,n=>{if(Rt.isError(n))return!1;throw n})}isValidSync(e,t){try{return this.validateSync(e,t),!0}catch(n){if(Rt.isError(n))return!1;throw n}}_getDefault(e){let t=this.spec.default;return t==null?t:typeof t=="function"?t.call(this,e):Rn(t)}getDefault(e){return this.resolve(e||{})._getDefault(e)}default(e){return arguments.length===0?this._getDefault():this.clone({default:e})}strict(e=!0){return this.clone({strict:e})}nullability(e,t){const n=this.clone({nullable:e});return n.internalTests.nullable=_n({message:t,name:"nullable",test(s){return s===null?this.schema.spec.nullable:!0}}),n}optionality(e,t){const n=this.clone({optional:e});return n.internalTests.optionality=_n({message:t,name:"optionality",test(s){return s===void 0?this.schema.spec.optional:!0}}),n}optional(){return this.optionality(!0)}defined(e=cr.defined){return this.optionality(!1,e)}nullable(){return this.nullability(!0)}nonNullable(e=cr.notNull){return this.nullability(!1,e)}required(e=cr.required){return this.clone().withMutation(t=>t.nonNullable(e).defined(e))}notRequired(){return this.clone().withMutation(e=>e.nullable().optional())}transform(e){let t=this.clone();return t.transforms.push(e),t}test(...e){let t;if(e.length===1?typeof e[0]=="function"?t={test:e[0]}:t=e[0]:e.length===2?t={name:e[0],test:e[1]}:t={name:e[0],message:e[1],test:e[2]},t.message===void 0&&(t.message=cr.default),typeof t.test!="function")throw new TypeError("`test` is a required parameters");let n=this.clone(),s=_n(t),i=t.exclusive||t.name&&n.exclusiveTests[t.name]===!0;if(t.exclusive&&!t.name)throw new TypeError("Exclusive tests must provide a unique `name` identifying the test");return t.name&&(n.exclusiveTests[t.name]=!!t.exclusive),n.tests=n.tests.filter(a=>!(a.OPTIONS.name===t.name&&(i||a.OPTIONS.test===s.OPTIONS.test))),n.tests.push(s),n}when(e,t){!Array.isArray(e)&&typeof e!="string"&&(t=e,e=".");let n=this.clone(),s=Eu(e).map(i=>new un(i));return s.forEach(i=>{i.isSibling&&n.deps.push(i.key)}),n.conditions.push(typeof t=="function"?new wi(s,t):wi.fromOptions(s,t)),n}typeError(e){let t=this.clone();return t.internalTests.typeError=_n({message:e,name:"typeError",skipAbsent:!0,test(n){return this.schema._typeCheck(n)?!0:this.createError({params:{type:this.schema.type}})}}),t}oneOf(e,t=cr.oneOf){let n=this.clone();return e.forEach(s=>{n._whitelist.add(s),n._blacklist.delete(s)}),n.internalTests.whiteList=_n({message:t,name:"oneOf",skipAbsent:!0,test(s){let i=this.schema._whitelist,a=i.resolveAll(this.resolve);return a.includes(s)?!0:this.createError({params:{values:Array.from(i).join(", "),resolved:a}})}}),n}notOneOf(e,t=cr.notOneOf){let n=this.clone();return e.forEach(s=>{n._blacklist.add(s),n._whitelist.delete(s)}),n.internalTests.blacklist=_n({message:t,name:"notOneOf",test(s){let i=this.schema._blacklist,a=i.resolveAll(this.resolve);return a.includes(s)?this.createError({params:{values:Array.from(i).join(", "),resolved:a}}):!0}}),n}strip(e=!0){let t=this.clone();return t.spec.strip=e,t}describe(e){const t=(e?this.resolve(e):this).clone(),{label:n,meta:s,optional:i,nullable:a}=t.spec;return{meta:s,label:n,optional:i,nullable:a,default:t.getDefault(e),type:t.type,oneOf:t._whitelist.describe(),notOneOf:t._blacklist.describe(),tests:t.tests.filter((l,c,d)=>d.findIndex(u=>u.OPTIONS.name===l.OPTIONS.name)===c).map(l=>{const c=l.OPTIONS.params&&e?Cu(Object.assign({},l.OPTIONS.params),e):l.OPTIONS.params;return{name:l.OPTIONS.name,params:c}})}}get"~standard"(){const e=this;return{version:1,vendor:"yup",async validate(n){try{return{value:await e.validate(n,{abortEarly:!1})}}catch(s){if(s instanceof Rt)return{issues:Du(s)};throw s}}}}}Gt.prototype.__isYupSchema__=!0;for(const r of["validate","validateSync"])Gt.prototype[`${r}At`]=function(e,t,n={}){const{parent:s,parentPath:i,schema:a}=G_(this,e,t,n.context);return a[r](s&&s[i],Object.assign({},n,{parent:s,path:e}))};for(const r of["equals","is"])Gt.prototype[r]=Gt.prototype.oneOf;for(const r of["not","nope"])Gt.prototype[r]=Gt.prototype.notOneOf;const X_=/^(\d{4}|[+-]\d{6})(?:-?(\d{2})(?:-?(\d{2}))?)?(?:[ T]?(\d{2}):?(\d{2})(?::?(\d{2})(?:[,.](\d{1,}))?)?(?:(Z)|([+-])(\d{2})(?::?(\d{2}))?)?)?$/;function Q_(r){const e=no(r);if(!e)return Date.parse?Date.parse(r):Number.NaN;if(e.z===void 0&&e.plusMinus===void 0)return new Date(e.year,e.month,e.day,e.hour,e.minute,e.second,e.millisecond).valueOf();let t=0;return e.z!=="Z"&&e.plusMinus!==void 0&&(t=e.hourOffset*60+e.minuteOffset,e.plusMinus==="+"&&(t=0-t)),Date.UTC(e.year,e.month,e.day,e.hour,e.minute+t,e.second,e.millisecond)}function no(r){var e,t;const n=X_.exec(r);return n?{year:yr(n[1]),month:yr(n[2],1)-1,day:yr(n[3],1),hour:yr(n[4]),minute:yr(n[5]),second:yr(n[6]),millisecond:n[7]?yr(n[7].substring(0,3)):0,precision:(e=(t=n[7])==null?void 0:t.length)!=null?e:void 0,z:n[8]||void 0,plusMinus:n[9]||void 0,hourOffset:yr(n[10]),minuteOffset:yr(n[11])}:null}function yr(r,e=0){return Number(r)||e}let J_=/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,Z_=/^((https?|ftp):)?\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i,eS=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,tS="^\\d{4}-\\d{2}-\\d{2}",rS="\\d{2}:\\d{2}:\\d{2}",nS="(([+-]\\d{2}(:?\\d{2})?)|Z)",sS=new RegExp(`${tS}T${rS}(\\.\\d+)?${nS}$`),iS=r=>xr(r)||r===r.trim(),aS={}.toString();function kt(){return new Nu}class Nu extends Gt{constructor(){super({type:"string",check(e){return e instanceof String&&(e=e.valueOf()),typeof e=="string"}}),this.withMutation(()=>{this.transform((e,t)=>{if(!this.spec.coerce||this.isType(e)||Array.isArray(e))return e;const n=e!=null&&e.toString?e.toString():e;return n===aS?e:n})})}required(e){return super.required(e).withMutation(t=>t.test({message:e||cr.required,name:"required",skipAbsent:!0,test:n=>!!n.length}))}notRequired(){return super.notRequired().withMutation(e=>(e.tests=e.tests.filter(t=>t.OPTIONS.name!=="required"),e))}length(e,t=Ct.length){return this.test({message:t,name:"length",exclusive:!0,params:{length:e},skipAbsent:!0,test(n){return n.length===this.resolve(e)}})}min(e,t=Ct.min){return this.test({message:t,name:"min",exclusive:!0,params:{min:e},skipAbsent:!0,test(n){return n.length>=this.resolve(e)}})}max(e,t=Ct.max){return this.test({name:"max",exclusive:!0,message:t,params:{max:e},skipAbsent:!0,test(n){return n.length<=this.resolve(e)}})}matches(e,t){let n=!1,s,i;return t&&(typeof t=="object"?{excludeEmptyString:n=!1,message:s,name:i}=t:s=t),this.test({name:i||"matches",message:s||Ct.matches,params:{regex:e},skipAbsent:!0,test:a=>a===""&&n||a.search(e)!==-1})}email(e=Ct.email){return this.matches(J_,{name:"email",message:e,excludeEmptyString:!0})}url(e=Ct.url){return this.matches(Z_,{name:"url",message:e,excludeEmptyString:!0})}uuid(e=Ct.uuid){return this.matches(eS,{name:"uuid",message:e,excludeEmptyString:!1})}datetime(e){let t="",n,s;return e&&(typeof e=="object"?{message:t="",allowOffset:n=!1,precision:s=void 0}=e:t=e),this.matches(sS,{name:"datetime",message:t||Ct.datetime,excludeEmptyString:!0}).test({name:"datetime_offset",message:t||Ct.datetime_offset,params:{allowOffset:n},skipAbsent:!0,test:i=>{if(!i||n)return!0;const a=no(i);return a?!!a.z:!1}}).test({name:"datetime_precision",message:t||Ct.datetime_precision,params:{precision:s},skipAbsent:!0,test:i=>{if(!i||s==null)return!0;const a=no(i);return a?a.precision===s:!1}})}ensure(){return this.default("").transform(e=>e===null?"":e)}trim(e=Ct.trim){return this.transform(t=>t!=null?t.trim():t).test({message:e,name:"trim",test:iS})}lowercase(e=Ct.lowercase){return this.transform(t=>xr(t)?t:t.toLowerCase()).test({message:e,name:"string_case",exclusive:!0,skipAbsent:!0,test:t=>xr(t)||t===t.toLowerCase()})}uppercase(e=Ct.uppercase){return this.transform(t=>xr(t)?t:t.toUpperCase()).test({message:e,name:"string_case",exclusive:!0,skipAbsent:!0,test:t=>xr(t)||t===t.toUpperCase()})}}kt.prototype=Nu.prototype;let oS=r=>r!=+r;function nt(){return new Au}class Au extends Gt{constructor(){super({type:"number",check(e){return e instanceof Number&&(e=e.valueOf()),typeof e=="number"&&!oS(e)}}),this.withMutation(()=>{this.transform((e,t)=>{if(!this.spec.coerce)return e;let n=e;if(typeof n=="string"){if(n=n.replace(/\s/g,""),n==="")return NaN;n=+n}return this.isType(n)||n===null?n:parseFloat(n)})})}min(e,t=Lr.min){return this.test({message:t,name:"min",exclusive:!0,params:{min:e},skipAbsent:!0,test(n){return n>=this.resolve(e)}})}max(e,t=Lr.max){return this.test({message:t,name:"max",exclusive:!0,params:{max:e},skipAbsent:!0,test(n){return n<=this.resolve(e)}})}lessThan(e,t=Lr.lessThan){return this.test({message:t,name:"max",exclusive:!0,params:{less:e},skipAbsent:!0,test(n){return n<this.resolve(e)}})}moreThan(e,t=Lr.moreThan){return this.test({message:t,name:"min",exclusive:!0,params:{more:e},skipAbsent:!0,test(n){return n>this.resolve(e)}})}positive(e=Lr.positive){return this.moreThan(0,e)}negative(e=Lr.negative){return this.lessThan(0,e)}integer(e=Lr.integer){return this.test({name:"integer",message:e,skipAbsent:!0,test:t=>Number.isInteger(t)})}truncate(){return this.transform(e=>xr(e)?e:e|0)}round(e){var t;let n=["ceil","floor","round","trunc"];if(e=((t=e)==null?void 0:t.toLowerCase())||"round",e==="trunc")return this.truncate();if(n.indexOf(e.toLowerCase())===-1)throw new TypeError("Only valid options for round() are: "+n.join(", "));return this.transform(s=>xr(s)?s:Math[e](s))}}nt.prototype=Au.prototype;let Iu=new Date(""),lS=r=>Object.prototype.toString.call(r)==="[object Date]";function os(){return new Os}class Os extends Gt{constructor(){super({type:"date",check(e){return lS(e)&&!isNaN(e.getTime())}}),this.withMutation(()=>{this.transform((e,t)=>!this.spec.coerce||this.isType(e)||e===null?e:(e=Q_(e),isNaN(e)?Os.INVALID_DATE:new Date(e)))})}prepareParam(e,t){let n;if(un.isRef(e))n=e;else{let s=this.cast(e);if(!this._typeCheck(s))throw new TypeError(`\`${t}\` must be a Date or a value that can be \`cast()\` to a Date`);n=s}return n}min(e,t=ro.min){let n=this.prepareParam(e,"min");return this.test({message:t,name:"min",exclusive:!0,params:{min:e},skipAbsent:!0,test(s){return s>=this.resolve(n)}})}max(e,t=ro.max){let n=this.prepareParam(e,"max");return this.test({message:t,name:"max",exclusive:!0,params:{max:e},skipAbsent:!0,test(s){return s<=this.resolve(n)}})}}Os.INVALID_DATE=Iu;os.prototype=Os.prototype;os.INVALID_DATE=Iu;function cS(r,e=[]){let t=[],n=new Set,s=new Set(e.map(([a,o])=>`${a}-${o}`));function i(a,o){let l=sn.split(a)[0];n.add(l),s.has(`${o}-${l}`)||t.push([o,l])}for(const a of Object.keys(r)){let o=r[a];n.add(a),un.isRef(o)&&o.isSibling?i(o.path,a):zi(o)&&"deps"in o&&o.deps.forEach(l=>i(l,a))}return L_.array(Array.from(n),t).reverse()}function hc(r,e){let t=1/0;return r.some((n,s)=>{var i;if((i=e.path)!=null&&i.includes(n))return t=s,!0}),t}function Mu(r){return(e,t)=>hc(r,e)-hc(r,t)}const Pu=(r,e,t)=>{if(typeof r!="string")return r;let n=r;try{n=JSON.parse(r)}catch{}return t.isType(n)?n:r};function li(r){if("fields"in r){const e={};for(const[t,n]of Object.entries(r.fields))e[t]=li(n);return r.setFields(e)}if(r.type==="array"){const e=r.optional();return e.innerType&&(e.innerType=li(e.innerType)),e}return r.type==="tuple"?r.optional().clone({types:r.spec.types.map(li)}):"optional"in r?r.optional():r}const dS=(r,e)=>{const t=[...sn.normalizePath(e)];if(t.length===1)return t[0]in r;let n=t.pop(),s=sn.getter(sn.join(t),!0)(r);return!!(s&&n in s)};let fc=r=>Object.prototype.toString.call(r)==="[object Object]";function gc(r,e){let t=Object.keys(r.fields);return Object.keys(e).filter(n=>t.indexOf(n)===-1)}const uS=Mu([]);function Wr(r){return new ju(r)}class ju extends Gt{constructor(e){super({type:"object",check(t){return fc(t)||typeof t=="function"}}),this.fields=Object.create(null),this._sortErrors=uS,this._nodes=[],this._excludedEdges=[],this.withMutation(()=>{e&&this.shape(e)})}_cast(e,t={}){var n;let s=super._cast(e,t);if(s===void 0)return this.getDefault(t);if(!this._typeCheck(s))return s;let i=this.fields,a=(n=t.stripUnknown)!=null?n:this.spec.noUnknown,o=[].concat(this._nodes,Object.keys(s).filter(u=>!this._nodes.includes(u))),l={},c=Object.assign({},t,{parent:l,__validating:t.__validating||!1}),d=!1;for(const u of o){let f=i[u],g=u in s,b=s[u];if(f){let m;c.path=(t.path?`${t.path}.`:"")+u,f=f.resolve({value:b,context:t.context,parent:l});let y=f instanceof Gt?f.spec:void 0,v=y?.strict;if(y!=null&&y.strip){d=d||u in s;continue}m=!t.__validating||!v?f.cast(b,c):b,m!==void 0&&(l[u]=m)}else g&&!a&&(l[u]=b);(g!==u in l||l[u]!==b)&&(d=!0)}return d?l:s}_validate(e,t={},n,s){let{from:i=[],originalValue:a=e,recursive:o=this.spec.recursive}=t;t.from=[{schema:this,value:a},...i],t.__validating=!0,t.originalValue=a,super._validate(e,t,n,(l,c)=>{if(!o||!fc(c)){s(l,c);return}a=a||c;let d=[];for(let u of this._nodes){let f=this.fields[u];!f||un.isRef(f)||d.push(f.asNestedTest({options:t,key:u,parent:c,parentPath:t.path,originalParent:a}))}this.runTests({tests:d,value:c,originalValue:a,options:t},n,u=>{s(u.sort(this._sortErrors).concat(l),c)})})}clone(e){const t=super.clone(e);return t.fields=Object.assign({},this.fields),t._nodes=this._nodes,t._excludedEdges=this._excludedEdges,t._sortErrors=this._sortErrors,t}concat(e){let t=super.concat(e),n=t.fields;for(let[s,i]of Object.entries(this.fields)){const a=n[s];n[s]=a===void 0?i:a}return t.withMutation(s=>s.setFields(n,[...this._excludedEdges,...e._excludedEdges]))}_getDefault(e){if("default"in this.spec)return super._getDefault(e);if(!this._nodes.length)return;let t={};return this._nodes.forEach(n=>{var s;const i=this.fields[n];let a=e;(s=a)!=null&&s.value&&(a=Object.assign({},a,{parent:a.value,value:a.value[n]})),t[n]=i&&"getDefault"in i?i.getDefault(a):void 0}),t}setFields(e,t){let n=this.clone();return n.fields=e,n._nodes=cS(e,t),n._sortErrors=Mu(Object.keys(e)),t&&(n._excludedEdges=t),n}shape(e,t=[]){return this.clone().withMutation(n=>{let s=n._excludedEdges;return t.length&&(Array.isArray(t[0])||(t=[t]),s=[...n._excludedEdges,...t]),n.setFields(Object.assign(n.fields,e),s)})}partial(){const e={};for(const[t,n]of Object.entries(this.fields))e[t]="optional"in n&&n.optional instanceof Function?n.optional():n;return this.setFields(e)}deepPartial(){return li(this)}pick(e){const t={};for(const n of e)this.fields[n]&&(t[n]=this.fields[n]);return this.setFields(t,this._excludedEdges.filter(([n,s])=>e.includes(n)&&e.includes(s)))}omit(e){const t=[];for(const n of Object.keys(this.fields))e.includes(n)||t.push(n);return this.pick(t)}from(e,t,n){let s=sn.getter(e,!0);return this.transform(i=>{if(!i)return i;let a=i;return dS(i,e)&&(a=Object.assign({},i),n||delete a[e],a[t]=s(i)),a})}json(){return this.transform(Pu)}exact(e){return this.test({name:"exact",exclusive:!0,message:e||ai.exact,test(t){if(t==null)return!0;const n=gc(this.schema,t);return n.length===0||this.createError({params:{properties:n.join(", ")}})}})}stripUnknown(){return this.clone({noUnknown:!0})}noUnknown(e=!0,t=ai.noUnknown){typeof e!="boolean"&&(t=e,e=!0);let n=this.test({name:"noUnknown",exclusive:!0,message:t,test(s){if(s==null)return!0;const i=gc(this.schema,s);return!e||i.length===0||this.createError({params:{unknown:i.join(", ")}})}});return n.spec.noUnknown=e,n}unknown(e=!0,t=ai.noUnknown){return this.noUnknown(!e,t)}transformKeys(e){return this.transform(t=>{if(!t)return t;const n={};for(const s of Object.keys(t))n[e(s)]=t[s];return n})}camelCase(){return this.transformKeys(Ea.camelCase)}snakeCase(){return this.transformKeys(Ea.snakeCase)}constantCase(){return this.transformKeys(e=>Ea.snakeCase(e).toUpperCase())}describe(e){const t=(e?this.resolve(e):this).clone(),n=super.describe(e);n.fields={};for(const[i,a]of Object.entries(t.fields)){var s;let o=e;(s=o)!=null&&s.value&&(o=Object.assign({},o,{parent:o.value,value:o.value[i]})),n.fields[i]=a.describe(o)}return n}}Wr.prototype=ju.prototype;function Lu(r){return new $u(r)}class $u extends Gt{constructor(e){super({type:"array",spec:{types:e},check(t){return Array.isArray(t)}}),this.innerType=void 0,this.innerType=e}_cast(e,t){const n=super._cast(e,t);if(!this._typeCheck(n)||!this.innerType)return n;let s=!1;const i=n.map((a,o)=>{const l=this.innerType.cast(a,Object.assign({},t,{path:`${t.path||""}[${o}]`,parent:n,originalValue:a,value:a,index:o}));return l!==a&&(s=!0),l});return s?i:n}_validate(e,t={},n,s){var i;let a=this.innerType,o=(i=t.recursive)!=null?i:this.spec.recursive;t.originalValue!=null&&t.originalValue,super._validate(e,t,n,(l,c)=>{var d;if(!o||!a||!this._typeCheck(c)){s(l,c);return}let u=new Array(c.length);for(let g=0;g<c.length;g++){var f;u[g]=a.asNestedTest({options:t,index:g,parent:c,parentPath:t.path,originalParent:(f=t.originalValue)!=null?f:e})}this.runTests({value:c,tests:u,originalValue:(d=t.originalValue)!=null?d:e,options:t},n,g=>s(g.concat(l),c))})}clone(e){const t=super.clone(e);return t.innerType=this.innerType,t}json(){return this.transform(Pu)}concat(e){let t=super.concat(e);return t.innerType=this.innerType,e.innerType&&(t.innerType=t.innerType?t.innerType.concat(e.innerType):e.innerType),t}of(e){let t=this.clone();if(!zi(e))throw new TypeError("`array.of()` sub-schema must be a valid yup schema not: "+Tr(e));return t.innerType=e,t.spec=Object.assign({},t.spec,{types:e}),t}length(e,t=oi.length){return this.test({message:t,name:"length",exclusive:!0,params:{length:e},skipAbsent:!0,test(n){return n.length===this.resolve(e)}})}min(e,t){return t=t||oi.min,this.test({message:t,name:"min",exclusive:!0,params:{min:e},skipAbsent:!0,test(n){return n.length>=this.resolve(e)}})}max(e,t){return t=t||oi.max,this.test({message:t,name:"max",exclusive:!0,params:{max:e},skipAbsent:!0,test(n){return n.length<=this.resolve(e)}})}ensure(){return this.default(()=>[]).transform((e,t)=>this._typeCheck(e)?e:t==null?[]:[].concat(t))}compact(e){let t=e?(n,s,i)=>!e(n,s,i):n=>!!n;return this.transform(n=>n!=null?n.filter(t):n)}describe(e){const t=(e?this.resolve(e):this).clone(),n=super.describe(e);if(t.innerType){var s;let i=e;(s=i)!=null&&s.value&&(i=Object.assign({},i,{parent:i.value,value:i.value[0]})),n.innerType=t.innerType.describe(i)}return n}}Lu.prototype=$u.prototype;const qe=kt().required("This field is required");nt().required("This field is required").min(0,"Value must be at least 0");const lr=nt().nullable().transform(r=>isNaN(r)?null:r).min(0,"Value must be at least 0"),hS=r=>r.bag_width&&r.bag_step?r.bag_width>=r.bag_step:!0,fS=Wr({machine_name:qe.min(2,"Machine name must be at least 2 characters").max(100,"Machine name must be at most 100 characters").matches(/^[a-zA-Z0-9\s\-_]+$/,"Machine name can only contain letters, numbers, spaces, hyphens, and underscores"),machine_type:qe,department:qe.oneOf(["STAMPA","CONFEZIONAMENTO"],"Invalid department"),work_center:qe.oneOf(["ZANICA","BUSTO_GAROLFO"],"Invalid work center"),status:qe.oneOf(["ACTIVE","INACTIVE"],"Invalid status"),min_web_width:lr,max_web_width:lr,min_bag_height:lr,max_bag_height:lr,standard_speed:lr,setup_time_standard:lr,changeover_color:lr,changeover_material:lr,active_shifts:Lu().of(kt().oneOf(["T1","T2","T3"]))}).test("web-width-logic","Minimum web width cannot exceed maximum web width",function(r){return r.min_web_width&&r.max_web_width?r.min_web_width<=r.max_web_width:!0}).test("bag-height-logic","Minimum bag height cannot exceed maximum bag height",function(r){return r.min_bag_height&&r.max_bag_height?r.min_bag_height<=r.max_bag_height:!0}),gS=Wr({name:qe.min(2,"Phase name must be at least 2 characters").max(100,"Phase name must be at most 100 characters"),department:qe.oneOf(["STAMPA","CONFEZIONAMENTO"],"Invalid department"),work_center:qe.oneOf(["ZANICA","BUSTO_GAROLFO"],"Invalid work center"),numero_persone:nt().required("Number of people is required").min(1,"Number of people must be at least 1"),bag_width:lr,bag_step:lr,v_stampa:nt().nullable().transform(r=>isNaN(r)?null:r).when("department",{is:"STAMPA",then:r=>r.min(0,"Printing speed must be greater than 0")}),t_setup_stampa:nt().nullable().transform(r=>isNaN(r)?null:r).when("department",{is:"STAMPA",then:r=>r.min(0,"Setup time cannot be negative")}),costo_h_stampa:nt().nullable().transform(r=>isNaN(r)?null:r).when("department",{is:"STAMPA",then:r=>r.min(0,"Hourly cost cannot be negative")}),v_conf:nt().nullable().transform(r=>isNaN(r)?null:r).when("department",{is:"CONFEZIONAMENTO",then:r=>r.min(0,"Packaging speed must be greater than 0")}),t_setup_conf:nt().nullable().transform(r=>isNaN(r)?null:r).when("department",{is:"CONFEZIONAMENTO",then:r=>r.min(0,"Setup time cannot be negative")}),costo_h_conf:nt().nullable().transform(r=>isNaN(r)?null:r).when("department",{is:"CONFEZIONAMENTO",then:r=>r.min(0,"Hourly cost cannot be negative")})}).test("bag-width-step-logic","Bag width cannot be less than bag step",hS),mc=Wr({odp_number:qe.min(1,"Il numero ODP  obbligatorio"),article_code:qe.min(1,"Il codice articolo  obbligatorio"),work_center:qe.oneOf(["ZANICA","BUSTO_GAROLFO"],"Seleziona un centro di lavoro valido"),nome_cliente:qe.min(1,"Il nome del cliente  obbligatorio"),quantity:nt().required("La quantit  obbligatoria").min(0,"La quantit deve essere maggiore o uguale a 0").typeError("La quantit deve essere un numero valido"),delivery_date:os().required("La data di consegna  obbligatoria").typeError("Inserisci una data di consegna valida"),customer_order_ref:qe.min(1,"Il riferimento ordine cliente  obbligatorio"),department:qe.oneOf(["STAMPA","CONFEZIONAMENTO"],"Seleziona un reparto valido"),status:kt().oneOf(["NOT SCHEDULED","SCHEDULED","IN PROGRESS","COMPLETED","CANCELLED"],"Stato non valido").default("NOT SCHEDULED"),quantity_completed:nt().min(0,"La quantit completata deve essere maggiore o uguale a 0").default(0),production_lot:kt().nullable(),description:kt().nullable(),bag_height:nt().nullable().transform(r=>isNaN(r)?null:r).min(0,"L'altezza busta deve essere maggiore o uguale a 0"),bag_width:nt().nullable().transform(r=>isNaN(r)?null:r).min(0,"La larghezza busta deve essere maggiore o uguale a 0"),bag_step:nt().nullable().transform(r=>isNaN(r)?null:r).min(0,"Il passo busta deve essere maggiore o uguale a 0"),seal_sides:nt().nullable().transform(r=>isNaN(r)?null:r).oneOf([3,4],"I lati di sigillatura devono essere 3 o 4"),product_type:kt().nullable().oneOf(["CREMA","LIQUIDO","POLVERI"],"Seleziona un tipo di prodotto valido"),internal_customer_code:kt().nullable().test("not-empty-if-provided","Il codice cliente interno non pu essere vuoto",function(r){return!r||r.trim().length>0}),external_customer_code:kt().nullable().test("not-empty-if-provided","Il codice cliente esterno non pu essere vuoto",function(r){return!r||r.trim().length>0}),fase:kt().nullable(),duration:nt().nullable().transform(r=>isNaN(r)?null:r).min(0,"La durata deve essere maggiore o uguale a 0"),cost:nt().nullable().transform(r=>isNaN(r)?null:r).min(0,"Il costo deve essere maggiore o uguale a 0"),scheduled_start_time:os().nullable(),scheduled_end_time:os().nullable(),scheduled_machine_id:kt().nullable(),user_notes:kt().nullable(),asd_notes:kt().nullable(),material_availability_global:nt().nullable().transform(r=>isNaN(r)?null:r).min(0,"Material availability must be between 0 and 100").max(100,"Material availability must be between 0 and 100")}).test("bag-width-step-logic","La larghezza busta non pu essere minore del passo busta",function(r){return r.bag_width&&r.bag_step?r.bag_width>=r.bag_step:!0}).test("quantity-completed-logic","La quantit completata non pu superare la quantit totale",function(r){return r.quantity&&r.quantity_completed!==void 0?r.quantity_completed<=r.quantity:!0}).test("scheduled-time-order","L'ora di fine programmata deve essere dopo l'ora di inizio",function(r){return r.scheduled_start_time&&r.scheduled_end_time?new Date(r.scheduled_end_time)>new Date(r.scheduled_start_time):!0}).test("scheduling-logic","I campi di programmazione devono essere tutti forniti o tutti nulli",function(r){const e=!!r.scheduled_start_time,t=!!r.scheduled_end_time,n=!!r.scheduled_machine_id;return e&&t&&n||!e&&!t&&!n}),mS=Wr({startDate:qe,startTime:qe,endDate:qe,endTime:qe}).test("date-logic","End date cannot be before start date",function(r){return r.startDate&&r.endDate?new Date(r.startDate)<=new Date(r.endDate):!0}).test("time-logic","End time must be after start time when dates are the same",function(r){return r.startDate&&r.endDate&&r.startDate===r.endDate&&r.startTime&&r.endTime?r.startTime<r.endTime:!0}),pS=Wr({email:qe.email("Please enter a valid email address"),password:qe.min(6,"Password must be at least 6 characters")}),bS=Wr({email:qe.email("Please enter a valid email address"),password:qe.min(6,"Password must be at least 6 characters"),confirmPassword:kt().required("Please confirm your password")}).test("passwords-match","Passwords must match",function(r){return r.password===r.confirmPassword}),yS=Wr({email:qe.email("Please enter a valid email address")}),vS=(r,e)=>{try{return e.validateSync(r,{abortEarly:!1}),{isValid:!0,errors:{}}}catch(t){const n={};return t.inner.forEach(s=>{n[s.path]=s.message}),{isValid:!1,errors:n}}},wS={MACHINE:fS,PHASE:gS,ORDER:mc,BACKLOG:mc,OFF_TIME:mS,LOGIN:pS,SIGNUP:bS,FORGOT_PASSWORD:yS},_S=()=>{const r=_.useCallback((f,g)=>{const b=wS[g];if(!b)throw new Error(`Unknown schema type: ${g}`);return vS(f,b)},[]),e=_.useCallback(f=>r(f,"MACHINE"),[r]),t=_.useCallback(f=>r(f,"PHASE"),[r]),n=_.useCallback(f=>r(f,"ORDER"),[r]),s=_.useCallback(f=>r(f,"OFF_TIME"),[r]),i=_.useCallback((f,g)=>r(f,g),[r]),a=_.useCallback((f,g)=>{const b={};return g.some(y=>y.scheduled_machine_id===f)&&(b.general="Cannot delete machine with scheduled tasks. Please unschedule all tasks first."),{isValid:Object.keys(b).length===0,errors:b}},[]),o=_.useCallback(f=>{const g={};return f?(f.quantity_completed>0&&(g.general="Cannot delete order that has started production"),f.scheduled_machine_id&&(g.general="Cannot delete scheduled order. Please unschedule first."),{isValid:Object.keys(g).length===0,errors:g}):(g.general="Order is required",{isValid:!1,errors:g})},[]),l=_.useCallback((f,g,b,m)=>{const y={};return f?g?!b||!m?(y.general="Start and end times are required",{isValid:!1,errors:y}):(g.status!=="ACTIVE"&&(y.general=`Machine ${g.machine_name} is not active`),f.scheduled_machine_id&&f.scheduled_machine_id!==g.id&&(y.general="Order is already scheduled on a different machine"),f.fase||(y.general="Order must have a production phase selected"),(!f.quantity||f.quantity<=0)&&(y.general="Order must have a valid quantity"),(!f.duration||f.duration<=0)&&(y.general="Order must have calculated duration"),{isValid:Object.keys(y).length===0,errors:y}):(y.general="Machine is required",{isValid:!1,errors:y}):(y.general="Order is required",{isValid:!1,errors:y})},[]),c=_.useCallback((f,g)=>{const b={};if(!f)return b.general="Please select a production phase",{isValid:!1,errors:b};g.department&&f.department!==g.department&&(b.general=`Selected phase is for ${f.department} department, but order is for ${g.department}`),g.work_center&&f.work_center!==g.work_center&&(b.general=`Selected phase is for ${f.work_center} work center, but order is for ${g.work_center}`);const m=t(f);return m.isValid||Object.assign(b,m.errors),{isValid:Object.keys(b).length===0,errors:b}},[t]),d=_.useCallback((f,g)=>{if(f.status!=="ACTIVE")return!1;const b=f.active_shifts||[];if(b.length===0)return!1;const m=g.getUTCHours();return b.some(v=>{switch(v){case"T1":return m>=6&&m<14;case"T2":return m>=14&&m<22;case"T3":return m>=22||m<6;default:return!1}})},[]),u=_.useCallback(f=>({name:f?.machine_name||"Unknown Machine",type:f?.machine_type||"Unknown Type",department:f?.department||"Unknown Department",workCenter:f?.work_center||"Unknown Work Center",status:f?.status||"UNKNOWN",isActive:f?.status==="ACTIVE"}),[]);return{validate:r,validateMachine:e,validatePhase:t,validateOrder:n,validateOffTime:s,validateAuth:i,validateMachineDeletion:a,validateOrderDeletion:o,validateOrderScheduling:l,validatePhaseSelection:c,isMachineAvailable:d,getMachineDisplayInfo:u}},SS=(r,e,t=null)=>{const{entities:n}=bi(),[s,i]=_.useState(""),[a,o]=_.useState(!1),[l,c]=_.useState(null),[d,u]=_.useState({}),f=_.useRef(null),g=_.useMemo(()=>!n||n.length===0?[]:r||e?n.filter(S=>(!r||S.department===r)&&(!e||S.work_center===e)).filter(S=>S.name.toLowerCase().includes(s.toLowerCase())):[],[s,r,e,n]);_.useEffect(()=>{if(t&&n&&n.length>0&&!l){const w=n.find(S=>S.id===t);w&&(c(w),i(w.name),u({v_stampa:w.v_stampa||null,t_setup_stampa:w.t_setup_stampa||null,costo_h_stampa:w.costo_h_stampa||null,v_conf:w.v_conf||null,t_setup_conf:w.t_setup_conf||null,costo_h_conf:w.costo_h_conf||null}))}},[t,n,l]),_.useEffect(()=>()=>{f.current&&clearTimeout(f.current)},[]);const b=_.useCallback((w,S)=>{const x=S===""?null:parseFloat(S);u(E=>({...E,[w]:x}))},[]),m=_.useCallback((w,S,x)=>{S("fase",w.id),c(w),i(w.name),o(!1),x("fase"),u({v_stampa:w.v_stampa||null,t_setup_stampa:w.t_setup_stampa||null,costo_h_stampa:w.costo_h_stampa||null,v_conf:w.v_conf||null,t_setup_conf:w.t_setup_conf||null,costo_h_conf:w.costo_h_conf||null})},[]),y=_.useCallback(()=>{i(""),c(null),u({})},[]),v=_.useCallback(()=>{f.current&&clearTimeout(f.current),f.current=setTimeout(()=>o(!1),150)},[]);return _.useMemo(()=>({phaseSearch:s,setPhaseSearch:i,isDropdownVisible:a,setIsDropdownVisible:o,selectedPhase:l,setSelectedPhase:c,filteredPhases:g,editablePhaseParams:d,setEditablePhaseParams:u,handlePhaseParamChange:b,handlePhaseSelect:m,resetPhaseData:y,handleBlur:v,blurTimeoutRef:f}),[s,a,l,g,d,u,b,m,y,v])};function xS(r,e){const t=E_(e),n=new Set;if(t===0||t===6){for(let o=0;o<24;o++)n.add(o.toString());return Array.from(n)}for(let o=0;o<24;o++)n.add(o.toString());const{work_center:s,department:i,active_shifts:a=[]}=r;return a.forEach(o=>{if(o==="T3"){n.clear();return}if(o==="T2")for(let l=6;l<22;l++)n.delete(l.toString());if(o==="T1"){if(s===ve.BUSTO_GAROLFO){for(let l=8;l<12;l++)n.delete(l.toString());for(let l=14;l<18;l++)n.delete(l.toString())}else if(s===ve.ZANICA)if(i===We.PACKAGING){for(let l=8;l<12;l++)n.delete(l.toString());for(let l=13;l<17;l++)n.delete(l.toString())}else{for(let l=8;l<12;l++)n.delete(l.toString());for(let l=13;l<17;l++)n.delete(l.toString())}}}),Array.from(n).sort((o,l)=>parseInt(o)-parseInt(l))}function ES(r,e){const t=[],n=wu(new Date(e,0,1)),s=T0(new Date(e,11,31));for(const i of r){let a=new Date(n);for(;!T_(a,s);){const o=xS(i,a);o.length>0&&t.push({machine_id:i.id,date:ht(a,"yyyy-MM-dd"),unavailable_hours:o}),a=Ts(a,1)}}return t}const ge={machines:["machines"],machine:r=>["machines",r],machinesByWorkCenter:r=>["machines","workCenter",r],orders:["orders"],order:r=>["orders",r],phases:["phases"],phase:r=>["phases",r],machineAvailability:(r,e,t)=>["machineAvailability",r,e,t],machineAvailabilityForDate:(r,e)=>["machineAvailability",r,"date",e],machineAvailabilityForDateAllMachines:r=>["machineAvailability","allMachines",r]},Wi=()=>Vt({queryKey:ge.machines,queryFn:()=>Re.getMachines(),staleTime:120*1e3}),TS=r=>Vt({queryKey:ge.machinesByWorkCenter(r),queryFn:()=>Re.getMachines().then(e=>r===ve.BOTH?e:e.filter(t=>t.work_center===r)),staleTime:120*1e3}),RS=()=>{const r=Ye();return St({mutationFn:async e=>{const t=await Re.addMachine(e);try{const n=new Date().getUTCFullYear(),s=ES([t],n);s.length>0&&await Re.bulkUpsertMachineAvailability(s),cn(`Machine "${t?.machine_name||"Unknown"}" added and calendar set successfully`)}catch(n){ts(`Machine added, but failed to set calendar: ${n.message}`)}return t},onSuccess:e=>{r.invalidateQueries({queryKey:ge.machines}),r.invalidateQueries({queryKey:ge.machinesByWorkCenter()}),r.setQueryData(ge.machines,t=>t?[...t,e]:[e])}})},OS=()=>{const r=Ye();return St({mutationFn:({id:e,updates:t})=>Re.updateMachine(e,t),onSuccess:(e,{id:t})=>{r.invalidateQueries({queryKey:ge.machines}),r.invalidateQueries({queryKey:ge.machinesByWorkCenter()}),r.setQueryData(ge.machines,n=>n?.map(s=>s.id===t?{...s,...e}:s)),r.setQueryData(ge.machine(t),e),cn(`Machine "${e?.machine_name||"Unknown"}" updated successfully`)}})},CS=()=>{const r=Ye();return St({mutationFn:async e=>{const t=await Re.getMachines().then(n=>n.find(s=>s.id===e));return await Re.removeMachine(e),t},onSuccess:e=>{r.invalidateQueries({queryKey:ge.machines}),r.invalidateQueries({queryKey:ge.machinesByWorkCenter()}),r.setQueryData(ge.machines,t=>t?.filter(n=>n.id!==e.id)),r.removeQueries({queryKey:ge.machine(e.id)}),cn(`Machine "${e?.machine_name||"Unknown"}" deleted successfully`)}})},qi=()=>Vt({queryKey:ge.orders,queryFn:()=>Re.getOdpOrders(),staleTime:60*1e3}),kS=r=>Vt({queryKey:ge.order(r),queryFn:async()=>{try{return await Re.getOdpOrder(r)}catch{const n=(await Re.getOdpOrders()).find(s=>s.id===r);if(!n)throw new Error(`Order with id ${r} not found`);return n}},enabled:!!r,staleTime:60*1e3}),DS=()=>{const r=Ye();return St({mutationFn:e=>Re.addOdpOrder(e),onSuccess:e=>{r.invalidateQueries({queryKey:ge.orders}),r.setQueryData(ge.orders,t=>t?[e,...t]:[e])}})},NS=()=>{const r=Ye();return St({mutationFn:({id:e,updates:t})=>Re.updateOdpOrder(e,t),onSuccess:(e,{id:t})=>{r.invalidateQueries({queryKey:ge.orders}),r.setQueryData(ge.orders,n=>n?.map(s=>s.id===t?{...s,...e}:s)),r.setQueryData(ge.order(t),e)}})},AS=()=>{const r=Ye();return St({mutationFn:e=>Re.removeOdpOrder(e),onSuccess:(e,t)=>{r.invalidateQueries({queryKey:ge.orders}),r.setQueryData(ge.orders,n=>n?.filter(s=>s.id!==t)),r.removeQueries({queryKey:ge.order(t)})}})},Po=()=>Vt({queryKey:ge.phases,queryFn:()=>Re.getPhases(),staleTime:300*1e3}),IS=r=>Vt({queryKey:ge.phase(r),queryFn:()=>Re.getPhases().then(e=>e.find(t=>t.id===r)),enabled:!!r,staleTime:300*1e3}),MS=()=>{const r=Ye();return St({mutationFn:e=>Re.addPhase(e),onSuccess:e=>{r.invalidateQueries({queryKey:ge.phases}),r.setQueryData(ge.phases,t=>t?[...t,e]:[e])}})},PS=()=>{const r=Ye();return St({mutationFn:({id:e,updates:t})=>Re.updatePhase(e,t),onSuccess:(e,{id:t})=>{r.invalidateQueries({queryKey:ge.phases}),r.setQueryData(ge.phases,n=>n?.map(s=>s.id===t?{...s,...e}:s)),r.setQueryData(ge.phase(t),e)}})},jS=()=>{const r=Ye();return St({mutationFn:e=>Re.removePhase(e),onSuccess:(e,t)=>{r.invalidateQueries({queryKey:ge.phases}),r.setQueryData(ge.phases,n=>n?.filter(s=>s.id!==t)),r.removeQueries({queryKey:ge.phase(t)})}})},eO=r=>Vt({queryKey:ge.machineAvailabilityForDateAllMachines(r),queryFn:()=>Re.getMachineAvailabilityForDateAllMachines(r),enabled:!!r,staleTime:30*1e3}),LS=()=>{const{data:r,isLoading:e,error:t}=Wi(),{data:n,isLoading:s,error:i}=qi(),{data:a,isLoading:o,error:l}=Po(),{setEntities:c}=ur(),{setEntities:d}=dt(),{setEntities:u}=bi();return _.useEffect(()=>{r&&!e&&!t&&c(r)},[r,e,t,c]),_.useEffect(()=>{n&&!s&&!i&&d(n)},[n,s,i,d]),_.useEffect(()=>{a&&!o&&!l&&u(a)},[a,o,l,u]),{isLoading:e||s||o,errors:{machines:t,orders:i,phases:l}}};function $S(){const{selectedWorkCenter:r,showConfirmDialog:e}=Ve(),t=gr(),{data:n=[],isLoading:s,error:i}=TS(r),a=CS(),{handleAsync:o}=Yt("MachineryListPage");if(i)return h.jsxs("div",{className:"text-center py-2 text-red-600 text-[10px]",children:["Errore nel caricamento delle macchine: ",i.message]});const l=_.useMemo(()=>[{header:"Nome Macchina",accessorKey:"machine_name"},{header:"Centro di Lavoro",accessorKey:"work_center"},{header:"Reparto",accessorKey:"department"},{header:"Stato",accessorKey:"status"},{header:"Larghezza Min (mm)",accessorKey:"min_web_width"},{header:"Larghezza Max (mm)",accessorKey:"max_web_width"},{header:"Altezza Min (mm)",accessorKey:"min_bag_height"},{header:"Altezza Max (mm)",accessorKey:"max_bag_height"},{header:"Velocit Std",accessorKey:"standard_speed"},{header:"Setup (h)",accessorKey:"setup_time_standard"},{header:"Cambio Colore (h)",accessorKey:"changeover_color"},{header:"Cambio Materiale (h)",accessorKey:"changeover_material"},{header:"Turni Attivi",accessorKey:"active_shifts",cell:u=>Array.isArray(u.getValue())?u.getValue().join(", "):""},{header:"Calendario",accessorKey:"id",cell:u=>h.jsx(Te,{asChild:!0,variant:"outline",size:"sm",children:h.jsx(Nt,{to:`/machinery/${u.getValue()}/calendar`,children:"Visualizza Calendario"})})}],[]),c=u=>{t(`/machinery/${u.id}/edit`)},d=async u=>{e("Elimina Macchina",`Sei sicuro di voler eliminare "${u.machine_name}"? Questa azione non pu essere annullata.`,async()=>{await o(async()=>{await a.mutateAsync(u.id)},{context:"Delete Machine",fallbackMessage:"Eliminazione macchina fallita"})},"danger")};return s?h.jsx("div",{children:"Caricamento dati macchine..."}):r?h.jsx(Do,{title:"Lista Macchine",entityName:"Machine",createButtonHref:"/machinery/add",data:n,columns:l,onEditRow:c,onDeleteRow:d,enableGlobalSearch:!1}):h.jsx("div",{className:"text-center py-2 text-red-600 text-[10px]",children:"Seleziona un centro di lavoro per visualizzare i dati delle macchine."})}const zt={validationSchema:"MACHINE",addButtonText:"Aggiungi Macchina",editButtonText:"Aggiorna Macchina",addLoadingText:"Aggiunta...",editLoadingText:"Aggiornamento...",addContext:"Add Machine",editContext:"Update Machine",addErrorMessage:"Aggiunta macchina fallita",editErrorMessage:"Aggiornamento macchina fallita",sections:[{title:"Identificazione",fields:[{name:"department",label:"Department",type:"select",required:!0,options:[{value:We.PRINTING,label:We.PRINTING},{value:We.PACKAGING,label:We.PACKAGING}],defaultValue:Ue.MACHINE.DEPARTMENT,validation:{required:"Department is required"}},{name:"machine_type",label:"Machine Type",type:"select",required:!0,placeholder:"Seleziona tipo macchina",options:[],conditional:r=>r===We.PRINTING||r===We.PACKAGING,validation:{required:"Machine type is required"}},{name:"machine_name",label:"Machine Name",type:"text",required:!0,placeholder:"Nome descrittivo",validation:{required:"Machine name is required",minLength:{value:2,message:"Machine name must be at least 2 characters"},maxLength:{value:100,message:"Machine name must be at most 100 characters"},pattern:{value:/^[a-zA-Z0-9\s\-_]+$/,message:"Machine name can only contain letters, numbers, spaces, hyphens, and underscores"}}},{name:"work_center",label:"Work Center",type:"select",required:!0,placeholder:"Seleziona un centro di lavoro",options:[{value:ve.ZANICA,label:ve.ZANICA},{value:ve.BUSTO_GAROLFO,label:ve.BUSTO_GAROLFO}],defaultValue:Ue.MACHINE.WORK_CENTER,helpText:"Il centro di lavoro  pre-impostato.",validation:{required:"Work center is required"}}]},{title:"Capacit Tecniche",fields:[{name:"min_web_width",label:"Min Web Width (mm)",type:"number",required:!0,defaultValue:Ue.MACHINE.MIN_WEB_WIDTH,validation:{required:"Min web width is required",min:{value:1,message:"Min web width must be at least 1"}}},{name:"max_web_width",label:"Max Web Width (mm)",type:"number",required:!0,defaultValue:Ue.MACHINE.MAX_WEB_WIDTH,validation:{required:"Max web width is required",min:{value:1,message:"Max web width must be at least 1"}}},{name:"min_bag_height",label:"Min Bag Height (mm)",type:"number",required:!0,defaultValue:Ue.MACHINE.MIN_BAG_HEIGHT,validation:{required:"Min bag height is required",min:{value:1,message:"Min bag height must be at least 1"}}},{name:"max_bag_height",label:"Max Bag Height (mm)",type:"number",required:!0,defaultValue:Ue.MACHINE.MAX_BAG_HEIGHT,validation:{required:"Max bag height is required",min:{value:1,message:"Max bag height must be at least 1"}}}]},{title:"Performance",fields:[{name:"standard_speed",label:"Standard Speed",type:"number",required:!0,placeholder:"pz/h o mt/h",validation:{required:"Standard speed is required",min:{value:1,message:"Standard speed must be at least 1"}}},{name:"setup_time_standard",label:"Setup Time Standard (h)",type:"number",required:!0,defaultValue:Ue.MACHINE.SETUP_TIME_STANDARD,validation:{required:"Setup time is required",min:{value:0,message:"Setup time must be at least 0"}}},{name:"changeover_color",label:"Changeover Color (h)",type:"number",required:!0,defaultValue:Ue.MACHINE.CHANGEOVER_COLOR,conditional:(r,e,t)=>t("department")===We.PRINTING,validation:{required:"Changeover color time is required",min:{value:0,message:"Changeover color time must be at least 0"}}},{name:"changeover_material",label:"Material Changeover (h)",type:"number",required:!0,defaultValue:Ue.MACHINE.CHANGEOVER_MATERIAL,conditional:(r,e,t)=>t("department")===We.PACKAGING,validation:{required:"Changeover material time is required",min:{value:0,message:"Changeover material time must be at least 0"}}}]},{title:"Disponibilit",fields:[{name:"active_shifts",label:"Active Shifts",type:"checkbox",required:!1,defaultValue:Ue.MACHINE.ACTIVE_SHIFTS,options:[{value:fn.T1,label:fn.T1},{value:fn.T2,label:fn.T2},{value:fn.T3,label:fn.T3}]},{name:"status",label:"Status",type:"select",required:!0,defaultValue:Ue.MACHINE.STATUS,options:[{value:_r.ACTIVE,label:_r.ACTIVE},{value:_r.INACTIVE,label:_r.INACTIVE}],validation:{required:"Status is required"}}]}]},or={validationSchema:"PHASE",addButtonText:"Aggiungi Fase",editButtonText:"Aggiorna Fase",addLoadingText:"Aggiunta Fase...",editLoadingText:"Aggiornamento Fase...",addContext:"Add Phase",editContext:"Update Phase",addErrorMessage:"Aggiunta fase fallita",editErrorMessage:"Aggiornamento fase fallita",sections:[{title:"Informazioni Fase",fields:[{name:"name",label:"Nome Fase",type:"text",required:!0,placeholder:"es. Stampa Alta Velocit"},{name:"department",label:"Tipo Fase",type:"select",required:!0,options:[{value:We.PRINTING,label:We.PRINTING},{value:We.PACKAGING,label:We.PACKAGING}],defaultValue:Ue.PHASE.DEPARTMENT},{name:"numero_persone",label:"Numero di Persone Richieste",type:"number",required:!0,defaultValue:Ue.PHASE.NUMERO_PERSONE},{name:"work_center",label:"Centro di Lavoro",type:"select",required:!0,options:[{value:ve.ZANICA,label:ve.ZANICA},{value:ve.BUSTO_GAROLFO,label:ve.BUSTO_GAROLFO}],defaultValue:Ue.PHASE.WORK_CENTER,helpText:"Il centro di lavoro  impostato in base alla tua selezione di accesso"}]},{title:"Parametri Stampa",fields:[{name:"v_stampa",label:"Velocit Stampa (mt/h)",type:"number",required:!0,defaultValue:Ue.PHASE.V_STAMPA,conditional:(r,e,t)=>t("department")===We.PRINTING},{name:"t_setup_stampa",label:"Tempo Setup (ore)",type:"number",required:!0,defaultValue:Ue.PHASE.T_SETUP_STAMPA,conditional:(r,e,t)=>t("department")===We.PRINTING},{name:"costo_h_stampa",label:"Costo Orario (/h)",type:"number",required:!0,defaultValue:Ue.PHASE.COSTO_H_STAMPA,conditional:(r,e,t)=>t("department")===We.PRINTING}]},{title:"Parametri Confezionamento",fields:[{name:"v_conf",label:"Velocit Confezionamento (pz/h)",type:"number",required:!0,defaultValue:Ue.PHASE.V_CONF,conditional:(r,e,t)=>t("department")===We.PACKAGING},{name:"t_setup_conf",label:"Tempo Setup (ore)",type:"number",required:!0,defaultValue:Ue.PHASE.T_SETUP_CONF,conditional:(r,e,t)=>t("department")===We.PACKAGING},{name:"costo_h_conf",label:"Costo Orario (/h)",type:"number",required:!0,defaultValue:Ue.PHASE.COSTO_H_CONF,conditional:(r,e,t)=>t("department")===We.PACKAGING}]},{title:"Descrizione Fase",fields:[{name:"contenuto_fase",label:"Descrizione Contenuto Fase",type:"textarea",required:!0,placeholder:"Descrivi il contenuto della fase e i requisiti...",rows:3}],gridCols:"grid-cols-1"}]},FS={validationSchema:"ORDER",addButtonText:"Aggiungi al Backlog",editButtonText:"Aggiorna Ordine",addLoadingText:"Aggiunta...",editLoadingText:"Aggiornamento...",addContext:"Add Order",editContext:"Update Order",addErrorMessage:"Aggiunta ordine fallita",editErrorMessage:"Aggiornamento ordine fallito",sections:[{title:"Identificazione",fields:[{name:"odp_number",label:"Numero ODP",type:"text",required:!0,placeholder:"Inserisci numero ODP"},{name:"article_code",label:"Codice Articolo",type:"article_code",required:!0,placeholder:"Inserisci codice articolo"},{name:"production_lot",label:"Codice Articolo Esterno",type:"text",required:!0,placeholder:"Inserisci codice articolo esterno"},{name:"work_center",label:"Centro di Lavoro",type:"select",required:!0,placeholder:"Seleziona centro di lavoro",options:[{value:ve.ZANICA,label:ve.ZANICA},{value:ve.BUSTO_GAROLFO,label:ve.BUSTO_GAROLFO}],conditional:(r,e,t)=>!0},{name:"nome_cliente",label:"Nome Cliente",type:"text",required:!0,placeholder:"Inserisci nome cliente"}]},{title:"Specifiche Tecniche",fields:[{name:"bag_height",label:"Altezza Busta (mm)",type:"number",required:!1,placeholder:"Inserisci altezza busta"},{name:"bag_width",label:"Larghezza Busta (mm)",type:"number",required:!1,placeholder:"Inserisci larghezza busta"},{name:"bag_step",label:"Passo Busta (mm)",type:"number",required:!1,placeholder:"Inserisci passo busta"},{name:"seal_sides",label:"Lati Sigillatura",type:"select",required:!1,placeholder:"Seleziona...",options:[{value:"3",label:"3"},{value:"4",label:"4"}],defaultValue:Ue.ORDER.SEAL_SIDES},{name:"product_type",label:"Tipo Prodotto",type:"select",required:!1,placeholder:"Seleziona...",options:[{value:hn.CREMA,label:hn.CREMA},{value:hn.LIQUIDO,label:hn.LIQUIDO},{value:hn.POLVERI,label:hn.POLVERI}]},{name:"quantity",label:"Quantit",type:"number",required:!0,placeholder:"Inserisci quantit"},{name:"quantity_completed",label:"Q.t Completata",type:"number",required:!0,defaultValue:Ue.ORDER.QUANTITY_COMPLETED}]},{title:"Dati Commerciali",fields:[{name:"internal_customer_code",label:"Lotto FLEXI",type:"text",required:!0,placeholder:"Inserisci lotto FLEXI"},{name:"external_customer_code",label:"Lotto Cliente",type:"text",required:!0,placeholder:"Inserisci lotto cliente"},{name:"customer_order_ref",label:"Riferimento Cliente",type:"text",required:!0,placeholder:"Inserisci riferimento cliente"},{name:"user_notes",label:"Note Libere",type:"textarea",required:!1,placeholder:"Inserisci note libere per l'ordine...",rows:3},{name:"asd_notes",label:"Note ASD",type:"textarea",required:!1,placeholder:"Inserisci note ASD per l'ordine...",rows:3}],gridCols:"grid-cols-2 md:grid-cols-3"},{title:"Dati Lavorazione & Pianificazione",fields:[{name:"department",label:"Reparto",type:"text",required:!0,readOnly:!0,className:"bg-gray-50"},{name:"phase_search",label:"Cerca Fase di Produzione",type:"phase_search",required:!0},{name:"delivery_date",label:"Data di Consegna",type:"datetime-local",required:!0}]},{title:"Disponibilit Materiali",fields:[{name:"material_availability_global",label:"Disponibilit Materiale Globale (%)",type:"number",required:!1,placeholder:"Inserisci percentuale disponibilit (0-100)",min:0,max:100}]}],customFields:{phase_parameters:{type:"phase_parameters",label:"Parametri Fase Selezionata"},calculation_results:{type:"calculation_results",label:"Risultati Calcolo Produzione"}},customValidation:r=>{const e={};return{isValid:Object.keys(e).length===0,errors:e}}},Ta={validationSchema:"OFF_TIME",addButtonText:"Imposta Non Disponibilit",editButtonText:"Aggiorna Non Disponibilit",addLoadingText:"Impostazione...",editLoadingText:"Aggiornamento...",addContext:"Set Machine Unavailability",editContext:"Update Machine Unavailability",addErrorMessage:"Impostazione indisponibilit macchina fallita",editErrorMessage:"Aggiornamento indisponibilit macchina fallita",sections:[{title:"Periodo di Non Disponibilit",fields:[{name:"startDate",label:"Data Inizio",type:"date",required:!0,defaultValue:""},{name:"startTime",label:"Ora Inizio",type:"time",required:!0,defaultValue:Ue.OFF_TIME.START_TIME},{name:"endDate",label:"Data Fine",type:"date",required:!0,defaultValue:""},{name:"endTime",label:"Ora Fine",type:"time",required:!0,defaultValue:Ue.OFF_TIME.END_TIME}]}],customValidation:r=>{const e={};if(r.startDate&&r.endDate){const t=new Date(r.startDate);new Date(r.endDate)<t&&(e.endDate=Xo.END_DATE_BEFORE_START),r.startDate===r.endDate&&r.startTime&&r.endTime&&r.startTime>=r.endTime&&(e.endTime=Xo.END_TIME_BEFORE_START)}return{isValid:Object.keys(e).length===0,errors:e}}};function US({machineToEdit:r,onSuccess:e}){const{selectedWorkCenter:t}=Ve(),{getValidMachineTypes:n}=xu(),s=RS(),i=OS(),a=!!r,o=_.useMemo(()=>{const u={...zt};return u.sections[0].fields[1].options=[...n("STAMPA").map(f=>({value:f,label:f})),...n("CONFEZIONAMENTO").map(f=>({value:f,label:f}))],u.sections[0].fields[1].placeholder="Seleziona tipo macchina",t!==ve.BOTH&&(u.sections[0].fields[3].disabled=!0,u.sections[0].fields[3].defaultValue=t,u.sections[0].fields[3].helpText="Il centro di lavoro  pre-impostato."),u},[n,t]),l=_.useMemo(()=>({department:r?.department||zt.sections[0].fields[0].defaultValue,machine_type:r?.machine_type||"",machine_name:r?.machine_name||"",work_center:r?.work_center||(t===ve.BOTH?zt.sections[0].fields[3].defaultValue:t),min_web_width:r?.min_web_width||zt.sections[1].fields[0].defaultValue,max_web_width:r?.max_web_width||zt.sections[1].fields[1].defaultValue,min_bag_height:r?.min_bag_height||zt.sections[1].fields[2].defaultValue,max_bag_height:r?.max_bag_height||zt.sections[1].fields[3].defaultValue,standard_speed:r?.standard_speed||"",setup_time_standard:r?.setup_time_standard||zt.sections[2].fields[1].defaultValue,changeover_color:r?.changeover_color||zt.sections[2].fields[2].defaultValue,changeover_material:r?.changeover_material||zt.sections[2].fields[3].defaultValue,active_shifts:r?.active_shifts||zt.sections[3].fields[0].defaultValue,status:r?.status||zt.sections[3].fields[1].defaultValue}),[t,r]),c=async u=>{a?await i.mutateAsync({id:r.id,updates:u}):await s.mutateAsync(u),e&&e()},d=s.isPending||i.isPending;return h.jsx(Li,{config:o,initialData:l,onSubmit:c,onSuccess:e,isEditMode:a,isLoading:d})}function HS({title:r,children:e}){return h.jsx("div",{className:"sticky top-0 z-10 bg-background border-b border-border px-2 py-3 mb-2",children:h.jsxs("div",{className:"flex items-center justify-between",children:[h.jsx("div",{className:"flex items-center",children:r&&h.jsx("h2",{className:"text-[10px] font-semibold text-gray-900",children:r})}),e]})})}function pc(){const{id:r}=Ni(),e=gr(),{getMachineById:t}=ur(),{selectedWorkCenter:n}=Ve(),{isLoading:s,isInitialized:i,init:a,cleanup:o}=zr(),l=!!r,c=l?t(r):null;return _.useEffect(()=>(i||a(),()=>{o()}),[a,i,o]),_.useEffect(()=>{l&&!s&&!c&&e("/machinery",{replace:!0})},[l,s,c,e]),s?h.jsx("div",{children:"Caricamento..."}):l&&!c?h.jsx("div",{className:"text-center py-2 text-red-600 text-[10px]",children:"Macchina non trovata."}):n?h.jsxs("div",{className:"space-y-6",children:[h.jsxs("div",{className:"flex items-center justify-between",children:[h.jsx("h1",{className:"text-2xl font-semibold text-foreground",children:l?`Modifica Macchina: ${c?.machine_name}`:"Aggiungi Nuova Macchina"}),l&&h.jsx(Te,{asChild:!0,variant:"outline",children:h.jsx(Nt,{to:`/machinery/${r}/calendar`,children:"Visualizza Calendario"})})]}),h.jsx(US,{machineToEdit:c})]}):h.jsx("div",{className:"text-center py-2 text-red-600 text-[10px]",children:"Seleziona un centro di lavoro per gestire le macchine."})}function BS({machineId:r,currentDate:e,onSuccess:t}){const{setMachineUnavailability:n}=Rs(),{showAlert:s}=Ve(),i=_.useMemo(()=>{const o=new Date,l=Ts(o,1);return{startDate:ht(o,"yyyy-MM-dd"),endDate:ht(l,"yyyy-MM-dd"),startTime:Ta.sections[0].fields[1].defaultValue,endTime:Ta.sections[0].fields[3].defaultValue}},[e]),a=async o=>{await n(r,o.startDate,o.endDate,o.startTime,o.endTime),s("Indisponibilit macchina impostata con successo!","success"),t&&t()};return h.jsx(Li,{config:Ta,initialData:i,onSubmit:a,onSuccess:t,className:"p-1 bg-white rounded-lg shadow-sm border"})}class zS extends mr{constructor(){super(...arguments),this.headerElRef=Lt()}renderSimpleLayout(e,t){let{props:n,context:s}=this,i=[],a=ui(s.options);return e&&i.push({type:"header",key:"header",isSticky:a,chunk:{elRef:this.headerElRef,tableClassName:"fc-col-header",rowContent:e}}),i.push({type:"body",key:"body",liquid:!0,chunk:{content:t}}),C(fs,{elClasses:["fc-daygrid"],viewSpec:s.viewSpec},C(ed,{liquid:!n.isHeightAuto&&!n.forPrint,collapsibleWidth:n.forPrint,cols:[],sections:i}))}renderHScrollLayout(e,t,n,s){let i=this.context.pluginHooks.scrollGridImpl;if(!i)throw new Error("No ScrollGrid implementation");let{props:a,context:o}=this,l=!a.forPrint&&ui(o.options),c=!a.forPrint&&td(o.options),d=[];return e&&d.push({type:"header",key:"header",isSticky:l,chunks:[{key:"main",elRef:this.headerElRef,tableClassName:"fc-col-header",rowContent:e}]}),d.push({type:"body",key:"body",liquid:!0,chunks:[{key:"main",content:t}]}),c&&d.push({type:"footer",key:"footer",isSticky:!0,chunks:[{key:"main",content:Na}]}),C(fs,{elClasses:["fc-daygrid"],viewSpec:o.viewSpec},C(i,{liquid:!a.isHeightAuto&&!a.forPrint,forPrint:a.forPrint,collapsibleWidth:a.forPrint,colGroups:[{cols:[{span:n,minWidth:s}]}],sections:d}))}}function ci(r,e){let t=[];for(let n=0;n<e;n+=1)t[n]=[];for(let n of r)t[n.row].push(n);return t}function ti(r,e){let t=[];for(let n=0;n<e;n+=1)t[n]=[];for(let n of r)t[n.firstCol].push(n);return t}function bc(r,e){let t=[];if(r){for(let n=0;n<e;n+=1)t[n]={affectedInstances:r.affectedInstances,isEvent:r.isEvent,segs:[]};for(let n of r.segs)t[n.row].segs.push(n)}else for(let n=0;n<e;n+=1)t[n]=null;return t}const Fu=Rr({hour:"numeric",minute:"2-digit",omitZeroMinute:!0,meridiem:"narrow"});function Uu(r){let{display:e}=r.eventRange.ui;return e==="list-item"||e==="auto"&&!r.eventRange.def.allDay&&r.firstCol===r.lastCol&&r.isStart&&r.isEnd}class Hu extends Kt{render(){let{props:e}=this;return C(Xc,Object.assign({},e,{elClasses:["fc-daygrid-event","fc-daygrid-block-event","fc-h-event"],defaultTimeFormat:Fu,defaultDisplayEventEnd:e.defaultDisplayEventEnd,disableResizing:!e.seg.eventRange.def.allDay}))}}class Bu extends Kt{render(){let{props:e,context:t}=this,{options:n}=t,{seg:s}=e,i=n.eventTimeFormat||Fu,a=ri(s,i,t,!0,e.defaultDisplayEventEnd);return C(Yc,Object.assign({},e,{elTag:"a",elClasses:["fc-daygrid-event","fc-daygrid-dot-event"],elAttrs:Kc(e.seg,t),defaultGenerator:WS,timeText:a,isResizing:!1,isDateSelecting:!1}))}}function WS(r){return C(xt,null,C("div",{className:"fc-daygrid-event-dot",style:{borderColor:r.borderColor||r.backgroundColor}}),r.timeText&&C("div",{className:"fc-event-time"},r.timeText),C("div",{className:"fc-event-title"},r.event.title||C(xt,null,"")))}class qS extends Kt{constructor(){super(...arguments),this.compileSegs=Xe(VS)}render(){let{props:e}=this,{allSegs:t,invisibleSegs:n}=this.compileSegs(e.singlePlacements);return C(Jc,{elClasses:["fc-daygrid-more-link"],dateProfile:e.dateProfile,todayRange:e.todayRange,allDayDate:e.allDayDate,moreCnt:e.moreCnt,allSegs:t,hiddenSegs:n,alignmentElRef:e.alignmentElRef,alignGridTop:e.alignGridTop,extraDateSpan:e.extraDateSpan,popoverContent:()=>{let s=(e.eventDrag?e.eventDrag.affectedInstances:null)||(e.eventResize?e.eventResize.affectedInstances:null)||{};return C(xt,null,t.map(i=>{let a=i.eventRange.instance.instanceId;return C("div",{className:"fc-daygrid-event-harness",key:a,style:{visibility:s[a]?"hidden":""}},Uu(i)?C(Bu,Object.assign({seg:i,isDragging:!1,isSelected:a===e.eventSelection,defaultDisplayEventEnd:!1},Er(i,e.todayRange))):C(Hu,Object.assign({seg:i,isDragging:!1,isResizing:!1,isDateSelecting:!1,isSelected:a===e.eventSelection,defaultDisplayEventEnd:!1},Er(i,e.todayRange))))}))}})}}function VS(r){let e=[],t=[];for(let n of r)e.push(n.seg),n.isVisible||t.push(n.seg);return{allSegs:e,invisibleSegs:t}}const GS=Rr({week:"narrow"});class KS extends mr{constructor(){super(...arguments),this.rootElRef=Lt(),this.state={dayNumberId:rs()},this.handleRootEl=e=>{Vo(this.rootElRef,e),Vo(this.props.elRef,e)}}render(){let{context:e,props:t,state:n,rootElRef:s}=this,{options:i,dateEnv:a}=e,{date:o,dateProfile:l}=t;const c=t.showDayNumber&&XS(o,l.currentRange,a);return C(Gc,{elTag:"td",elRef:this.handleRootEl,elClasses:["fc-daygrid-day",...t.extraClassNames||[]],elAttrs:Object.assign(Object.assign(Object.assign({},t.extraDataAttrs),t.showDayNumber?{"aria-labelledby":n.dayNumberId}:{}),{role:"gridcell"}),defaultGenerator:YS,date:o,dateProfile:l,todayRange:t.todayRange,showDayNumber:t.showDayNumber,isMonthStart:c,extraRenderProps:t.extraRenderProps},(d,u)=>C("div",{ref:t.innerElRef,className:"fc-daygrid-day-frame fc-scrollgrid-sync-inner",style:{minHeight:t.minHeight}},t.showWeekNumber&&C(qc,{elTag:"a",elClasses:["fc-daygrid-week-number"],elAttrs:hs(e,o,"week"),date:o,defaultFormat:GS}),!u.isDisabled&&(t.showDayNumber||Vc(i)||t.forceDayTop)?C("div",{className:"fc-daygrid-day-top"},C(d,{elTag:"a",elClasses:["fc-daygrid-day-number",c&&"fc-daygrid-month-start"],elAttrs:Object.assign(Object.assign({},hs(e,o)),{id:n.dayNumberId})})):t.showDayNumber?C("div",{className:"fc-daygrid-day-top",style:{visibility:"hidden"}},C("a",{className:"fc-daygrid-day-number"},"")):void 0,C("div",{className:"fc-daygrid-day-events",ref:t.fgContentElRef},t.fgContent,C("div",{className:"fc-daygrid-day-bottom",style:{marginTop:t.moreMarginTop}},C(qS,{allDayDate:o,singlePlacements:t.singlePlacements,moreCnt:t.moreCnt,alignmentElRef:s,alignGridTop:!t.showDayNumber,extraDateSpan:t.extraDateSpan,dateProfile:t.dateProfile,eventSelection:t.eventSelection,eventDrag:t.eventDrag,eventResize:t.eventResize,todayRange:t.todayRange}))),C("div",{className:"fc-daygrid-day-bg"},t.bgContent)))}}function YS(r){return r.dayNumberText||C(xt,null,"")}function XS(r,e,t){const{start:n,end:s}=e,i=Zh(s,-1),a=t.getYear(n),o=t.getMonth(n),l=t.getYear(i),c=t.getMonth(i);return!(a===l&&o===c)&&(r.valueOf()===n.valueOf()||t.getDay(r)===1&&r.valueOf()<s.valueOf())}function zu(r){return r.eventRange.instance.instanceId+":"+r.firstCol}function Wu(r){return zu(r)+":"+r.lastCol}function QS(r,e,t,n,s,i,a){let o=new ex(v=>{let p=r[v.index].eventRange.instance.instanceId+":"+v.span.start+":"+(v.span.end-1);return s[p]||1});o.allowReslicing=!0,o.strictOrder=n,e===!0||t===!0?(o.maxCoord=i,o.hiddenConsumes=!0):typeof e=="number"?o.maxStackCnt=e:typeof t=="number"&&(o.maxStackCnt=t,o.hiddenConsumes=!0);let l=[],c=[];for(let v=0;v<r.length;v+=1){let p=r[v],w=Wu(p);s[w]!=null?l.push({index:v,span:{start:p.firstCol,end:p.lastCol+1}}):c.push(p)}let d=o.addSegs(l),u=o.toRects(),{singleColPlacements:f,multiColPlacements:g,leftoverMargins:b}=JS(u,r,a),m=[],y=[];for(let v of c){g[v.firstCol].push({seg:v,isVisible:!1,isAbsolute:!0,absoluteTop:0,marginTop:0});for(let p=v.firstCol;p<=v.lastCol;p+=1)f[p].push({seg:Nn(v,p,p+1,a),isVisible:!1,isAbsolute:!1,absoluteTop:0,marginTop:0})}for(let v=0;v<a.length;v+=1)m.push(0);for(let v of d){let p=r[v.index],w=v.span;g[w.start].push({seg:Nn(p,w.start,w.end,a),isVisible:!1,isAbsolute:!0,absoluteTop:0,marginTop:0});for(let S=w.start;S<w.end;S+=1)m[S]+=1,f[S].push({seg:Nn(p,S,S+1,a),isVisible:!1,isAbsolute:!1,absoluteTop:0,marginTop:0})}for(let v=0;v<a.length;v+=1)y.push(b[v]);return{singleColPlacements:f,multiColPlacements:g,moreCnts:m,moreMarginTops:y}}function JS(r,e,t){let n=ZS(r,t.length),s=[],i=[],a=[];for(let o=0;o<t.length;o+=1){let l=n[o],c=[],d=0,u=0;for(let g of l){let b=e[g.index];c.push({seg:Nn(b,o,o+1,t),isVisible:!0,isAbsolute:!1,absoluteTop:g.levelCoord,marginTop:g.levelCoord-d}),d=g.levelCoord+g.thickness}let f=[];d=0,u=0;for(let g of l){let b=e[g.index],m=g.span.end-g.span.start>1,y=g.span.start===o;u+=g.levelCoord-d,d=g.levelCoord+g.thickness,m?(u+=g.thickness,y&&f.push({seg:Nn(b,g.span.start,g.span.end,t),isVisible:!0,isAbsolute:!0,absoluteTop:g.levelCoord,marginTop:0})):y&&(f.push({seg:Nn(b,g.span.start,g.span.end,t),isVisible:!0,isAbsolute:!1,absoluteTop:g.levelCoord,marginTop:u}),u=0)}s.push(c),i.push(f),a.push(u)}return{singleColPlacements:s,multiColPlacements:i,leftoverMargins:a}}function ZS(r,e){let t=[];for(let n=0;n<e;n+=1)t.push([]);for(let n of r)for(let s=n.span.start;s<n.span.end;s+=1)t[s].push(n);return t}function Nn(r,e,t,n){if(r.firstCol===e&&r.lastCol===t-1)return r;let s=r.eventRange,i=s.range,a=fo(i,{start:n[e].date,end:us(n[t-1].date,1)});return Object.assign(Object.assign({},r),{firstCol:e,lastCol:t-1,eventRange:{def:s.def,ui:Object.assign(Object.assign({},s.ui),{durationEditable:!1}),instance:s.instance,range:a},isStart:r.isStart&&a.start.valueOf()===i.start.valueOf(),isEnd:r.isEnd&&a.end.valueOf()===i.end.valueOf()})}class ex extends Qc{constructor(){super(...arguments),this.hiddenConsumes=!1,this.forceHidden={}}addSegs(e){const t=super.addSegs(e),{entriesByLevel:n}=this,s=i=>!this.forceHidden[ns(i)];for(let i=0;i<n.length;i+=1)n[i]=n[i].filter(s);return t}handleInvalidInsertion(e,t,n){const{entriesByLevel:s,forceHidden:i}=this,{touchingEntry:a,touchingLevel:o,touchingLateral:l}=e;if(this.hiddenConsumes&&a){const c=ns(a);if(!i[c])if(this.allowReslicing){const d=Object.assign(Object.assign({},a),{span:Jh(a.span,t.span)}),u=ns(d);i[u]=!0,s[o][l]=d,n.push(d),this.splitEntry(a,t,n)}else i[c]=!0,n.push(a)}super.handleInvalidInsertion(e,t,n)}}class qu extends mr{constructor(){super(...arguments),this.cellElRefs=new en,this.frameElRefs=new en,this.fgElRefs=new en,this.segHarnessRefs=new en,this.rootElRef=Lt(),this.state={framePositions:null,maxContentHeight:null,segHeights:{}},this.handleResize=e=>{e&&this.updateSizing(!0)}}render(){let{props:e,state:t,context:n}=this,{options:s}=n,i=e.cells.length,a=ti(e.businessHourSegs,i),o=ti(e.bgEventSegs,i),l=ti(this.getHighlightSegs(),i),c=ti(this.getMirrorSegs(),i),{singleColPlacements:d,multiColPlacements:u,moreCnts:f,moreMarginTops:g}=QS(ho(e.fgEventSegs,s.eventOrder),e.dayMaxEvents,e.dayMaxEventRows,s.eventOrderStrict,t.segHeights,t.maxContentHeight,e.cells),b=e.eventDrag&&e.eventDrag.affectedInstances||e.eventResize&&e.eventResize.affectedInstances||{};return C("tr",{ref:this.rootElRef,role:"row"},e.renderIntro&&e.renderIntro(),e.cells.map((m,y)=>{let v=this.renderFgSegs(y,e.forPrint?d[y]:u[y],e.todayRange,b),p=this.renderFgSegs(y,tx(c[y],u),e.todayRange,{},!!e.eventDrag,!!e.eventResize,!1);return C(KS,{key:m.key,elRef:this.cellElRefs.createRef(m.key),innerElRef:this.frameElRefs.createRef(m.key),dateProfile:e.dateProfile,date:m.date,showDayNumber:e.showDayNumbers,showWeekNumber:e.showWeekNumbers&&y===0,forceDayTop:e.showWeekNumbers,todayRange:e.todayRange,eventSelection:e.eventSelection,eventDrag:e.eventDrag,eventResize:e.eventResize,extraRenderProps:m.extraRenderProps,extraDataAttrs:m.extraDataAttrs,extraClassNames:m.extraClassNames,extraDateSpan:m.extraDateSpan,moreCnt:f[y],moreMarginTop:g[y],singlePlacements:d[y],fgContentElRef:this.fgElRefs.createRef(m.key),fgContent:C(xt,null,C(xt,null,v),C(xt,null,p)),bgContent:C(xt,null,this.renderFillSegs(l[y],"highlight"),this.renderFillSegs(a[y],"non-business"),this.renderFillSegs(o[y],"bg-event")),minHeight:e.cellMinHeight})}))}componentDidMount(){this.updateSizing(!0),this.context.addResizeHandler(this.handleResize)}componentDidUpdate(e,t){let n=this.props;this.updateSizing(!Hc(e,n))}componentWillUnmount(){this.context.removeResizeHandler(this.handleResize)}getHighlightSegs(){let{props:e}=this;return e.eventDrag&&e.eventDrag.segs.length?e.eventDrag.segs:e.eventResize&&e.eventResize.segs.length?e.eventResize.segs:e.dateSelectionSegs}getMirrorSegs(){let{props:e}=this;return e.eventResize&&e.eventResize.segs.length?e.eventResize.segs:[]}renderFgSegs(e,t,n,s,i,a,o){let{context:l}=this,{eventSelection:c}=this.props,{framePositions:d}=this.state,u=this.props.cells.length===1,f=i||a||o,g=[];if(d)for(let b of t){let{seg:m}=b,{instanceId:y}=m.eventRange.instance,v=b.isVisible&&!s[y],p=b.isAbsolute,w="",S="";p&&(l.isRtl?(S=0,w=d.lefts[m.lastCol]-d.lefts[m.firstCol]):(w=0,S=d.rights[m.firstCol]-d.rights[m.lastCol])),g.push(C("div",{className:"fc-daygrid-event-harness"+(p?" fc-daygrid-event-harness-abs":""),key:zu(m),ref:f?null:this.segHarnessRefs.createRef(Wu(m)),style:{visibility:v?"":"hidden",marginTop:p?"":b.marginTop,top:p?b.absoluteTop:"",left:w,right:S}},Uu(m)?C(Bu,Object.assign({seg:m,isDragging:i,isSelected:y===c,defaultDisplayEventEnd:u},Er(m,n))):C(Hu,Object.assign({seg:m,isDragging:i,isResizing:a,isDateSelecting:o,isSelected:y===c,defaultDisplayEventEnd:u},Er(m,n)))))}return g}renderFillSegs(e,t){let{isRtl:n}=this.context,{todayRange:s}=this.props,{framePositions:i}=this.state,a=[];if(i)for(let o of e){let l=n?{right:0,left:i.lefts[o.lastCol]-i.lefts[o.firstCol]}:{left:0,right:i.rights[o.firstCol]-i.rights[o.lastCol]};a.push(C("div",{key:Wc(o.eventRange),className:"fc-daygrid-bg-harness",style:l},t==="bg-event"?C(zc,Object.assign({seg:o},Er(o,s))):Bc(t)))}return C(xt,{},...a)}updateSizing(e){let{props:t,state:n,frameElRefs:s}=this;if(!t.forPrint&&t.clientWidth!==null){if(e){let l=t.cells.map(c=>s.currentMap[c.key]);if(l.length){let c=this.rootElRef.current,d=new In(c,l,!0,!1);(!n.framePositions||!n.framePositions.similarTo(d))&&this.setState({framePositions:new In(c,l,!0,!1)})}}const i=this.state.segHeights,a=this.querySegHeights(),o=t.dayMaxEvents===!0||t.dayMaxEventRows===!0;this.safeSetState({segHeights:Object.assign(Object.assign({},i),a),maxContentHeight:o?this.computeMaxContentHeight():null})}}querySegHeights(){let e=this.segHarnessRefs.currentMap,t={};for(let n in e){let s=Math.round(e[n].getBoundingClientRect().height);t[n]=Math.max(t[n]||0,s)}return t}computeMaxContentHeight(){let e=this.props.cells[0].key,t=this.cellElRefs.currentMap[e],n=this.fgElRefs.currentMap[e];return t.getBoundingClientRect().bottom-n.getBoundingClientRect().top}getCellEls(){let e=this.cellElRefs.currentMap;return this.props.cells.map(t=>e[t.key])}}qu.addStateEquality({segHeights:Hc});function tx(r,e){if(!r.length)return[];let t=rx(e);return r.map(n=>({seg:n,isVisible:!0,isAbsolute:!0,absoluteTop:t[n.eventRange.instance.instanceId],marginTop:0}))}function rx(r){let e={};for(let t of r)for(let n of t)e[n.seg.eventRange.instance.instanceId]=n.absoluteTop;return e}class nx extends mr{constructor(){super(...arguments),this.splitBusinessHourSegs=Xe(ci),this.splitBgEventSegs=Xe(sx),this.splitFgEventSegs=Xe(ci),this.splitDateSelectionSegs=Xe(ci),this.splitEventDrag=Xe(bc),this.splitEventResize=Xe(bc),this.rowRefs=new en}render(){let{props:e,context:t}=this,n=e.cells.length,s=this.splitBusinessHourSegs(e.businessHourSegs,n),i=this.splitBgEventSegs(e.bgEventSegs,n),a=this.splitFgEventSegs(e.fgEventSegs,n),o=this.splitDateSelectionSegs(e.dateSelectionSegs,n),l=this.splitEventDrag(e.eventDrag,n),c=this.splitEventResize(e.eventResize,n),d=n>=7&&e.clientWidth?e.clientWidth/t.options.aspectRatio/6:null;return C(Ai,{unit:"day"},(u,f)=>C(xt,null,e.cells.map((g,b)=>C(qu,{ref:this.rowRefs.createRef(b),key:g.length?g[0].date.toISOString():b,showDayNumbers:n>1,showWeekNumbers:e.showWeekNumbers,todayRange:f,dateProfile:e.dateProfile,cells:g,renderIntro:e.renderRowIntro,businessHourSegs:s[b],eventSelection:e.eventSelection,bgEventSegs:i[b],fgEventSegs:a[b],dateSelectionSegs:o[b],eventDrag:l[b],eventResize:c[b],dayMaxEvents:e.dayMaxEvents,dayMaxEventRows:e.dayMaxEventRows,clientWidth:e.clientWidth,clientHeight:e.clientHeight,cellMinHeight:d,forPrint:e.forPrint}))))}componentDidMount(){this.registerInteractiveComponent()}componentDidUpdate(){this.registerInteractiveComponent()}registerInteractiveComponent(){if(!this.rootEl){const e=this.rowRefs.currentMap[0].getCellEls()[0],t=e?e.closest(".fc-daygrid-body"):null;t&&(this.rootEl=t,this.context.registerInteractiveComponent(this,{el:t,isHitComboAllowed:this.props.isHitComboAllowed}))}}componentWillUnmount(){this.rootEl&&(this.context.unregisterInteractiveComponent(this),this.rootEl=null)}prepareHits(){this.rowPositions=new In(this.rootEl,this.rowRefs.collect().map(e=>e.getCellEls()[0]),!1,!0),this.colPositions=new In(this.rootEl,this.rowRefs.currentMap[0].getCellEls(),!0,!1)}queryHit(e,t){let{colPositions:n,rowPositions:s}=this,i=n.leftToIndex(e),a=s.topToIndex(t);if(a!=null&&i!=null){let o=this.props.cells[a][i];return{dateProfile:this.props.dateProfile,dateSpan:Object.assign({range:this.getCellRange(a,i),allDay:!0},o.extraDateSpan),dayEl:this.getCellEl(a,i),rect:{left:n.lefts[i],right:n.rights[i],top:s.tops[a],bottom:s.bottoms[a]},layer:0}}return null}getCellEl(e,t){return this.rowRefs.currentMap[e].getCellEls()[t]}getCellRange(e,t){let n=this.props.cells[e][t].date,s=us(n,1);return{start:n,end:s}}}function sx(r,e){return ci(r.filter(ix),e)}function ix(r){return r.eventRange.def.allDay}class ax extends mr{constructor(){super(...arguments),this.elRef=Lt(),this.needsScrollReset=!1}render(){let{props:e}=this,{dayMaxEventRows:t,dayMaxEvents:n,expandRows:s}=e,i=n===!0||t===!0;i&&!s&&(i=!1,t=null,n=null);let a=["fc-daygrid-body",i?"fc-daygrid-body-balanced":"fc-daygrid-body-unbalanced",s?"":"fc-daygrid-body-natural"];return C("div",{ref:this.elRef,className:a.join(" "),style:{width:e.clientWidth,minWidth:e.tableMinWidth}},C("table",{role:"presentation",className:"fc-scrollgrid-sync-table",style:{width:e.clientWidth,minWidth:e.tableMinWidth,height:s?e.clientHeight:""}},e.colGroupNode,C("tbody",{role:"presentation"},C(nx,{dateProfile:e.dateProfile,cells:e.cells,renderRowIntro:e.renderRowIntro,showWeekNumbers:e.showWeekNumbers,clientWidth:e.clientWidth,clientHeight:e.clientHeight,businessHourSegs:e.businessHourSegs,bgEventSegs:e.bgEventSegs,fgEventSegs:e.fgEventSegs,dateSelectionSegs:e.dateSelectionSegs,eventSelection:e.eventSelection,eventDrag:e.eventDrag,eventResize:e.eventResize,dayMaxEvents:n,dayMaxEventRows:t,forPrint:e.forPrint,isHitComboAllowed:e.isHitComboAllowed}))))}componentDidMount(){this.requestScrollReset()}componentDidUpdate(e){e.dateProfile!==this.props.dateProfile?this.requestScrollReset():this.flushScrollReset()}requestScrollReset(){this.needsScrollReset=!0,this.flushScrollReset()}flushScrollReset(){if(this.needsScrollReset&&this.props.clientWidth){const e=ox(this.elRef.current,this.props.dateProfile);if(e){const t=e.closest(".fc-daygrid-body"),n=t.closest(".fc-scroller"),s=e.getBoundingClientRect().top-t.getBoundingClientRect().top;n.scrollTop=s?s+1:0}this.needsScrollReset=!1}}}function ox(r,e){let t;return e.currentRangeUnit.match(/year|month/)&&(t=r.querySelector(`[data-date="${Qh(e.currentDate)}-01"]`)),t||(t=r.querySelector(`[data-date="${uo(e.currentDate)}"]`)),t}class lx extends Uc{constructor(){super(...arguments),this.forceDayIfListItem=!0}sliceRange(e,t){return t.sliceRange(e)}}class Vu extends mr{constructor(){super(...arguments),this.slicer=new lx,this.tableRef=Lt()}render(){let{props:e,context:t}=this;return C(ax,Object.assign({ref:this.tableRef},this.slicer.sliceProps(e,e.dateProfile,e.nextDayThreshold,t,e.dayTableModel),{dateProfile:e.dateProfile,cells:e.dayTableModel.cells,colGroupNode:e.colGroupNode,tableMinWidth:e.tableMinWidth,renderRowIntro:e.renderRowIntro,dayMaxEvents:e.dayMaxEvents,dayMaxEventRows:e.dayMaxEventRows,showWeekNumbers:e.showWeekNumbers,expandRows:e.expandRows,headerAlignElRef:e.headerAlignElRef,clientWidth:e.clientWidth,clientHeight:e.clientHeight,forPrint:e.forPrint}))}}class cx extends zS{constructor(){super(...arguments),this.buildDayTableModel=Xe(dx),this.headerRef=Lt(),this.tableRef=Lt()}render(){let{options:e,dateProfileGenerator:t}=this.context,{props:n}=this,s=this.buildDayTableModel(n.dateProfile,t),i=e.dayHeaders&&C(Zc,{ref:this.headerRef,dateProfile:n.dateProfile,dates:s.headerDates,datesRepDistinctDays:s.rowCnt===1}),a=o=>C(Vu,{ref:this.tableRef,dateProfile:n.dateProfile,dayTableModel:s,businessHours:n.businessHours,dateSelection:n.dateSelection,eventStore:n.eventStore,eventUiBases:n.eventUiBases,eventSelection:n.eventSelection,eventDrag:n.eventDrag,eventResize:n.eventResize,nextDayThreshold:e.nextDayThreshold,colGroupNode:o.tableColGroupNode,tableMinWidth:o.tableMinWidth,dayMaxEvents:e.dayMaxEvents,dayMaxEventRows:e.dayMaxEventRows,showWeekNumbers:e.weekNumbers,expandRows:!n.isHeightAuto,headerAlignElRef:this.headerElRef,clientWidth:o.clientWidth,clientHeight:o.clientHeight,forPrint:n.forPrint});return e.dayMinWidth?this.renderHScrollLayout(i,a,s.colCnt,e.dayMinWidth):this.renderSimpleLayout(i,a)}}function dx(r,e){let t=new rd(r.renderRange,e);return new nd(t,/year|month|week/.test(r.currentRangeUnit))}class ux extends ef{buildRenderRange(e,t,n){let s=super.buildRenderRange(e,t,n),{props:i}=this;return hx({currentRange:s,snapToWeek:/^(year|month)$/.test(t),fixedWeekCount:i.fixedWeekCount,dateEnv:i.dateEnv})}}function hx(r){let{dateEnv:e,currentRange:t}=r,{start:n,end:s}=t,i;if(r.snapToWeek&&(n=e.startOfWeek(n),i=e.startOfWeek(s),i.valueOf()!==s.valueOf()&&(s=Go(i,1))),r.fixedWeekCount){let a=e.startOfWeek(e.startOfMonth(us(t.end,-1))),o=Math.ceil(tf(a,s));s=Go(s,6-o)}return{start:n,end:s}}var fx=':root{--fc-daygrid-event-dot-width:8px}.fc-daygrid-day-events:after,.fc-daygrid-day-events:before,.fc-daygrid-day-frame:after,.fc-daygrid-day-frame:before,.fc-daygrid-event-harness:after,.fc-daygrid-event-harness:before{clear:both;content:"";display:table}.fc .fc-daygrid-body{position:relative;z-index:1}.fc .fc-daygrid-day.fc-day-today{background-color:var(--fc-today-bg-color)}.fc .fc-daygrid-day-frame{min-height:100%;position:relative}.fc .fc-daygrid-day-top{display:flex;flex-direction:row-reverse}.fc .fc-day-other .fc-daygrid-day-top{opacity:.3}.fc .fc-daygrid-day-number{padding:4px;position:relative;z-index:4}.fc .fc-daygrid-month-start{font-size:1.1em;font-weight:700}.fc .fc-daygrid-day-events{margin-top:1px}.fc .fc-daygrid-body-balanced .fc-daygrid-day-events{left:0;position:absolute;right:0}.fc .fc-daygrid-body-unbalanced .fc-daygrid-day-events{min-height:2em;position:relative}.fc .fc-daygrid-body-natural .fc-daygrid-day-events{margin-bottom:1em}.fc .fc-daygrid-event-harness{position:relative}.fc .fc-daygrid-event-harness-abs{left:0;position:absolute;right:0;top:0}.fc .fc-daygrid-bg-harness{bottom:0;position:absolute;top:0}.fc .fc-daygrid-day-bg .fc-non-business{z-index:1}.fc .fc-daygrid-day-bg .fc-bg-event{z-index:2}.fc .fc-daygrid-day-bg .fc-highlight{z-index:3}.fc .fc-daygrid-event{margin-top:1px;z-index:6}.fc .fc-daygrid-event.fc-event-mirror{z-index:7}.fc .fc-daygrid-day-bottom{font-size:.85em;margin:0 2px}.fc .fc-daygrid-day-bottom:after,.fc .fc-daygrid-day-bottom:before{clear:both;content:"";display:table}.fc .fc-daygrid-more-link{border-radius:3px;cursor:pointer;line-height:1;margin-top:1px;max-width:100%;overflow:hidden;padding:2px;position:relative;white-space:nowrap;z-index:4}.fc .fc-daygrid-more-link:hover{background-color:rgba(0,0,0,.1)}.fc .fc-daygrid-week-number{background-color:var(--fc-neutral-bg-color);color:var(--fc-neutral-text-color);min-width:1.5em;padding:2px;position:absolute;text-align:center;top:0;z-index:5}.fc .fc-more-popover .fc-popover-body{min-width:220px;padding:10px}.fc-direction-ltr .fc-daygrid-event.fc-event-start,.fc-direction-rtl .fc-daygrid-event.fc-event-end{margin-left:2px}.fc-direction-ltr .fc-daygrid-event.fc-event-end,.fc-direction-rtl .fc-daygrid-event.fc-event-start{margin-right:2px}.fc-direction-ltr .fc-daygrid-more-link{float:left}.fc-direction-ltr .fc-daygrid-week-number{border-radius:0 0 3px 0;left:0}.fc-direction-rtl .fc-daygrid-more-link{float:right}.fc-direction-rtl .fc-daygrid-week-number{border-radius:0 0 0 3px;right:0}.fc-liquid-hack .fc-daygrid-day-frame{position:static}.fc-daygrid-event{border-radius:3px;font-size:var(--fc-small-font-size);position:relative;white-space:nowrap}.fc-daygrid-block-event .fc-event-time{font-weight:700}.fc-daygrid-block-event .fc-event-time,.fc-daygrid-block-event .fc-event-title{padding:1px}.fc-daygrid-dot-event{align-items:center;display:flex;padding:2px 0}.fc-daygrid-dot-event .fc-event-title{flex-grow:1;flex-shrink:1;font-weight:700;min-width:0;overflow:hidden}.fc-daygrid-dot-event.fc-event-mirror,.fc-daygrid-dot-event:hover{background:rgba(0,0,0,.1)}.fc-daygrid-dot-event.fc-event-selected:before{bottom:-10px;top:-10px}.fc-daygrid-event-dot{border:calc(var(--fc-daygrid-event-dot-width)/2) solid var(--fc-event-border-color);border-radius:calc(var(--fc-daygrid-event-dot-width)/2);box-sizing:content-box;height:0;margin:0 4px;width:0}.fc-direction-ltr .fc-daygrid-event .fc-event-time{margin-right:3px}.fc-direction-rtl .fc-daygrid-event .fc-event-time{margin-left:3px}';go(fx);var gx=Ii({name:"@fullcalendar/daygrid",initialView:"dayGridMonth",views:{dayGrid:{component:cx,dateProfileGeneratorClass:ux},dayGridDay:{type:"dayGrid",duration:{days:1}},dayGridWeek:{type:"dayGrid",duration:{weeks:1}},dayGridMonth:{type:"dayGrid",duration:{months:1},fixedWeekCount:!0},dayGridYear:{type:"dayGrid",duration:{years:1}}}});class mx extends nf{getKeyInfo(){return{allDay:{},timed:{}}}getKeysForDateSpan(e){return e.allDay?["allDay"]:["timed"]}getKeysForEventDef(e){return e.allDay?sf(e)?["timed","allDay"]:["allDay"]:["timed"]}}const px=Rr({hour:"numeric",minute:"2-digit",omitZeroMinute:!0,meridiem:"short"});function Gu(r){let e=["fc-timegrid-slot","fc-timegrid-slot-label",r.isLabeled?"fc-scrollgrid-shrink":"fc-timegrid-slot-minor"];return C(af.Consumer,null,t=>{if(!r.isLabeled)return C("td",{className:e.join(" "),"data-time":r.isoTimeStr});let{dateEnv:n,options:s,viewApi:i}=t,a=s.slotLabelFormat==null?px:Array.isArray(s.slotLabelFormat)?Rr(s.slotLabelFormat[0]):Rr(s.slotLabelFormat),o={level:0,time:r.time,date:n.toDate(r.date),view:i,text:n.format(r.date,a)};return C(jn,{elTag:"td",elClasses:e,elAttrs:{"data-time":r.isoTimeStr},renderProps:o,generatorName:"slotLabelContent",customGenerator:s.slotLabelContent,defaultGenerator:bx,classNameGenerator:s.slotLabelClassNames,didMount:s.slotLabelDidMount,willUnmount:s.slotLabelWillUnmount},l=>C("div",{className:"fc-timegrid-slot-label-frame fc-scrollgrid-shrink-frame"},C(l,{elTag:"div",elClasses:["fc-timegrid-slot-label-cushion","fc-scrollgrid-shrink-cushion"]})))})}function bx(r){return r.text}class yx extends Kt{render(){return this.props.slatMetas.map(e=>C("tr",{key:e.key},C(Gu,Object.assign({},e))))}}const vx=Rr({week:"short"}),wx=5;class _x extends mr{constructor(){super(...arguments),this.allDaySplitter=new mx,this.headerElRef=Lt(),this.rootElRef=Lt(),this.scrollerElRef=Lt(),this.state={slatCoords:null},this.handleScrollTopRequest=e=>{let t=this.scrollerElRef.current;t&&(t.scrollTop=e)},this.renderHeadAxis=(e,t="")=>{let{options:n}=this.context,{dateProfile:s}=this.props,i=s.renderRange,o=rf(i.start,i.end)===1?hs(this.context,i.start,"week"):{};return n.weekNumbers&&e==="day"?C(qc,{elTag:"th",elClasses:["fc-timegrid-axis","fc-scrollgrid-shrink"],elAttrs:{"aria-hidden":!0},date:i.start,defaultFormat:vx},l=>C("div",{className:["fc-timegrid-axis-frame","fc-scrollgrid-shrink-frame","fc-timegrid-axis-frame-liquid"].join(" "),style:{height:t}},C(l,{elTag:"a",elClasses:["fc-timegrid-axis-cushion","fc-scrollgrid-shrink-cushion","fc-scrollgrid-sync-inner"],elAttrs:o}))):C("th",{"aria-hidden":!0,className:"fc-timegrid-axis"},C("div",{className:"fc-timegrid-axis-frame",style:{height:t}}))},this.renderTableRowAxis=e=>{let{options:t,viewApi:n}=this.context,s={text:t.allDayText,view:n};return C(jn,{elTag:"td",elClasses:["fc-timegrid-axis","fc-scrollgrid-shrink"],elAttrs:{"aria-hidden":!0},renderProps:s,generatorName:"allDayContent",customGenerator:t.allDayContent,defaultGenerator:Sx,classNameGenerator:t.allDayClassNames,didMount:t.allDayDidMount,willUnmount:t.allDayWillUnmount},i=>C("div",{className:["fc-timegrid-axis-frame","fc-scrollgrid-shrink-frame",e==null?" fc-timegrid-axis-frame-liquid":""].join(" "),style:{height:e}},C(i,{elTag:"span",elClasses:["fc-timegrid-axis-cushion","fc-scrollgrid-shrink-cushion","fc-scrollgrid-sync-inner"]})))},this.handleSlatCoords=e=>{this.setState({slatCoords:e})}}renderSimpleLayout(e,t,n){let{context:s,props:i}=this,a=[],o=ui(s.options);return e&&a.push({type:"header",key:"header",isSticky:o,chunk:{elRef:this.headerElRef,tableClassName:"fc-col-header",rowContent:e}}),t&&(a.push({type:"body",key:"all-day",chunk:{content:t}}),a.push({type:"body",key:"all-day-divider",outerContent:C("tr",{role:"presentation",className:"fc-scrollgrid-section"},C("td",{className:"fc-timegrid-divider "+s.theme.getClass("tableCellShaded")}))})),a.push({type:"body",key:"body",liquid:!0,expandRows:!!s.options.expandRows,chunk:{scrollerElRef:this.scrollerElRef,content:n}}),C(fs,{elRef:this.rootElRef,elClasses:["fc-timegrid"],viewSpec:s.viewSpec},C(ed,{liquid:!i.isHeightAuto&&!i.forPrint,collapsibleWidth:i.forPrint,cols:[{width:"shrink"}],sections:a}))}renderHScrollLayout(e,t,n,s,i,a,o){let l=this.context.pluginHooks.scrollGridImpl;if(!l)throw new Error("No ScrollGrid implementation");let{context:c,props:d}=this,u=!d.forPrint&&ui(c.options),f=!d.forPrint&&td(c.options),g=[];e&&g.push({type:"header",key:"header",isSticky:u,syncRowHeights:!0,chunks:[{key:"axis",rowContent:m=>C("tr",{role:"presentation"},this.renderHeadAxis("day",m.rowSyncHeights[0]))},{key:"cols",elRef:this.headerElRef,tableClassName:"fc-col-header",rowContent:e}]}),t&&(g.push({type:"body",key:"all-day",syncRowHeights:!0,chunks:[{key:"axis",rowContent:m=>C("tr",{role:"presentation"},this.renderTableRowAxis(m.rowSyncHeights[0]))},{key:"cols",content:t}]}),g.push({key:"all-day-divider",type:"body",outerContent:C("tr",{role:"presentation",className:"fc-scrollgrid-section"},C("td",{colSpan:2,className:"fc-timegrid-divider "+c.theme.getClass("tableCellShaded")}))}));let b=c.options.nowIndicator;return g.push({type:"body",key:"body",liquid:!0,expandRows:!!c.options.expandRows,chunks:[{key:"axis",content:m=>C("div",{className:"fc-timegrid-axis-chunk"},C("table",{"aria-hidden":!0,style:{height:m.expandRows?m.clientHeight:""}},m.tableColGroupNode,C("tbody",null,C(yx,{slatMetas:a}))),C("div",{className:"fc-timegrid-now-indicator-container"},C(Ai,{unit:b?"minute":"day"},y=>{let v=b&&o&&o.safeComputeTop(y);return typeof v=="number"?C(mo,{elClasses:["fc-timegrid-now-indicator-arrow"],elStyle:{top:v},isAxis:!0,date:y}):null})))},{key:"cols",scrollerElRef:this.scrollerElRef,content:n}]}),f&&g.push({key:"footer",type:"footer",isSticky:!0,chunks:[{key:"axis",content:Na},{key:"cols",content:Na}]}),C(fs,{elRef:this.rootElRef,elClasses:["fc-timegrid"],viewSpec:c.viewSpec},C(l,{liquid:!d.isHeightAuto&&!d.forPrint,forPrint:d.forPrint,collapsibleWidth:!1,colGroups:[{width:"shrink",cols:[{width:"shrink"}]},{cols:[{span:s,minWidth:i}]}],sections:g}))}getAllDayMaxEventProps(){let{dayMaxEvents:e,dayMaxEventRows:t}=this.context.options;return(e===!0||t===!0)&&(e=void 0,t=wx),{dayMaxEvents:e,dayMaxEventRows:t}}}function Sx(r){return r.text}class xx{constructor(e,t,n){this.positions=e,this.dateProfile=t,this.slotDuration=n}safeComputeTop(e){let{dateProfile:t}=this;if(df(t.currentRange,e)){let n=hi(e),s=e.valueOf()-n.valueOf();if(s>=En(t.slotMinTime)&&s<En(t.slotMaxTime))return this.computeTimeTop(Mn(s))}return null}computeDateTop(e,t){return t||(t=hi(e)),this.computeTimeTop(Mn(e.valueOf()-t.valueOf()))}computeTimeTop(e){let{positions:t,dateProfile:n}=this,s=t.els.length,i=(e.milliseconds-En(n.slotMinTime))/En(this.slotDuration),a,o;return i=Math.max(0,i),i=Math.min(s,i),a=Math.floor(i),a=Math.min(a,s-1),o=i-a,t.tops[a]+t.getHeight(a)*o}}class Ex extends Kt{render(){let{props:e,context:t}=this,{options:n}=t,{slatElRefs:s}=e;return C("tbody",null,e.slatMetas.map((i,a)=>{let o={time:i.time,date:t.dateEnv.toDate(i.date),view:t.viewApi};return C("tr",{key:i.key,ref:s.createRef(i.key)},e.axis&&C(Gu,Object.assign({},i)),C(jn,{elTag:"td",elClasses:["fc-timegrid-slot","fc-timegrid-slot-lane",!i.isLabeled&&"fc-timegrid-slot-minor"],elAttrs:{"data-time":i.isoTimeStr},renderProps:o,generatorName:"slotLaneContent",customGenerator:n.slotLaneContent,classNameGenerator:n.slotLaneClassNames,didMount:n.slotLaneDidMount,willUnmount:n.slotLaneWillUnmount}))}))}}class Tx extends Kt{constructor(){super(...arguments),this.rootElRef=Lt(),this.slatElRefs=new en}render(){let{props:e,context:t}=this;return C("div",{ref:this.rootElRef,className:"fc-timegrid-slots"},C("table",{"aria-hidden":!0,className:t.theme.getClass("table"),style:{minWidth:e.tableMinWidth,width:e.clientWidth,height:e.minHeight}},e.tableColGroupNode,C(Ex,{slatElRefs:this.slatElRefs,axis:e.axis,slatMetas:e.slatMetas})))}componentDidMount(){this.updateSizing()}componentDidUpdate(){this.updateSizing()}componentWillUnmount(){this.props.onCoords&&this.props.onCoords(null)}updateSizing(){let{context:e,props:t}=this;t.onCoords&&t.clientWidth!==null&&this.rootElRef.current.offsetHeight&&t.onCoords(new xx(new In(this.rootElRef.current,Rx(this.slatElRefs.currentMap,t.slatMetas),!1,!0),this.props.dateProfile,e.options.slotDuration))}}function Rx(r,e){return e.map(t=>r[t.key])}function Jn(r,e){let t=[],n;for(n=0;n<e;n+=1)t.push([]);if(r)for(n=0;n<r.length;n+=1)t[r[n].col].push(r[n]);return t}function yc(r,e){let t=[];if(r){for(let n=0;n<e;n+=1)t[n]={affectedInstances:r.affectedInstances,isEvent:r.isEvent,segs:[]};for(let n of r.segs)t[n.col].segs.push(n)}else for(let n=0;n<e;n+=1)t[n]=null;return t}class Ox extends Kt{render(){let{props:e}=this;return C(Jc,{elClasses:["fc-timegrid-more-link"],elStyle:{top:e.top,bottom:e.bottom},allDayDate:null,moreCnt:e.hiddenSegs.length,allSegs:e.hiddenSegs,hiddenSegs:e.hiddenSegs,extraDateSpan:e.extraDateSpan,dateProfile:e.dateProfile,todayRange:e.todayRange,popoverContent:()=>Yu(e.hiddenSegs,e),defaultGenerator:Cx,forceTimed:!0},t=>C(t,{elTag:"div",elClasses:["fc-timegrid-more-link-inner","fc-sticky"]}))}}function Cx(r){return r.shortText}function kx(r,e,t){let n=new Qc;e!=null&&(n.strictOrder=e),t!=null&&(n.maxStackCnt=t);let s=n.addSegs(r),i=uf(s),a=Dx(n);return a=Mx(a,1),{segRects:Px(a),hiddenGroups:i}}function Dx(r){const{entriesByLevel:e}=r,t=jo((n,s)=>n+":"+s,(n,s)=>{let i=Ix(r,n,s),a=vc(i,t),o=e[n][s];return[Object.assign(Object.assign({},o),{nextLevelNodes:a[0]}),o.thickness+a[1]]});return vc(e.length?{level:0,lateralStart:0,lateralEnd:e[0].length}:null,t)[0]}function vc(r,e){if(!r)return[[],0];let{level:t,lateralStart:n,lateralEnd:s}=r,i=n,a=[];for(;i<s;)a.push(e(t,i)),i+=1;return a.sort(Nx),[a.map(Ax),a[0][1]]}function Nx(r,e){return e[1]-r[1]}function Ax(r){return r[0]}function Ix(r,e,t){let{levelCoords:n,entriesByLevel:s}=r,i=s[e][t],a=n[e]+i.thickness,o=n.length,l=e;for(;l<o&&n[l]<a;l+=1);for(;l<o;l+=1){let c=s[l],d,u=ff(c,i.span.start,gf),f=u[0]+u[1],g=f;for(;(d=c[g])&&d.span.start<i.span.end;)g+=1;if(f<g)return{level:l,lateralStart:f,lateralEnd:g}}return null}function Mx(r,e){const t=jo((n,s,i)=>ns(n),(n,s,i)=>{let{nextLevelNodes:a,thickness:o}=n,l=o+i,c=o/l,d,u=[];if(!a.length)d=e;else for(let g of a)if(d===void 0){let b=t(g,s,l);d=b[0],u.push(b[1])}else{let b=t(g,d,0);u.push(b[1])}let f=(d-s)*c;return[d-f,Object.assign(Object.assign({},n),{thickness:f,nextLevelNodes:u})]});return r.map(n=>t(n,0,0)[1])}function Px(r){let e=[];const t=jo((s,i,a)=>ns(s),(s,i,a)=>{let o=Object.assign(Object.assign({},s),{levelCoord:i,stackDepth:a,stackForward:0});return e.push(o),o.stackForward=n(s.nextLevelNodes,i+s.thickness,a+1)+1});function n(s,i,a){let o=0;for(let l of s)o=Math.max(t(l,i,a),o);return o}return n(r,0,0),e}function jo(r,e){const t={};return(...n)=>{let s=r(...n);return s in t?t[s]:t[s]=e(...n)}}function wc(r,e,t=null,n=0){let s=[];if(t)for(let i=0;i<r.length;i+=1){let a=r[i],o=t.computeDateTop(a.start,e),l=Math.max(o+(n||0),t.computeDateTop(a.end,e));s.push({start:Math.round(o),end:Math.round(l)})}return s}function jx(r,e,t,n){let s=[],i=[];for(let c=0;c<r.length;c+=1){let d=e[c];d?s.push({index:c,thickness:1,span:d}):i.push(r[c])}let{segRects:a,hiddenGroups:o}=kx(s,t,n),l=[];for(let c of a)l.push({seg:r[c.index],rect:c});for(let c of i)l.push({seg:c,rect:null});return{segPlacements:l,hiddenGroups:o}}const Lx=Rr({hour:"numeric",minute:"2-digit",meridiem:!1});class Ku extends Kt{render(){return C(Xc,Object.assign({},this.props,{elClasses:["fc-timegrid-event","fc-v-event",this.props.isShort&&"fc-timegrid-event-short"],defaultTimeFormat:Lx}))}}class $x extends Kt{constructor(){super(...arguments),this.sortEventSegs=Xe(ho)}render(){let{props:e,context:t}=this,{options:n}=t,s=n.selectMirror,i=e.eventDrag&&e.eventDrag.segs||e.eventResize&&e.eventResize.segs||s&&e.dateSelectionSegs||[],a=e.eventDrag&&e.eventDrag.affectedInstances||e.eventResize&&e.eventResize.affectedInstances||{},o=this.sortEventSegs(e.fgEventSegs,n.eventOrder);return C(Gc,{elTag:"td",elRef:e.elRef,elClasses:["fc-timegrid-col",...e.extraClassNames||[]],elAttrs:Object.assign({role:"gridcell"},e.extraDataAttrs),date:e.date,dateProfile:e.dateProfile,todayRange:e.todayRange,extraRenderProps:e.extraRenderProps},l=>C("div",{className:"fc-timegrid-col-frame"},C("div",{className:"fc-timegrid-col-bg"},this.renderFillSegs(e.businessHourSegs,"non-business"),this.renderFillSegs(e.bgEventSegs,"bg-event"),this.renderFillSegs(e.dateSelectionSegs,"highlight")),C("div",{className:"fc-timegrid-col-events"},this.renderFgSegs(o,a,!1,!1,!1)),C("div",{className:"fc-timegrid-col-events"},this.renderFgSegs(i,{},!!e.eventDrag,!!e.eventResize,!!s,"mirror")),C("div",{className:"fc-timegrid-now-indicator-container"},this.renderNowIndicator(e.nowIndicatorSegs)),Vc(n)&&C(l,{elTag:"div",elClasses:["fc-timegrid-col-misc"]})))}renderFgSegs(e,t,n,s,i,a){let{props:o}=this;return o.forPrint?Yu(e,o):this.renderPositionedFgSegs(e,t,n,s,i,a)}renderPositionedFgSegs(e,t,n,s,i,a){let{eventMaxStack:o,eventShortHeight:l,eventOrderStrict:c,eventMinHeight:d}=this.context.options,{date:u,slatCoords:f,eventSelection:g,todayRange:b,nowDate:m}=this.props,y=n||s||i,v=wc(e,u,f,d),{segPlacements:p,hiddenGroups:w}=jx(e,v,c,o);return C(xt,null,this.renderHiddenGroups(w,e),p.map(S=>{let{seg:x,rect:E}=S,T=x.eventRange.instance.instanceId,R=y||!!(!t[T]&&E),k=Ra(E&&E.span),O=!y&&E?this.computeSegHStyle(E):{left:0,right:0},D=!!E&&E.stackForward>0,A=!!E&&E.span.end-E.span.start<l;return C("div",{className:"fc-timegrid-event-harness"+(D?" fc-timegrid-event-harness-inset":""),key:a||T,style:Object.assign(Object.assign({visibility:R?"":"hidden"},k),O)},C(Ku,Object.assign({seg:x,isDragging:n,isResizing:s,isDateSelecting:i,isSelected:T===g,isShort:A},Er(x,b,m))))}))}renderHiddenGroups(e,t){let{extraDateSpan:n,dateProfile:s,todayRange:i,nowDate:a,eventSelection:o,eventDrag:l,eventResize:c}=this.props;return C(xt,null,e.map(d=>{let u=Ra(d.span),f=Fx(d.entries,t);return C(Ox,{key:lf(cf(f)),hiddenSegs:f,top:u.top,bottom:u.bottom,extraDateSpan:n,dateProfile:s,todayRange:i,nowDate:a,eventSelection:o,eventDrag:l,eventResize:c})}))}renderFillSegs(e,t){let{props:n,context:s}=this,a=wc(e,n.date,n.slatCoords,s.options.eventMinHeight).map((o,l)=>{let c=e[l];return C("div",{key:Wc(c.eventRange),className:"fc-timegrid-bg-harness",style:Ra(o)},t==="bg-event"?C(zc,Object.assign({seg:c},Er(c,n.todayRange,n.nowDate))):Bc(t))});return C(xt,null,a)}renderNowIndicator(e){let{slatCoords:t,date:n}=this.props;return t?e.map((s,i)=>C(mo,{key:i,elClasses:["fc-timegrid-now-indicator-line"],elStyle:{top:t.computeDateTop(s.start,n)},isAxis:!1,date:n})):null}computeSegHStyle(e){let{isRtl:t,options:n}=this.context,s=n.slotEventOverlap,i=e.levelCoord,a=e.levelCoord+e.thickness,o,l;s&&(a=Math.min(1,i+(a-i)*2)),t?(o=1-a,l=i):(o=i,l=1-a);let c={zIndex:e.stackDepth+1,left:o*100+"%",right:l*100+"%"};return s&&!e.stackForward&&(c[t?"marginLeft":"marginRight"]=20),c}}function Yu(r,{todayRange:e,nowDate:t,eventSelection:n,eventDrag:s,eventResize:i}){let a=(s?s.affectedInstances:null)||(i?i.affectedInstances:null)||{};return C(xt,null,r.map(o=>{let l=o.eventRange.instance.instanceId;return C("div",{key:l,style:{visibility:a[l]?"hidden":""}},C(Ku,Object.assign({seg:o,isDragging:!1,isResizing:!1,isDateSelecting:!1,isSelected:l===n,isShort:!1},Er(o,e,t))))}))}function Ra(r){return r?{top:r.start,bottom:-r.end}:{top:"",bottom:""}}function Fx(r,e){return r.map(t=>e[t.index])}class Ux extends Kt{constructor(){super(...arguments),this.splitFgEventSegs=Xe(Jn),this.splitBgEventSegs=Xe(Jn),this.splitBusinessHourSegs=Xe(Jn),this.splitNowIndicatorSegs=Xe(Jn),this.splitDateSelectionSegs=Xe(Jn),this.splitEventDrag=Xe(yc),this.splitEventResize=Xe(yc),this.rootElRef=Lt(),this.cellElRefs=new en}render(){let{props:e,context:t}=this,n=t.options.nowIndicator&&e.slatCoords&&e.slatCoords.safeComputeTop(e.nowDate),s=e.cells.length,i=this.splitFgEventSegs(e.fgEventSegs,s),a=this.splitBgEventSegs(e.bgEventSegs,s),o=this.splitBusinessHourSegs(e.businessHourSegs,s),l=this.splitNowIndicatorSegs(e.nowIndicatorSegs,s),c=this.splitDateSelectionSegs(e.dateSelectionSegs,s),d=this.splitEventDrag(e.eventDrag,s),u=this.splitEventResize(e.eventResize,s);return C("div",{className:"fc-timegrid-cols",ref:this.rootElRef},C("table",{role:"presentation",style:{minWidth:e.tableMinWidth,width:e.clientWidth}},e.tableColGroupNode,C("tbody",{role:"presentation"},C("tr",{role:"row"},e.axis&&C("td",{"aria-hidden":!0,className:"fc-timegrid-col fc-timegrid-axis"},C("div",{className:"fc-timegrid-col-frame"},C("div",{className:"fc-timegrid-now-indicator-container"},typeof n=="number"&&C(mo,{elClasses:["fc-timegrid-now-indicator-arrow"],elStyle:{top:n},isAxis:!0,date:e.nowDate})))),e.cells.map((f,g)=>C($x,{key:f.key,elRef:this.cellElRefs.createRef(f.key),dateProfile:e.dateProfile,date:f.date,nowDate:e.nowDate,todayRange:e.todayRange,extraRenderProps:f.extraRenderProps,extraDataAttrs:f.extraDataAttrs,extraClassNames:f.extraClassNames,extraDateSpan:f.extraDateSpan,fgEventSegs:i[g],bgEventSegs:a[g],businessHourSegs:o[g],nowIndicatorSegs:l[g],dateSelectionSegs:c[g],eventDrag:d[g],eventResize:u[g],slatCoords:e.slatCoords,eventSelection:e.eventSelection,forPrint:e.forPrint}))))))}componentDidMount(){this.updateCoords()}componentDidUpdate(){this.updateCoords()}updateCoords(){let{props:e}=this;e.onColCoords&&e.clientWidth!==null&&e.onColCoords(new In(this.rootElRef.current,Hx(this.cellElRefs.currentMap,e.cells),!0,!1))}}function Hx(r,e){return e.map(t=>r[t.key])}class Bx extends mr{constructor(){super(...arguments),this.processSlotOptions=Xe(zx),this.state={slatCoords:null},this.handleRootEl=e=>{e?this.context.registerInteractiveComponent(this,{el:e,isHitComboAllowed:this.props.isHitComboAllowed}):this.context.unregisterInteractiveComponent(this)},this.handleScrollRequest=e=>{let{onScrollTopRequest:t}=this.props,{slatCoords:n}=this.state;if(t&&n){if(e.time){let s=n.computeTimeTop(e.time);s=Math.ceil(s),s&&(s+=1),t(s)}return!0}return!1},this.handleColCoords=e=>{this.colCoords=e},this.handleSlatCoords=e=>{this.setState({slatCoords:e}),this.props.onSlatCoords&&this.props.onSlatCoords(e)}}render(){let{props:e,state:t}=this;return C("div",{className:"fc-timegrid-body",ref:this.handleRootEl,style:{width:e.clientWidth,minWidth:e.tableMinWidth}},C(Tx,{axis:e.axis,dateProfile:e.dateProfile,slatMetas:e.slatMetas,clientWidth:e.clientWidth,minHeight:e.expandRows?e.clientHeight:"",tableMinWidth:e.tableMinWidth,tableColGroupNode:e.axis?e.tableColGroupNode:null,onCoords:this.handleSlatCoords}),C(Ux,{cells:e.cells,axis:e.axis,dateProfile:e.dateProfile,businessHourSegs:e.businessHourSegs,bgEventSegs:e.bgEventSegs,fgEventSegs:e.fgEventSegs,dateSelectionSegs:e.dateSelectionSegs,eventSelection:e.eventSelection,eventDrag:e.eventDrag,eventResize:e.eventResize,todayRange:e.todayRange,nowDate:e.nowDate,nowIndicatorSegs:e.nowIndicatorSegs,clientWidth:e.clientWidth,tableMinWidth:e.tableMinWidth,tableColGroupNode:e.tableColGroupNode,slatCoords:t.slatCoords,onColCoords:this.handleColCoords,forPrint:e.forPrint}))}componentDidMount(){this.scrollResponder=this.context.createScrollResponder(this.handleScrollRequest)}componentDidUpdate(e){this.scrollResponder.update(e.dateProfile!==this.props.dateProfile)}componentWillUnmount(){this.scrollResponder.detach()}queryHit(e,t){let{dateEnv:n,options:s}=this.context,{colCoords:i}=this,{dateProfile:a}=this.props,{slatCoords:o}=this.state,{snapDuration:l,snapsPerSlot:c}=this.processSlotOptions(this.props.slotDuration,s.snapDuration),d=i.leftToIndex(e),u=o.positions.topToIndex(t);if(d!=null&&u!=null){let f=this.props.cells[d],g=o.positions.tops[u],b=o.positions.getHeight(u),m=(t-g)/b,y=Math.floor(m*c),v=u*c+y,p=this.props.cells[d].date,w=Aa(a.slotMinTime,of(l,v)),S=n.add(p,w),x=n.add(S,l);return{dateProfile:a,dateSpan:Object.assign({range:{start:S,end:x},allDay:!1},f.extraDateSpan),dayEl:i.els[d],rect:{left:i.lefts[d],right:i.rights[d],top:g,bottom:g+b},layer:0}}return null}}function zx(r,e){let t=e||r,n=po(r,t);return n===null&&(t=r,n=1),{snapDuration:t,snapsPerSlot:n}}class Wx extends Uc{sliceRange(e,t){let n=[];for(let s=0;s<t.length;s+=1){let i=fo(e,t[s]);i&&n.push({start:i.start,end:i.end,isStart:i.start.valueOf()===e.start.valueOf(),isEnd:i.end.valueOf()===e.end.valueOf(),col:s})}return n}}class qx extends mr{constructor(){super(...arguments),this.buildDayRanges=Xe(Vx),this.slicer=new Wx,this.timeColsRef=Lt()}render(){let{props:e,context:t}=this,{dateProfile:n,dayTableModel:s}=e,{nowIndicator:i,nextDayThreshold:a}=t.options,o=this.buildDayRanges(s,n,t.dateEnv);return C(Ai,{unit:i?"minute":"day"},(l,c)=>C(Bx,Object.assign({ref:this.timeColsRef},this.slicer.sliceProps(e,n,null,t,o),{forPrint:e.forPrint,axis:e.axis,dateProfile:n,slatMetas:e.slatMetas,slotDuration:e.slotDuration,cells:s.cells[0],tableColGroupNode:e.tableColGroupNode,tableMinWidth:e.tableMinWidth,clientWidth:e.clientWidth,clientHeight:e.clientHeight,expandRows:e.expandRows,nowDate:l,nowIndicatorSegs:i&&this.slicer.sliceNowDate(l,n,a,t,o),todayRange:c,onScrollTopRequest:e.onScrollTopRequest,onSlatCoords:e.onSlatCoords})))}}function Vx(r,e,t){let n=[];for(let s of r.headerDates)n.push({start:t.add(s,e.slotMinTime),end:t.add(s,e.slotMaxTime)});return n}const _c=[{hours:1},{minutes:30},{minutes:15},{seconds:30},{seconds:15}];function Gx(r,e,t,n,s){let i=new Date(0),a=r,o=Mn(0),l=t||Kx(n),c=[];for(;En(a)<En(e);){let d=s.add(i,a),u=po(o,l)!==null;c.push({date:d,time:a,key:d.toISOString(),isoTimeStr:hf(d),isLabeled:u}),a=Aa(a,n),o=Aa(o,n)}return c}function Kx(r){let e,t,n;for(e=_c.length-1;e>=0;e-=1)if(t=Mn(_c[e]),n=po(t,r),n!==null&&n>1)return t;return r}class Yx extends _x{constructor(){super(...arguments),this.buildTimeColsModel=Xe(Xx),this.buildSlatMetas=Xe(Gx)}render(){let{options:e,dateEnv:t,dateProfileGenerator:n}=this.context,{props:s}=this,{dateProfile:i}=s,a=this.buildTimeColsModel(i,n),o=this.allDaySplitter.splitProps(s),l=this.buildSlatMetas(i.slotMinTime,i.slotMaxTime,e.slotLabelInterval,e.slotDuration,t),{dayMinWidth:c}=e,d=!c,u=c,f=e.dayHeaders&&C(Zc,{dates:a.headerDates,dateProfile:i,datesRepDistinctDays:!0,renderIntro:d?this.renderHeadAxis:null}),g=e.allDaySlot!==!1&&(m=>C(Vu,Object.assign({},o.allDay,{dateProfile:i,dayTableModel:a,nextDayThreshold:e.nextDayThreshold,tableMinWidth:m.tableMinWidth,colGroupNode:m.tableColGroupNode,renderRowIntro:d?this.renderTableRowAxis:null,showWeekNumbers:!1,expandRows:!1,headerAlignElRef:this.headerElRef,clientWidth:m.clientWidth,clientHeight:m.clientHeight,forPrint:s.forPrint},this.getAllDayMaxEventProps()))),b=m=>C(qx,Object.assign({},o.timed,{dayTableModel:a,dateProfile:i,axis:d,slotDuration:e.slotDuration,slatMetas:l,forPrint:s.forPrint,tableColGroupNode:m.tableColGroupNode,tableMinWidth:m.tableMinWidth,clientWidth:m.clientWidth,clientHeight:m.clientHeight,onSlatCoords:this.handleSlatCoords,expandRows:m.expandRows,onScrollTopRequest:this.handleScrollTopRequest}));return u?this.renderHScrollLayout(f,g,b,a.colCnt,c,l,this.state.slatCoords):this.renderSimpleLayout(f,g,b)}}function Xx(r,e){let t=new rd(r.renderRange,e);return new nd(t,!1)}var Qx='.fc-v-event{background-color:var(--fc-event-bg-color);border:1px solid var(--fc-event-border-color);display:block}.fc-v-event .fc-event-main{color:var(--fc-event-text-color);height:100%}.fc-v-event .fc-event-main-frame{display:flex;flex-direction:column;height:100%}.fc-v-event .fc-event-time{flex-grow:0;flex-shrink:0;max-height:100%;overflow:hidden}.fc-v-event .fc-event-title-container{flex-grow:1;flex-shrink:1;min-height:0}.fc-v-event .fc-event-title{bottom:0;max-height:100%;overflow:hidden;top:0}.fc-v-event:not(.fc-event-start){border-top-left-radius:0;border-top-right-radius:0;border-top-width:0}.fc-v-event:not(.fc-event-end){border-bottom-left-radius:0;border-bottom-right-radius:0;border-bottom-width:0}.fc-v-event.fc-event-selected:before{left:-10px;right:-10px}.fc-v-event .fc-event-resizer-start{cursor:n-resize}.fc-v-event .fc-event-resizer-end{cursor:s-resize}.fc-v-event:not(.fc-event-selected) .fc-event-resizer{height:var(--fc-event-resizer-thickness);left:0;right:0}.fc-v-event:not(.fc-event-selected) .fc-event-resizer-start{top:calc(var(--fc-event-resizer-thickness)/-2)}.fc-v-event:not(.fc-event-selected) .fc-event-resizer-end{bottom:calc(var(--fc-event-resizer-thickness)/-2)}.fc-v-event.fc-event-selected .fc-event-resizer{left:50%;margin-left:calc(var(--fc-event-resizer-dot-total-width)/-2)}.fc-v-event.fc-event-selected .fc-event-resizer-start{top:calc(var(--fc-event-resizer-dot-total-width)/-2)}.fc-v-event.fc-event-selected .fc-event-resizer-end{bottom:calc(var(--fc-event-resizer-dot-total-width)/-2)}.fc .fc-timegrid .fc-daygrid-body{z-index:2}.fc .fc-timegrid-divider{padding:0 0 2px}.fc .fc-timegrid-body{min-height:100%;position:relative;z-index:1}.fc .fc-timegrid-axis-chunk{position:relative}.fc .fc-timegrid-axis-chunk>table,.fc .fc-timegrid-slots{position:relative;z-index:1}.fc .fc-timegrid-slot{border-bottom:0;height:1.5em}.fc .fc-timegrid-slot:empty:before{content:"\\00a0"}.fc .fc-timegrid-slot-minor{border-top-style:dotted}.fc .fc-timegrid-slot-label-cushion{display:inline-block;white-space:nowrap}.fc .fc-timegrid-slot-label{vertical-align:middle}.fc .fc-timegrid-axis-cushion,.fc .fc-timegrid-slot-label-cushion{padding:0 4px}.fc .fc-timegrid-axis-frame-liquid{height:100%}.fc .fc-timegrid-axis-frame{align-items:center;display:flex;justify-content:flex-end;overflow:hidden}.fc .fc-timegrid-axis-cushion{flex-shrink:0;max-width:60px}.fc-direction-ltr .fc-timegrid-slot-label-frame{text-align:right}.fc-direction-rtl .fc-timegrid-slot-label-frame{text-align:left}.fc-liquid-hack .fc-timegrid-axis-frame-liquid{bottom:0;height:auto;left:0;position:absolute;right:0;top:0}.fc .fc-timegrid-col.fc-day-today{background-color:var(--fc-today-bg-color)}.fc .fc-timegrid-col-frame{min-height:100%;position:relative}.fc-media-screen.fc-liquid-hack .fc-timegrid-col-frame{bottom:0;height:auto;left:0;position:absolute;right:0;top:0}.fc-media-screen .fc-timegrid-cols{bottom:0;left:0;position:absolute;right:0;top:0}.fc-media-screen .fc-timegrid-cols>table{height:100%}.fc-media-screen .fc-timegrid-col-bg,.fc-media-screen .fc-timegrid-col-events,.fc-media-screen .fc-timegrid-now-indicator-container{left:0;position:absolute;right:0;top:0}.fc .fc-timegrid-col-bg{z-index:2}.fc .fc-timegrid-col-bg .fc-non-business{z-index:1}.fc .fc-timegrid-col-bg .fc-bg-event{z-index:2}.fc .fc-timegrid-col-bg .fc-highlight{z-index:3}.fc .fc-timegrid-bg-harness{left:0;position:absolute;right:0}.fc .fc-timegrid-col-events{z-index:3}.fc .fc-timegrid-now-indicator-container{bottom:0;overflow:hidden}.fc-direction-ltr .fc-timegrid-col-events{margin:0 2.5% 0 2px}.fc-direction-rtl .fc-timegrid-col-events{margin:0 2px 0 2.5%}.fc-timegrid-event-harness{position:absolute}.fc-timegrid-event-harness>.fc-timegrid-event{bottom:0;left:0;position:absolute;right:0;top:0}.fc-timegrid-event-harness-inset .fc-timegrid-event,.fc-timegrid-event.fc-event-mirror,.fc-timegrid-more-link{box-shadow:0 0 0 1px var(--fc-page-bg-color)}.fc-timegrid-event,.fc-timegrid-more-link{border-radius:3px;font-size:var(--fc-small-font-size)}.fc-timegrid-event{margin-bottom:1px}.fc-timegrid-event .fc-event-main{padding:1px 1px 0}.fc-timegrid-event .fc-event-time{font-size:var(--fc-small-font-size);margin-bottom:1px;white-space:nowrap}.fc-timegrid-event-short .fc-event-main-frame{flex-direction:row;overflow:hidden}.fc-timegrid-event-short .fc-event-time:after{content:"\\00a0-\\00a0"}.fc-timegrid-event-short .fc-event-title{font-size:var(--fc-small-font-size)}.fc-timegrid-more-link{background:var(--fc-more-link-bg-color);color:var(--fc-more-link-text-color);cursor:pointer;margin-bottom:1px;position:absolute;z-index:9999}.fc-timegrid-more-link-inner{padding:3px 2px;top:0}.fc-direction-ltr .fc-timegrid-more-link{right:0}.fc-direction-rtl .fc-timegrid-more-link{left:0}.fc .fc-timegrid-now-indicator-arrow,.fc .fc-timegrid-now-indicator-line{pointer-events:none}.fc .fc-timegrid-now-indicator-line{border-color:var(--fc-now-indicator-color);border-style:solid;border-width:1px 0 0;left:0;position:absolute;right:0;z-index:4}.fc .fc-timegrid-now-indicator-arrow{border-color:var(--fc-now-indicator-color);border-style:solid;margin-top:-5px;position:absolute;z-index:4}.fc-direction-ltr .fc-timegrid-now-indicator-arrow{border-bottom-color:transparent;border-top-color:transparent;border-width:5px 0 5px 6px;left:0}.fc-direction-rtl .fc-timegrid-now-indicator-arrow{border-bottom-color:transparent;border-top-color:transparent;border-width:5px 6px 5px 0;right:0}';go(Qx);const Jx={allDaySlot:Boolean};var Zx=Ii({name:"@fullcalendar/timegrid",initialView:"timeGridWeek",optionRefiners:Jx,views:{timeGrid:{component:Yx,usesMinMaxTime:!0,allDaySlot:!0,slotDuration:"00:30:00",slotEventOverlap:!0},timeGridDay:{type:"timeGrid",duration:{days:1}},timeGridWeek:{type:"timeGrid",duration:{weeks:1}}}});class eE extends Kt{constructor(){super(...arguments),this.state={textId:rs()}}render(){let{theme:e,dateEnv:t,options:n,viewApi:s}=this.context,{cellId:i,dayDate:a,todayRange:o}=this.props,{textId:l}=this.state,c=bf(a,o),d=n.listDayFormat?t.format(a,n.listDayFormat):"",u=n.listDaySideFormat?t.format(a,n.listDaySideFormat):"",f=Object.assign({date:t.toDate(a),view:s,textId:l,text:d,sideText:u,navLinkAttrs:hs(this.context,a),sideNavLinkAttrs:hs(this.context,a,"day",!1)},c);return C(jn,{elTag:"tr",elClasses:["fc-list-day",...yf(c,e)],elAttrs:{"data-date":uo(a)},renderProps:f,generatorName:"dayHeaderContent",customGenerator:n.dayHeaderContent,defaultGenerator:tE,classNameGenerator:n.dayHeaderClassNames,didMount:n.dayHeaderDidMount,willUnmount:n.dayHeaderWillUnmount},g=>C("th",{scope:"colgroup",colSpan:3,id:i,"aria-labelledby":l},C(g,{elTag:"div",elClasses:["fc-list-day-cushion",e.getClass("tableCellShaded")]})))}}function tE(r){return C(xt,null,r.text&&C("a",Object.assign({id:r.textId,className:"fc-list-day-text"},r.navLinkAttrs),r.text),r.sideText&&C("a",Object.assign({"aria-hidden":!0,className:"fc-list-day-side-text"},r.sideNavLinkAttrs),r.sideText))}const rE=Rr({hour:"numeric",minute:"2-digit",meridiem:"short"});class nE extends Kt{render(){let{props:e,context:t}=this,{options:n}=t,{seg:s,timeHeaderId:i,eventHeaderId:a,dateHeaderId:o}=e,l=n.eventTimeFormat||rE;return C(Yc,Object.assign({},e,{elTag:"tr",elClasses:["fc-list-event",s.eventRange.def.url&&"fc-event-forced-url"],defaultGenerator:()=>sE(s,t),seg:s,timeText:"",disableDragging:!0,disableResizing:!0}),(c,d)=>C(xt,null,iE(s,l,t,i,o),C("td",{"aria-hidden":!0,className:"fc-list-event-graphic"},C("span",{className:"fc-list-event-dot",style:{borderColor:d.borderColor||d.backgroundColor}})),C(c,{elTag:"td",elClasses:["fc-list-event-title"],elAttrs:{headers:`${a} ${o}`}})))}}function sE(r,e){let t=Kc(r,e);return C("a",Object.assign({},t),r.eventRange.def.title)}function iE(r,e,t,n,s){let{options:i}=t;if(i.displayEventTime!==!1){let a=r.eventRange.def,o=r.eventRange.instance,l=!1,c;if(a.allDay?l=!0:vf(r.eventRange.range)?r.isStart?c=ri(r,e,t,null,null,o.range.start,r.end):r.isEnd?c=ri(r,e,t,null,null,r.start,o.range.end):l=!0:c=ri(r,e,t),l){let d={text:t.options.allDayText,view:t.viewApi};return C(jn,{elTag:"td",elClasses:["fc-list-event-time"],elAttrs:{headers:`${n} ${s}`},renderProps:d,generatorName:"allDayContent",customGenerator:i.allDayContent,defaultGenerator:aE,classNameGenerator:i.allDayClassNames,didMount:i.allDayDidMount,willUnmount:i.allDayWillUnmount})}return C("td",{className:"fc-list-event-time"},c)}return null}function aE(r){return r.text}class oE extends mr{constructor(){super(...arguments),this.computeDateVars=Xe(cE),this.eventStoreToSegs=Xe(this._eventStoreToSegs),this.state={timeHeaderId:rs(),eventHeaderId:rs(),dateHeaderIdRoot:rs()},this.setRootEl=e=>{e?this.context.registerInteractiveComponent(this,{el:e}):this.context.unregisterInteractiveComponent(this)}}render(){let{props:e,context:t}=this,{dayDates:n,dayRanges:s}=this.computeDateVars(e.dateProfile),i=this.eventStoreToSegs(e.eventStore,e.eventUiBases,s);return C(fs,{elRef:this.setRootEl,elClasses:["fc-list",t.theme.getClass("table"),t.options.stickyHeaderDates!==!1?"fc-list-sticky":""],viewSpec:t.viewSpec},C(mf,{liquid:!e.isHeightAuto,overflowX:e.isHeightAuto?"visible":"hidden",overflowY:e.isHeightAuto?"visible":"auto"},i.length>0?this.renderSegList(i,n):this.renderEmptyMessage()))}renderEmptyMessage(){let{options:e,viewApi:t}=this.context,n={text:e.noEventsText,view:t};return C(jn,{elTag:"div",elClasses:["fc-list-empty"],renderProps:n,generatorName:"noEventsContent",customGenerator:e.noEventsContent,defaultGenerator:lE,classNameGenerator:e.noEventsClassNames,didMount:e.noEventsDidMount,willUnmount:e.noEventsWillUnmount},s=>C(s,{elTag:"div",elClasses:["fc-list-empty-cushion"]}))}renderSegList(e,t){let{theme:n,options:s}=this.context,{timeHeaderId:i,eventHeaderId:a,dateHeaderIdRoot:o}=this.state,l=dE(e);return C(Ai,{unit:"day"},(c,d)=>{let u=[];for(let f=0;f<l.length;f+=1){let g=l[f];if(g){let b=uo(t[f]),m=o+"-"+b;u.push(C(eE,{key:b,cellId:m,dayDate:t[f],todayRange:d})),g=ho(g,s.eventOrder);for(let y of g)u.push(C(nE,Object.assign({key:b+":"+y.eventRange.instance.instanceId,seg:y,isDragging:!1,isResizing:!1,isDateSelecting:!1,isSelected:!1,timeHeaderId:i,eventHeaderId:a,dateHeaderId:m},Er(y,d,c))))}}return C("table",{className:"fc-list-table "+n.getClass("table")},C("thead",null,C("tr",null,C("th",{scope:"col",id:i},s.timeHint),C("th",{scope:"col","aria-hidden":!0}),C("th",{scope:"col",id:a},s.eventHint))),C("tbody",null,u))})}_eventStoreToSegs(e,t,n){return this.eventRangesToSegs(pf(e,t,this.props.dateProfile.activeRange,this.context.options.nextDayThreshold).fg,n)}eventRangesToSegs(e,t){let n=[];for(let s of e)n.push(...this.eventRangeToSegs(s,t));return n}eventRangeToSegs(e,t){let{dateEnv:n}=this.context,{nextDayThreshold:s}=this.context.options,i=e.range,a=e.def.allDay,o,l,c,d=[];for(o=0;o<t.length;o+=1)if(l=fo(i,t[o]),l&&(c={component:this,eventRange:e,start:l.start,end:l.end,isStart:e.isStart&&l.start.valueOf()===i.start.valueOf(),isEnd:e.isEnd&&l.end.valueOf()===i.end.valueOf(),dayIndex:o},d.push(c),!c.isEnd&&!a&&o+1<t.length&&i.end<n.add(t[o+1].start,s))){c.end=i.end,c.isEnd=!0;break}return d}}function lE(r){return r.text}function cE(r){let e=hi(r.renderRange.start),t=r.renderRange.end,n=[],s=[];for(;e<t;)n.push(e),s.push({start:e,end:us(e,1)}),e=us(e,1);return{dayDates:n,dayRanges:s}}function dE(r){let e=[],t,n;for(t=0;t<r.length;t+=1)n=r[t],(e[n.dayIndex]||(e[n.dayIndex]=[])).push(n);return e}var uE=':root{--fc-list-event-dot-width:10px;--fc-list-event-hover-bg-color:#f5f5f5}.fc-theme-standard .fc-list{border:1px solid var(--fc-border-color)}.fc .fc-list-empty{align-items:center;background-color:var(--fc-neutral-bg-color);display:flex;height:100%;justify-content:center}.fc .fc-list-empty-cushion{margin:5em 0}.fc .fc-list-table{border-style:hidden;width:100%}.fc .fc-list-table tr>*{border-left:0;border-right:0}.fc .fc-list-sticky .fc-list-day>*{background:var(--fc-page-bg-color);position:sticky;top:0}.fc .fc-list-table thead{left:-10000px;position:absolute}.fc .fc-list-table tbody>tr:first-child th{border-top:0}.fc .fc-list-table th{padding:0}.fc .fc-list-day-cushion,.fc .fc-list-table td{padding:8px 14px}.fc .fc-list-day-cushion:after{clear:both;content:"";display:table}.fc-theme-standard .fc-list-day-cushion{background-color:var(--fc-neutral-bg-color)}.fc-direction-ltr .fc-list-day-text,.fc-direction-rtl .fc-list-day-side-text{float:left}.fc-direction-ltr .fc-list-day-side-text,.fc-direction-rtl .fc-list-day-text{float:right}.fc-direction-ltr .fc-list-table .fc-list-event-graphic{padding-right:0}.fc-direction-rtl .fc-list-table .fc-list-event-graphic{padding-left:0}.fc .fc-list-event.fc-event-forced-url{cursor:pointer}.fc .fc-list-event:hover td{background-color:var(--fc-list-event-hover-bg-color)}.fc .fc-list-event-graphic,.fc .fc-list-event-time{white-space:nowrap;width:1px}.fc .fc-list-event-dot{border:calc(var(--fc-list-event-dot-width)/2) solid var(--fc-event-border-color);border-radius:calc(var(--fc-list-event-dot-width)/2);box-sizing:content-box;display:inline-block;height:0;width:0}.fc .fc-list-event-title a{color:inherit;text-decoration:none}.fc .fc-list-event.fc-event-forced-url:hover a{text-decoration:underline}';go(uE);const hE={listDayFormat:Sc,listDaySideFormat:Sc,noEventsClassNames:Tt,noEventsContent:Tt,noEventsDidMount:Tt,noEventsWillUnmount:Tt};function Sc(r){return r===!1?null:Rr(r)}var fE=Ii({name:"@fullcalendar/list",optionRefiners:hE,views:{list:{component:oE,buttonTextKey:"list",listDayFormat:{month:"long",day:"numeric",year:"numeric"}},listDay:{type:"list",duration:{days:1},listDayFormat:{weekday:"long"}},listWeek:{type:"list",duration:{weeks:1},listDayFormat:{weekday:"long"},listDaySideFormat:{month:"long",day:"numeric",year:"numeric"}},listMonth:{type:"list",duration:{month:1},listDaySideFormat:{weekday:"long"}},listYear:{type:"list",duration:{year:1},listDaySideFormat:{weekday:"long"}}}});wo.touchMouseIgnoreWait=500;let so=0,Si=0,io=!1;class Xu{constructor(e){this.subjectEl=null,this.selector="",this.handleSelector="",this.shouldIgnoreMove=!1,this.shouldWatchScroll=!0,this.isDragging=!1,this.isTouchDragging=!1,this.wasTouchScroll=!1,this.handleMouseDown=t=>{if(!this.shouldIgnoreMouse()&&gE(t)&&this.tryStart(t)){let n=this.createEventFromMouse(t,!0);this.emitter.trigger("pointerdown",n),this.initScrollWatch(n),this.shouldIgnoreMove||document.addEventListener("mousemove",this.handleMouseMove),document.addEventListener("mouseup",this.handleMouseUp)}},this.handleMouseMove=t=>{let n=this.createEventFromMouse(t);this.recordCoords(n),this.emitter.trigger("pointermove",n)},this.handleMouseUp=t=>{document.removeEventListener("mousemove",this.handleMouseMove),document.removeEventListener("mouseup",this.handleMouseUp),this.emitter.trigger("pointerup",this.createEventFromMouse(t)),this.cleanup()},this.handleTouchStart=t=>{if(this.tryStart(t)){this.isTouchDragging=!0;let n=this.createEventFromTouch(t,!0);this.emitter.trigger("pointerdown",n),this.initScrollWatch(n);let s=t.target;this.shouldIgnoreMove||s.addEventListener("touchmove",this.handleTouchMove),s.addEventListener("touchend",this.handleTouchEnd),s.addEventListener("touchcancel",this.handleTouchEnd),window.addEventListener("scroll",this.handleTouchScroll,!0)}},this.handleTouchMove=t=>{let n=this.createEventFromTouch(t);this.recordCoords(n),this.emitter.trigger("pointermove",n)},this.handleTouchEnd=t=>{if(this.isDragging){let n=t.target;n.removeEventListener("touchmove",this.handleTouchMove),n.removeEventListener("touchend",this.handleTouchEnd),n.removeEventListener("touchcancel",this.handleTouchEnd),window.removeEventListener("scroll",this.handleTouchScroll,!0),this.emitter.trigger("pointerup",this.createEventFromTouch(t)),this.cleanup(),this.isTouchDragging=!1,mE()}},this.handleTouchScroll=()=>{this.wasTouchScroll=!0},this.handleScroll=t=>{if(!this.shouldIgnoreMove){let n=window.scrollX-this.prevScrollX+this.prevPageX,s=window.scrollY-this.prevScrollY+this.prevPageY;this.emitter.trigger("pointermove",{origEvent:t,isTouch:this.isTouchDragging,subjectEl:this.subjectEl,pageX:n,pageY:s,deltaX:n-this.origPageX,deltaY:s-this.origPageY})}},this.containerEl=e,this.emitter=new od,e.addEventListener("mousedown",this.handleMouseDown),e.addEventListener("touchstart",this.handleTouchStart,{passive:!0}),pE()}destroy(){this.containerEl.removeEventListener("mousedown",this.handleMouseDown),this.containerEl.removeEventListener("touchstart",this.handleTouchStart,{passive:!0}),bE()}tryStart(e){let t=this.querySubjectEl(e),n=e.target;return t&&(!this.handleSelector||an(n,this.handleSelector))?(this.subjectEl=t,this.isDragging=!0,this.wasTouchScroll=!1,!0):!1}cleanup(){io=!1,this.isDragging=!1,this.subjectEl=null,this.destroyScrollWatch()}querySubjectEl(e){return this.selector?an(e.target,this.selector):this.containerEl}shouldIgnoreMouse(){return so||this.isTouchDragging}cancelTouchScroll(){this.isDragging&&(io=!0)}initScrollWatch(e){this.shouldWatchScroll&&(this.recordCoords(e),window.addEventListener("scroll",this.handleScroll,!0))}recordCoords(e){this.shouldWatchScroll&&(this.prevPageX=e.pageX,this.prevPageY=e.pageY,this.prevScrollX=window.scrollX,this.prevScrollY=window.scrollY)}destroyScrollWatch(){this.shouldWatchScroll&&window.removeEventListener("scroll",this.handleScroll,!0)}createEventFromMouse(e,t){let n=0,s=0;return t?(this.origPageX=e.pageX,this.origPageY=e.pageY):(n=e.pageX-this.origPageX,s=e.pageY-this.origPageY),{origEvent:e,isTouch:!1,subjectEl:this.subjectEl,pageX:e.pageX,pageY:e.pageY,deltaX:n,deltaY:s}}createEventFromTouch(e,t){let n=e.touches,s,i,a=0,o=0;return n&&n.length?(s=n[0].pageX,i=n[0].pageY):(s=e.pageX,i=e.pageY),t?(this.origPageX=s,this.origPageY=i):(a=s-this.origPageX,o=i-this.origPageY),{origEvent:e,isTouch:!0,subjectEl:this.subjectEl,pageX:s,pageY:i,deltaX:a,deltaY:o}}}function gE(r){return r.button===0&&!r.ctrlKey}function mE(){so+=1,setTimeout(()=>{so-=1},wo.touchMouseIgnoreWait)}function pE(){Si+=1,Si===1&&window.addEventListener("touchmove",Qu,{passive:!1})}function bE(){Si-=1,Si||window.removeEventListener("touchmove",Qu,{passive:!1})}function Qu(r){io&&r.preventDefault()}class yE{constructor(){this.isVisible=!1,this.sourceEl=null,this.mirrorEl=null,this.sourceElRect=null,this.parentNode=document.body,this.zIndex=9999,this.revertDuration=0}start(e,t,n){this.sourceEl=e,this.sourceElRect=this.sourceEl.getBoundingClientRect(),this.origScreenX=t-window.scrollX,this.origScreenY=n-window.scrollY,this.deltaX=0,this.deltaY=0,this.updateElPosition()}handleMove(e,t){this.deltaX=e-window.scrollX-this.origScreenX,this.deltaY=t-window.scrollY-this.origScreenY,this.updateElPosition()}setIsVisible(e){e?this.isVisible||(this.mirrorEl&&(this.mirrorEl.style.display=""),this.isVisible=e,this.updateElPosition()):this.isVisible&&(this.mirrorEl&&(this.mirrorEl.style.display="none"),this.isVisible=e)}stop(e,t){let n=()=>{this.cleanup(),t()};e&&this.mirrorEl&&this.isVisible&&this.revertDuration&&(this.deltaX||this.deltaY)?this.doRevertAnimation(n,this.revertDuration):setTimeout(n,0)}doRevertAnimation(e,t){let n=this.mirrorEl,s=this.sourceEl.getBoundingClientRect();n.style.transition="top "+t+"ms,left "+t+"ms",ea(n,{left:s.left,top:s.top}),kf(n,()=>{n.style.transition="",e()})}cleanup(){this.mirrorEl&&(Df(this.mirrorEl),this.mirrorEl=null),this.sourceEl=null}updateElPosition(){this.sourceEl&&this.isVisible&&ea(this.getMirrorEl(),{left:this.sourceElRect.left+this.deltaX,top:this.sourceElRect.top+this.deltaY})}getMirrorEl(){let e=this.sourceElRect,t=this.mirrorEl;return t||(t=this.mirrorEl=this.sourceEl.cloneNode(!0),t.style.userSelect="none",t.style.webkitUserSelect="none",t.style.pointerEvents="none",t.classList.add("fc-event-dragging"),ea(t,{position:"fixed",zIndex:this.zIndex,visibility:"",boxSizing:"border-box",width:e.right-e.left,height:e.bottom-e.top,right:"auto",bottom:"auto",margin:0}),this.parentNode.appendChild(t)),t}}class Ju extends Hf{constructor(e,t){super(),this.handleScroll=()=>{this.scrollTop=this.scrollController.getScrollTop(),this.scrollLeft=this.scrollController.getScrollLeft(),this.handleScrollChange()},this.scrollController=e,this.doesListening=t,this.scrollTop=this.origScrollTop=e.getScrollTop(),this.scrollLeft=this.origScrollLeft=e.getScrollLeft(),this.scrollWidth=e.getScrollWidth(),this.scrollHeight=e.getScrollHeight(),this.clientWidth=e.getClientWidth(),this.clientHeight=e.getClientHeight(),this.clientRect=this.computeClientRect(),this.doesListening&&this.getEventTarget().addEventListener("scroll",this.handleScroll)}destroy(){this.doesListening&&this.getEventTarget().removeEventListener("scroll",this.handleScroll)}getScrollTop(){return this.scrollTop}getScrollLeft(){return this.scrollLeft}setScrollTop(e){this.scrollController.setScrollTop(e),this.doesListening||(this.scrollTop=Math.max(Math.min(e,this.getMaxScrollTop()),0),this.handleScrollChange())}setScrollLeft(e){this.scrollController.setScrollLeft(e),this.doesListening||(this.scrollLeft=Math.max(Math.min(e,this.getMaxScrollLeft()),0),this.handleScrollChange())}getClientWidth(){return this.clientWidth}getClientHeight(){return this.clientHeight}getScrollWidth(){return this.scrollWidth}getScrollHeight(){return this.scrollHeight}handleScrollChange(){}}class Zu extends Ju{constructor(e,t){super(new Ff(e),t)}getEventTarget(){return this.scrollController.el}computeClientRect(){return Uf(this.scrollController.el)}}class vE extends Ju{constructor(e){super(new $f,e)}getEventTarget(){return window}computeClientRect(){return{left:this.scrollLeft,right:this.scrollLeft+this.clientWidth,top:this.scrollTop,bottom:this.scrollTop+this.clientHeight}}handleScrollChange(){this.clientRect=this.computeClientRect()}}const xc=typeof performance=="function"?performance.now:Date.now;class wE{constructor(){this.isEnabled=!0,this.scrollQuery=[window,".fc-scroller"],this.edgeThreshold=50,this.maxVelocity=300,this.pointerScreenX=null,this.pointerScreenY=null,this.isAnimating=!1,this.scrollCaches=null,this.everMovedUp=!1,this.everMovedDown=!1,this.everMovedLeft=!1,this.everMovedRight=!1,this.animate=()=>{if(this.isAnimating){let e=this.computeBestEdge(this.pointerScreenX+window.scrollX,this.pointerScreenY+window.scrollY);if(e){let t=xc();this.handleSide(e,(t-this.msSinceRequest)/1e3),this.requestAnimation(t)}else this.isAnimating=!1}}}start(e,t,n){this.isEnabled&&(this.scrollCaches=this.buildCaches(n),this.pointerScreenX=null,this.pointerScreenY=null,this.everMovedUp=!1,this.everMovedDown=!1,this.everMovedLeft=!1,this.everMovedRight=!1,this.handleMove(e,t))}handleMove(e,t){if(this.isEnabled){let n=e-window.scrollX,s=t-window.scrollY,i=this.pointerScreenY===null?0:s-this.pointerScreenY,a=this.pointerScreenX===null?0:n-this.pointerScreenX;i<0?this.everMovedUp=!0:i>0&&(this.everMovedDown=!0),a<0?this.everMovedLeft=!0:a>0&&(this.everMovedRight=!0),this.pointerScreenX=n,this.pointerScreenY=s,this.isAnimating||(this.isAnimating=!0,this.requestAnimation(xc()))}}stop(){if(this.isEnabled){this.isAnimating=!1;for(let e of this.scrollCaches)e.destroy();this.scrollCaches=null}}requestAnimation(e){this.msSinceRequest=e,requestAnimationFrame(this.animate)}handleSide(e,t){let{scrollCache:n}=e,{edgeThreshold:s}=this,i=s-e.distance,a=i*i/(s*s)*this.maxVelocity*t,o=1;switch(e.name){case"left":o=-1;case"right":n.setScrollLeft(n.getScrollLeft()+a*o);break;case"top":o=-1;case"bottom":n.setScrollTop(n.getScrollTop()+a*o);break}}computeBestEdge(e,t){let{edgeThreshold:n}=this,s=null,i=this.scrollCaches||[];for(let a of i){let o=a.clientRect,l=e-o.left,c=o.right-e,d=t-o.top,u=o.bottom-t;l>=0&&c>=0&&d>=0&&u>=0&&(d<=n&&this.everMovedUp&&a.canScrollUp()&&(!s||s.distance>d)&&(s={scrollCache:a,name:"top",distance:d}),u<=n&&this.everMovedDown&&a.canScrollDown()&&(!s||s.distance>u)&&(s={scrollCache:a,name:"bottom",distance:u}),l<=n&&this.everMovedLeft&&a.canScrollLeft()&&(!s||s.distance>l)&&(s={scrollCache:a,name:"left",distance:l}),c<=n&&this.everMovedRight&&a.canScrollRight()&&(!s||s.distance>c)&&(s={scrollCache:a,name:"right",distance:c}))}return s}buildCaches(e){return this.queryScrollEls(e).map(t=>t===window?new vE(!1):new Zu(t,!1))}queryScrollEls(e){let t=[];for(let n of this.scrollQuery)typeof n=="object"?t.push(n):t.push(...Array.prototype.slice.call(e.getRootNode().querySelectorAll(n)));return t}}class Cs extends wf{constructor(e,t){super(e),this.containerEl=e,this.delay=null,this.minDistance=0,this.touchScrollAllowed=!0,this.mirrorNeedsRevert=!1,this.isInteracting=!1,this.isDragging=!1,this.isDelayEnded=!1,this.isDistanceSurpassed=!1,this.delayTimeoutId=null,this.onPointerDown=s=>{this.isDragging||(this.isInteracting=!0,this.isDelayEnded=!1,this.isDistanceSurpassed=!1,_f(document.body),Sf(document.body),s.isTouch||s.origEvent.preventDefault(),this.emitter.trigger("pointerdown",s),this.isInteracting&&!this.pointer.shouldIgnoreMove&&(this.mirror.setIsVisible(!1),this.mirror.start(s.subjectEl,s.pageX,s.pageY),this.startDelay(s),this.minDistance||this.handleDistanceSurpassed(s)))},this.onPointerMove=s=>{if(this.isInteracting){if(this.emitter.trigger("pointermove",s),!this.isDistanceSurpassed){let i=this.minDistance,a,{deltaX:o,deltaY:l}=s;a=o*o+l*l,a>=i*i&&this.handleDistanceSurpassed(s)}this.isDragging&&(s.origEvent.type!=="scroll"&&(this.mirror.handleMove(s.pageX,s.pageY),this.autoScroller.handleMove(s.pageX,s.pageY)),this.emitter.trigger("dragmove",s))}},this.onPointerUp=s=>{this.isInteracting&&(this.isInteracting=!1,xf(document.body),Ef(document.body),this.emitter.trigger("pointerup",s),this.isDragging&&(this.autoScroller.stop(),this.tryStopDrag(s)),this.delayTimeoutId&&(clearTimeout(this.delayTimeoutId),this.delayTimeoutId=null))};let n=this.pointer=new Xu(e);n.emitter.on("pointerdown",this.onPointerDown),n.emitter.on("pointermove",this.onPointerMove),n.emitter.on("pointerup",this.onPointerUp),t&&(n.selector=t),this.mirror=new yE,this.autoScroller=new wE}destroy(){this.pointer.destroy(),this.onPointerUp({})}startDelay(e){typeof this.delay=="number"?this.delayTimeoutId=setTimeout(()=>{this.delayTimeoutId=null,this.handleDelayEnd(e)},this.delay):this.handleDelayEnd(e)}handleDelayEnd(e){this.isDelayEnded=!0,this.tryStartDrag(e)}handleDistanceSurpassed(e){this.isDistanceSurpassed=!0,this.tryStartDrag(e)}tryStartDrag(e){this.isDelayEnded&&this.isDistanceSurpassed&&(!this.pointer.wasTouchScroll||this.touchScrollAllowed)&&(this.isDragging=!0,this.mirrorNeedsRevert=!1,this.autoScroller.start(e.pageX,e.pageY,this.containerEl),this.emitter.trigger("dragstart",e),this.touchScrollAllowed===!1&&this.pointer.cancelTouchScroll())}tryStopDrag(e){this.mirror.stop(this.mirrorNeedsRevert,this.stopDrag.bind(this,e))}stopDrag(e){this.isDragging=!1,this.emitter.trigger("dragend",e)}setIgnoreMove(e){this.pointer.shouldIgnoreMove=e}setMirrorIsVisible(e){this.mirror.setIsVisible(e)}setMirrorNeedsRevert(e){this.mirrorNeedsRevert=e}setAutoScrollEnabled(e){this.autoScroller.isEnabled=e}}class _E{constructor(e){this.el=e,this.origRect=ld(e),this.scrollCaches=zf(e).map(t=>new Zu(t,!0))}destroy(){for(let e of this.scrollCaches)e.destroy()}computeLeft(){let e=this.origRect.left;for(let t of this.scrollCaches)e+=t.origScrollLeft-t.getScrollLeft();return e}computeTop(){let e=this.origRect.top;for(let t of this.scrollCaches)e+=t.origScrollTop-t.getScrollTop();return e}isWithinClipping(e,t){let n={left:e,top:t};for(let s of this.scrollCaches)if(!SE(s.getEventTarget())&&!Wf(n,s.clientRect))return!1;return!0}}function SE(r){let e=r.tagName;return e==="HTML"||e==="BODY"}class Vi{constructor(e,t){this.useSubjectCenter=!1,this.requireInitial=!0,this.disablePointCheck=!1,this.initialHit=null,this.movingHit=null,this.finalHit=null,this.handlePointerDown=n=>{let{dragging:s}=this;this.initialHit=null,this.movingHit=null,this.finalHit=null,this.prepareHits(),this.processFirstCoord(n),this.initialHit||!this.requireInitial?(s.setIgnoreMove(!1),this.emitter.trigger("pointerdown",n)):s.setIgnoreMove(!0)},this.handleDragStart=n=>{this.emitter.trigger("dragstart",n),this.handleMove(n,!0)},this.handleDragMove=n=>{this.emitter.trigger("dragmove",n),this.handleMove(n)},this.handlePointerUp=n=>{this.releaseHits(),this.emitter.trigger("pointerup",n)},this.handleDragEnd=n=>{this.movingHit&&this.emitter.trigger("hitupdate",null,!0,n),this.finalHit=this.movingHit,this.movingHit=null,this.emitter.trigger("dragend",n)},this.droppableStore=t,e.emitter.on("pointerdown",this.handlePointerDown),e.emitter.on("dragstart",this.handleDragStart),e.emitter.on("dragmove",this.handleDragMove),e.emitter.on("pointerup",this.handlePointerUp),e.emitter.on("dragend",this.handleDragEnd),this.dragging=e,this.emitter=new od}processFirstCoord(e){let t={left:e.pageX,top:e.pageY},n=t,s=e.subjectEl,i;s instanceof HTMLElement&&(i=ld(s),n=Af(n,i));let a=this.initialHit=this.queryHitForOffset(n.left,n.top);if(a){if(this.useSubjectCenter&&i){let o=If(i,a.rect);o&&(n=Mf(o))}this.coordAdjust=Pf(n,t)}else this.coordAdjust={left:0,top:0}}handleMove(e,t){let n=this.queryHitForOffset(e.pageX+this.coordAdjust.left,e.pageY+this.coordAdjust.top);(t||!Gi(this.movingHit,n))&&(this.movingHit=n,this.emitter.trigger("hitupdate",n,!1,e))}prepareHits(){this.offsetTrackers=jf(this.droppableStore,e=>(e.component.prepareHits(),new _E(e.el)))}releaseHits(){let{offsetTrackers:e}=this;for(let t in e)e[t].destroy();this.offsetTrackers={}}queryHitForOffset(e,t){let{droppableStore:n,offsetTrackers:s}=this,i=null;for(let a in n){let o=n[a].component,l=s[a];if(l&&l.isWithinClipping(e,t)){let c=l.computeLeft(),d=l.computeTop(),u=e-c,f=t-d,{origRect:g}=l,b=g.right-g.left,m=g.bottom-g.top;if(u>=0&&u<b&&f>=0&&f<m){let y=o.queryHit(u,f,b,m);y&&Lf(y.dateProfile.activeRange,y.dateSpan.range)&&(this.disablePointCheck||l.el.contains(l.el.getRootNode().elementFromPoint(u+c-window.scrollX,f+d-window.scrollY)))&&(!i||y.layer>i.layer)&&(y.componentId=a,y.context=o.context,y.rect.left+=c,y.rect.right+=c,y.rect.top+=d,y.rect.bottom+=d,i=y)}}}return i}}function Gi(r,e){return!r&&!e?!0:!!r!=!!e?!1:Nf(r.dateSpan,e.dateSpan)}function eh(r,e){let t={};for(let n of e.pluginHooks.datePointTransforms)Object.assign(t,n(r,e));return Object.assign(t,xE(r,e.dateEnv)),t}function xE(r,e){return{date:e.toDate(r.range.start),dateStr:e.formatIso(r.range.start,{omitTime:r.allDay}),allDay:r.allDay}}class EE extends Mi{constructor(e){super(e),this.handlePointerDown=n=>{let{dragging:s}=this,i=n.origEvent.target;s.setIgnoreMove(!this.component.isValidDateDownEl(i))},this.handleDragEnd=n=>{let{component:s}=this,{pointer:i}=this.dragging;if(!i.wasTouchScroll){let{initialHit:a,finalHit:o}=this.hitDragging;if(a&&o&&Gi(a,o)){let{context:l}=s,c=Object.assign(Object.assign({},eh(a.dateSpan,l)),{dayEl:a.dayEl,jsEvent:n.origEvent,view:l.viewApi||l.calendarApi.view});l.emitter.trigger("dateClick",c)}}},this.dragging=new Cs(e.el),this.dragging.autoScroller.isEnabled=!1;let t=this.hitDragging=new Vi(this.dragging,bo(e));t.emitter.on("pointerdown",this.handlePointerDown),t.emitter.on("dragend",this.handleDragEnd)}destroy(){this.dragging.destroy()}}class TE extends Mi{constructor(e){super(e),this.dragSelection=null,this.handlePointerDown=a=>{let{component:o,dragging:l}=this,{options:c}=o.context,d=c.selectable&&o.isValidDateDownEl(a.origEvent.target);l.setIgnoreMove(!d),l.delay=a.isTouch?RE(o):null},this.handleDragStart=a=>{this.component.context.calendarApi.unselect(a)},this.handleHitUpdate=(a,o)=>{let{context:l}=this.component,c=null,d=!1;if(a){let u=this.hitDragging.initialHit;a.componentId===u.componentId&&this.isHitComboAllowed&&!this.isHitComboAllowed(u,a)||(c=OE(u,a,l.pluginHooks.dateSelectionTransformers)),(!c||!Rf(c,a.dateProfile,l))&&(d=!0,c=null)}c?l.dispatch({type:"SELECT_DATES",selection:c}):o||l.dispatch({type:"UNSELECT_DATES"}),d?vo():yo(),o||(this.dragSelection=c)},this.handlePointerUp=a=>{this.dragSelection&&(Of(this.dragSelection,a,this.component.context),this.dragSelection=null)};let{component:t}=e,{options:n}=t.context,s=this.dragging=new Cs(e.el);s.touchScrollAllowed=!1,s.minDistance=n.selectMinDistance||0,s.autoScroller.isEnabled=n.dragScroll;let i=this.hitDragging=new Vi(this.dragging,bo(e));i.emitter.on("pointerdown",this.handlePointerDown),i.emitter.on("dragstart",this.handleDragStart),i.emitter.on("hitupdate",this.handleHitUpdate),i.emitter.on("pointerup",this.handlePointerUp)}destroy(){this.dragging.destroy()}}function RE(r){let{options:e}=r.context,t=e.selectLongPressDelay;return t==null&&(t=e.longPressDelay),t}function OE(r,e,t){let n=r.dateSpan,s=e.dateSpan,i=[n.range.start,n.range.end,s.range.start,s.range.end];i.sort(Bf);let a={};for(let o of t){let l=o(r,e);if(l===!1)return null;l&&Object.assign(a,l)}return a.range={start:i[0],end:i[3]},a.allDay=n.allDay,a}class ks extends Mi{constructor(e){super(e),this.subjectEl=null,this.subjectSeg=null,this.isDragging=!1,this.eventRange=null,this.relevantEvents=null,this.receivingContext=null,this.validMutation=null,this.mutatedRelevantEvents=null,this.handlePointerDown=a=>{let o=a.origEvent.target,{component:l,dragging:c}=this,{mirror:d}=c,{options:u}=l.context,f=l.context;this.subjectEl=a.subjectEl;let g=this.subjectSeg=Ia(a.subjectEl),m=(this.eventRange=g.eventRange).instance.instanceId;this.relevantEvents=sd(f.getCurrentData().eventStore,m),c.minDistance=a.isTouch?0:u.eventDragMinDistance,c.delay=a.isTouch&&m!==l.props.eventSelection?kE(l):null,u.fixedMirrorParent?d.parentNode=u.fixedMirrorParent:d.parentNode=an(o,".fc"),d.revertDuration=u.dragRevertDuration;let y=l.isValidSegDownEl(o)&&!an(o,".fc-event-resizer");c.setIgnoreMove(!y),this.isDragging=y&&a.subjectEl.classList.contains("fc-event-draggable")},this.handleDragStart=a=>{let o=this.component.context,l=this.eventRange,c=l.instance.instanceId;a.isTouch?c!==this.component.props.eventSelection&&o.dispatch({type:"SELECT_EVENT",eventInstanceId:c}):o.dispatch({type:"UNSELECT_EVENT"}),this.isDragging&&(o.calendarApi.unselect(a),o.emitter.trigger("eventDragStart",{el:this.subjectEl,event:new tn(o,l.def,l.instance),jsEvent:a.origEvent,view:o.viewApi}))},this.handleHitUpdate=(a,o)=>{if(!this.isDragging)return;let l=this.relevantEvents,c=this.hitDragging.initialHit,d=this.component.context,u=null,f=null,g=null,b=!1,m={affectedEvents:l,mutatedEvents:ni(),isEvent:!0};if(a){u=a.context;let y=u.options;d===u||y.editable&&y.droppable?(f=CE(c,a,this.eventRange.instance.range.start,u.getCurrentData().pluginHooks.eventDragMutationMassagers),f&&(g=id(l,u.getCurrentData().eventUiBases,f,u),m.mutatedEvents=g,ad(m,a.dateProfile,u)||(b=!0,f=null,g=null,m.mutatedEvents=ni()))):u=null}this.displayDrag(u,m),b?vo():yo(),o||(d===u&&Gi(c,a)&&(f=null),this.dragging.setMirrorNeedsRevert(!f),this.dragging.setMirrorIsVisible(!a||!this.subjectEl.getRootNode().querySelector(".fc-event-mirror")),this.receivingContext=u,this.validMutation=f,this.mutatedRelevantEvents=g)},this.handlePointerUp=()=>{this.isDragging||this.cleanup()},this.handleDragEnd=a=>{if(this.isDragging){let o=this.component.context,l=o.viewApi,{receivingContext:c,validMutation:d}=this,u=this.eventRange.def,f=this.eventRange.instance,g=new tn(o,u,f),b=this.relevantEvents,m=this.mutatedRelevantEvents,{finalHit:y}=this.hitDragging;if(this.clearDrag(),o.emitter.trigger("eventDragStop",{el:this.subjectEl,event:g,jsEvent:a.origEvent,view:l}),d){if(c===o){let v=new tn(o,m.defs[u.defId],f?m.instances[f.instanceId]:null);o.dispatch({type:"MERGE_EVENTS",eventStore:m});let p={oldEvent:g,event:v,relatedEvents:si(m,o,f),revert(){o.dispatch({type:"MERGE_EVENTS",eventStore:b})}},w={};for(let S of o.getCurrentData().pluginHooks.eventDropTransformers)Object.assign(w,S(d,o));o.emitter.trigger("eventDrop",Object.assign(Object.assign(Object.assign({},p),w),{el:a.subjectEl,delta:d.datesDelta,jsEvent:a.origEvent,view:l})),o.emitter.trigger("eventChange",p)}else if(c){let v={event:g,relatedEvents:si(b,o,f),revert(){o.dispatch({type:"MERGE_EVENTS",eventStore:b})}};o.emitter.trigger("eventLeave",Object.assign(Object.assign({},v),{draggedEl:a.subjectEl,view:l})),o.dispatch({type:"REMOVE_EVENTS",eventStore:b}),o.emitter.trigger("eventRemove",v);let p=m.defs[u.defId],w=m.instances[f.instanceId],S=new tn(c,p,w);c.dispatch({type:"MERGE_EVENTS",eventStore:m});let x={event:S,relatedEvents:si(m,c,w),revert(){c.dispatch({type:"REMOVE_EVENTS",eventStore:m})}};c.emitter.trigger("eventAdd",x),a.isTouch&&c.dispatch({type:"SELECT_EVENT",eventInstanceId:f.instanceId}),c.emitter.trigger("drop",Object.assign(Object.assign({},eh(y.dateSpan,c)),{draggedEl:a.subjectEl,jsEvent:a.origEvent,view:y.context.viewApi})),c.emitter.trigger("eventReceive",Object.assign(Object.assign({},x),{draggedEl:a.subjectEl,view:y.context.viewApi}))}}else o.emitter.trigger("_noEventDrop")}this.cleanup()};let{component:t}=this,{options:n}=t.context,s=this.dragging=new Cs(e.el);s.pointer.selector=ks.SELECTOR,s.touchScrollAllowed=!1,s.autoScroller.isEnabled=n.dragScroll;let i=this.hitDragging=new Vi(this.dragging,Cf);i.useSubjectCenter=e.useEventCenter,i.emitter.on("pointerdown",this.handlePointerDown),i.emitter.on("dragstart",this.handleDragStart),i.emitter.on("hitupdate",this.handleHitUpdate),i.emitter.on("pointerup",this.handlePointerUp),i.emitter.on("dragend",this.handleDragEnd)}destroy(){this.dragging.destroy()}displayDrag(e,t){let n=this.component.context,s=this.receivingContext;s&&s!==e&&(s===n?s.dispatch({type:"SET_EVENT_DRAG",state:{affectedEvents:t.affectedEvents,mutatedEvents:ni(),isEvent:!0}}):s.dispatch({type:"UNSET_EVENT_DRAG"})),e&&e.dispatch({type:"SET_EVENT_DRAG",state:t})}clearDrag(){let e=this.component.context,{receivingContext:t}=this;t&&t.dispatch({type:"UNSET_EVENT_DRAG"}),e!==t&&e.dispatch({type:"UNSET_EVENT_DRAG"})}cleanup(){this.subjectSeg=null,this.isDragging=!1,this.eventRange=null,this.relevantEvents=null,this.receivingContext=null,this.validMutation=null,this.mutatedRelevantEvents=null}}ks.SELECTOR=".fc-event-draggable, .fc-event-resizable";function CE(r,e,t,n){let s=r.dateSpan,i=e.dateSpan,a=s.range.start,o=i.range.start,l={};s.allDay!==i.allDay&&(l.allDay=i.allDay,l.hasEnd=e.context.options.allDayMaintainDuration,i.allDay?a=hi(t):a=t);let c=cd(a,o,r.context.dateEnv,r.componentId===e.componentId?r.largeUnit:null);c.milliseconds&&(l.allDay=!1);let d={datesDelta:c,standardProps:l};for(let u of n)u(d,r,e);return d}function kE(r){let{options:e}=r.context,t=e.eventLongPressDelay;return t==null&&(t=e.longPressDelay),t}class DE extends Mi{constructor(e){super(e),this.draggingSegEl=null,this.draggingSeg=null,this.eventRange=null,this.relevantEvents=null,this.validMutation=null,this.mutatedRelevantEvents=null,this.handlePointerDown=i=>{let{component:a}=this,o=this.querySegEl(i),l=Ia(o),c=this.eventRange=l.eventRange;this.dragging.minDistance=a.context.options.eventDragMinDistance,this.dragging.setIgnoreMove(!this.component.isValidSegDownEl(i.origEvent.target)||i.isTouch&&this.component.props.eventSelection!==c.instance.instanceId)},this.handleDragStart=i=>{let{context:a}=this.component,o=this.eventRange;this.relevantEvents=sd(a.getCurrentData().eventStore,this.eventRange.instance.instanceId);let l=this.querySegEl(i);this.draggingSegEl=l,this.draggingSeg=Ia(l),a.calendarApi.unselect(),a.emitter.trigger("eventResizeStart",{el:l,event:new tn(a,o.def,o.instance),jsEvent:i.origEvent,view:a.viewApi})},this.handleHitUpdate=(i,a,o)=>{let{context:l}=this.component,c=this.relevantEvents,d=this.hitDragging.initialHit,u=this.eventRange.instance,f=null,g=null,b=!1,m={affectedEvents:c,mutatedEvents:ni(),isEvent:!0};i&&(i.componentId===d.componentId&&this.isHitComboAllowed&&!this.isHitComboAllowed(d,i)||(f=NE(d,i,o.subjectEl.classList.contains("fc-event-resizer-start"),u.range))),f&&(g=id(c,l.getCurrentData().eventUiBases,f,l),m.mutatedEvents=g,ad(m,i.dateProfile,l)||(b=!0,f=null,g=null,m.mutatedEvents=null)),g?l.dispatch({type:"SET_EVENT_RESIZE",state:m}):l.dispatch({type:"UNSET_EVENT_RESIZE"}),b?vo():yo(),a||(f&&Gi(d,i)&&(f=null),this.validMutation=f,this.mutatedRelevantEvents=g)},this.handleDragEnd=i=>{let{context:a}=this.component,o=this.eventRange.def,l=this.eventRange.instance,c=new tn(a,o,l),d=this.relevantEvents,u=this.mutatedRelevantEvents;if(a.emitter.trigger("eventResizeStop",{el:this.draggingSegEl,event:c,jsEvent:i.origEvent,view:a.viewApi}),this.validMutation){let f=new tn(a,u.defs[o.defId],l?u.instances[l.instanceId]:null);a.dispatch({type:"MERGE_EVENTS",eventStore:u});let g={oldEvent:c,event:f,relatedEvents:si(u,a,l),revert(){a.dispatch({type:"MERGE_EVENTS",eventStore:d})}};a.emitter.trigger("eventResize",Object.assign(Object.assign({},g),{el:this.draggingSegEl,startDelta:this.validMutation.startDelta||Mn(0),endDelta:this.validMutation.endDelta||Mn(0),jsEvent:i.origEvent,view:a.viewApi})),a.emitter.trigger("eventChange",g)}else a.emitter.trigger("_noEventResize");this.draggingSeg=null,this.relevantEvents=null,this.validMutation=null};let{component:t}=e,n=this.dragging=new Cs(e.el);n.pointer.selector=".fc-event-resizer",n.touchScrollAllowed=!1,n.autoScroller.isEnabled=t.context.options.dragScroll;let s=this.hitDragging=new Vi(this.dragging,bo(e));s.emitter.on("pointerdown",this.handlePointerDown),s.emitter.on("dragstart",this.handleDragStart),s.emitter.on("hitupdate",this.handleHitUpdate),s.emitter.on("dragend",this.handleDragEnd)}destroy(){this.dragging.destroy()}querySegEl(e){return an(e.subjectEl,".fc-event")}}function NE(r,e,t,n){let s=r.context.dateEnv,i=r.dateSpan.range.start,a=e.dateSpan.range.start,o=cd(i,a,s,r.largeUnit);if(t){if(s.add(n.start,o)<n.end)return{startDelta:o}}else if(s.add(n.end,o)>n.start)return{endDelta:o};return null}class AE{constructor(e){this.context=e,this.isRecentPointerDateSelect=!1,this.matchesCancel=!1,this.matchesEvent=!1,this.onSelect=n=>{n.jsEvent&&(this.isRecentPointerDateSelect=!0)},this.onDocumentPointerDown=n=>{let s=this.context.options.unselectCancel,i=Tf(n.origEvent);this.matchesCancel=!!an(i,s),this.matchesEvent=!!an(i,ks.SELECTOR)},this.onDocumentPointerUp=n=>{let{context:s}=this,{documentPointer:i}=this,a=s.getCurrentData();if(!i.wasTouchScroll){if(a.dateSelection&&!this.isRecentPointerDateSelect){let o=s.options.unselectAuto;o&&(!o||!this.matchesCancel)&&s.calendarApi.unselect(n)}a.eventSelection&&!this.matchesEvent&&s.dispatch({type:"UNSELECT_EVENT"})}this.isRecentPointerDateSelect=!1};let t=this.documentPointer=new Xu(document);t.shouldIgnoreMove=!0,t.shouldWatchScroll=!1,t.emitter.on("pointerdown",this.onDocumentPointerDown),t.emitter.on("pointerup",this.onDocumentPointerUp),e.emitter.on("select",this.onSelect)}destroy(){this.context.emitter.off("select",this.onSelect),this.documentPointer.destroy()}}const IE={fixedMirrorParent:Tt},ME={dateClick:Tt,eventDragStart:Tt,eventDragStop:Tt,eventDrop:Tt,eventResizeStart:Tt,eventResizeStop:Tt,eventResize:Tt,drop:Tt,eventReceive:Tt,eventLeave:Tt};wo.dataAttrPrefix="";var PE=Ii({name:"@fullcalendar/interaction",componentInteractions:[EE,TE,ks,DE],calendarInteractions:[AE],elementDraggingImpl:Cs,optionRefiners:IE,listenerRefiners:ME});function jE({machineId:r,refreshTrigger:e}){const[t,n]=_.useState(!1),[s,i]=_.useState({}),a=N.useRef(null),{entities:o}=ur(),{entities:l}=dt(),{machineAvailability:c,loadMachineAvailabilityForDateRange:d,toggleMachineHourAvailability:u,getTaskOccupiedSegments:f}=Rs(),{showAlert:g}=Ve();Yt("FullCalendarGrid");const b=o.find(x=>x.id===r),m=_.useCallback(x=>{try{const E=f(x);return E&&E.length>0?E:x.scheduled_start_time&&x.scheduled_end_time?[{start:new Date(x.scheduled_start_time),end:new Date(x.scheduled_end_time),duration:(new Date(x.scheduled_end_time).getTime()-new Date(x.scheduled_start_time).getTime())/(1e3*60*60)}]:[]}catch(E){return console.warn("Failed to get task segments:",E),[]}},[f]),y=_.useMemo(()=>{if(!b)return[];const x=[];return l.filter(E=>E.status==="SCHEDULED"&&E.scheduled_machine_id===b.id&&E.scheduled_start_time&&E.scheduled_end_time).forEach(E=>{const T=m(E);T.forEach((R,k)=>{const O=T.length>1;x.push({id:`${E.id}-segment-${k}`,title:`${E.odp_number} - ${E.article_code}${O?` (${k+1}/${T.length})`:""}`,start:R.start,end:R.end,backgroundColor:O?"#8b5cf6":"#3b82f6",borderColor:O?"#7c3aed":"#2563eb",textColor:"#ffffff",extendedProps:{taskId:E.id,odpNumber:E.odp_number,articleCode:E.article_code,quantity:E.quantity,status:E.status,segmentIndex:k,totalSegments:T.length,isSplitTask:O}})})}),x},[b,l,m]),v=_.useMemo(()=>{if(!c||!b)return[];const x=[];return Object.entries(c).forEach(([E,T])=>{if(Array.isArray(T)){const R=T.find(k=>k.machine_id===r);R&&R.unavailable_hours&&(Array.isArray(R.unavailable_hours)?R.unavailable_hours:[]).forEach(O=>{const D=parseInt(O);if(D<6||D>=22)return;const A=new Date(E);A.setUTCHours(D,0,0,0);const P=new Date(A);P.setUTCHours(D+1,0,0,0),x.push({id:`availability-${E}-${O}`,title:"Unavailable",start:A,end:P,backgroundColor:"#ef4444",borderColor:"#dc2626",textColor:"#ffffff",display:"background",extendedProps:{type:"availability",date:E,hour:parseInt(O)}})})}}),x},[c,r,b]);_.useEffect(()=>{(async()=>{if(r){n(!0);try{const E=new Date,T=new Date(Date.UTC(E.getUTCFullYear(),E.getUTCMonth(),1)),R=new Date(Date.UTC(E.getUTCFullYear(),E.getUTCMonth()+1,0));await d(r,ht(T,"yyyy-MM-dd"),ht(R,"yyyy-MM-dd"))}catch(E){console.error("Failed to load machine availability data:",E)}finally{n(!1)}}})()},[r,e]);const p=_.useCallback(async x=>{const E=x.date,T=ht(E,"yyyy-MM-dd"),R=E.getUTCHours();if(y.some(D=>{const A=new Date(D.start),P=new Date(D.end),Q=new Date(E);return Q>=A&&Q<P})){g("Cannot mark time slot as unavailable - it has scheduled tasks","error");return}if(!b)return;const O=`${T}-${R}`;i(D=>({...D,[O]:!0}));try{await u(b.id,T,R)}catch(D){console.error("Failed to toggle machine hour availability:",D),g("An unexpected error occurred.","error")}finally{i(D=>({...D,[O]:!1}))}},[y,g,b,u]),w=_.useCallback(x=>{const E=x.event,T=E.extendedProps;T.type==="availability"?console.log("Availability event clicked:",T):console.log("Scheduled task clicked:",{odpNumber:T.odpNumber,articleCode:T.articleCode,quantity:T.quantity,start:E.start,end:E.end})},[]),S=_.useMemo(()=>({plugins:[gx,Zx,fE,PE],initialView:"dayGridMonth",initialDate:new Date,headerToolbar:{left:"prev,next today",center:"title",right:"dayGridMonth,timeGridWeek,timeGridDay"},height:"auto",locale:"it",timeZone:"UTC",firstDay:mw.APP.FIRST_DAY_OF_WEEK,slotMinTime:"06:00:00",slotMaxTime:"22:00:00",slotDuration:"01:00:00",slotLabelInterval:"01:00:00",allDaySlot:!1,weekends:!0,editable:!1,selectable:!0,selectMirror:!0,dayMaxEvents:!0,eventDisplay:"block",eventTimeFormat:{hour:"2-digit",minute:"2-digit",meridiem:!1,hour12:!1},dayHeaderFormat:{weekday:"short",day:"numeric"},slotLabelFormat:{hour:"2-digit",minute:"2-digit",meridiem:!1,hour12:!1},buttonText:{today:"Oggi",month:"Mese",week:"Settimana",day:"Giorno"},eventClick:w,dateClick:p,events:[...y,...v]}),[w,p,y,v]);return b?t?h.jsx("div",{className:"loading",children:"Loading calendar data..."}):h.jsx("div",{className:"fullcalendar-container",children:h.jsx(qf,{ref:a,...S})}):h.jsx("div",{className:"loading",children:"Loading machine data..."})}function LE(){const{machineId:r}=Ni(),[e,t]=_.useState(0),{getMachineById:n}=ur(),{isLoading:s,isInitialized:i}=Ve(),{init:a,cleanup:o}=zr(),l=n(r);if(_.useEffect(()=>{if(!i){console.log("Initializing main store...");const d=a(),u=new Promise((f,g)=>setTimeout(()=>g(new Error("Initialization timeout")),1e4));Promise.race([d,u]).catch(f=>{console.error("Initialization failed or timed out:",f)})}return()=>{o()}},[a,i,o]),s)return h.jsx("div",{className:"p-1 bg-white rounded shadow-sm border",children:h.jsxs("div",{className:"text-center py-1 text-gray-500 text-[10px]",children:["Caricamento calendario macchina... (Loading: ",s.toString(),", Initialized: ",i.toString(),")"]})});if(!l)return h.jsx("div",{className:"p-1 bg-white rounded shadow-sm border",children:h.jsxs("div",{className:"text-center py-1 text-red-600 text-[10px]",children:["Macchina non trovata (ID: ",r,", Initialized: ",i.toString(),")"]})});const c=()=>{t(d=>d+1)};return h.jsxs("div",{className:"p-1 bg-white rounded shadow-sm border",children:[h.jsx(HS,{title:"Calendario Disponibilit Macchina"}),h.jsx("div",{className:"mb-1",children:h.jsx("h3",{className:"text-[10px] font-semibold text-gray-900",children:l.machine_name})}),!1,h.jsx(BS,{machineId:l.id,currentDate:new Date,onSuccess:c}),h.jsx(jE,{machineId:l.id,refreshTrigger:e})]})}function $E(){const{data:r=[],isLoading:e,error:t}=Po(),n=jS(),{selectedWorkCenter:s,isInitialized:i,showConfirmDialog:a}=Ve(),{init:o,cleanup:l}=zr(),c=gr(),d=_.useMemo(()=>s?s===ve.BOTH?r:r.filter(b=>b.work_center===s):[],[r,s]);Yt("PhasesListPage"),_.useEffect(()=>(i||o(),()=>{l()}),[o,i,l]);const u=_.useMemo(()=>[{header:"Nome Fase",accessorKey:"name"},{header:"Centro di Lavoro",accessorKey:"work_center"},{header:"Reparto",accessorKey:"department"},{header:"Numero Persone",accessorKey:"numero_persone"},{header:"V Stampa",accessorKey:"v_stampa"},{header:"T Setup Stampa (h)",accessorKey:"t_setup_stampa"},{header:"Costo H Stampa",accessorKey:"costo_h_stampa"},{header:"V Conf",accessorKey:"v_conf"},{header:"T Setup Conf (h)",accessorKey:"t_setup_conf"},{header:"Costo H Conf",accessorKey:"costo_h_conf"},{header:"Contenuto Fase",accessorKey:"contenuto_fase"}],[]),f=b=>{c(`/phases/${b.id}/edit`)},g=async b=>{a("Elimina Fase",`Sei sicuro di voler eliminare "${b.name}"? Questa azione non pu essere annullata.`,async()=>{try{await n.mutateAsync(b.id),cn(`Fase "${b.name}" eliminata con successo`)}catch(m){Sr(m.message||"Errore durante l'eliminazione della fase")}},"danger")};return e?h.jsx("div",{children:"Caricamento dati fasi..."}):t?h.jsxs("div",{className:"text-center py-2 text-red-600 text-[10px]",children:["Errore nel caricamento delle fasi: ",t.message]}):s?h.jsx(Do,{title:"Lista Fasi",entityName:"Phase",createButtonHref:"/phases/add",data:d,columns:u,onEditRow:f,onDeleteRow:g,enableGlobalSearch:!1}):h.jsx("div",{className:"text-center py-2 text-red-600 text-[10px]",children:"Seleziona un centro di lavoro per visualizzare i dati delle fasi."})}function FE({phaseToEdit:r,onSuccess:e}){const{selectedWorkCenter:t}=Ve(),n=MS(),s=PS(),{handleAsync:i}=Yt("PhasesForm"),a=!!r,o=_.useMemo(()=>{const d={...or};return t!==ve.BOTH&&(d.sections[0].fields[3].disabled=!0,d.sections[0].fields[3].defaultValue=t,d.sections[0].fields[3].helpText="Il centro di lavoro  impostato in base alla tua selezione di accesso"),d},[t]),l=_.useMemo(()=>({name:r?.name||"",department:r?.department||or.sections[0].fields[1].defaultValue,numero_persone:r?.numero_persone||or.sections[0].fields[2].defaultValue,work_center:r?.work_center||(t===ve.BOTH?or.sections[0].fields[3].defaultValue:t),v_stampa:r?.v_stampa||or.sections[1].fields[0].defaultValue,t_setup_stampa:r?.t_setup_stampa||or.sections[1].fields[1].defaultValue,costo_h_stampa:r?.costo_h_stampa||or.sections[1].fields[2].defaultValue,v_conf:r?.v_conf||or.sections[2].fields[0].defaultValue,t_setup_conf:r?.t_setup_conf||or.sections[2].fields[1].defaultValue,costo_h_conf:r?.costo_h_conf||or.sections[2].fields[2].defaultValue,contenuto_fase:r?.contenuto_fase||""}),[t,r]),c=async d=>{await i(async()=>{a?await s.mutateAsync({id:r.id,updates:d}):await n.mutateAsync(d),e&&e(),cn(a?"Fase aggiornata con successo":"Fase aggiunta con successo")},{context:a?"Update Phase":"Add Phase",fallbackMessage:a?"Aggiornamento fase fallito":"Aggiunta fase fallita"})};return h.jsx(Li,{config:o,initialData:l,onSubmit:c,onSuccess:e,isEditMode:a})}function Ec(){const{id:r}=Ni(),e=gr(),{selectedWorkCenter:t}=Ve(),{isLoading:n,isInitialized:s,init:i,cleanup:a}=zr(),o=!!r,{data:l,isLoading:c,error:d}=IS(r);return _.useEffect(()=>(s||i(),()=>{a()}),[i,s,a]),_.useEffect(()=>{o&&!n&&!c&&!l&&!d&&e("/phases",{replace:!0})},[o,n,c,l,d,e]),n||o&&c?h.jsx("div",{children:"Caricamento..."}):o&&d?h.jsxs("div",{className:"text-center py-2 text-red-600 text-[10px]",children:["Errore nel caricamento della fase: ",d.message]}):o&&!l?h.jsx("div",{className:"text-center py-2 text-red-600 text-[10px]",children:"Fase non trovata."}):t?h.jsxs("div",{className:"space-y-6",children:[h.jsx("div",{className:"flex items-center justify-between",children:h.jsx("h1",{className:"text-2xl font-semibold text-foreground",children:o?`Modifica Fase: ${l?.name}`:"Aggiungi Nuova Fase"})}),h.jsx(FE,{phaseToEdit:l})]}):h.jsx("div",{className:"text-center py-2 text-red-600 text-[10px]",children:"Seleziona un centro di lavoro per gestire le fasi."})}function UE(){const{selectedWorkCenter:r,showConfirmDialog:e}=Ve(),t=gr(),{data:n=[],isLoading:s,error:i}=qi(),{data:a=[],isLoading:o}=Wi(),{data:l=[],isLoading:c}=Po(),d=AS(),{handleAsync:u}=Yt("BacklogListPage");if(i)return h.jsxs("div",{className:"text-center py-2 text-red-600 text-[10px]",children:["Errore nel caricamento degli ordini: ",i.message]});const f=_.useMemo(()=>{if(!r)return[];let v=n;return r!==ve.BOTH&&(v=n.filter(p=>p.work_center===r)),v.map(p=>({...p,machine_name:p.scheduled_machine_id?a.find(w=>w.id===p.scheduled_machine_id)?.machine_name||"Macchina non trovata":"Non programmato",phase_name:p.fase?l.find(w=>w.id===p.fase)?.name||"Fase non trovata":"Fase non assegnata",progress:p.progress||0,time_remaining:p.time_remaining||p.duration||0}))},[n,r,a,l]),g=s||o||c,b=_.useMemo(()=>[{header:"Numero ODP",accessorKey:"odp_number",cell:v=>{const p=v.row.original.status,w=v.getValue(),S=p==="SCHEDULED";return h.jsx("span",{className:S?"text-green-600 font-medium":"",children:w})}},{header:"Codice Articolo",accessorKey:"article_code"},{header:"Note ASD",accessorKey:"asd_notes",cell:v=>{const p=v.getValue();return p?h.jsx("div",{className:"max-w-[200px] truncate text-[10px]",title:p,children:p}):"N/A"}},{header:"Nome Cliente",accessorKey:"nome_cliente"},{header:"Quantit",accessorKey:"quantity"},{header:"Quantit Completata",accessorKey:"quantity_completed"},{header:"Altezza Busta (mm)",accessorKey:"bag_height"},{header:"Larghezza Busta (mm)",accessorKey:"bag_width"},{header:"Passo Busta (mm)",accessorKey:"bag_step"},{header:"Lotto Produzione",accessorKey:"production_lot"},{header:"Centro di Lavoro",accessorKey:"work_center"},{header:"Reparto",accessorKey:"department"},{header:"Lati Sigillati",accessorKey:"seal_sides"},{header:"Tipo Prodotto",accessorKey:"product_type"},{header:"Data Consegna",accessorKey:"delivery_date",cell:v=>v.getValue()?ht(new Date(v.getValue()),"yyyy-MM-dd"):"Non impostata"},{header:"Inizio Programmato",accessorKey:"scheduled_start_time",cell:v=>v.getValue()?new Date(v.getValue()).toISOString().replace("T"," ").replace(".000Z",""):"Non programmato"},{header:"Fine Programmata",accessorKey:"scheduled_end_time",cell:v=>v.getValue()?new Date(v.getValue()).toISOString().replace("T"," ").replace(".000Z",""):"Non programmato"},{header:"Codice Cliente Interno",accessorKey:"internal_customer_code"},{header:"Codice Cliente Esterno",accessorKey:"external_customer_code"},{header:"Riferimento Ordine Cliente",accessorKey:"customer_order_ref"},{header:"Note Libere",accessorKey:"user_notes"},{header:"Nome Fase",accessorKey:"phase_name"},{header:"Durata (ore)",accessorKey:"duration",cell:v=>{const p=v.getValue();return typeof p=="number"?p.toFixed(1):p}},{header:"Costo ()",accessorKey:"cost",cell:v=>{const p=v.getValue();return typeof p=="number"?p.toFixed(1):p}},{header:"Stato",accessorKey:"status"},{header:"Nome Macchina",accessorKey:"machine_name"},{header:"Progresso (%)",accessorKey:"progress",cell:v=>{const p=v.getValue();return typeof p=="number"?`${p}%`:p}},{header:"Tempo Rimanente (ore)",accessorKey:"time_remaining",cell:v=>{const p=v.getValue();return typeof p=="number"?p.toFixed(1):p}},{header:"Material ISP (%)",accessorKey:"material_availability_isp",cell:v=>{const p=v.getValue();if(typeof p!="number")return p||"N/A";const w=p<=39?"bg-gray-300":p<=69?"bg-yellow-400":"bg-green-400";return h.jsx("div",{className:`inline-flex items-center justify-center w-8 h-8 rounded-full ${w} text-black text-[10px] font-medium`,children:p})}},{header:"Material Lotti (%)",accessorKey:"material_availability_lotti",cell:v=>{const p=v.getValue();if(typeof p!="number")return p||"N/A";const w=p<=39?"bg-gray-300":p<=69?"bg-yellow-400":"bg-green-400";return h.jsx("div",{className:`inline-flex items-center justify-center w-8 h-8 rounded-full ${w} text-black text-[10px] font-medium`,children:p})}},{header:"Material Global (%)",accessorKey:"material_availability_global",cell:v=>{const p=v.getValue();if(typeof p!="number")return p||"N/A";const w=p<=39?"bg-gray-300":p<=69?"bg-yellow-400":"bg-green-400";return h.jsx("div",{className:`inline-flex items-center justify-center w-8 h-8 rounded-full ${w} text-black text-[10px] font-medium`,children:p})}}],[]);_.useMemo(()=>b.map(v=>v.accessorKey),[b]);const m=v=>{t(`/backlog/${v.id}/edit`)},y=async v=>{e("Elimina Ordine",`Sei sicuro di voler eliminare "${v.odp_number}"? Questa azione non pu essere annullata.`,async()=>{await u(async()=>{await d.mutateAsync(v.id)},{context:"Delete Order",fallbackMessage:"Eliminazione ordine fallita"})},"danger")};return g?h.jsx("div",{children:"Caricamento dati backlog..."}):r?h.jsx(Do,{title:"Lista Ordini",entityName:"Order",createButtonHref:"/backlog/add",data:f,columns:b,onEditRow:m,onDeleteRow:y,enableGlobalSearch:!1,enableFiltering:!1}):h.jsx("div",{className:"text-center py-2 text-red-600 text-[10px]",children:"Seleziona un centro di lavoro per visualizzare i dati del backlog."})}const HE=({onSuccess:r,orderToEdit:e})=>{const{selectedWorkCenter:t,showConflictDialog:n}=Ve(),{scheduleTaskFromSlot:s,unscheduleTask:i}=Rs(),{calculateProductionMetrics:a,validatePhaseParameters:o,autoDetermineWorkCenter:l,autoDetermineDepartment:c}=xu(),{handleAsync:d}=Yt("BacklogForm"),{validateOrder:u}=_S(),f=DS(),g=NS(),b=Ye(),[m,y]=_.useState(null),v=!!e,p=_.useMemo(()=>{const U={...FS};if(t!==ve.BOTH){const ie=U.sections[0].fields.find(ke=>ke.name==="work_center");ie&&(ie.disabled=!0,ie.defaultValue=t,ie.helpText="Centro di lavoro pre-impostato.")}return U},[t]),w=_.useMemo(()=>({odp_number:e?.odp_number||"",article_code:e?.article_code||"",work_center:e?.work_center||(t===ve.BOTH?"":t),nome_cliente:e?.nome_cliente||"",delivery_date:e?.delivery_date?new Date(e.delivery_date).toISOString().slice(0,16):"",quantity:e?.quantity||"",customer_order_ref:e?.customer_order_ref||"",department:e?.department||"",quantity_completed:e?.quantity_completed||Ue.ORDER.QUANTITY_COMPLETED,production_lot:e?.production_lot||null,bag_height:e?.bag_height||null,bag_width:e?.bag_width||null,bag_step:e?.bag_step||null,seal_sides:e?.seal_sides||null,product_type:e?.product_type||null,internal_customer_code:e?.internal_customer_code||null,external_customer_code:e?.external_customer_code||null,user_notes:e?.user_notes||null,asd_notes:e?.asd_notes||null,material_availability_global:e?.material_availability_global||null,fase:e?.fase||null}),[t,e]),[S,x]=_.useState(w.department),[E,T]=_.useState(w.work_center),[R,k]=_.useState(w.quantity),[O,D]=_.useState(w.bag_step),{phaseSearch:A,setPhaseSearch:P,isDropdownVisible:Q,setIsDropdownVisible:he,selectedPhase:H,setSelectedPhase:J,filteredPhases:Oe,editablePhaseParams:L,setEditablePhaseParams:Z,handlePhaseParamChange:ee,handlePhaseSelect:Le,handleBlur:G}=SS(S,E,v?e?.fase:null),F=_.useCallback(()=>{P(""),J(null),Z({}),y(null)},[P,J,Z]),V=_.useCallback((U,ie)=>{if(U){const ke=c(U);ie("department",ke),t===ve.BOTH&&ie("work_center",l(U)),ie("fase",""),P(""),J(null),Z({}),y(null)}},[c,l,t,P,J,Z]),q=async U=>{const ie=u(U);if(!ie.isValid){const we=Object.entries(ie.errors).map(([K,He])=>`${{odp_number:"Numero ODP",article_code:"Codice Articolo",work_center:"Centro di Lavoro",nome_cliente:"Nome Cliente",quantity:"Quantit",delivery_date:"Data di Consegna",customer_order_ref:"Riferimento Ordine Cliente",department:"Reparto",bag_height:"Altezza Busta",bag_width:"Larghezza Busta",bag_step:"Passo Busta",seal_sides:"Lati Sigillatura",product_type:"Tipo Prodotto",internal_customer_code:"Codice Cliente Interno",external_customer_code:"Codice Cliente Esterno"}[K]||K}: ${He}`);Ov(we);return}const ke=U.fase,Be=H?.department===We.PRINTING;if(ke&&(!Be||U.bag_step)&&(!m?.totals||typeof m.totals.duration!="number"||typeof m.totals.cost!="number")){ts("Calcola le metriche di produzione valide prima di procedere.");return}await d(async()=>{const{phase_search:we,...K}=U,He={...K,fase:K.fase===""?null:K.fase,scheduled_machine_id:K.scheduled_machine_id===""?null:K.scheduled_machine_id,production_lot:K.production_lot===""?null:K.production_lot,internal_customer_code:K.internal_customer_code===""?null:K.internal_customer_code,external_customer_code:K.external_customer_code===""?null:K.external_customer_code,user_notes:K.user_notes===""?null:K.user_notes,asd_notes:K.asd_notes===""?null:K.asd_notes,material_availability_global:K.material_availability_global===""?null:K.material_availability_global,bag_height:K.bag_height===""?null:K.bag_height,bag_width:K.bag_width===""?null:K.bag_width,bag_step:K.bag_step===""?null:K.bag_step,seal_sides:K.seal_sides===""?null:K.seal_sides,product_type:K.product_type===""?null:K.product_type};let I;if(v){const j=m?.totals?.duration||e.duration,_e=e.quantity_completed/e.quantity||0,re=j*(1-_e);if(e.scheduled_machine_id&&e.scheduled_start_time){console.log(" EDIT FLOW: Starting rescheduling for task",e.id),console.log(" EDIT FLOW: Original duration:",e.duration,"New duration:",j);const Y=e.duration,ae=j-Y;if(Math.abs(ae)<.01){console.log(" SCENARIO X: Duration unchanged, skipping rescheduling");const z={...He,duration:j,cost:m?.totals?.cost||null};I=await g.mutateAsync({id:e.id,updates:z})}else if(ae>0){console.log(" SCENARIO Y: Duration increased, using standard rescheduling");const z=new Date(e.scheduled_start_time),me=z.getUTCHours(),xe=z.getUTCMinutes(),pe=new Date(Date.UTC(z.getUTCFullYear(),z.getUTCMonth(),z.getUTCDate()));console.log(" EDIT FLOW: Start date:",z.toISOString()),console.log(" EDIT FLOW: Hour:",me,"Minute:",xe),console.log(" EDIT FLOW: Current date:",pe.toISOString());const ce={duration:j};console.log(" EDIT FLOW: Updating task with new duration:",ce),await g.mutateAsync({id:e.id,updates:ce}),await new Promise(Se=>setTimeout(Se,100));const{getOrderById:nr}=dt.getState(),Xt=nr(e.id);console.log(" EDIT FLOW: Task duration after update:",Xt?.duration),console.log(" EDIT FLOW: Unscheduling task first"),await i(e.id,b),await new Promise(Se=>setTimeout(Se,100));const de={id:e.scheduled_machine_id};console.log(" EDIT FLOW: Calling scheduleTaskFromSlot with:",{taskId:e.id,machine:de,currentDate:pe.toISOString(),hour:me,minute:xe,timeRemaining:re});const et=await s(e.id,de,pe,me,xe,re,b);if(console.log(" EDIT FLOW: scheduleTaskFromSlot result:",et),et?.conflict){console.log(" EDIT FLOW: Conflict detected, showing dialog");const Se={...et,schedulingParams:{taskId:e.id,machine:de,currentDate:pe,hour:me,minute:xe,newDuration:re,originalConflict:et}};n(Se);return}else if(et?.error){console.log(" EDIT FLOW: Error:",et.error),Sr(et.error);return}else console.log(" EDIT FLOW: Scheduling successful");const gt=et?.updatedTask;console.log(" EDIT FLOW: Updated task from scheduling result:",gt);const ue={...He,duration:j,cost:m?.totals?.cost||null,scheduled_start_time:gt?.scheduled_start_time||z.toISOString(),scheduled_end_time:gt?.scheduled_end_time||new Date(z.getTime()+j*36e5).toISOString(),description:gt?.description||e.description};console.log(" EDIT FLOW: Final order data to save:",ue),I=await g.mutateAsync({id:e.id,updates:ue}),console.log(" EDIT FLOW: Final update completed:",I)}else{console.log(" SCENARIO Z: Duration decreased, using adjacent task rescheduling");const z=await Ae(e.id,j,re,He,m?.totals?.cost||null,b,g,s,i,n);if(z?.error){console.log(" SCENARIO Z: Error:",z.error),Sr(z.error);return}I=z.updatedOrder,console.log(" SCENARIO Z: Duration decrease rescheduling completed:",I)}}else{const Y={...He,duration:j,cost:m?.totals?.cost||null};I=await g.mutateAsync({id:e.id,updates:Y})}}else{const j={...He,duration:m?.totals?.duration||null,cost:m?.totals?.cost||null,status:"NOT SCHEDULED"};I=await f.mutateAsync(j)}r&&r(),F(),cn(v?"Ordine aggiornato con successo":"Ordine aggiunto con successo")},{context:v?"Aggiorna Ordine":"Aggiungi Ordine",fallbackMessage:v?"Aggiornamento ordine fallito":"Aggiunta ordine fallita"})},fe=()=>{if(!H){ts("Seleziona una fase prima di calcolare.");return}if(!R){ts("Inserisci la quantit per calcolare.");return}if(H.department===We.PRINTING&&!O){ts("Inserisci il passo busta per calcolare la stampa.");return}const U={...H,...L},ie=o(U);if(!ie.isValid){Sr(ie.error),y(null);return}const ke=H.department===We.PRINTING?O:null,Be=a(U,R,ke);if(!Be||typeof Be.totals?.duration!="number"||typeof Be.totals?.cost!="number"){Sr("Errore nel calcolo. Verifica i parametri della fase."),y(null);return}y(Be)},B=U=>L[U]??H[U]??"",Ae=async(U,ie,ke,Be,ft,we,K,He,I,j,_e)=>{try{console.log(" SCENARIO Z: Starting duration decrease rescheduling for task",U);const{getOrderById:re,getOdpOrders:Y}=dt.getState(),ae=re(U);if(!ae)return{error:"Task not found"};const z=new Date(ae.scheduled_start_time),me=z.getUTCHours(),xe=z.getUTCMinutes(),pe=new Date(Date.UTC(z.getUTCFullYear(),z.getUTCMonth(),z.getUTCDate())),ce={id:ae.scheduled_machine_id};console.log(" SCENARIO Z: Current task start:",z.toISOString()),console.log(" SCENARIO Z: New time remaining:",ke);const nr=new Date(ae.scheduled_end_time);console.log(" SCENARIO Z: Current end time for task A (from DB):",nr.toISOString());const Xt=Y(),de=[];let et=nr;for(console.log(" SCENARIO Z: Starting to find chain of adjacent tasks...");;){const gt=Xt.find(ue=>{if(ue.id===U||!ue.scheduled_machine_id||!ue.scheduled_start_time||ue.status!=="SCHEDULED"||ue.scheduled_machine_id!==ae.scheduled_machine_id||de.some(ir=>ir.id===ue.id))return!1;const Se=new Date(ue.scheduled_start_time),sr=Math.abs(Se.getTime()-et.getTime())/(1e3*60);return console.log(" SCENARIO Z: Checking task",ue.odp_number,"start:",Se.toISOString(),"diff:",sr,"minutes","against end time:",et.toISOString()),sr<=120});if(gt)console.log(" SCENARIO Z: Found adjacent task in chain:",gt.odp_number),de.push(gt),et=new Date(gt.scheduled_end_time),console.log(" SCENARIO Z: Next task end time for chain:",et.toISOString()),console.log(" SCENARIO Z: Continuing to search for more adjacent tasks...");else{console.log(" SCENARIO Z: No more adjacent tasks found, stopping chain search");break}}if(de.length>0){console.log(" SCENARIO Z: Found chain of",de.length,"adjacent tasks:",de.map($=>$.odp_number)),console.log(" SCENARIO Z: Step 2 - Rescheduling task A");const gt={duration:ie};await K.mutateAsync({id:U,updates:gt}),await new Promise($=>setTimeout($,100)),await I(U,we),await new Promise($=>setTimeout($,100));const ue=await He(U,ce,pe,me,xe,ke,we);if(ue?.conflict){console.log(" SCENARIO Z: Conflict detected for task A, showing dialog");const $={...ue,schedulingParams:{taskId:U,machine:ce,currentDate:pe,hour:me,minute:xe,newDuration:ke,originalConflict:ue}};return j($),{error:"Conflict detected for task A"}}else if(ue?.error)return console.log(" SCENARIO Z: Error rescheduling task A:",ue.error),{error:ue.error};console.log(" SCENARIO Z: Task A rescheduled successfully"),console.log(" SCENARIO Z: Step 3 - Rescheduling chain of",de.length,"tasks");let Se=new Date(ue.schedulingResult.endTime);const sr=[];for(let $=0;$<de.length;$++){const oe=de[$];console.log(` SCENARIO Z: Rescheduling chain task ${$+1}/${de.length}:`,oe.odp_number);const be=Se.getUTCHours(),Ee=Se.getUTCMinutes(),at=new Date(Date.UTC(Se.getUTCFullYear(),Se.getUTCMonth(),Se.getUTCDate()));console.log(" SCENARIO Z: Chain task new start time:",Se.toISOString()),console.log(" SCENARIO Z: Chain task new hour:",be,"minute:",Ee);const Ie=oe.time_remaining||oe.duration||1;console.log(" SCENARIO Z: Chain task time remaining:",Ie),await I(oe.id,we),await new Promise(mt=>setTimeout(mt,100));const le=await He(oe.id,ce,at,be,Ee,Ie,we);if(le?.conflict){console.log(" SCENARIO Z: Conflict detected for chain task",oe.odp_number,", showing dialog");const mt={...le,schedulingParams:{taskId:oe.id,machine:ce,currentDate:at,hour:be,minute:Ee,newDuration:Ie,originalConflict:le}};return j(mt),{error:`Conflict detected for chain task ${oe.odp_number}`}}else if(le?.error)return console.log(" SCENARIO Z: Error rescheduling chain task",oe.odp_number,":",le.error),{error:`Error rescheduling chain task ${oe.odp_number}: ${le.error}`};console.log(" SCENARIO Z: Chain task",oe.odp_number,"rescheduled successfully"),sr.push(le),Se=new Date(le.schedulingResult.endTime),console.log(" SCENARIO Z: Updated end time for next chain task:",Se.toISOString())}console.log(" SCENARIO Z: All",de.length,"chain tasks rescheduled successfully");const ir=ue?.updatedTask,Pe={...Be,duration:ie,cost:ft,scheduled_start_time:ir?.scheduled_start_time||z.toISOString(),scheduled_end_time:ir?.scheduled_end_time||new Date(z.getTime()+ie*36e5).toISOString(),description:ir?.description||ae.description},it=await K.mutateAsync({id:U,updates:Pe});return console.log(" SCENARIO Z: Task A and",de.length,"chain tasks rescheduled successfully"),{updatedOrder:it}}else{console.log(" SCENARIO Z: No adjacent task found, using standard rescheduling");const gt={duration:ie};await K.mutateAsync({id:U,updates:gt}),await new Promise(Pe=>setTimeout(Pe,100)),await I(U,we),await new Promise(Pe=>setTimeout(Pe,100));const ue=await He(U,ce,pe,me,xe,ke,we);if(ue?.conflict){console.log(" SCENARIO Z: Conflict detected, showing dialog");const Pe={...ue,schedulingParams:{taskId:U,machine:ce,currentDate:pe,hour:me,minute:xe,newDuration:ke,originalConflict:ue}};return j(Pe),{error:"Conflict detected"}}else if(ue?.error)return console.log(" SCENARIO Z: Error:",ue.error),{error:ue.error};const Se=ue?.updatedTask,sr={...Be,duration:ie,cost:ft,scheduled_start_time:Se?.scheduled_start_time||z.toISOString(),scheduled_end_time:Se?.scheduled_end_time||new Date(z.getTime()+ie*36e5).toISOString(),description:Se?.description||ae.description};return{updatedOrder:await K.mutateAsync({id:U,updates:sr})}}}catch(re){return console.error(" SCENARIO Z: Error in handleDurationDecreaseRescheduling:",re),{error:re.message||"Error during duration decrease rescheduling"}}},Ce=()=>H?H.department===We.PRINTING?[{name:"v_stampa",label:"Velocit Stampa:",unit:"mt/h"},{name:"t_setup_stampa",label:"Setup Stampa:",unit:"h"},{name:"costo_h_stampa",label:"Costo Stampa:",unit:"/h"}]:[{name:"v_conf",label:"Velocit Confezionamento:",unit:"pz/h"},{name:"t_setup_conf",label:"Setup Confezionamento:",unit:"h"},{name:"costo_h_conf",label:"Costo Confezionamento:",unit:"/h"}]:[],vt=_.useMemo(()=>({article_code:(U,{watch:ie,setValue:ke,getValues:Be,register:ft})=>h.jsx(ct,{type:"text",...ft(U.name,{...U.validation,onChange:we=>{U.validation?.onChange&&U.validation.onChange(we),V(we.target.value,ke)}}),placeholder:U.placeholder,disabled:U.disabled,className:U.className}),phase_search:(U,{watch:ie,setValue:ke,getValues:Be,register:ft})=>{const we=ie("department"),K=ie("work_center"),He=ie("quantity"),I=ie("bag_step");return _.useEffect(()=>{we!==S&&x(we),K!==E&&T(K),He!==R&&k(He),I!==O&&D(I)},[we,K,He,I,S,E,R,O]),h.jsxs("div",{className:"relative",children:[h.jsx(ct,{type:"text",value:A,onChange:j=>P(j.target.value),onFocus:()=>he(!0),onBlur:G,placeholder:"Cerca fase di produzione..."}),h.jsx("input",{type:"hidden",...ft("fase")}),Q&&Oe.length>0&&h.jsx("div",{className:"absolute top-full left-0 right-0 bg-white border border-gray-300 rounded-md shadow-lg z-10 max-h-60 overflow-y-auto",children:Oe.map(j=>h.jsxs("div",{className:"px-3 py-1 hover:bg-gray-100 cursor-pointer border-b border-gray-100 last:border-b-0",onMouseDown:()=>{Le(j,ke,()=>{}),y(null)},children:[h.jsx("div",{className:"text-[10px] font-medium",children:j.name}),h.jsx("div",{className:"text-[10px] text-gray-600",children:j.contenuto_fase})]},j.id))})]})},phase_parameters:()=>H?h.jsxs("div",{className:"space-y-2",children:[h.jsx("h3",{className:"text-[10px] font-semibold text-gray-900 border-b pb-2",children:"Parametri Fase Selezionata"}),h.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2",children:Ce().map(U=>h.jsxs("div",{className:"space-y-2",children:[h.jsx(Et,{htmlFor:U.name,children:U.label}),h.jsxs("div",{className:"flex items-center space-x-2",children:[h.jsx(ct,{type:"number",id:U.name,value:B(U.name),onChange:ie=>ee(U.name,ie.target.value)}),h.jsx("span",{className:"text-[10px] text-gray-500 whitespace-nowrap",children:U.unit})]})]},U.name))})]}):null,calculation_results:()=>m?.totals?h.jsxs("div",{className:"space-y-2",children:[h.jsx("h3",{className:"text-[10px] font-semibold text-gray-900 border-b pb-2",children:"Risultati Calcolo Produzione"}),h.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:[h.jsxs("div",{className:"space-y-2",children:[h.jsx(Et,{children:"Durata Totale (ore):"}),h.jsx("div",{className:"text-[10px] font-semibold text-navy-800",children:m.totals.duration.toFixed(2)})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Et,{children:"Costo Totale ():"}),h.jsx("div",{className:"text-[10px] font-semibold text-green-600",children:m.totals.cost.toFixed(2)})]})]})]}):null}),[A,P,Q,he,Oe,G,Le,H,B,ee,Ce,m,V]),Ze=_.useMemo(()=>h.jsx("div",{className:"flex justify-end space-x-4 pt-6",children:h.jsx(Te,{type:"button",variant:"outline",onClick:fe,disabled:!H,children:"Calcola"})}),[H,fe]),kr=f.isPending||g.isPending;return h.jsx(Li,{config:p,initialData:w,onSubmit:q,onSuccess:r,isEditMode:v,isLoading:kr,customActions:Ze,customFieldRenderers:vt})};function Tc(){const{id:r}=Ni(),e=gr(),{data:t,isLoading:n,error:s}=kS(r),{selectedWorkCenter:i}=Ve(),{isLoading:a,isInitialized:o,init:l,cleanup:c}=zr(),d=!!r;return _.useEffect(()=>(o||l(),()=>{c()}),[l,o,c]),_.useEffect(()=>{d&&!n&&!t&&s&&e("/backlog",{replace:!0})},[d,n,t,e,s]),n?h.jsx("div",{children:"Caricamento..."}):d&&!t?h.jsx("div",{className:"text-center py-2 text-red-600 text-[10px]",children:"Ordine non trovato."}):i?h.jsxs("div",{className:"space-y-6",children:[h.jsxs("div",{className:"flex items-center justify-between",children:[h.jsx("h1",{className:"text-2xl font-semibold text-foreground",children:d?`Modifica Ordine: ${t?.odp_number}`:"Aggiungi Nuovo Ordine"}),d&&h.jsx(Te,{variant:"outline",onClick:()=>e("/scheduler"),children:" Torna al Programmatore"})]}),h.jsx(HE,{onSuccess:d?()=>e("/scheduler"):void 0,orderToEdit:t})]}):h.jsx("div",{className:"text-center py-2 text-red-600 text-[10px]",children:"Seleziona un centro di lavoro per gestire gli ordini del backlog."})}const Ki=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function Bn(r){const e=Object.prototype.toString.call(r);return e==="[object Window]"||e==="[object global]"}function Lo(r){return"nodeType"in r}function Ot(r){var e,t;return r?Bn(r)?r:Lo(r)&&(e=(t=r.ownerDocument)==null?void 0:t.defaultView)!=null?e:window:window}function $o(r){const{Document:e}=Ot(r);return r instanceof e}function Ds(r){return Bn(r)?!1:r instanceof Ot(r).HTMLElement}function th(r){return r instanceof Ot(r).SVGElement}function zn(r){return r?Bn(r)?r.document:Lo(r)?$o(r)?r:Ds(r)||th(r)?r.ownerDocument:document:document:document}const Cr=Ki?_.useLayoutEffect:_.useEffect;function Yi(r){const e=_.useRef(r);return Cr(()=>{e.current=r}),_.useCallback(function(){for(var t=arguments.length,n=new Array(t),s=0;s<t;s++)n[s]=arguments[s];return e.current==null?void 0:e.current(...n)},[])}function BE(){const r=_.useRef(null),e=_.useCallback((n,s)=>{r.current=setInterval(n,s)},[]),t=_.useCallback(()=>{r.current!==null&&(clearInterval(r.current),r.current=null)},[]);return[e,t]}function ws(r,e){e===void 0&&(e=[r]);const t=_.useRef(r);return Cr(()=>{t.current!==r&&(t.current=r)},e),t}function Ns(r,e){const t=_.useRef();return _.useMemo(()=>{const n=r(t.current);return t.current=n,n},[...e])}function xi(r){const e=Yi(r),t=_.useRef(null),n=_.useCallback(s=>{s!==t.current&&e?.(s,t.current),t.current=s},[]);return[t,n]}function Ei(r){const e=_.useRef();return _.useEffect(()=>{e.current=r},[r]),e.current}let Oa={};function Xi(r,e){return _.useMemo(()=>{if(e)return e;const t=Oa[r]==null?0:Oa[r]+1;return Oa[r]=t,r+"-"+t},[r,e])}function rh(r){return function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),s=1;s<t;s++)n[s-1]=arguments[s];return n.reduce((i,a)=>{const o=Object.entries(a);for(const[l,c]of o){const d=i[l];d!=null&&(i[l]=d+r*c)}return i},{...e})}}const An=rh(1),Ti=rh(-1);function zE(r){return"clientX"in r&&"clientY"in r}function Fo(r){if(!r)return!1;const{KeyboardEvent:e}=Ot(r.target);return e&&r instanceof e}function WE(r){if(!r)return!1;const{TouchEvent:e}=Ot(r.target);return e&&r instanceof e}function Ri(r){if(WE(r)){if(r.touches&&r.touches.length){const{clientX:e,clientY:t}=r.touches[0];return{x:e,y:t}}else if(r.changedTouches&&r.changedTouches.length){const{clientX:e,clientY:t}=r.changedTouches[0];return{x:e,y:t}}}return zE(r)?{x:r.clientX,y:r.clientY}:null}const _s=Object.freeze({Translate:{toString(r){if(!r)return;const{x:e,y:t}=r;return"translate3d("+(e?Math.round(e):0)+"px, "+(t?Math.round(t):0)+"px, 0)"}},Scale:{toString(r){if(!r)return;const{scaleX:e,scaleY:t}=r;return"scaleX("+e+") scaleY("+t+")"}},Transform:{toString(r){if(r)return[_s.Translate.toString(r),_s.Scale.toString(r)].join(" ")}},Transition:{toString(r){let{property:e,duration:t,easing:n}=r;return e+" "+t+"ms "+n}}}),Rc="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function qE(r){return r.matches(Rc)?r:r.querySelector(Rc)}const VE={display:"none"};function GE(r){let{id:e,value:t}=r;return N.createElement("div",{id:e,style:VE},t)}function KE(r){let{id:e,announcement:t,ariaLiveType:n="assertive"}=r;const s={position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"};return N.createElement("div",{id:e,style:s,role:"status","aria-live":n,"aria-atomic":!0},t)}function YE(){const[r,e]=_.useState("");return{announce:_.useCallback(n=>{n!=null&&e(n)},[]),announcement:r}}const nh=_.createContext(null);function XE(r){const e=_.useContext(nh);_.useEffect(()=>{if(!e)throw new Error("useDndMonitor must be used within a children of <DndContext>");return e(r)},[r,e])}function QE(){const[r]=_.useState(()=>new Set),e=_.useCallback(n=>(r.add(n),()=>r.delete(n)),[r]);return[_.useCallback(n=>{let{type:s,event:i}=n;r.forEach(a=>{var o;return(o=a[s])==null?void 0:o.call(a,i)})},[r]),e]}const JE={draggable:`
    To pick up a draggable item, press the space bar.
    While dragging, use the arrow keys to move the item.
    Press space again to drop the item in its new position, or press escape to cancel.
  `},ZE={onDragStart(r){let{active:e}=r;return"Picked up draggable item "+e.id+"."},onDragOver(r){let{active:e,over:t}=r;return t?"Draggable item "+e.id+" was moved over droppable area "+t.id+".":"Draggable item "+e.id+" is no longer over a droppable area."},onDragEnd(r){let{active:e,over:t}=r;return t?"Draggable item "+e.id+" was dropped over droppable area "+t.id:"Draggable item "+e.id+" was dropped."},onDragCancel(r){let{active:e}=r;return"Dragging was cancelled. Draggable item "+e.id+" was dropped."}};function eT(r){let{announcements:e=ZE,container:t,hiddenTextDescribedById:n,screenReaderInstructions:s=JE}=r;const{announce:i,announcement:a}=YE(),o=Xi("DndLiveRegion"),[l,c]=_.useState(!1);if(_.useEffect(()=>{c(!0)},[]),XE(_.useMemo(()=>({onDragStart(u){let{active:f}=u;i(e.onDragStart({active:f}))},onDragMove(u){let{active:f,over:g}=u;e.onDragMove&&i(e.onDragMove({active:f,over:g}))},onDragOver(u){let{active:f,over:g}=u;i(e.onDragOver({active:f,over:g}))},onDragEnd(u){let{active:f,over:g}=u;i(e.onDragEnd({active:f,over:g}))},onDragCancel(u){let{active:f,over:g}=u;i(e.onDragCancel({active:f,over:g}))}}),[i,e])),!l)return null;const d=N.createElement(N.Fragment,null,N.createElement(GE,{id:n,value:s.draggable}),N.createElement(KE,{id:o,announcement:a}));return t?Zn.createPortal(d,t):d}var st;(function(r){r.DragStart="dragStart",r.DragMove="dragMove",r.DragEnd="dragEnd",r.DragCancel="dragCancel",r.DragOver="dragOver",r.RegisterDroppable="registerDroppable",r.SetDroppableDisabled="setDroppableDisabled",r.UnregisterDroppable="unregisterDroppable"})(st||(st={}));function Oi(){}function Oc(r,e){return _.useMemo(()=>({sensor:r,options:e??{}}),[r,e])}function tT(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];return _.useMemo(()=>[...e].filter(n=>n!=null),[...e])}const rr=Object.freeze({x:0,y:0});function rT(r,e){const t=Ri(r);if(!t)return"0 0";const n={x:(t.x-e.left)/e.width*100,y:(t.y-e.top)/e.height*100};return n.x+"% "+n.y+"%"}function nT(r,e){let{data:{value:t}}=r,{data:{value:n}}=e;return n-t}function sT(r,e){if(!r||r.length===0)return null;const[t]=r;return t[e]}function iT(r,e){const t=Math.max(e.top,r.top),n=Math.max(e.left,r.left),s=Math.min(e.left+e.width,r.left+r.width),i=Math.min(e.top+e.height,r.top+r.height),a=s-n,o=i-t;if(n<s&&t<i){const l=e.width*e.height,c=r.width*r.height,d=a*o,u=d/(l+c-d);return Number(u.toFixed(4))}return 0}const aT=r=>{let{collisionRect:e,droppableRects:t,droppableContainers:n}=r;const s=[];for(const i of n){const{id:a}=i,o=t.get(a);if(o){const l=iT(o,e);l>0&&s.push({id:a,data:{droppableContainer:i,value:l}})}}return s.sort(nT)};function oT(r,e,t){return{...r,scaleX:e&&t?e.width/t.width:1,scaleY:e&&t?e.height/t.height:1}}function sh(r,e){return r&&e?{x:r.left-e.left,y:r.top-e.top}:rr}function lT(r){return function(t){for(var n=arguments.length,s=new Array(n>1?n-1:0),i=1;i<n;i++)s[i-1]=arguments[i];return s.reduce((a,o)=>({...a,top:a.top+r*o.y,bottom:a.bottom+r*o.y,left:a.left+r*o.x,right:a.right+r*o.x}),{...t})}}const cT=lT(1);function ih(r){if(r.startsWith("matrix3d(")){const e=r.slice(9,-1).split(/, /);return{x:+e[12],y:+e[13],scaleX:+e[0],scaleY:+e[5]}}else if(r.startsWith("matrix(")){const e=r.slice(7,-1).split(/, /);return{x:+e[4],y:+e[5],scaleX:+e[0],scaleY:+e[3]}}return null}function dT(r,e,t){const n=ih(e);if(!n)return r;const{scaleX:s,scaleY:i,x:a,y:o}=n,l=r.left-a-(1-s)*parseFloat(t),c=r.top-o-(1-i)*parseFloat(t.slice(t.indexOf(" ")+1)),d=s?r.width/s:r.width,u=i?r.height/i:r.height;return{width:d,height:u,top:c,right:l+d,bottom:c+u,left:l}}const uT={ignoreTransform:!1};function As(r,e){e===void 0&&(e=uT);let t=r.getBoundingClientRect();if(e.ignoreTransform){const{transform:c,transformOrigin:d}=Ot(r).getComputedStyle(r);c&&(t=dT(t,c,d))}const{top:n,left:s,width:i,height:a,bottom:o,right:l}=t;return{top:n,left:s,width:i,height:a,bottom:o,right:l}}function Cc(r){return As(r,{ignoreTransform:!0})}function hT(r){const e=r.innerWidth,t=r.innerHeight;return{top:0,left:0,right:e,bottom:t,width:e,height:t}}function fT(r,e){return e===void 0&&(e=Ot(r).getComputedStyle(r)),e.position==="fixed"}function gT(r,e){e===void 0&&(e=Ot(r).getComputedStyle(r));const t=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(s=>{const i=e[s];return typeof i=="string"?t.test(i):!1})}function Uo(r,e){const t=[];function n(s){if(e!=null&&t.length>=e||!s)return t;if($o(s)&&s.scrollingElement!=null&&!t.includes(s.scrollingElement))return t.push(s.scrollingElement),t;if(!Ds(s)||th(s)||t.includes(s))return t;const i=Ot(r).getComputedStyle(s);return s!==r&&gT(s,i)&&t.push(s),fT(s,i)?t:n(s.parentNode)}return r?n(r):t}function ah(r){const[e]=Uo(r,1);return e??null}function Ca(r){return!Ki||!r?null:Bn(r)?r:Lo(r)?$o(r)||r===zn(r).scrollingElement?window:Ds(r)?r:null:null}function oh(r){return Bn(r)?r.scrollX:r.scrollLeft}function lh(r){return Bn(r)?r.scrollY:r.scrollTop}function ao(r){return{x:oh(r),y:lh(r)}}var lt;(function(r){r[r.Forward=1]="Forward",r[r.Backward=-1]="Backward"})(lt||(lt={}));function ch(r){return!Ki||!r?!1:r===document.scrollingElement}function dh(r){const e={x:0,y:0},t=ch(r)?{height:window.innerHeight,width:window.innerWidth}:{height:r.clientHeight,width:r.clientWidth},n={x:r.scrollWidth-t.width,y:r.scrollHeight-t.height},s=r.scrollTop<=e.y,i=r.scrollLeft<=e.x,a=r.scrollTop>=n.y,o=r.scrollLeft>=n.x;return{isTop:s,isLeft:i,isBottom:a,isRight:o,maxScroll:n,minScroll:e}}const mT={x:.2,y:.2};function pT(r,e,t,n,s){let{top:i,left:a,right:o,bottom:l}=t;n===void 0&&(n=10),s===void 0&&(s=mT);const{isTop:c,isBottom:d,isLeft:u,isRight:f}=dh(r),g={x:0,y:0},b={x:0,y:0},m={height:e.height*s.y,width:e.width*s.x};return!c&&i<=e.top+m.height?(g.y=lt.Backward,b.y=n*Math.abs((e.top+m.height-i)/m.height)):!d&&l>=e.bottom-m.height&&(g.y=lt.Forward,b.y=n*Math.abs((e.bottom-m.height-l)/m.height)),!f&&o>=e.right-m.width?(g.x=lt.Forward,b.x=n*Math.abs((e.right-m.width-o)/m.width)):!u&&a<=e.left+m.width&&(g.x=lt.Backward,b.x=n*Math.abs((e.left+m.width-a)/m.width)),{direction:g,speed:b}}function bT(r){if(r===document.scrollingElement){const{innerWidth:i,innerHeight:a}=window;return{top:0,left:0,right:i,bottom:a,width:i,height:a}}const{top:e,left:t,right:n,bottom:s}=r.getBoundingClientRect();return{top:e,left:t,right:n,bottom:s,width:r.clientWidth,height:r.clientHeight}}function uh(r){return r.reduce((e,t)=>An(e,ao(t)),rr)}function yT(r){return r.reduce((e,t)=>e+oh(t),0)}function vT(r){return r.reduce((e,t)=>e+lh(t),0)}function hh(r,e){if(e===void 0&&(e=As),!r)return;const{top:t,left:n,bottom:s,right:i}=e(r);ah(r)&&(s<=0||i<=0||t>=window.innerHeight||n>=window.innerWidth)&&r.scrollIntoView({block:"center",inline:"center"})}const wT=[["x",["left","right"],yT],["y",["top","bottom"],vT]];class Ho{constructor(e,t){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const n=Uo(t),s=uh(n);this.rect={...e},this.width=e.width,this.height=e.height;for(const[i,a,o]of wT)for(const l of a)Object.defineProperty(this,l,{get:()=>{const c=o(n),d=s[i]-c;return this.rect[l]+d},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class ls{constructor(e){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(t=>{var n;return(n=this.target)==null?void 0:n.removeEventListener(...t)})},this.target=e}add(e,t,n){var s;(s=this.target)==null||s.addEventListener(e,t,n),this.listeners.push([e,t,n])}}function _T(r){const{EventTarget:e}=Ot(r);return r instanceof e?r:zn(r)}function ka(r,e){const t=Math.abs(r.x),n=Math.abs(r.y);return typeof e=="number"?Math.sqrt(t**2+n**2)>e:"x"in e&&"y"in e?t>e.x&&n>e.y:"x"in e?t>e.x:"y"in e?n>e.y:!1}var qt;(function(r){r.Click="click",r.DragStart="dragstart",r.Keydown="keydown",r.ContextMenu="contextmenu",r.Resize="resize",r.SelectionChange="selectionchange",r.VisibilityChange="visibilitychange"})(qt||(qt={}));function kc(r){r.preventDefault()}function ST(r){r.stopPropagation()}var je;(function(r){r.Space="Space",r.Down="ArrowDown",r.Right="ArrowRight",r.Left="ArrowLeft",r.Up="ArrowUp",r.Esc="Escape",r.Enter="Enter",r.Tab="Tab"})(je||(je={}));const fh={start:[je.Space,je.Enter],cancel:[je.Esc],end:[je.Space,je.Enter,je.Tab]},xT=(r,e)=>{let{currentCoordinates:t}=e;switch(r.code){case je.Right:return{...t,x:t.x+25};case je.Left:return{...t,x:t.x-25};case je.Down:return{...t,y:t.y+25};case je.Up:return{...t,y:t.y-25}}};class gh{constructor(e){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=e;const{event:{target:t}}=e;this.props=e,this.listeners=new ls(zn(t)),this.windowListeners=new ls(Ot(t)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(qt.Resize,this.handleCancel),this.windowListeners.add(qt.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(qt.Keydown,this.handleKeyDown))}handleStart(){const{activeNode:e,onStart:t}=this.props,n=e.node.current;n&&hh(n),t(rr)}handleKeyDown(e){if(Fo(e)){const{active:t,context:n,options:s}=this.props,{keyboardCodes:i=fh,coordinateGetter:a=xT,scrollBehavior:o="smooth"}=s,{code:l}=e;if(i.end.includes(l)){this.handleEnd(e);return}if(i.cancel.includes(l)){this.handleCancel(e);return}const{collisionRect:c}=n.current,d=c?{x:c.left,y:c.top}:rr;this.referenceCoordinates||(this.referenceCoordinates=d);const u=a(e,{active:t,context:n.current,currentCoordinates:d});if(u){const f=Ti(u,d),g={x:0,y:0},{scrollableAncestors:b}=n.current;for(const m of b){const y=e.code,{isTop:v,isRight:p,isLeft:w,isBottom:S,maxScroll:x,minScroll:E}=dh(m),T=bT(m),R={x:Math.min(y===je.Right?T.right-T.width/2:T.right,Math.max(y===je.Right?T.left:T.left+T.width/2,u.x)),y:Math.min(y===je.Down?T.bottom-T.height/2:T.bottom,Math.max(y===je.Down?T.top:T.top+T.height/2,u.y))},k=y===je.Right&&!p||y===je.Left&&!w,O=y===je.Down&&!S||y===je.Up&&!v;if(k&&R.x!==u.x){const D=m.scrollLeft+f.x,A=y===je.Right&&D<=x.x||y===je.Left&&D>=E.x;if(A&&!f.y){m.scrollTo({left:D,behavior:o});return}A?g.x=m.scrollLeft-D:g.x=y===je.Right?m.scrollLeft-x.x:m.scrollLeft-E.x,g.x&&m.scrollBy({left:-g.x,behavior:o});break}else if(O&&R.y!==u.y){const D=m.scrollTop+f.y,A=y===je.Down&&D<=x.y||y===je.Up&&D>=E.y;if(A&&!f.x){m.scrollTo({top:D,behavior:o});return}A?g.y=m.scrollTop-D:g.y=y===je.Down?m.scrollTop-x.y:m.scrollTop-E.y,g.y&&m.scrollBy({top:-g.y,behavior:o});break}}this.handleMove(e,An(Ti(u,this.referenceCoordinates),g))}}}handleMove(e,t){const{onMove:n}=this.props;e.preventDefault(),n(t)}handleEnd(e){const{onEnd:t}=this.props;e.preventDefault(),this.detach(),t()}handleCancel(e){const{onCancel:t}=this.props;e.preventDefault(),this.detach(),t()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}gh.activators=[{eventName:"onKeyDown",handler:(r,e,t)=>{let{keyboardCodes:n=fh,onActivation:s}=e,{active:i}=t;const{code:a}=r.nativeEvent;if(n.start.includes(a)){const o=i.activatorNode.current;return o&&r.target!==o?!1:(r.preventDefault(),s?.({event:r.nativeEvent}),!0)}return!1}}];function Dc(r){return!!(r&&"distance"in r)}function Nc(r){return!!(r&&"delay"in r)}class Bo{constructor(e,t,n){var s;n===void 0&&(n=_T(e.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=e,this.events=t;const{event:i}=e,{target:a}=i;this.props=e,this.events=t,this.document=zn(a),this.documentListeners=new ls(this.document),this.listeners=new ls(n),this.windowListeners=new ls(Ot(a)),this.initialCoordinates=(s=Ri(i))!=null?s:rr,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){const{events:e,props:{options:{activationConstraint:t,bypassActivationConstraint:n}}}=this;if(this.listeners.add(e.move.name,this.handleMove,{passive:!1}),this.listeners.add(e.end.name,this.handleEnd),e.cancel&&this.listeners.add(e.cancel.name,this.handleCancel),this.windowListeners.add(qt.Resize,this.handleCancel),this.windowListeners.add(qt.DragStart,kc),this.windowListeners.add(qt.VisibilityChange,this.handleCancel),this.windowListeners.add(qt.ContextMenu,kc),this.documentListeners.add(qt.Keydown,this.handleKeydown),t){if(n!=null&&n({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(Nc(t)){this.timeoutId=setTimeout(this.handleStart,t.delay),this.handlePending(t);return}if(Dc(t)){this.handlePending(t);return}}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),this.timeoutId!==null&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(e,t){const{active:n,onPending:s}=this.props;s(n,e,this.initialCoordinates,t)}handleStart(){const{initialCoordinates:e}=this,{onStart:t}=this.props;e&&(this.activated=!0,this.documentListeners.add(qt.Click,ST,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(qt.SelectionChange,this.removeTextSelection),t(e))}handleMove(e){var t;const{activated:n,initialCoordinates:s,props:i}=this,{onMove:a,options:{activationConstraint:o}}=i;if(!s)return;const l=(t=Ri(e))!=null?t:rr,c=Ti(s,l);if(!n&&o){if(Dc(o)){if(o.tolerance!=null&&ka(c,o.tolerance))return this.handleCancel();if(ka(c,o.distance))return this.handleStart()}if(Nc(o)&&ka(c,o.tolerance))return this.handleCancel();this.handlePending(o,c);return}e.cancelable&&e.preventDefault(),a(l)}handleEnd(){const{onAbort:e,onEnd:t}=this.props;this.detach(),this.activated||e(this.props.active),t()}handleCancel(){const{onAbort:e,onCancel:t}=this.props;this.detach(),this.activated||e(this.props.active),t()}handleKeydown(e){e.code===je.Esc&&this.handleCancel()}removeTextSelection(){var e;(e=this.document.getSelection())==null||e.removeAllRanges()}}const ET={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class zo extends Bo{constructor(e){const{event:t}=e,n=zn(t.target);super(e,ET,n)}}zo.activators=[{eventName:"onPointerDown",handler:(r,e)=>{let{nativeEvent:t}=r,{onActivation:n}=e;return!t.isPrimary||t.button!==0?!1:(n?.({event:t}),!0)}}];const TT={move:{name:"mousemove"},end:{name:"mouseup"}};var oo;(function(r){r[r.RightClick=2]="RightClick"})(oo||(oo={}));class mh extends Bo{constructor(e){super(e,TT,zn(e.event.target))}}mh.activators=[{eventName:"onMouseDown",handler:(r,e)=>{let{nativeEvent:t}=r,{onActivation:n}=e;return t.button===oo.RightClick?!1:(n?.({event:t}),!0)}}];const Da={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};class RT extends Bo{constructor(e){super(e,Da)}static setup(){return window.addEventListener(Da.move.name,e,{capture:!1,passive:!1}),function(){window.removeEventListener(Da.move.name,e)};function e(){}}}RT.activators=[{eventName:"onTouchStart",handler:(r,e)=>{let{nativeEvent:t}=r,{onActivation:n}=e;const{touches:s}=t;return s.length>1?!1:(n?.({event:t}),!0)}}];var cs;(function(r){r[r.Pointer=0]="Pointer",r[r.DraggableRect=1]="DraggableRect"})(cs||(cs={}));var Ci;(function(r){r[r.TreeOrder=0]="TreeOrder",r[r.ReversedTreeOrder=1]="ReversedTreeOrder"})(Ci||(Ci={}));function OT(r){let{acceleration:e,activator:t=cs.Pointer,canScroll:n,draggingRect:s,enabled:i,interval:a=5,order:o=Ci.TreeOrder,pointerCoordinates:l,scrollableAncestors:c,scrollableAncestorRects:d,delta:u,threshold:f}=r;const g=kT({delta:u,disabled:!i}),[b,m]=BE(),y=_.useRef({x:0,y:0}),v=_.useRef({x:0,y:0}),p=_.useMemo(()=>{switch(t){case cs.Pointer:return l?{top:l.y,bottom:l.y,left:l.x,right:l.x}:null;case cs.DraggableRect:return s}},[t,s,l]),w=_.useRef(null),S=_.useCallback(()=>{const E=w.current;if(!E)return;const T=y.current.x*v.current.x,R=y.current.y*v.current.y;E.scrollBy(T,R)},[]),x=_.useMemo(()=>o===Ci.TreeOrder?[...c].reverse():c,[o,c]);_.useEffect(()=>{if(!i||!c.length||!p){m();return}for(const E of x){if(n?.(E)===!1)continue;const T=c.indexOf(E),R=d[T];if(!R)continue;const{direction:k,speed:O}=pT(E,R,p,e,f);for(const D of["x","y"])g[D][k[D]]||(O[D]=0,k[D]=0);if(O.x>0||O.y>0){m(),w.current=E,b(S,a),y.current=O,v.current=k;return}}y.current={x:0,y:0},v.current={x:0,y:0},m()},[e,S,n,m,i,a,JSON.stringify(p),JSON.stringify(g),b,c,x,d,JSON.stringify(f)])}const CT={x:{[lt.Backward]:!1,[lt.Forward]:!1},y:{[lt.Backward]:!1,[lt.Forward]:!1}};function kT(r){let{delta:e,disabled:t}=r;const n=Ei(e);return Ns(s=>{if(t||!n||!s)return CT;const i={x:Math.sign(e.x-n.x),y:Math.sign(e.y-n.y)};return{x:{[lt.Backward]:s.x[lt.Backward]||i.x===-1,[lt.Forward]:s.x[lt.Forward]||i.x===1},y:{[lt.Backward]:s.y[lt.Backward]||i.y===-1,[lt.Forward]:s.y[lt.Forward]||i.y===1}}},[t,e,n])}function DT(r,e){const t=e!=null?r.get(e):void 0,n=t?t.node.current:null;return Ns(s=>{var i;return e==null?null:(i=n??s)!=null?i:null},[n,e])}function NT(r,e){return _.useMemo(()=>r.reduce((t,n)=>{const{sensor:s}=n,i=s.activators.map(a=>({eventName:a.eventName,handler:e(a.handler,n)}));return[...t,...i]},[]),[r,e])}var Ss;(function(r){r[r.Always=0]="Always",r[r.BeforeDragging=1]="BeforeDragging",r[r.WhileDragging=2]="WhileDragging"})(Ss||(Ss={}));var lo;(function(r){r.Optimized="optimized"})(lo||(lo={}));const Ac=new Map;function AT(r,e){let{dragging:t,dependencies:n,config:s}=e;const[i,a]=_.useState(null),{frequency:o,measure:l,strategy:c}=s,d=_.useRef(r),u=y(),f=ws(u),g=_.useCallback(function(v){v===void 0&&(v=[]),!f.current&&a(p=>p===null?v:p.concat(v.filter(w=>!p.includes(w))))},[f]),b=_.useRef(null),m=Ns(v=>{if(u&&!t)return Ac;if(!v||v===Ac||d.current!==r||i!=null){const p=new Map;for(let w of r){if(!w)continue;if(i&&i.length>0&&!i.includes(w.id)&&w.rect.current){p.set(w.id,w.rect.current);continue}const S=w.node.current,x=S?new Ho(l(S),S):null;w.rect.current=x,x&&p.set(w.id,x)}return p}return v},[r,i,t,u,l]);return _.useEffect(()=>{d.current=r},[r]),_.useEffect(()=>{u||g()},[t,u]),_.useEffect(()=>{i&&i.length>0&&a(null)},[JSON.stringify(i)]),_.useEffect(()=>{u||typeof o!="number"||b.current!==null||(b.current=setTimeout(()=>{g(),b.current=null},o))},[o,u,g,...n]),{droppableRects:m,measureDroppableContainers:g,measuringScheduled:i!=null};function y(){switch(c){case Ss.Always:return!1;case Ss.BeforeDragging:return t;default:return!t}}}function Wo(r,e){return Ns(t=>r?t||(typeof e=="function"?e(r):r):null,[e,r])}function IT(r,e){return Wo(r,e)}function MT(r){let{callback:e,disabled:t}=r;const n=Yi(e),s=_.useMemo(()=>{if(t||typeof window>"u"||typeof window.MutationObserver>"u")return;const{MutationObserver:i}=window;return new i(n)},[n,t]);return _.useEffect(()=>()=>s?.disconnect(),[s]),s}function Qi(r){let{callback:e,disabled:t}=r;const n=Yi(e),s=_.useMemo(()=>{if(t||typeof window>"u"||typeof window.ResizeObserver>"u")return;const{ResizeObserver:i}=window;return new i(n)},[t]);return _.useEffect(()=>()=>s?.disconnect(),[s]),s}function PT(r){return new Ho(As(r),r)}function Ic(r,e,t){e===void 0&&(e=PT);const[n,s]=_.useState(null);function i(){s(l=>{if(!r)return null;if(r.isConnected===!1){var c;return(c=l??t)!=null?c:null}const d=e(r);return JSON.stringify(l)===JSON.stringify(d)?l:d})}const a=MT({callback(l){if(r)for(const c of l){const{type:d,target:u}=c;if(d==="childList"&&u instanceof HTMLElement&&u.contains(r)){i();break}}}}),o=Qi({callback:i});return Cr(()=>{i(),r?(o?.observe(r),a?.observe(document.body,{childList:!0,subtree:!0})):(o?.disconnect(),a?.disconnect())},[r]),n}function jT(r){const e=Wo(r);return sh(r,e)}const Mc=[];function LT(r){const e=_.useRef(r),t=Ns(n=>r?n&&n!==Mc&&r&&e.current&&r.parentNode===e.current.parentNode?n:Uo(r):Mc,[r]);return _.useEffect(()=>{e.current=r},[r]),t}function $T(r){const[e,t]=_.useState(null),n=_.useRef(r),s=_.useCallback(i=>{const a=Ca(i.target);a&&t(o=>o?(o.set(a,ao(a)),new Map(o)):null)},[]);return _.useEffect(()=>{const i=n.current;if(r!==i){a(i);const o=r.map(l=>{const c=Ca(l);return c?(c.addEventListener("scroll",s,{passive:!0}),[c,ao(c)]):null}).filter(l=>l!=null);t(o.length?new Map(o):null),n.current=r}return()=>{a(r),a(i)};function a(o){o.forEach(l=>{const c=Ca(l);c?.removeEventListener("scroll",s)})}},[s,r]),_.useMemo(()=>r.length?e?Array.from(e.values()).reduce((i,a)=>An(i,a),rr):uh(r):rr,[r,e])}function Pc(r,e){e===void 0&&(e=[]);const t=_.useRef(null);return _.useEffect(()=>{t.current=null},e),_.useEffect(()=>{const n=r!==rr;n&&!t.current&&(t.current=r),!n&&t.current&&(t.current=null)},[r]),t.current?Ti(r,t.current):rr}function FT(r){_.useEffect(()=>{if(!Ki)return;const e=r.map(t=>{let{sensor:n}=t;return n.setup==null?void 0:n.setup()});return()=>{for(const t of e)t?.()}},r.map(e=>{let{sensor:t}=e;return t}))}function UT(r,e){return _.useMemo(()=>r.reduce((t,n)=>{let{eventName:s,handler:i}=n;return t[s]=a=>{i(a,e)},t},{}),[r,e])}function ph(r){return _.useMemo(()=>r?hT(r):null,[r])}const jc=[];function HT(r,e){e===void 0&&(e=As);const[t]=r,n=ph(t?Ot(t):null),[s,i]=_.useState(jc);function a(){i(()=>r.length?r.map(l=>ch(l)?n:new Ho(e(l),l)):jc)}const o=Qi({callback:a});return Cr(()=>{o?.disconnect(),a(),r.forEach(l=>o?.observe(l))},[r]),s}function bh(r){if(!r)return null;if(r.children.length>1)return r;const e=r.children[0];return Ds(e)?e:r}function BT(r){let{measure:e}=r;const[t,n]=_.useState(null),s=_.useCallback(c=>{for(const{target:d}of c)if(Ds(d)){n(u=>{const f=e(d);return u?{...u,width:f.width,height:f.height}:f});break}},[e]),i=Qi({callback:s}),a=_.useCallback(c=>{const d=bh(c);i?.disconnect(),d&&i?.observe(d),n(d?e(d):null)},[e,i]),[o,l]=xi(a);return _.useMemo(()=>({nodeRef:o,rect:t,setRef:l}),[t,o,l])}const zT=[{sensor:zo,options:{}},{sensor:gh,options:{}}],WT={current:{}},di={draggable:{measure:Cc},droppable:{measure:Cc,strategy:Ss.WhileDragging,frequency:lo.Optimized},dragOverlay:{measure:As}};class ds extends Map{get(e){var t;return e!=null&&(t=super.get(e))!=null?t:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(e=>{let{disabled:t}=e;return!t})}getNodeFor(e){var t,n;return(t=(n=this.get(e))==null?void 0:n.node.current)!=null?t:void 0}}const qT={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new ds,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:Oi},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:di,measureDroppableContainers:Oi,windowRect:null,measuringScheduled:!1},yh={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:Oi,draggableNodes:new Map,over:null,measureDroppableContainers:Oi},Is=_.createContext(yh),vh=_.createContext(qT);function VT(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new ds}}}function GT(r,e){switch(e.type){case st.DragStart:return{...r,draggable:{...r.draggable,initialCoordinates:e.initialCoordinates,active:e.active}};case st.DragMove:return r.draggable.active==null?r:{...r,draggable:{...r.draggable,translate:{x:e.coordinates.x-r.draggable.initialCoordinates.x,y:e.coordinates.y-r.draggable.initialCoordinates.y}}};case st.DragEnd:case st.DragCancel:return{...r,draggable:{...r.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case st.RegisterDroppable:{const{element:t}=e,{id:n}=t,s=new ds(r.droppable.containers);return s.set(n,t),{...r,droppable:{...r.droppable,containers:s}}}case st.SetDroppableDisabled:{const{id:t,key:n,disabled:s}=e,i=r.droppable.containers.get(t);if(!i||n!==i.key)return r;const a=new ds(r.droppable.containers);return a.set(t,{...i,disabled:s}),{...r,droppable:{...r.droppable,containers:a}}}case st.UnregisterDroppable:{const{id:t,key:n}=e,s=r.droppable.containers.get(t);if(!s||n!==s.key)return r;const i=new ds(r.droppable.containers);return i.delete(t),{...r,droppable:{...r.droppable,containers:i}}}default:return r}}function KT(r){let{disabled:e}=r;const{active:t,activatorEvent:n,draggableNodes:s}=_.useContext(Is),i=Ei(n),a=Ei(t?.id);return _.useEffect(()=>{if(!e&&!n&&i&&a!=null){if(!Fo(i)||document.activeElement===i.target)return;const o=s.get(a);if(!o)return;const{activatorNode:l,node:c}=o;if(!l.current&&!c.current)return;requestAnimationFrame(()=>{for(const d of[l.current,c.current]){if(!d)continue;const u=qE(d);if(u){u.focus();break}}})}},[n,e,s,a,i]),null}function wh(r,e){let{transform:t,...n}=e;return r!=null&&r.length?r.reduce((s,i)=>i({transform:s,...n}),t):t}function YT(r){return _.useMemo(()=>({draggable:{...di.draggable,...r?.draggable},droppable:{...di.droppable,...r?.droppable},dragOverlay:{...di.dragOverlay,...r?.dragOverlay}}),[r?.draggable,r?.droppable,r?.dragOverlay])}function XT(r){let{activeNode:e,measure:t,initialRect:n,config:s=!0}=r;const i=_.useRef(!1),{x:a,y:o}=typeof s=="boolean"?{x:s,y:s}:s;Cr(()=>{if(!a&&!o||!e){i.current=!1;return}if(i.current||!n)return;const c=e?.node.current;if(!c||c.isConnected===!1)return;const d=t(c),u=sh(d,n);if(a||(u.x=0),o||(u.y=0),i.current=!0,Math.abs(u.x)>0||Math.abs(u.y)>0){const f=ah(c);f&&f.scrollBy({top:u.y,left:u.x})}},[e,a,o,n,t])}const Ji=_.createContext({...rr,scaleX:1,scaleY:1});var Fr;(function(r){r[r.Uninitialized=0]="Uninitialized",r[r.Initializing=1]="Initializing",r[r.Initialized=2]="Initialized"})(Fr||(Fr={}));const QT=_.memo(function(e){var t,n,s,i;let{id:a,accessibility:o,autoScroll:l=!0,children:c,sensors:d=zT,collisionDetection:u=aT,measuring:f,modifiers:g,...b}=e;const m=_.useReducer(GT,void 0,VT),[y,v]=m,[p,w]=QE(),[S,x]=_.useState(Fr.Uninitialized),E=S===Fr.Initialized,{draggable:{active:T,nodes:R,translate:k},droppable:{containers:O}}=y,D=T!=null?R.get(T):null,A=_.useRef({initial:null,translated:null}),P=_.useMemo(()=>{var Pe;return T!=null?{id:T,data:(Pe=D?.data)!=null?Pe:WT,rect:A}:null},[T,D]),Q=_.useRef(null),[he,H]=_.useState(null),[J,Oe]=_.useState(null),L=ws(b,Object.values(b)),Z=Xi("DndDescribedBy",a),ee=_.useMemo(()=>O.getEnabled(),[O]),Le=YT(f),{droppableRects:G,measureDroppableContainers:F,measuringScheduled:V}=AT(ee,{dragging:E,dependencies:[k.x,k.y],config:Le.droppable}),q=DT(R,T),fe=_.useMemo(()=>J?Ri(J):null,[J]),B=ir(),Ae=IT(q,Le.draggable.measure);XT({activeNode:T!=null?R.get(T):null,config:B.layoutShiftCompensation,initialRect:Ae,measure:Le.draggable.measure});const Ce=Ic(q,Le.draggable.measure,Ae),vt=Ic(q?q.parentElement:null),Ze=_.useRef({activatorEvent:null,active:null,activeNode:q,collisionRect:null,collisions:null,droppableRects:G,draggableNodes:R,draggingNode:null,draggingNodeRect:null,droppableContainers:O,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),kr=O.getNodeFor((t=Ze.current.over)==null?void 0:t.id),U=BT({measure:Le.dragOverlay.measure}),ie=(n=U.nodeRef.current)!=null?n:q,ke=E?(s=U.rect)!=null?s:Ce:null,Be=!!(U.nodeRef.current&&U.rect),ft=jT(Be?null:Ce),we=ph(ie?Ot(ie):null),K=LT(E?kr??q:null),He=HT(K),I=wh(g,{transform:{x:k.x-ft.x,y:k.y-ft.y,scaleX:1,scaleY:1},activatorEvent:J,active:P,activeNodeRect:Ce,containerNodeRect:vt,draggingNodeRect:ke,over:Ze.current.over,overlayNodeRect:U.rect,scrollableAncestors:K,scrollableAncestorRects:He,windowRect:we}),j=fe?An(fe,k):null,_e=$T(K),re=Pc(_e),Y=Pc(_e,[Ce]),ae=An(I,re),z=ke?cT(ke,I):null,me=P&&z?u({active:P,collisionRect:z,droppableRects:G,droppableContainers:ee,pointerCoordinates:j}):null,xe=sT(me,"id"),[pe,ce]=_.useState(null),nr=Be?I:An(I,Y),Xt=oT(nr,(i=pe?.rect)!=null?i:null,Ce),de=_.useRef(null),et=_.useCallback((Pe,it)=>{let{sensor:$,options:oe}=it;if(Q.current==null)return;const be=R.get(Q.current);if(!be)return;const Ee=Pe.nativeEvent,at=new $({active:Q.current,activeNode:be,event:Ee,options:oe,context:Ze,onAbort(le){if(!R.get(le))return;const{onDragAbort:Ke}=L.current,Qe={id:le};Ke?.(Qe),p({type:"onDragAbort",event:Qe})},onPending(le,mt,Ke,Qe){if(!R.get(le))return;const{onDragPending:It}=L.current,pr={id:le,constraint:mt,initialCoordinates:Ke,offset:Qe};It?.(pr),p({type:"onDragPending",event:pr})},onStart(le){const mt=Q.current;if(mt==null)return;const Ke=R.get(mt);if(!Ke)return;const{onDragStart:Qe}=L.current,Dr={activatorEvent:Ee,active:{id:mt,data:Ke.data,rect:A}};Zn.unstable_batchedUpdates(()=>{Qe?.(Dr),x(Fr.Initializing),v({type:st.DragStart,initialCoordinates:le,active:mt}),p({type:"onDragStart",event:Dr}),H(de.current),Oe(Ee)})},onMove(le){v({type:st.DragMove,coordinates:le})},onEnd:Ie(st.DragEnd),onCancel:Ie(st.DragCancel)});de.current=at;function Ie(le){return async function(){const{active:Ke,collisions:Qe,over:Dr,scrollAdjustedTranslate:It}=Ze.current;let pr=null;if(Ke&&It){const{cancelDrop:Wn}=L.current;pr={activatorEvent:Ee,active:Ke,collisions:Qe,delta:It,over:Dr},le===st.DragEnd&&typeof Wn=="function"&&await Promise.resolve(Wn(pr))&&(le=st.DragCancel)}Q.current=null,Zn.unstable_batchedUpdates(()=>{v({type:le}),x(Fr.Uninitialized),ce(null),H(null),Oe(null),de.current=null;const Wn=le===st.DragEnd?"onDragEnd":"onDragCancel";if(pr){const Zi=L.current[Wn];Zi?.(pr),p({type:Wn,event:pr})}})}}},[R]),gt=_.useCallback((Pe,it)=>($,oe)=>{const be=$.nativeEvent,Ee=R.get(oe);if(Q.current!==null||!Ee||be.dndKit||be.defaultPrevented)return;const at={active:Ee};Pe($,it.options,at)===!0&&(be.dndKit={capturedBy:it.sensor},Q.current=oe,et($,it))},[R,et]),ue=NT(d,gt);FT(d),Cr(()=>{Ce&&S===Fr.Initializing&&x(Fr.Initialized)},[Ce,S]),_.useEffect(()=>{const{onDragMove:Pe}=L.current,{active:it,activatorEvent:$,collisions:oe,over:be}=Ze.current;if(!it||!$)return;const Ee={active:it,activatorEvent:$,collisions:oe,delta:{x:ae.x,y:ae.y},over:be};Zn.unstable_batchedUpdates(()=>{Pe?.(Ee),p({type:"onDragMove",event:Ee})})},[ae.x,ae.y]),_.useEffect(()=>{const{active:Pe,activatorEvent:it,collisions:$,droppableContainers:oe,scrollAdjustedTranslate:be}=Ze.current;if(!Pe||Q.current==null||!it||!be)return;const{onDragOver:Ee}=L.current,at=oe.get(xe),Ie=at&&at.rect.current?{id:at.id,rect:at.rect.current,data:at.data,disabled:at.disabled}:null,le={active:Pe,activatorEvent:it,collisions:$,delta:{x:be.x,y:be.y},over:Ie};Zn.unstable_batchedUpdates(()=>{ce(Ie),Ee?.(le),p({type:"onDragOver",event:le})})},[xe]),Cr(()=>{Ze.current={activatorEvent:J,active:P,activeNode:q,collisionRect:z,collisions:me,droppableRects:G,draggableNodes:R,draggingNode:ie,draggingNodeRect:ke,droppableContainers:O,over:pe,scrollableAncestors:K,scrollAdjustedTranslate:ae},A.current={initial:ke,translated:z}},[P,q,me,z,R,ie,ke,G,O,pe,K,ae]),OT({...B,delta:k,draggingRect:z,pointerCoordinates:j,scrollableAncestors:K,scrollableAncestorRects:He});const Se=_.useMemo(()=>({active:P,activeNode:q,activeNodeRect:Ce,activatorEvent:J,collisions:me,containerNodeRect:vt,dragOverlay:U,draggableNodes:R,droppableContainers:O,droppableRects:G,over:pe,measureDroppableContainers:F,scrollableAncestors:K,scrollableAncestorRects:He,measuringConfiguration:Le,measuringScheduled:V,windowRect:we}),[P,q,Ce,J,me,vt,U,R,O,G,pe,F,K,He,Le,V,we]),sr=_.useMemo(()=>({activatorEvent:J,activators:ue,active:P,activeNodeRect:Ce,ariaDescribedById:{draggable:Z},dispatch:v,draggableNodes:R,over:pe,measureDroppableContainers:F}),[J,ue,P,Ce,v,Z,R,pe,F]);return N.createElement(nh.Provider,{value:w},N.createElement(Is.Provider,{value:sr},N.createElement(vh.Provider,{value:Se},N.createElement(Ji.Provider,{value:Xt},c)),N.createElement(KT,{disabled:o?.restoreFocus===!1})),N.createElement(eT,{...o,hiddenTextDescribedById:Z}));function ir(){const Pe=he?.autoScrollEnabled===!1,it=typeof l=="object"?l.enabled===!1:l===!1,$=E&&!Pe&&!it;return typeof l=="object"?{...l,enabled:$}:{enabled:$}}}),JT=_.createContext(null),Lc="button",ZT="Draggable";function eR(r){let{id:e,data:t,disabled:n=!1,attributes:s}=r;const i=Xi(ZT),{activators:a,activatorEvent:o,active:l,activeNodeRect:c,ariaDescribedById:d,draggableNodes:u,over:f}=_.useContext(Is),{role:g=Lc,roleDescription:b="draggable",tabIndex:m=0}=s??{},y=l?.id===e,v=_.useContext(y?Ji:JT),[p,w]=xi(),[S,x]=xi(),E=UT(a,e),T=ws(t);Cr(()=>(u.set(e,{id:e,key:i,node:p,activatorNode:S,data:T}),()=>{const k=u.get(e);k&&k.key===i&&u.delete(e)}),[u,e]);const R=_.useMemo(()=>({role:g,tabIndex:m,"aria-disabled":n,"aria-pressed":y&&g===Lc?!0:void 0,"aria-roledescription":b,"aria-describedby":d.draggable}),[n,g,m,y,b,d.draggable]);return{active:l,activatorEvent:o,activeNodeRect:c,attributes:R,isDragging:y,listeners:n?void 0:E,node:p,over:f,setNodeRef:w,setActivatorNodeRef:x,transform:v}}function tR(){return _.useContext(vh)}const rR="Droppable",nR={timeout:25};function sR(r){let{data:e,disabled:t=!1,id:n,resizeObserverConfig:s}=r;const i=Xi(rR),{active:a,dispatch:o,over:l,measureDroppableContainers:c}=_.useContext(Is),d=_.useRef({disabled:t}),u=_.useRef(!1),f=_.useRef(null),g=_.useRef(null),{disabled:b,updateMeasurementsFor:m,timeout:y}={...nR,...s},v=ws(m??n),p=_.useCallback(()=>{if(!u.current){u.current=!0;return}g.current!=null&&clearTimeout(g.current),g.current=setTimeout(()=>{c(Array.isArray(v.current)?v.current:[v.current]),g.current=null},y)},[y]),w=Qi({callback:p,disabled:b||!a}),S=_.useCallback((R,k)=>{w&&(k&&(w.unobserve(k),u.current=!1),R&&w.observe(R))},[w]),[x,E]=xi(S),T=ws(e);return _.useEffect(()=>{!w||!x.current||(w.disconnect(),u.current=!1,w.observe(x.current))},[x,w]),_.useEffect(()=>(o({type:st.RegisterDroppable,element:{id:n,key:i,disabled:t,node:x,rect:f,data:T}}),()=>o({type:st.UnregisterDroppable,key:i,id:n})),[n]),_.useEffect(()=>{t!==d.current.disabled&&(o({type:st.SetDroppableDisabled,id:n,key:i,disabled:t}),d.current.disabled=t)},[n,i,t,o]),{active:a,rect:f,isOver:l?.id===n,node:x,over:l,setNodeRef:E}}function iR(r){let{animation:e,children:t}=r;const[n,s]=_.useState(null),[i,a]=_.useState(null),o=Ei(t);return!t&&!n&&o&&s(o),Cr(()=>{if(!i)return;const l=n?.key,c=n?.props.id;if(l==null||c==null){s(null);return}Promise.resolve(e(c,i)).then(()=>{s(null)})},[e,n,i]),N.createElement(N.Fragment,null,t,n?_.cloneElement(n,{ref:a}):null)}const aR={x:0,y:0,scaleX:1,scaleY:1};function oR(r){let{children:e}=r;return N.createElement(Is.Provider,{value:yh},N.createElement(Ji.Provider,{value:aR},e))}const lR={position:"fixed",touchAction:"none"},cR=r=>Fo(r)?"transform 250ms ease":void 0,dR=_.forwardRef((r,e)=>{let{as:t,activatorEvent:n,adjustScale:s,children:i,className:a,rect:o,style:l,transform:c,transition:d=cR}=r;if(!o)return null;const u=s?c:{...c,scaleX:1,scaleY:1},f={...lR,width:o.width,height:o.height,top:o.top,left:o.left,transform:_s.Transform.toString(u),transformOrigin:s&&n?rT(n,o):void 0,transition:typeof d=="function"?d(n):d,...l};return N.createElement(t,{className:a,style:f,ref:e},i)}),uR=r=>e=>{let{active:t,dragOverlay:n}=e;const s={},{styles:i,className:a}=r;if(i!=null&&i.active)for(const[o,l]of Object.entries(i.active))l!==void 0&&(s[o]=t.node.style.getPropertyValue(o),t.node.style.setProperty(o,l));if(i!=null&&i.dragOverlay)for(const[o,l]of Object.entries(i.dragOverlay))l!==void 0&&n.node.style.setProperty(o,l);return a!=null&&a.active&&t.node.classList.add(a.active),a!=null&&a.dragOverlay&&n.node.classList.add(a.dragOverlay),function(){for(const[l,c]of Object.entries(s))t.node.style.setProperty(l,c);a!=null&&a.active&&t.node.classList.remove(a.active)}},hR=r=>{let{transform:{initial:e,final:t}}=r;return[{transform:_s.Transform.toString(e)},{transform:_s.Transform.toString(t)}]},fR={duration:250,easing:"ease",keyframes:hR,sideEffects:uR({styles:{active:{opacity:"0"}}})};function gR(r){let{config:e,draggableNodes:t,droppableContainers:n,measuringConfiguration:s}=r;return Yi((i,a)=>{if(e===null)return;const o=t.get(i);if(!o)return;const l=o.node.current;if(!l)return;const c=bh(a);if(!c)return;const{transform:d}=Ot(a).getComputedStyle(a),u=ih(d);if(!u)return;const f=typeof e=="function"?e:mR(e);return hh(l,s.draggable.measure),f({active:{id:i,data:o.data,node:l,rect:s.draggable.measure(l)},draggableNodes:t,dragOverlay:{node:a,rect:s.dragOverlay.measure(c)},droppableContainers:n,measuringConfiguration:s,transform:u})})}function mR(r){const{duration:e,easing:t,sideEffects:n,keyframes:s}={...fR,...r};return i=>{let{active:a,dragOverlay:o,transform:l,...c}=i;if(!e)return;const d={x:o.rect.left-a.rect.left,y:o.rect.top-a.rect.top},u={scaleX:l.scaleX!==1?a.rect.width*l.scaleX/o.rect.width:1,scaleY:l.scaleY!==1?a.rect.height*l.scaleY/o.rect.height:1},f={x:l.x-d.x,y:l.y-d.y,...u},g=s({...c,active:a,dragOverlay:o,transform:{initial:l,final:f}}),[b]=g,m=g[g.length-1];if(JSON.stringify(b)===JSON.stringify(m))return;const y=n?.({active:a,dragOverlay:o,...c}),v=o.node.animate(g,{duration:e,easing:t,fill:"forwards"});return new Promise(p=>{v.onfinish=()=>{y?.(),p()}})}}let $c=0;function pR(r){return _.useMemo(()=>{if(r!=null)return $c++,$c},[r])}const bR=N.memo(r=>{let{adjustScale:e=!1,children:t,dropAnimation:n,style:s,transition:i,modifiers:a,wrapperElement:o="div",className:l,zIndex:c=999}=r;const{activatorEvent:d,active:u,activeNodeRect:f,containerNodeRect:g,draggableNodes:b,droppableContainers:m,dragOverlay:y,over:v,measuringConfiguration:p,scrollableAncestors:w,scrollableAncestorRects:S,windowRect:x}=tR(),E=_.useContext(Ji),T=pR(u?.id),R=wh(a,{activatorEvent:d,active:u,activeNodeRect:f,containerNodeRect:g,draggingNodeRect:y.rect,over:v,overlayNodeRect:y.rect,scrollableAncestors:w,scrollableAncestorRects:S,transform:E,windowRect:x}),k=Wo(f),O=gR({config:n,draggableNodes:b,droppableContainers:m,measuringConfiguration:p}),D=k?y.setRef:void 0;return N.createElement(oR,null,N.createElement(iR,{animation:O},u&&T?N.createElement(dR,{key:T,id:u.id,ref:D,as:o,activatorEvent:d,adjustScale:e,className:l,transition:i,rect:k,style:{zIndex:c,...s},transform:R},t):null))});function Gr({label:r,options:e,selectedOptions:t,onSelectionChange:n,searchPlaceholder:s,id:i,width:a="200px"}){const[o,l]=_.useState(!1),[c,d]=_.useState(""),u=_.useRef(null);_.useEffect(()=>{const p=w=>{u.current&&!u.current.contains(w.target)&&l(!1)};return document.addEventListener("mousedown",p),()=>document.removeEventListener("mousedown",p)},[]);const f=e.filter(p=>(typeof p=="string"?p:p.label||p.value||"").toLowerCase().includes(c.toLowerCase())),g=f.length>0&&f.every(p=>t.includes(p)),b=p=>{if(p.preventDefault(),p.stopPropagation(),g){const w=t.filter(S=>!f.includes(S));n(w)}else{const w=[...new Set([...t,...f])];n(w)}},m=(p,w)=>{if(p.preventDefault(),p.stopPropagation(),t.includes(w)){const S=t.filter(x=>x!==w);n(S)}else{const S=[...t.filter(x=>x!==""),w];n(S)}},y=()=>{l(!0)},v=p=>{d(p.target.value)};return h.jsxs("div",{className:"relative",ref:u,style:{width:a},children:[h.jsxs("div",{className:"space-y-2",children:[h.jsxs(Et,{htmlFor:i,children:[r,":"]}),h.jsx(ct,{type:"text",id:i,value:c,onChange:v,onFocus:y,placeholder:s})]}),o&&e.length>0&&h.jsxs("div",{className:"absolute top-full left-0 right-0 bg-white border border-gray-300 rounded-md shadow-lg z-10 max-h-60 overflow-y-auto",children:[h.jsx("div",{className:`px-3 py-1 hover:bg-gray-100 cursor-pointer border-b border-gray-100 ${g?"bg-navy-50 text-navy-800":""}`,onMouseDown:b,children:h.jsx("div",{className:"text-xs font-bold",children:"Tutti"})}),f.map(p=>{const w=typeof p=="string"?p:p.value||p.label,S=typeof p=="string"?p:p.label||p.value;return h.jsx("div",{className:`px-3 py-1 hover:bg-gray-100 cursor-pointer border-b border-gray-100 last:border-b-0 ${t.includes(p)?"bg-navy-50 text-navy-800":""}`,onMouseDown:x=>m(x,p),children:h.jsx("div",{className:"text-xs font-normal",children:S})},w)})]})]})}const yR=new Un(Me,"machines"),vR=new Un(Me,"odp_orders"),wR=new Un(Me,"phases");Fn(yR);Fn(vR);Fn(wR);class _R extends Un{constructor(){super(Me,"machines")}async getMachinesWithFilters(e={}){return this.getAll({select:"id, machine_name, machine_type, work_center, status, capacity_per_hour, created_at, updated_at",orderBy:"machine_name",ascending:!0,...e})}async getMachinesByWorkCenter(e){return this.getByField("work_center",e,{orderBy:"machine_name"})}async getAvailableMachines(){return this.getByField("status","available",{orderBy:"machine_name"})}async updateMachineStatus(e,t){const n=["available","busy","maintenance","offline"];if(!n.includes(t))throw new Error(`Invalid status. Must be one of: ${n.join(", ")}`);return this.update(e,{status:t,updated_at:new Date().toISOString()})}async getMachineStats(){const e=await this.getAll({select:"status, work_center"}),t={total:e.length,byStatus:{},byWorkCenter:{}};return e.forEach(n=>{t.byStatus[n.status]=(t.byStatus[n.status]||0)+1,t.byWorkCenter[n.work_center]=(t.byWorkCenter[n.work_center]||0)+1}),t}}class SR extends Un{constructor(){super(Me,"odp_orders")}async getOrdersWithFilters(e={}){return this.getAll({select:"*",orderBy:"created_at",ascending:!1,...e})}async getUnscheduledOrders(e=null){const t={status:"NOT SCHEDULED"};return e&&e!=="BOTH"&&(t.work_center=e),this.filterBy(t)}async getScheduledOrders(e=null){const t={status:"SCHEDULED"};return e&&e!=="BOTH"&&(t.work_center=e),this.filterBy(t)}async scheduleOrder(e,t){return this.update(e,{...t,status:"SCHEDULED",updated_at:new Date().toISOString()})}async unscheduleOrder(e){return this.update(e,{status:"NOT SCHEDULED",scheduled_start_time:null,scheduled_end_time:null,machine_id:null,updated_at:new Date().toISOString()})}async getOrdersByDateRange(e,t,n="scheduled_start_time"){return this.getByDateRange(e,t,n)}async filterBy(e){return(await this.getAll()).filter(n=>Object.entries(e).every(([s,i])=>i==null?!0:n[s]===i))}}class xR extends Un{constructor(){super(Me,"phases")}async getPhasesWithFilters(e={}){return this.getAll({select:"*",orderBy:"phase_name",ascending:!0,...e})}async searchPhases(e,t={}){return this.search(e,["phase_name","description"],{orderBy:"phase_name",...t})}async getPhasesByWorkCenter(e){return this.getByField("work_center",e,{orderBy:"phase_name"})}}const ER=new _R,TR=new SR,RR=new xR;Fn(ER);const _h=Fn(TR);Fn(RR);const OR=(r={})=>_h.useList({orderBy:"created_at",ascending:!1,...r},{staleTime:120*1e3,onError:t=>{console.error("Failed to fetch orders:",t)}}),CR=()=>{const r=_h,{showSchedulerAlert:e}=Ve();return r.useDelete({onSuccess:()=>{e("Order deleted successfully","success")},onError:t=>{e(`Failed to delete order: ${t.message}`,"error")}})},kR=({task:r,isEditMode:e,schedulingLoading:t,conflictDialog:n})=>{gr();const{updateEntity:s}=dt();Yt("TaskPoolDataTable");const{attributes:i,listeners:a,setNodeRef:o}=eR({id:`task-${r.id}`,data:{task:r,type:"task"},disabled:!e}),l=t.taskId===r.id&&(t.isScheduling||t.isRescheduling||t.isShunting);return h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx(Te,{variant:"outline",size:"sm",className:"w-6 h-6 p-0",onClick:c=>{c.stopPropagation(),c.preventDefault()},onMouseDown:c=>{c.stopPropagation(),c.preventDefault()},onPointerDown:c=>{c.stopPropagation(),c.preventDefault()},title:`Codice Articolo: ${r.article_code||"Non specificato"}
Codice Articolo Esterno: ${r.external_article_code||"Non specificato"}
Nome Cliente: ${r.nome_cliente||"Non specificato"}
Data Consegna: ${r.delivery_date?ma(r.delivery_date):"Non impostata"}
Quantit: ${r.quantity||"Non specificata"}
Note Libere: ${r.user_notes||"Nessuna nota"}
Note ASD: ${r.asd_notes||"Nessuna nota"}
Material Global: ${r.material_availability_global||"N/A"}%
${r.scheduled_start_time?`Inizio Programmato: ${ma(r.scheduled_start_time)}`:"Non programmato"}
${r.scheduled_end_time?`Fine Programmata: ${ma(r.scheduled_end_time)}`:"Non programmato"}`,children:"i"}),e&&h.jsx("div",{ref:o,className:"drag-handle",...a,...i,title:"Trascina per programmare",style:{background:"#f3f4f6",border:"1px solid #d1d5db",minWidth:"30px",minHeight:"30px",display:"flex",alignItems:"center",justifyContent:"center",cursor:"grab",borderRadius:"4px",transition:"all 0.2s ease"},onMouseEnter:c=>{c.target.style.background="#e5e7eb",c.target.style.borderColor="#9ca3af"},onMouseLeave:c=>{c.target.style.background="#f3f4f6",c.target.style.borderColor="#d1d5db"},onClick:c=>{c.stopPropagation()},onMouseDown:c=>{c.stopPropagation()},children:h.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"currentColor",children:h.jsx("path",{d:"M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"})})}),l&&h.jsx("div",{className:"inline-flex items-center justify-center w-6 h-6",children:h.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-blue-600"})})]})};function DR(){const r=gr(),{selectedWorkCenter:e,isEditMode:t,conflictDialog:n,schedulingLoading:s}=Ve(),{entities:i,setEntities:a}=dt(),{setNodeRef:o}=sR({id:"task-pool",data:{type:"pool"}}),{data:l=[],isLoading:c,error:d,refetch:u}=OR(),f=CR(),{handleAsync:g}=Yt("TaskPoolDataTable");_.useEffect(()=>{l.length>0&&a(l)},[l,a]),_.useEffect(()=>{const w=()=>{u()};return window.addEventListener("focus",w),()=>{window.removeEventListener("focus",w)}},[u]);const b=l.length>0?l:i,m=_.useMemo(()=>{let w=b.filter(S=>S.status!=="SCHEDULED"&&S.duration>0&&S.cost>0);return e&&e!=="BOTH"&&(w=w.filter(S=>S.work_center===e)),w},[b,e]),y=_.useMemo(()=>[{header:"ODP",accessorKey:"odp_number"},{header:"Codice Articolo",accessorKey:"article_code"},{header:"Nome Cliente",accessorKey:"nome_cliente"},{header:"Durata (h)",accessorKey:"duration",cell:({row:w})=>{const S=w.original.duration;return S?Number(S).toFixed(1):"N/A"}},{header:"Costo ()",accessorKey:"cost",cell:({row:w})=>{const S=w.original.cost;return S?Number(S).toFixed(2):"N/A"}},{header:"Material ISP (%)",accessorKey:"material_availability_isp",cell:({row:w})=>{const S=w.original.material_availability_isp;if(typeof S!="number")return S||"N/A";const x=S<=39?"bg-gray-300":S<=69?"bg-yellow-400":"bg-green-400";return h.jsx("div",{className:`inline-flex items-center justify-center w-8 h-8 rounded-full ${x} text-black text-[10px] font-medium`,children:S})}},{header:"Material Lotti (%)",accessorKey:"material_availability_lotti",cell:({row:w})=>{const S=w.original.material_availability_lotti;if(typeof S!="number")return S||"N/A";const x=S<=39?"bg-gray-300":S<=69?"bg-yellow-400":"bg-green-400";return h.jsx("div",{className:`inline-flex items-center justify-center w-8 h-8 rounded-full ${x} text-black text-[10px] font-medium`,children:S})}},{header:"Material Global (%)",accessorKey:"material_availability_global",cell:({row:w})=>{const S=w.original.material_availability_global;if(typeof S!="number")return S||"N/A";const x=S<=39?"bg-gray-300":S<=69?"bg-yellow-400":"bg-green-400";return h.jsx("div",{className:`inline-flex items-center justify-center w-8 h-8 rounded-full ${x} text-black text-[10px] font-medium`,children:S})}},{header:"Note ASD",accessorKey:"asd_notes",cell:({row:w})=>{const S=w.original.asd_notes;return S?h.jsx("div",{className:"max-w-[200px] truncate text-[10px]",title:S,children:S}):"N/A"}},{header:"Gantt",id:"gantt_actions",cell:({row:w})=>h.jsx(kR,{task:w.original,isEditMode:t,schedulingLoading:s,conflictDialog:n})}],[t,s,n]),v=w=>{if(!w||!w.id){console.error("Invalid task data for editing:",w);return}r(`/backlog/${w.id}/edit`)},p=async w=>{Ka(`Sei sicuro di voler eliminare "${w.odp_number}"? Questa azione non pu essere annullata.`)&&await g(async()=>{await f.mutateAsync(w.id)},{context:"Delete Order",fallbackMessage:"Eliminazione ordine fallita"})};return h.jsxs("div",{ref:o,id:"task_pool",className:"task-pool-table-container",children:[c?h.jsxs("div",{className:"empty-state",children:[h.jsx("h3",{children:"Caricamento..."}),h.jsx("p",{children:"Recupero dati dal server..."})]}):d?h.jsxs("div",{className:"empty-state",children:[h.jsx("h3",{children:"Errore nel caricamento"}),h.jsx("p",{children:"Impossibile caricare i dati. Riprova pi tardi."})]}):h.jsx(Jd,{data:m,columns:y,onEditRow:v,onDeleteRow:p,enableGlobalSearch:!0,enableColumnVisibility:!0,enableRowSelection:!0,loading:c,emptyMessage:"No unscheduled tasks available. Tasks must have duration and cost greater than 0 to appear here.",onBulkDelete:w=>{console.log("Bulk deleting tasks:",w)},onBulkExport:w=>{console.log("Exporting tasks:",w)}}),!1]})}const NR=_.lazy(()=>hr(()=>import("./GanttChart-C0OHqhYR.js"),__vite__mapDeps([0,1,2]))),AR=()=>h.jsx("div",{className:"loading",children:"Caricamento componenti scheduler..."}),IR=({schedulingLoading:r})=>{if(!r.isScheduling&&!r.isRescheduling&&!r.isShunting&&!r.isNavigating)return null;const e=()=>r.isScheduling?"Programmazione lavoro...":r.isRescheduling?"Riprogrammazione lavoro...":r.isShunting?"Risoluzione conflitti...":r.isNavigating?"Navigazione...":"Operazione in corso...";return h.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:h.jsxs("div",{className:"bg-white rounded-lg p-6 shadow-lg flex items-center space-x-3",children:[h.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"}),h.jsx("span",{className:"text-gray-700 font-medium",children:e()})]})})},MR=(r,e)=>{const t=document.querySelector(r);if(!t){Sr("Grafico Gantt non trovato. Assicurati che il grafico sia visibile sullo schermo.");return}const n=Array.from(document.styleSheets);let s="";n.forEach(f=>{try{Array.from(f.cssRules||f.rules||[]).forEach(b=>{s+=b.cssText+`
`})}catch{}});const i=t.cloneNode(!0),a=`
    <!DOCTYPE html>
    <html>
      <head>
        <title>Grafico Gantt - ${e}</title>
        <style>
          ${s}
          body { 
            margin: 0; 
            padding: 20px; 
            font-family: Arial, sans-serif;
          }
          .calendar-section {
            width: 100%;
            overflow-x: auto;
          }
        </style>
      </head>
      <body>
        <div style="text-align: center; margin-bottom: 20px; font-size: 12px; font-weight: bold;">
          Grafico Gantt - ${e}
        </div>
        <div class="calendar-section">
          ${i.outerHTML}
        </div>
      </body>
    </html>
  `,o=new Blob([a],{type:"text/html"}),l=window.URL.createObjectURL(o),c=document.createElement("a");c.href=l;const d=new Date().toISOString().split("T")[0],u=new Date().toISOString().split("T")[1].split(".")[0].replace(/:/g,"-");c.download=`grafico-gantt-${d}-${u}.html`,document.body.appendChild(c),c.click(),document.body.removeChild(c),window.URL.revokeObjectURL(l)};function PR(){const{data:r=[],isLoading:e,error:t}=qi(),{data:n=[],isLoading:s,error:i}=Wi(),{getOdpOrdersByWorkCenter:a,getScheduledOrders:o}=dt(),{selectedWorkCenter:l,isLoading:c,isInitialized:d,isEditMode:u,toggleEditMode:f,showConflictDialog:g,schedulingLoading:b,setDragPreview:m,clearDragPreview:y,dragPreview:v}=Ve(),{scheduleTask:p,unscheduleTask:w,scheduleTaskFromSlot:S,rescheduleTaskToSlot:x,validateSlotAvailability:E}=Rs(),{init:T,cleanup:R}=zr(),k=Ye(),O=tT(Oc(zo,{activationConstraint:{distance:0}}),Oc(mh,{activationConstraint:{distance:0}})),[D,A]=_.useState(()=>{const I=new Date;return new Date(Date.UTC(I.getUTCFullYear(),I.getUTCMonth(),I.getUTCDate()))}),[P,Q]=_.useState(null),he=e||s||c,[H,J]=_.useState(null),[Oe,L]=_.useState(""),[Z,ee]=_.useState(""),[Le,G]=_.useState(""),F={workCenter:[],department:[],machineType:[],machineName:[]};function V(I,j){switch(j.type){case"SET_FILTER":return{...I,[j.payload.filterName]:j.payload.value};case"CLEAR_FILTERS":return F;default:return I}}const[q,fe]=_.useReducer(V,F);_.useEffect(()=>(d||T(),()=>{R()}),[T,d,R]);const B=_.useMemo(()=>l?l==="BOTH"?r:r.filter(I=>I.work_center===l):[],[l,r]),Ae=_.useMemo(()=>B.filter(j=>j.status==="SCHEDULED"),[B,l]),Ce=_.useMemo(()=>{if(performance.now(),!n||n.length===0)return{activeMachines:[],workCenters:[],departments:[],machineTypes:[],machineNames:[]};let I=n;l&&l!==ve.BOTH&&(I=n.filter(ce=>ce.work_center===l));const j=I.filter(ce=>ce.status===_r.ACTIVE);if(j.length===0)return{activeMachines:[],workCenters:[],departments:[],machineTypes:[],machineNames:[]};const _e=new Set,re=new Set,Y=new Set,ae=new Set;for(const ce of j)ce.work_center&&_e.add(ce.work_center),ce.department&&re.add(ce.department),ce.machine_type&&Y.add(ce.machine_type),ce.machine_name&&ae.add(ce.machine_name);const z=Array.from(_e).sort(),me=Array.from(re).sort(),xe=Array.from(Y).sort(),pe=Array.from(ae).sort();return performance.now(),{activeMachines:j,workCenters:z,departments:me,machineTypes:xe,machineNames:pe}},[n,l]),vt=_.useMemo(()=>{const{activeMachines:I}=Ce;let j=I;return q.workCenter.length>0&&(j=j.filter(_e=>q.workCenter.includes(_e.work_center))),q.department.length>0&&(j=j.filter(_e=>q.department.includes(_e.department))),q.machineType.length>0&&(j=j.filter(_e=>q.machineType.includes(_e.machine_type))),q.machineName.length>0&&(j=j.filter(_e=>q.machineName.includes(_e.machine_name))),j},[Ce,q]),Ze=_.useCallback(async(I,j="Daily")=>{const{startSchedulingOperation:_e,stopSchedulingOperation:re}=Ve.getState();try{_e("navigate");let Y;A(ae=>{if(I==="today"){const z=new Date,me=z.getUTCFullYear(),xe=z.getUTCMonth(),pe=z.getUTCDate();return Y=new Date(Date.UTC(me,xe,pe)),Y}else if(I==="prev"){if(j==="Weekly")return Y=on(R_(ae,1),{weekStartsOn:1}),Y;{const z=new Date(ae);return z.setUTCDate(z.getUTCDate()-1),Y=z,Y}}else if(I==="next"){if(j==="Weekly")return Y=on(vu(ae,1),{weekStartsOn:1}),Y;{const z=new Date(ae);return z.setUTCDate(z.getUTCDate()+1),Y=z,z}}return Y=ae,ae})}finally{re()}},[]),kr=_.useCallback(()=>{const I=new Date,j=I.getUTCFullYear(),_e=I.getUTCMonth(),re=I.getUTCDate(),Y=new Date(Date.UTC(j,_e,re));return D.getTime()===Y.getTime()?"Oggi":ht(D,"yyyy-MM-dd")},[D]),U=_.useCallback(()=>{fe({type:"CLEAR_FILTERS"})},[]),ie=_.useCallback((I,j,_e)=>{if(!I.trim())return;let re=Ae.find(Y=>Y[j]===I.trim());if(re||(re=Ae.find(Y=>Y[j]&&Y[j].toLowerCase().includes(I.trim().toLowerCase()))),!re){Jt(`Lavoro non trovato per ${_e}: ${I}`,"warning");return}ke(re,j,_e,I)},[Ae,n]),ke=_.useCallback((I,j,_e,re)=>{const Y=n.find(z=>z.id===I.scheduled_machine_id);if(!Y){Jt("Macchina non trovata per questo lavoro","error");return}if(fe({type:"SET_FILTER",payload:{filterName:"machineName",value:[Y.machine_name]}}),fe({type:"SET_FILTER",payload:{filterName:"workCenter",value:[Y.work_center]}}),fe({type:"SET_FILTER",payload:{filterName:"department",value:[Y.department]}}),fe({type:"SET_FILTER",payload:{filterName:"machineType",value:[Y.machine_type]}}),I.scheduled_start_time){const z=new Date(I.scheduled_start_time),me=z.getUTCFullYear(),xe=z.getUTCMonth(),pe=z.getUTCDate();A(new Date(Date.UTC(me,xe,pe)))}j==="odp_number"?L(""):j==="article_code"?ee(""):j==="nome_cliente"&&G("");const ae=I[j];Jt(`Lavoro trovato per ${_e} "${ae}" su ${Y.machine_name}`,"success")},[n,L,ee,G,A]),Be=_.useRef(null),ft=_.useRef(!1),we=_.useCallback(I=>{const j=I.active.data.current;j&&j.type==="task"?Q(j.task):j&&j.type==="event"&&Q(j.event)},[]),K=_.useCallback(I=>{const{over:j}=I;if(j&&j.data.current?.type==="slot"){const{machine:_e,hour:re,minute:Y,isUnavailable:ae,hasScheduledTask:z}=j.data.current;if(ae||z){J(null),y();return}const me=`${_e.id}-${re}-${Y}`;if(J(me),P){const xe=P.time_remaining||P.duration||1,pe=Math.ceil(xe*4),ce=(re-6)*4+Math.floor(Y/15);m({isActive:!0,startSlot:ce,durationSlots:pe,machineId:_e.id})}}else j&&j.data.current?.type==="next-day"?(J("next-day-drop-zone"),y()):j&&j.data.current?.type==="previous-day"?(J("previous-day-drop-zone"),y()):(J(null),y())},[P,m,y]),He=_.useCallback(async I=>{if(performance.now(),Be.current&&clearTimeout(Be.current),ft.current)return;Q(null),J(null),y();const{over:j,active:_e}=I;if(!j)return;const re=_e.data.current,Y=j.data.current;if(!(!re||!Y)){ft.current=!0;try{await new Promise(ae=>{requestAnimationFrame(async()=>{const z=performance.now();if(re.type==="task"&&Y.type==="slot"){const me=re.task,{machine:xe,hour:pe,minute:ce,isUnavailable:nr,hasScheduledTask:Xt}=Y;if(Xt)return Jt("Impossibile pianificare il lavoro su uno slot temporale occupato","error"),ae();const de=await S(me.id,xe,D,pe,ce,null,k);console.log(" SCHEDULE RESULT:",de),de?.error?Jt(de.error,"error"):de?.conflict?(console.log(" CONFLICT DETECTED - SHOWING DIALOG:",de),g(de)):console.log(" SCHEDULING SUCCESS:",de)}else if(re.type==="event"&&Y.type==="slot"){const me=re.event,{machine:xe,hour:pe,minute:ce,isUnavailable:nr,hasScheduledTask:Xt}=Y;if(Xt)return Jt("Impossibile riprogrammare il lavoro su uno slot temporale occupato","error"),ae();const de=await x(me.id,xe,D,pe,ce,k);de?.error?Jt(de.error,"error"):de?.conflict&&g(de)}else if(re.type==="event"&&Y.type==="pool"){const me=re.event;w(me.id,k)}else(re.type==="task"||re.type==="event")&&Y.type==="next-day"?Jt("Navigazione al giorno successivo completata","success"):(re.type==="task"||re.type==="event")&&Y.type==="previous-day"&&Jt("Navigazione al giorno precedente completata","success");ae()})})}catch{Jt("Si  verificato un errore durante l'operazione di trascinamento","error")}finally{ft.current=!1}}},[D,S,x,w,g]);return he?h.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:h.jsxs("div",{className:"bg-white rounded-lg p-6 shadow-lg flex items-center space-x-3",children:[h.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"}),h.jsx("span",{className:"text-gray-700 font-medium",children:"Caricamento Scheduler Produzione..."})]})}):t||i?h.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:h.jsxs("div",{className:"bg-white rounded-lg p-6 shadow-lg text-center",children:[h.jsx("div",{className:"text-red-600 mb-4",children:h.jsx("svg",{className:"w-12 h-12 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:h.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.5 0L4.268 19.5c-.77.833.192 2.5 1.732 2.5z"})})}),h.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Errore nel caricamento dei dati"}),h.jsx("p",{className:"text-gray-600 mb-4",children:t?.message||i?.message||"Errore sconosciuto"}),h.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:"Riprova"})]})}):l?h.jsxs(h.Fragment,{children:[h.jsx(IR,{schedulingLoading:b}),h.jsxs(QT,{sensors:O,onDragStart:we,onDragOver:K,onDragEnd:He,children:[h.jsxs("div",{className:`content-section ${u?"edit-mode":""}`,children:[h.jsxs("div",{className:"task-pool-header",children:[h.jsx("h2",{className:"text-lg font-semibold text-foreground",children:"Pool Lavori"}),h.jsx(Te,{variant:u?"destructive":"default",size:"sm",onClick:f,title:u?"Disabilita modalit modifica":"Abilita modalit modifica",className:"text-white",children:u?"Disabilita Modalit Modifica":"Abilita Modalit Modifica"})]}),h.jsx(DR,{}),h.jsx("div",{className:"task-pool-header",children:h.jsx("h2",{className:"text-lg font-semibold text-foreground",children:"Filtri"})}),h.jsx("div",{className:"section-controls",children:h.jsxs("div",{className:"filters-grid",children:[h.jsx("div",{className:"filters-actions-left",children:h.jsx(Te,{variant:"secondary",size:"sm",onClick:U,title:"Clear all filters",children:"Cancella Filtri"})}),h.jsx(Gr,{label:"ODP",options:Ae.map(I=>I.odp_number).filter(Boolean),selectedOptions:Oe?[Oe]:[],onSelectionChange:I=>{I.length>0?(L(I[0]),ie(I[0],"odp_number","ODP")):L("")},searchPlaceholder:"Cerca ODP...",id:"odp_filter",width:"150px"}),h.jsx(Gr,{label:"Codice Articolo",options:Ae.map(I=>I.article_code).filter(Boolean),selectedOptions:Z?[Z]:[],onSelectionChange:I=>{I.length>0?(ee(I[0]),ie(I[0],"article_code","codice articolo")):ee("")},searchPlaceholder:"Cerca Articolo...",id:"article_filter",width:"150px"}),h.jsx(Gr,{label:"Nome Cliente",options:Ae.map(I=>I.nome_cliente).filter(Boolean),selectedOptions:Le?[Le]:[],onSelectionChange:I=>{I.length>0?(G(I[0]),ie(I[0],"nome_cliente","cliente")):G("")},searchPlaceholder:"Cerca Cliente...",id:"customer_filter",width:"150px"}),h.jsx(Gr,{label:"Centro di Lavoro",options:Ce.workCenters,selectedOptions:q.workCenter,onSelectionChange:I=>fe({type:"SET_FILTER",payload:{filterName:"workCenter",value:I}}),searchPlaceholder:"Cerca Centri di Lavoro",id:"work_center_filter",width:"150px"}),h.jsx(Gr,{label:"Reparto",options:Ce.departments,selectedOptions:q.department,onSelectionChange:I=>fe({type:"SET_FILTER",payload:{filterName:"department",value:I}}),searchPlaceholder:"Cerca Reparti",id:"department_filter",width:"150px"}),h.jsx(Gr,{label:"Tipo Macchina",options:Ce.machineTypes,selectedOptions:q.machineType,onSelectionChange:I=>fe({type:"SET_FILTER",payload:{filterName:"machineType",value:I}}),searchPlaceholder:"Cerca Tipi di Macchina",id:"machine_type_filter",width:"150px"}),h.jsx(Gr,{label:"Nome Macchina",options:Ce.machineNames,selectedOptions:q.machineName,onSelectionChange:I=>fe({type:"SET_FILTER",payload:{filterName:"machineName",value:I}}),searchPlaceholder:"Cerca Nomi Macchine",id:"machine_name_filter",width:"150px"}),h.jsx("div",{className:"filters-actions-right",children:h.jsx(Te,{variant:"secondary",size:"sm",onClick:()=>MR(".calendar-section .calendar-grid-container",kr()),title:"Download exact Gantt chart as HTML file",children:"Scarica HTML"})})]})}),h.jsxs("div",{className:"calendar-section relative",children:[h.jsx(_.Suspense,{fallback:h.jsx(AR,{}),children:h.jsx(NR,{machines:vt,currentDate:D,dropTargetId:H,dragPreview:v,onNavigateToNextDay:I=>Ze("next",I),onNavigateToPreviousDay:I=>Ze("prev",I)})}),(b.isScheduling||b.isRescheduling||b.isShunting||b.isNavigating)&&h.jsx("div",{className:"absolute inset-0 bg-white z-40"})]})]}),h.jsx(bR,{children:P?h.jsx("div",{style:{background:"#1e293b",color:"#ffffff",padding:"4px 8px",borderRadius:"4px",fontSize:"10px",fontWeight:"400",zIndex:9999,position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%) rotate(3deg) scale(1.05)",border:"1px solid #2d3a4b",boxShadow:"0 8px 25px rgba(0,0,0,0.3)",pointerEvents:"none",minHeight:"15px",display:"flex",alignItems:"center",justifyContent:"center",userSelect:"none",whiteSpace:"nowrap"},children:P.odp_number}):null})]})]}):h.jsx("div",{className:"p-1 bg-white rounded shadow-sm border",children:h.jsx("div",{className:"text-center py-1 text-red-600 text-[10px]",children:"Seleziona un centro di lavoro per visualizzare i dati dello scheduler."})})}Vf.register(Gf,Kf,Yf,Xf,Qf,Jf,Zf,eg,tg);function jR(){const{data:r=[],isLoading:e,error:t}=Wi(),{data:n=[],isLoading:s,error:i}=qi(),{isInitialized:a}=Ve(),{init:o,cleanup:l}=zr(),c=e||s;_.useEffect(()=>(a||o(),()=>{l()}),[o,a,l]);const d=_.useMemo(()=>{if(c)return{};const b=r.reduce((L,Z)=>{const ee=Z.work_center||"Unknown";return L[ee]||(L[ee]={[_r.ACTIVE]:0,[_r.INACTIVE]:0,[_r.MAINTENANCE]:0}),L[ee][Z.status]=(L[ee][Z.status]||0)+1,L},{}),m=new Date,y=new Date(m),v=m.getDay(),p=v===0?6:v-1;y.setUTCDate(m.getUTCDate()-p),y.setUTCHours(0,0,0,0);const w=n.filter(L=>L.completion_date?new Date(L.completion_date)>=y:!1).length,S=n.filter(L=>L.status==="IN PROGRESS"||L.status==="SCHEDULED").length,x=n.filter(L=>L.delivery_date?new Date(L.delivery_date)<m&&(L.quantity_completed||0)<(L.quantity||0):!1).length,E=r.filter(L=>L.status===_r.ACTIVE).length,T={},R=new Date(m);R.setUTCDate(m.getUTCDate()-7);const k=new Date(m);k.setUTCDate(m.getUTCDate()+7),n.forEach(L=>{if(L.scheduled_start_time){const Z=new Date(L.scheduled_start_time);if(Z>=R&&Z<=k){const ee=Z.toISOString().split("T")[0];T[ee]=(T[ee]||0)+1}}});const O=n.filter(L=>L.scheduled_start_time?new Date(L.scheduled_start_time)>=y:!1),D=O.filter(L=>L.cost&&L.cost>0).map(L=>L.cost),A=O.filter(L=>L.duration&&L.duration>0).map(L=>L.duration),P=D.length>0?D.reduce((L,Z)=>L+Z,0)/D.length:0,Q=A.length>0?A.reduce((L,Z)=>L+Z,0)/A.length:0,he={},H={},J=["STAMPA","CONFEZIONAMENTO"],Oe=["ZANICA","BUSTO_GAROLFO"];return J.forEach(L=>{const Z=L.toLowerCase();he[Z]={},H[Z]={},Oe.forEach(ee=>{const Le=ee==="BUSTO_GAROLFO"?"busto_garolfo":ee.toLowerCase(),G=n.filter(B=>!B.work_center||!B.department?!1:B.work_center===ee&&B.department===L),F=G.filter(B=>B.cost&&B.cost>0).map(B=>B.cost),V=F.length>0?F.reduce((B,Ae)=>B+Ae,0)/F.length:0,q=G.filter(B=>B.duration&&B.duration>0).map(B=>B.duration),fe=q.length>0?q.reduce((B,Ae)=>B+Ae,0)/q.length:0;he[Z][Le]=V,H[Z][Le]=fe})}),{machinesByWorkCenter:b,completedThisWeek:w,tasksInWip:S,delayedTasks:x,activeMachines:E,totalMachines:r.length,totalOrders:n.length,tasksPerDay:T,avgWeeklyCost:P,avgWeeklyDuration:Q,weeklyOrdersCount:O.length,costMatrix:he,durationMatrix:H}},[r,n,c]),u=_.useMemo(()=>{if(!d.tasksPerDay)return null;const b=[],m=new Date;for(let y=-7;y<=7;y++){const v=new Date(m);v.setUTCDate(m.getUTCDate()+y);const p=v.toISOString().split("T")[0];b.push(p)}return{labels:b.map(y=>{const v=new Date(y);return ht(new Date(v),"dd/MM")}),datasets:[{label:"Lavori Iniziati",data:b.map(y=>d.tasksPerDay[y]||0),borderColor:"rgb(37, 99, 235)",backgroundColor:"rgba(37, 99, 235, 0.1)",tension:.4,borderWidth:2,pointBackgroundColor:"rgb(37, 99, 235)",pointBorderColor:"rgb(37, 99, 235)",pointRadius:4,pointHoverRadius:6,fill:!0}]}},[d.tasksPerDay]),f={responsive:!0,maintainAspectRatio:!1,interaction:{intersect:!1,mode:"index"},plugins:{legend:{display:!1},title:{display:!1},tooltip:{backgroundColor:"rgba(0, 0, 0, 0.8)",titleColor:"white",bodyColor:"white",borderColor:"rgba(255, 255, 255, 0.1)",borderWidth:1,cornerRadius:8,displayColors:!1}},scales:{y:{beginAtZero:!0,grid:{color:"rgba(156, 163, 175, 0.2)",drawBorder:!1},ticks:{stepSize:1,color:"rgba(156, 163, 175, 0.8)",font:{size:12,family:"Inter, sans-serif"},padding:8}},x:{grid:{color:"rgba(156, 163, 175, 0.2)",drawBorder:!1},ticks:{color:"rgba(156, 163, 175, 0.8)",font:{size:12,family:"Inter, sans-serif"},padding:8}}},elements:{point:{hoverBorderWidth:3}}},g={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom",labels:{padding:10,usePointStyle:!0,font:{size:10}}}}};return c?h.jsx("div",{className:"p-1 bg-card rounded shadow-sm border",children:h.jsx("div",{className:"text-center py-1 text-muted-foreground text-[10px]",children:"Caricamento dashboard..."})}):t||i?h.jsx("div",{className:"p-1 bg-card rounded shadow-sm border",children:h.jsxs("div",{className:"text-center py-1 text-destructive text-[10px]",children:["Errore nel caricamento dei dati: ",t?.message||i?.message]})}):h.jsxs("div",{className:"space-y-6",children:[h.jsx("div",{className:"flex justify-between items-center",children:h.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Dashboard Produzione"})}),h.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6",children:[h.jsxs(Ft,{className:"p-6",children:[h.jsx(Ut,{className:"pb-2",children:h.jsx(Ht,{className:"text-sm font-medium text-muted-foreground",children:"Macchine Totali"})}),h.jsxs(Bt,{children:[h.jsx("div",{className:"text-3xl font-bold text-foreground",children:d.totalMachines}),h.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Attive: ",d.activeMachines]})]})]}),h.jsxs(Ft,{className:"p-6",children:[h.jsx(Ut,{className:"pb-2",children:h.jsx(Ht,{className:"text-sm font-medium text-muted-foreground",children:"Ordini Totali"})}),h.jsxs(Bt,{children:[h.jsx("div",{className:"text-3xl font-bold text-foreground",children:d.totalOrders}),h.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Totali nel sistema"})]})]}),h.jsxs(Ft,{className:"p-6",children:[h.jsx(Ut,{className:"pb-2",children:h.jsx(Ht,{className:"text-sm font-medium text-muted-foreground",children:"Completati Questa Settimana"})}),h.jsxs(Bt,{children:[h.jsx("div",{className:"text-3xl font-bold text-foreground",children:d.completedThisWeek}),h.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Lavori completati"})]})]}),h.jsxs(Ft,{className:"p-6",children:[h.jsx(Ut,{className:"pb-2",children:h.jsx(Ht,{className:"text-sm font-medium text-muted-foreground",children:"Lavori in Corso"})}),h.jsxs(Bt,{children:[h.jsx("div",{className:"text-3xl font-bold text-foreground",children:d.tasksInWip}),h.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"In progress/scheduled"})]})]}),h.jsxs(Ft,{className:"p-6 border-destructive/20 bg-destructive/5",children:[h.jsx(Ut,{className:"pb-2",children:h.jsx(Ht,{className:"text-sm font-medium text-destructive",children:"Lavori Ritardati"})}),h.jsxs(Bt,{children:[h.jsx("div",{className:"text-3xl font-bold text-destructive",children:d.delayedTasks}),h.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Oltre la scadenza"})]})]})]}),h.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[h.jsxs(Ft,{className:"p-6",children:[h.jsx(Ut,{className:"pb-2",children:h.jsx(Ht,{className:"text-sm font-medium text-muted-foreground",children:"Ordini Settimanali"})}),h.jsxs(Bt,{children:[h.jsx("div",{className:"text-3xl font-bold text-foreground",children:d.weeklyOrdersCount}),h.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Questa Settimana"})]})]}),h.jsxs(Ft,{className:"p-6",children:[h.jsx(Ut,{className:"pb-2",children:h.jsx(Ht,{className:"text-sm font-medium text-muted-foreground",children:"Costo Medio"})}),h.jsxs(Bt,{children:[h.jsxs("div",{className:"text-3xl font-bold text-foreground",children:["",d.avgWeeklyCost.toFixed(2)]}),h.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Per Lavoro Questa Settimana"})]})]}),h.jsxs(Ft,{className:"p-6",children:[h.jsx(Ut,{className:"pb-2",children:h.jsx(Ht,{className:"text-sm font-medium text-muted-foreground",children:"Durata Media"})}),h.jsxs(Bt,{children:[h.jsxs("div",{className:"text-3xl font-bold text-foreground",children:[d.avgWeeklyDuration.toFixed(1),"h"]}),h.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Per Lavoro Questa Settimana"})]})]})]}),h.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[h.jsxs(Ft,{children:[h.jsx(Ut,{children:h.jsxs("div",{className:"flex items-center justify-between",children:[h.jsx(Ht,{children:"Lavori Iniziati per Giorno (14 giorni)"}),h.jsx("div",{className:"flex items-center gap-3 text-xs",children:h.jsxs("div",{className:"flex items-center gap-1",children:[h.jsx("span",{className:"inline-block w-3 h-1 bg-primary"})," Lavori"]})})]})}),h.jsx(Bt,{children:h.jsx("div",{className:"h-64",children:u&&h.jsx(rg,{data:u,options:f,height:256})})})]}),h.jsxs(Ft,{children:[h.jsx(Ut,{children:h.jsx(Ht,{children:"Macchine per Centro di Lavoro e Stato"})}),h.jsx(Bt,{children:h.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:Object.entries(d.machinesByWorkCenter||{}).map(([b,m])=>{const y={labels:Object.keys(m).map(v=>v.charAt(0).toUpperCase()+v.slice(1).toLowerCase()),datasets:[{data:Object.values(m),backgroundColor:["rgba(37, 99, 235, 0.8)","rgba(107, 114, 128, 0.8)","rgba(156, 163, 175, 0.8)"],borderColor:["rgba(37, 99, 235, 1)","rgba(107, 114, 128, 1)","rgba(156, 163, 175, 1)"],borderWidth:2}]};return h.jsxs("div",{className:"text-center",children:[h.jsx("h4",{className:"text-sm font-medium text-foreground mb-2",children:b}),h.jsx("div",{className:"h-32",children:h.jsx(ng,{data:y,options:g,height:150})}),h.jsx("div",{className:"text-xs text-muted-foreground mt-2",children:Object.entries(m).map(([v,p])=>h.jsxs("div",{className:"flex items-center justify-center gap-1 mb-1",children:[h.jsx("span",{className:"w-2 h-2 rounded-full",style:{backgroundColor:v==="ACTIVE"?"rgba(37, 99, 235, 0.8)":v==="INACTIVE"?"rgba(107, 114, 128, 0.8)":"rgba(156, 163, 175, 0.8)"}}),h.jsxs("span",{children:[v,": ",p]})]},v))})]},b)})})})]})]}),h.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[h.jsxs(Ft,{children:[h.jsx(Ut,{children:h.jsx(Ht,{children:"Costo Medio per Centro di Lavoro e Reparto"})}),h.jsx(Bt,{children:h.jsx("div",{className:"overflow-x-auto",children:h.jsxs("table",{className:"w-full",children:[h.jsx("thead",{children:h.jsxs("tr",{className:"border-b border-border",children:[h.jsx("th",{className:"text-left py-2 px-2 text-sm font-medium text-muted-foreground"}),h.jsx("th",{className:"text-left py-2 px-2 text-sm font-medium text-muted-foreground",children:"ZANICA"}),h.jsx("th",{className:"text-left py-2 px-2 text-sm font-medium text-muted-foreground",children:"BUSTO GAROLFO"})]})}),h.jsxs("tbody",{children:[h.jsxs("tr",{className:"border-b border-border",children:[h.jsx("td",{className:"py-2 px-2 text-sm font-medium text-muted-foreground",children:"STAMPA"}),h.jsxs("td",{className:"py-2 px-2 text-sm text-foreground",children:["",d.costMatrix?.stampa?.zanica?.toFixed(2)||"0.00"]}),h.jsxs("td",{className:"py-2 px-2 text-sm text-foreground",children:["",d.costMatrix?.stampa?.busto_garolfo?.toFixed(2)||"0.00"]})]}),h.jsxs("tr",{children:[h.jsx("td",{className:"py-2 px-2 text-sm font-medium text-muted-foreground",children:"CONFEZIONAMENTO"}),h.jsxs("td",{className:"py-2 px-2 text-sm text-foreground",children:["",d.costMatrix?.confezionamento?.zanica?.toFixed(2)||"0.00"]}),h.jsxs("td",{className:"py-2 px-2 text-sm text-foreground",children:["",d.costMatrix?.confezionamento?.busto_garolfo?.toFixed(2)||"0.00"]})]})]})]})})})]}),h.jsxs(Ft,{children:[h.jsx(Ut,{children:h.jsx(Ht,{children:"Durata Media per Centro di Lavoro e Reparto"})}),h.jsx(Bt,{children:h.jsx("div",{className:"overflow-x-auto",children:h.jsxs("table",{className:"w-full",children:[h.jsx("thead",{children:h.jsxs("tr",{className:"border-b border-border",children:[h.jsx("th",{className:"text-left py-2 px-2 text-sm font-medium text-muted-foreground"}),h.jsx("th",{className:"text-left py-2 px-2 text-sm font-medium text-muted-foreground",children:"ZANICA"}),h.jsx("th",{className:"text-left py-2 px-2 text-sm font-medium text-muted-foreground",children:"BUSTO GAROLFO"})]})}),h.jsxs("tbody",{children:[h.jsxs("tr",{className:"border-b border-border",children:[h.jsx("td",{className:"py-2 px-2 text-sm font-medium text-muted-foreground",children:"STAMPA"}),h.jsxs("td",{className:"py-2 px-2 text-sm text-foreground",children:[d.durationMatrix?.stampa?.zanica?.toFixed(1)||"0.0","h"]}),h.jsxs("td",{className:"py-2 px-2 text-sm text-foreground",children:[d.durationMatrix?.stampa?.busto_garolfo?.toFixed(1)||"0.0","h"]})]}),h.jsxs("tr",{children:[h.jsx("td",{className:"py-2 px-2 text-sm font-medium text-muted-foreground",children:"CONFEZIONAMENTO"}),h.jsxs("td",{className:"py-2 px-2 text-sm text-foreground",children:[d.durationMatrix?.confezionamento?.zanica?.toFixed(1)||"0.0","h"]}),h.jsxs("td",{className:"py-2 px-2 text-sm text-foreground",children:[d.durationMatrix?.confezionamento?.busto_garolfo?.toFixed(1)||"0.0","h"]})]})]})]})})})]})]})]})}function LR(){const[r,e]=_.useState({email:"",password:"",workCenter:""}),[t,n]=_.useState({}),[s,i]=_.useState(!1),{signIn:a,error:o}=dn(),{setSelectedWorkCenter:l}=Ve(),c=gr(),{handleAsync:d}=Yt("LoginPage"),u=m=>{const{name:y,value:v}=m.target;e(p=>({...p,[y]:v})),t[y]&&n(p=>({...p,[y]:""}))},f=()=>{const m={};return r.email?/\S+@\S+\.\S+/.test(r.email)||(m.email="Email non valida"):m.email="Email richiesta",r.password||(m.password="Password richiesta"),r.workCenter||(m.workCenter="Centro di lavoro richiesto"),m},g=async m=>{m.preventDefault();const y=f();if(Object.keys(y).length>0){n(y);return}i(!0),n({}),await d(async()=>{(await a(r.email,r.password)).error||(l(r.workCenter),c("/",{replace:!0}))},{context:"Login",fallbackMessage:"Accesso fallito. Riprova.",onFinally:()=>i(!1)})},b=m=>t[m]?h.jsx("span",{className:"text-sm text-red-600",children:t[m]}):null;return h.jsx("div",{className:"min-h-screen flex",children:h.jsxs("div",{className:"container relative grid flex-col items-center justify-center sm:max-w-none lg:grid-cols-2 lg:px-0",children:[h.jsxs("div",{className:"relative hidden h-full flex-col bg-muted p-10 text-white dark:border-r lg:flex",children:[h.jsx("div",{className:"absolute inset-0 bg-primary"}),h.jsxs("div",{className:"relative z-20 flex items-center text-lg font-medium",children:[h.jsx("img",{className:"h-6 mr-2",src:"/scheduler-logo.png",alt:"Scheduler"}),"Scheduler"]})]}),h.jsx("div",{className:"lg:p-8",children:h.jsxs("div",{className:"mx-auto flex w-full flex-col justify-center space-y-6 sm:w-[350px]",children:[h.jsx("div",{className:"flex flex-col space-y-2 text-center",children:h.jsx("h1",{className:"text-2xl font-semibold tracking-tight",children:"Accedi"})}),h.jsxs("form",{className:"space-y-8",onSubmit:g,children:[o&&h.jsx("div",{className:"p-3 text-sm text-red-600 bg-red-50 border border-red-200 rounded-md",children:o}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Et,{htmlFor:"email",children:"Indirizzo Email"}),h.jsx(ct,{id:"email",name:"email",type:"email",value:r.email,onChange:u,placeholder:"Inserisci la tua email",className:t.email?"border-red-500":"",disabled:s,autoComplete:"email"}),b("email")]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Et,{htmlFor:"password",children:"Password"}),h.jsx(ct,{id:"password",name:"password",type:"password",value:r.password,onChange:u,placeholder:"Inserisci la tua password",className:t.password?"border-red-500":"",disabled:s,autoComplete:"current-password"}),b("password")]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Et,{htmlFor:"workCenter",children:"Centro di Lavoro"}),h.jsxs("select",{id:"workCenter",name:"workCenter",value:r.workCenter,onChange:u,className:`flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 ${t.workCenter?"border-red-500":""}`,children:[h.jsx("option",{value:"",children:"Seleziona un centro di lavoro"}),h.jsx("option",{value:ve.ZANICA,children:ve.ZANICA}),h.jsx("option",{value:ve.BUSTO_GAROLFO,children:ve.BUSTO_GAROLFO}),h.jsx("option",{value:ve.BOTH,children:ve.BOTH})]}),b("workCenter")]}),h.jsx(Te,{type:"submit",className:"w-full cursor-pointer",disabled:s,children:s?"Accesso in corso...":"Accedi"})]}),h.jsx(Nt,{to:"/forgot-password",className:"text-sm text-center hover:underline",children:"Password dimenticata?"}),!1]})})]})})}function $R(){const[r,e]=_.useState({email:"",password:"",confirmPassword:"",firstName:"",lastName:""}),[t,n]=_.useState(!1),[s,i]=_.useState({}),{signUp:a,error:o}=dn(),l=gr(),{handleAsync:c}=Yt("SignupPage"),d=b=>{const{name:m,value:y}=b.target;e(v=>({...v,[m]:y})),s[m]&&i(v=>({...v,[m]:""}))},u=()=>{const b={};return r.email.trim()?/\S+@\S+\.\S+/.test(r.email)||(b.email="Inserisci un indirizzo email valido"):b.email="Email richiesta",r.password?r.password.length<6&&(b.password="La password deve essere di almeno 6 caratteri"):b.password="Password richiesta",r.confirmPassword?r.password!==r.confirmPassword&&(b.confirmPassword="Le password non coincidono"):b.confirmPassword="Conferma la tua password",r.firstName.trim()||(b.firstName="Nome richiesto"),r.lastName.trim()||(b.lastName="Cognome richiesto"),i(b),Object.keys(b).length===0},f=async b=>{b.preventDefault(),u()&&(n(!0),await c(async()=>{const m={first_name:r.firstName,last_name:r.lastName,full_name:`${r.firstName} ${r.lastName}`};(await a(r.email,r.password,m)).error||l("/",{replace:!0})},{context:"Signup",fallbackMessage:"Creazione account fallita. Riprova.",onFinally:()=>n(!1)}))},g=b=>s[b]?h.jsx("span",{className:"error-message",style:{color:"red",fontSize:"12px",marginTop:"4px"},children:s[b]}):null;return h.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 py-6 px-2 sm:px-6 lg:px-8",children:h.jsxs("div",{className:"max-w-md w-full space-y-4",children:[h.jsxs("div",{className:"text-center",children:[h.jsx("h1",{className:"text-[10px] font-bold text-gray-900",children:"Crea Account"}),h.jsx("p",{className:"mt-2 text-[10px] text-gray-600",children:"Registrati per iniziare con il tuo account"})]}),h.jsxs("form",{onSubmit:f,className:"mt-4 space-y-4",children:[h.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:[h.jsxs("div",{className:"space-y-2",children:[h.jsx(Et,{htmlFor:"firstName",children:"Nome"}),h.jsx(ct,{type:"text",id:"firstName",name:"firstName",value:r.firstName,onChange:d,placeholder:"Inserisci il tuo nome",className:s.firstName?"border-red-500":"",disabled:t,autoComplete:"given-name"}),g("firstName")]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Et,{htmlFor:"lastName",children:"Cognome"}),h.jsx(ct,{type:"text",id:"lastName",name:"lastName",value:r.lastName,onChange:d,placeholder:"Inserisci il tuo cognome",className:s.lastName?"border-red-500":"",disabled:t,autoComplete:"family-name"}),g("lastName")]})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Et,{htmlFor:"email",children:"Indirizzo Email"}),h.jsx(ct,{type:"email",id:"email",name:"email",value:r.email,onChange:d,placeholder:"Inserisci la tua email",className:s.email?"border-red-500":"",disabled:t,autoComplete:"email"}),g("email")]}),h.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:[h.jsxs("div",{className:"space-y-2",children:[h.jsx(Et,{htmlFor:"password",children:"Password"}),h.jsx(ct,{type:"password",id:"password",name:"password",value:r.password,onChange:d,placeholder:"Crea una password",className:s.password?"border-red-500":"",disabled:t,autoComplete:"new-password"}),g("password")]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Et,{htmlFor:"confirmPassword",children:"Conferma Password"}),h.jsx(ct,{type:"password",id:"confirmPassword",name:"confirmPassword",value:r.confirmPassword,onChange:d,placeholder:"Conferma la tua password",className:s.confirmPassword?"border-red-500":"",disabled:t,autoComplete:"new-password"}),g("confirmPassword")]})]}),o&&h.jsx("div",{className:"bg-red-50 border border-red-200 rounded-md p-1",children:h.jsxs("div",{className:"flex",children:[h.jsx("div",{className:"flex-shrink-0",children:h.jsx("span",{className:"text-red-400",children:""})}),h.jsx("div",{className:"ml-3",children:h.jsx("p",{className:"text-[10px] text-red-800",children:o})})]})}),h.jsx(Te,{type:"submit",size:"sm",className:"w-full text-white",disabled:t,children:t?"Creazione Account...":"Crea Account"})]}),h.jsxs("div",{className:"text-center space-y-4",children:[h.jsxs("div",{className:"relative",children:[h.jsx("div",{className:"absolute inset-0 flex items-center",children:h.jsx("div",{className:"w-full border-t border-gray-300"})}),h.jsx("div",{className:"relative flex justify-center text-[10px]",children:h.jsx("span",{className:"px-1 bg-gray-50 text-gray-500",children:"Hai gi un account?"})})]}),h.jsx(Nt,{to:"/login",children:h.jsx(Te,{variant:"outline",size:"sm",className:"w-full text-gray-900",children:"Accedi"})})]})]})})}function FR(){const[r,e]=_.useState(""),[t,n]=_.useState(!1),[s,i]=_.useState(!1),[a,o]=_.useState(""),{resetPassword:l}=dn(),{handleAsync:c}=Yt("ForgotPasswordPage"),d=async u=>{if(u.preventDefault(),!r.trim()){o("Inserisci il tuo indirizzo email");return}if(!/\S+@\S+\.\S+/.test(r)){o("Inserisci un indirizzo email valido");return}n(!0),o(""),await c(async()=>{const f=await l(r);f.error?o(f.error||"Invio email di reset fallito"):i(!0)},{context:"Password Reset",fallbackMessage:"Invio email di reset fallito. Riprova.",onFinally:()=>n(!1)})};return s?h.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-2 sm:px-6 lg:px-8",children:h.jsxs("div",{className:"max-w-md w-full space-y-4",children:[h.jsxs("div",{className:"text-center",children:[h.jsx("h1",{className:"text-[10px] font-bold text-gray-900",children:"Controlla la Tua Email"}),h.jsxs("p",{className:"mt-2 text-[10px] text-gray-600",children:["Abbiamo inviato un link per il reset della password a ",r]})]}),h.jsx("div",{className:"bg-green-50 border border-green-200 rounded-md p-1",children:h.jsxs("div",{className:"flex",children:[h.jsx("div",{className:"flex-shrink-0",children:h.jsx("span",{className:"text-green-400 text-[10px]",children:""})}),h.jsx("div",{className:"ml-3",children:h.jsx("p",{className:"text-[10px] text-green-800",children:"Se non vedi l'email, controlla la cartella spam."})})]})}),h.jsx("div",{className:"text-center",children:h.jsx(Nt,{to:"/login",children:h.jsx(Te,{size:"sm",className:"w-full",children:"Torna all'Accesso"})})})]})}):h.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 py-6 px-2 sm:px-6 lg:px-8",children:h.jsxs("div",{className:"max-w-md w-full space-y-4",children:[h.jsxs("div",{className:"text-center",children:[h.jsx("h1",{className:"text-[10px] font-bold text-gray-900",children:"Reset Password"}),h.jsx("p",{className:"mt-2 text-[10px] text-gray-600",children:"Inserisci la tua email per ricevere un link per il reset della password"})]}),h.jsxs("form",{onSubmit:d,className:"mt-4 space-y-4",children:[h.jsxs("div",{className:"space-y-2",children:[h.jsx(Et,{htmlFor:"email",children:"Indirizzo Email"}),h.jsx(ct,{type:"email",id:"email",name:"email",value:r,onChange:u=>e(u.target.value),placeholder:"Inserisci la tua email",disabled:t,autoComplete:"email"})]}),a&&h.jsx("div",{className:"bg-red-50 border border-red-200 rounded-md p-1",children:h.jsxs("div",{className:"flex",children:[h.jsx("div",{className:"flex-shrink-0",children:h.jsx("span",{className:"text-red-400",children:""})}),h.jsx("div",{className:"ml-3",children:h.jsx("p",{className:"text-[10px] text-red-800",children:a})})]})}),h.jsx(Te,{type:"submit",size:"sm",className:"w-full",disabled:t,children:t?"Invio...":"Invia Link di Reset"})]}),h.jsx("div",{className:"text-center",children:h.jsx(Nt,{to:"/login",className:"text-[10px] text-navy-800 hover:text-navy-600",children:"Torna all'Accesso"})})]})})}const UR=`
  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }
`;if(typeof document<"u"){const r=document.createElement("style");r.textContent=UR,document.head.appendChild(r)}const HR=()=>{const{user:r,loading:e}=dn();return e?h.jsx("div",{className:"auth-loading",style:{padding:"20px",textAlign:"center"},children:h.jsxs("div",{className:"auth-loading__container",children:[h.jsx("div",{className:"auth-loading__spinner",style:{border:"4px solid #f3f3f3",borderTop:"4px solid #3498db",borderRadius:"50%",width:"40px",height:"40px",animation:"spin 2s linear infinite",margin:"0 auto 10px"}}),h.jsx("p",{children:"Checking authentication..."})]})}):r?h.jsx(ud,{}):h.jsx(dd,{to:"/login",replace:!0})},BR=()=>{const{forms:r,modals:e,hideConfirmDialog:t,conflictDialog:n,hideConflictDialog:s,showConflictDialog:i,schedulingLoading:a,selectedWorkCenter:o}=Ve(),l={...r.confirmDialog||{},isOpen:e.confirmDialog||!1},{cleanup:c}=zr(),d=Rs(),{resolveConflictByShunting:u,scheduleTaskFromSlot:f}=d,{user:g,signOut:b}=dn(),m=Ye();LS();const y=async v=>{if(n.details){try{if(!u||typeof u!="function"){console.error(" CONFLICT ERROR: resolveConflictByShunting is not available",{resolveConflictByShunting:u,schedulerStore:d,storeKeys:Object.keys(d||{})}),Sr("Funzione di risoluzione conflitti non disponibile"),s();return}const p=n.details.schedulingParams?n.details.schedulingParams.originalConflict:n.details;console.log(" CONFLICT: Using resolveConflictByShunting",v,{conflictData:p,functionAvailable:typeof u});const w=await u(p,v,m);w&&w.error?Sr(w.error):cn(`Task spostato con successo verso ${v==="left"?"sinistra":"destra"}`)}catch(p){console.error(" SHUNTING ERROR:",p),Sr("Errore durante lo spostamento del task")}s()}};return _.useEffect(()=>()=>{c()},[c]),h.jsxs("div",{className:"flex h-screen bg-background overflow-hidden",children:[h.jsx(uw,{}),h.jsxs("div",{className:"flex-1 flex flex-col min-w-0",children:[h.jsx(gw,{}),h.jsx("main",{className:"flex-1 overflow-auto bg-background min-w-0 p-4",id:"main-content",children:h.jsx("div",{className:"max-w-full",children:h.jsx(ud,{})})})]}),h.jsx(Pg,{position:"top-right",richColors:!0,closeButton:!0,duration:4e3}),l.isOpen&&(confirm(`${l.title}

${l.message}`)&&l.onConfirm?.(),t(),null),n.isOpen&&n.details&&h.jsx("div",{className:"fixed top-4 right-4 z-50 bg-white border border-orange-200 rounded-lg shadow-xl p-4 max-w-md transform transition-all duration-300 ease-in-out",children:h.jsxs("div",{className:"flex items-start space-x-3",children:[h.jsx("div",{className:"flex-shrink-0",children:h.jsx("div",{className:"w-8 h-8 bg-orange-100 rounded-full flex items-center justify-center",children:h.jsx("svg",{className:"w-5 h-5 text-orange-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:h.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.5 0L4.268 19.5c-.77.833.192 2.5 1.732 2.5z"})})})}),h.jsxs("div",{className:"flex-1",children:[h.jsx("h3",{className:"text-sm font-medium text-gray-900 mb-1",children:"Conflitto Rilevato"}),h.jsxs("p",{className:"text-sm text-gray-600 mb-3",children:["Il lavoro ",h.jsx("span",{className:"font-semibold text-orange-600",children:n.details.draggedTask?.odp_number})," si sovrappone con ",h.jsx("span",{className:"font-semibold text-orange-600",children:n.details.conflictingTask?.odp_number}),".",h.jsx("br",{}),"Dove vuoi spostarlo?"]}),h.jsxs("div",{className:"flex space-x-2",children:[h.jsx(Te,{onClick:()=>y("left"),variant:"default",size:"sm",children:" Sposta a Sinistra"}),h.jsx(Te,{onClick:()=>y("right"),variant:"default",size:"sm",children:"Sposta a Destra "}),h.jsx(Te,{onClick:()=>s(),variant:"outline",size:"sm",children:"Annulla"})]})]})]})})]})};function zR(){return h.jsx(Nv,{children:h.jsx(Vv,{children:h.jsxs(sg,{children:[h.jsx(ot,{path:"/login",element:h.jsx(LR,{})}),h.jsx(ot,{path:"/signup",element:h.jsx($R,{})}),h.jsx(ot,{path:"/forgot-password",element:h.jsx(FR,{})}),h.jsx(ot,{path:"/",element:h.jsx(HR,{}),children:h.jsxs(ot,{element:h.jsx(BR,{}),children:[h.jsx(ot,{index:!0,element:h.jsx(jR,{})}),h.jsx(ot,{path:"machinery",element:h.jsx($S,{})}),h.jsx(ot,{path:"machinery/add",element:h.jsx(pc,{})}),h.jsx(ot,{path:"machinery/:id/edit",element:h.jsx(pc,{})}),h.jsx(ot,{path:"machinery/:machineId/calendar",element:h.jsx(LE,{})}),h.jsx(ot,{path:"phases",element:h.jsx($E,{})}),h.jsx(ot,{path:"phases/add",element:h.jsx(Ec,{})}),h.jsx(ot,{path:"phases/:id/edit",element:h.jsx(Ec,{})}),h.jsx(ot,{path:"backlog",element:h.jsx(UE,{})}),h.jsx(ot,{path:"backlog/add",element:h.jsx(Tc,{})}),h.jsx(ot,{path:"backlog/:id/edit",element:h.jsx(Tc,{})}),h.jsx(ot,{path:"scheduler",element:h.jsx(PR,{})})]})}),h.jsx(ot,{path:"*",element:h.jsx(dd,{to:"/",replace:!0})})]})})})}const WR=new og({defaultOptions:{queries:{staleTime:300*1e3,gcTime:600*1e3,retry:1,refetchOnWindowFocus:!1},mutations:{retry:1}}}),qR="/scheduler_demo/";ig.createRoot(document.getElementById("root")).render(h.jsx(N.StrictMode,{children:h.jsx(lg,{client:WR,children:h.jsx(ag,{basename:qR,children:h.jsx(dw,{children:h.jsx(zR,{})})})})}));export{mw as A,Te as B,Ts as a,dt as b,eO as c,Rs as d,on as e,ht as f,Ve as g,eR as h,w0 as n,rc as s,yt as t,sR as u};
